import{b as bt,r as u,j as e,M as Bn,S as zn,D as Gn,P as ht,d as Ot,T as _s,e as Se,C as Ee,f as Vn,Z as Ye,E as mt,g as Ft,G as hs,I as pt,A as Te,h as Ce,i as gt,k as et,l as Ut,m as Ra,n as ps,o as Hn,F as De,B as $n,X as Le,p as ft,q as $e,t as ns,U as gs,u as Ma,v as ka,w as is,x as Aa,y as Xn,z as Yn,H as Zn,J as Ia,K as ta,L as Wn,N as Da,O as La,Q as qn,V as Qn,W as Kn,Y as Jn,_ as ei,$ as Ue,a0 as Oa,a1 as Fa,a2 as ti,a3 as pr,a4 as kt,a5 as si,a6 as Ua,a7 as ri,a8 as sa,a9 as or,aa as gr,ab as ai,ac as ni,ad as ii,ae as li,af as ls,ag as oi,ah as ci,ai as di,aj as mi,ak as ui,al as xi,am as hi,an as ra,ao as pi,ap as gi,aq as fi,ar as bi,as as yi}from"./react-vendor-97d11c3b.js";import{d as yt,p as Bt,s as vi}from"./state-management-20d2eddd.js";import{P as Ni,F as ji,C as fr,T as Ge,D as aa,O as br,a as ut,S as wi,b as Ei,u as Si,c as _i,V as qe,G as Ti,L as Ba}from"./three-3d-6e33c3e4.js";import"./index-f8780648.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();var Pi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function Ci(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const je=bt(yt(Bt((t,a)=>({printers:[],activePrinterId:null,addPrinter:r=>{const s={id:crypto.randomUUID(),name:r.name||"New Printer",model:r.model||"Unknown Model",firmware:r.firmware||"Unknown Firmware",bedSize:r.bedSize||{x:220,y:220,z:250},calibrationSteps:r.calibrationSteps||{},firmwareConfiguration:r.firmwareConfiguration||{},printerSettings:r.printerSettings||{units:{linear:"mm",temperature:"C"},filament:{diameter:1.75,type:"PLA"},stepsPerUnit:{x:80,y:80,z:400,e:93},feedrates:{x:500,y:500,z:5,e:25},acceleration:{max:1e3,print:1e3,retract:1e3,travel:1e3,jerk:{x:0,y:0,z:0,e:0}},homeOffset:{x:0,y:0,z:0},bedLeveling:{enabled:!1,mesh:[],fadeHeight:10},materialHeating:{pla:{hotend:200,bed:60},abs:{hotend:240,bed:100},petg:{hotend:230,bed:80}},pid:{hotend:{p:21.73,i:1.54,d:73.76},bed:{p:301.25,i:24.2,d:73.76}},powerLossRecovery:!0,zProbeOffset:{x:0,y:0,z:0},linearAdvance:0,filamentLoadUnload:{loadLength:0,unloadLength:0},lastUpdated:null},slicerProfiles:r.slicerProfiles||{curaPath:"",profiles:[],materials:[]},macros:r.macros||[],calibrationHistory:r.calibrationHistory||[],...r};t(i=>({printers:[...i.printers,s],activePrinterId:s.id}))},addMacro:(r,s)=>{const i={id:crypto.randomUUID(),name:s.name||"New Macro",description:s.description||"",commands:s.commands||[],isFavorite:!!s.isFavorite,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t(n=>({printers:n.printers.map(l=>l.id===r?{...l,macros:[...l.macros||[],i]}:l)}))},updateMacro:(r,s,i)=>{t(n=>({printers:n.printers.map(l=>l.id===r?{...l,macros:(l.macros||[]).map(c=>c.id===s?{...c,...i,updatedAt:new Date().toISOString()}:c)}:l)}))},deleteMacro:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,macros:(n.macros||[]).filter(l=>l.id!==s)}:n)}))},updatePrinter:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,...s}:n)}))},updatePrinterSettings:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,printerSettings:{...n.printerSettings,...s,lastUpdated:new Date().toISOString()}}:n)}))},deletePrinter:r=>{t(s=>{const i=s.printers.filter(l=>l.id!==r);let n=s.activePrinterId;return s.activePrinterId===r&&(n=i.length>0?i[0].id:null),{printers:i,activePrinterId:n}})},setActivePrinter:r=>{t({activePrinterId:r})},updateCalibrationStep:(r,s,i)=>{t(n=>({printers:n.printers.map(l=>{var c;return l.id===r?{...l,calibrationSteps:{...l.calibrationSteps,[s]:{...l.calibrationSteps[s],...i,lastUpdated:new Date().toISOString(),activeTab:i.activeTab||((c=l.calibrationSteps[s])==null?void 0:c.activeTab)||"Instructions"}},calibrationHistory:[...l.calibrationHistory||[],{id:crypto.randomUUID(),stepId:s,timestamp:new Date().toISOString(),results:i.results||null,inputs:i.inputValues||null}]}:l})}))},addIssue:(r,s)=>{const i={id:`issue_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),status:"open",resolvedTimestamp:null,followUpActions:[],...s};return t(n=>({printers:n.printers.map(l=>l.id===r?{...l,issues:[...l.issues||[],i]}:l)})),i.id},updateIssue:(r,s,i)=>{t(n=>({printers:n.printers.map(l=>{var c;return l.id===r?{...l,issues:((c=l.issues)==null?void 0:c.map(o=>o.id===s?{...o,...i,...i.status==="resolved"&&o.status!=="resolved"?{resolvedTimestamp:new Date().toISOString()}:{},...i.status!=="resolved"&&o.status==="resolved"?{resolvedTimestamp:null}:{}}:o))||[]}:l})}))},deleteIssue:(r,s)=>{t(i=>({printers:i.printers.map(n=>{var l;return n.id===r?{...n,issues:((l=n.issues)==null?void 0:l.filter(c=>c.id!==s))||[]}:n})}))},addFollowUpAction:(r,s,i)=>{const n={id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,description:i,completed:!1,timestamp:new Date().toISOString()};t(l=>({printers:l.printers.map(c=>{var o;return c.id===r?{...c,issues:((o=c.issues)==null?void 0:o.map(d=>d.id===s?{...d,followUpActions:[...d.followUpActions,n]}:d))||[]}:c})}))},updateFollowUpAction:(r,s,i,n)=>{t(l=>({printers:l.printers.map(c=>{var o;return c.id===r?{...c,issues:((o=c.issues)==null?void 0:o.map(d=>d.id===s?{...d,followUpActions:d.followUpActions.map(m=>m.id===i?{...m,completed:n}:m)}:d))||[]}:c})}))},addProfile:(r,s)=>{const i={id:crypto.randomUUID(),name:s.name||"New Profile",type:s.type||"quality",settings:s.settings||{},isActive:s.isActive||!1,materialId:s.materialId||null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...s};t(n=>({printers:n.printers.map(l=>{if(l.id!==r)return l;const c=l.slicerProfiles||{curaPath:"",profiles:[],materials:[]};return{...l,slicerProfiles:{...c,profiles:[...c.profiles||[],i]}}})}))},updateProfile:(r,s,i)=>{t(n=>({printers:n.printers.map(l=>l.id===r?{...l,slicerProfiles:{...l.slicerProfiles,profiles:l.slicerProfiles.profiles.map(c=>{if(c.id===s){const o={...c,...i,updatedAt:new Date().toISOString()};if(i.settings){const d={id:crypto.randomUUID(),timestamp:new Date().toISOString(),changes:Object.keys(i.settings||{}),snapshot:{...o.settings},source:i.source||"manual"};o.history=[...(c.history||[]).slice(-9),d]}return o}return c})}}:l)}))},deleteProfile:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,slicerProfiles:{...n.slicerProfiles,profiles:n.slicerProfiles.profiles.filter(l=>l.id!==s)}}:n)}))},duplicateProfile:(r,s)=>{const n=a().printers.find(c=>c.id===r),l=n==null?void 0:n.slicerProfiles.profiles.find(c=>c.id===s);if(l){const c={...l,id:crypto.randomUUID(),name:`${l.name} (Copy)`,isActive:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t(o=>({printers:o.printers.map(d=>d.id===r?{...d,slicerProfiles:{...d.slicerProfiles,profiles:[...d.slicerProfiles.profiles,c]}}:d)}))}},setActiveProfile:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,slicerProfiles:{...n.slicerProfiles,profiles:n.slicerProfiles.profiles.map(l=>({...l,isActive:l.id===s}))}}:n)}))},updateCuraPath:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,slicerProfiles:{...n.slicerProfiles,curaPath:s}}:n)}))},revertProfileToVersion:(r,s,i)=>{t(n=>({printers:n.printers.map(l=>l.id===r?{...l,slicerProfiles:{...l.slicerProfiles,profiles:l.slicerProfiles.profiles.map(c=>{var o;if(c.id===s){const d=(o=c.history)==null?void 0:o.find(m=>m.id===i);if(d){const m={...c,settings:{...d.snapshot},updatedAt:new Date().toISOString()},x={id:crypto.randomUUID(),timestamp:new Date().toISOString(),changes:["reverted"],snapshot:{...d.snapshot},source:"revert",revertedFrom:i};return m.history=[...(c.history||[]).slice(-9),x],m}}return c})}}:l)}))},addMaterial:(r,s)=>{const i={id:crypto.randomUUID(),name:s.name||"New Material",type:s.type||"PLA",properties:s.properties||{},recommendedSettings:s.recommendedSettings||{},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...s};t(n=>({printers:n.printers.map(l=>l.id===r?{...l,slicerProfiles:{...l.slicerProfiles,materials:[...l.slicerProfiles.materials||[],i]}}:l)}))},updateMaterial:(r,s,i)=>{t(n=>({printers:n.printers.map(l=>l.id===r?{...l,slicerProfiles:{...l.slicerProfiles,materials:(l.slicerProfiles.materials||[]).map(c=>c.id===s?{...c,...i,updatedAt:new Date().toISOString()}:c)}}:l)}))},deleteMaterial:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,slicerProfiles:{...n.slicerProfiles,materials:(n.slicerProfiles.materials||[]).filter(l=>l.id!==s)}}:n)}))},setProfileMaterial:(r,s,i,n=!0)=>{t(l=>({printers:l.printers.map(c=>{if(c.id!==r)return c;const o=(c.slicerProfiles.materials||[]).find(d=>d.id===i);return{...c,slicerProfiles:{...c.slicerProfiles,profiles:c.slicerProfiles.profiles.map(d=>{if(d.id!==s)return d;const m=n&&(o!=null&&o.recommendedSettings)?{...d.settings,...o.recommendedSettings}:d.settings;return{...d,materialId:i,settings:m,updatedAt:new Date().toISOString()}})}}})}))},getActivePrinter:()=>{const r=a();return r.printers.find(s=>s.id===r.activePrinterId)},getPrinterById:r=>a().printers.find(i=>i.id===r),createConfigurationSnapshot:(r,s,i="")=>{const l=a().printers.find(o=>o.id===r);if(!l)throw new Error("Printer not found");const c={id:crypto.randomUUID(),name:s,description:i,timestamp:new Date().toISOString(),printerId:r,printerName:l.name,configuration:{printerSettings:l.printerSettings,firmwareConfiguration:l.firmwareConfiguration,bedSize:l.bedSize,model:l.model,firmware:l.firmware}};return t(o=>({printers:o.printers.map(d=>d.id===r?{...d,configurationSnapshots:[...d.configurationSnapshots||[],c]}:d)})),c},restoreConfigurationSnapshot:(r,s)=>{var c;const n=a().printers.find(o=>o.id===r);if(!n)throw new Error("Printer not found");const l=(c=n.configurationSnapshots)==null?void 0:c.find(o=>o.id===s);if(!l)throw new Error("Snapshot not found");return t(o=>({printers:o.printers.map(d=>d.id===r?{...d,printerSettings:{...l.configuration.printerSettings},firmwareConfiguration:{...l.configuration.firmwareConfiguration},bedSize:{...l.configuration.bedSize},model:l.configuration.model,firmware:l.configuration.firmware}:d)})),l},deleteConfigurationSnapshot:(r,s)=>{t(i=>({printers:i.printers.map(n=>n.id===r?{...n,configurationSnapshots:(n.configurationSnapshots||[]).filter(l=>l.id!==s)}:n)}))},exportConfiguration:r=>{const i=a().printers.find(l=>l.id===r);if(!i)throw new Error("Printer not found");return{version:"1.0",timestamp:new Date().toISOString(),printer:{name:i.name,model:i.model,firmware:i.firmware,bedSize:i.bedSize,printerSettings:i.printerSettings,firmwareConfiguration:i.firmwareConfiguration},snapshots:i.configurationSnapshots||[]}},importConfiguration:(r,s)=>{if(!s.version||!s.printer)throw new Error("Invalid configuration file format");t(i=>({printers:i.printers.map(n=>n.id===r?{...n,name:s.printer.name||n.name,model:s.printer.model||n.model,firmware:s.printer.firmware||n.firmware,bedSize:s.printer.bedSize||n.bedSize,printerSettings:s.printer.printerSettings||n.printerSettings,firmwareConfiguration:s.printer.firmwareConfiguration||n.firmwareConfiguration,configurationSnapshots:s.snapshots||[]}:n)}))},compareConfigurations:(r,s,i)=>{const l=a().printers.find(h=>h.id===r);if(!l)throw new Error("Printer not found");const c=l.configurationSnapshots||[],o=c.find(h=>h.id===s),d=c.find(h=>h.id===i);if(!o||!d)throw new Error("One or both snapshots not found");const m=[],x=(h,f,y="")=>{for(const g in h){const p=y?`${y}.${g}`:g;typeof h[g]=="object"&&h[g]!==null?typeof f[g]=="object"&&f[g]!==null?x(h[g],f[g],p):m.push({path:p,type:"modified",oldValue:h[g],newValue:f[g]}):h[g]!==f[g]&&m.push({path:p,type:"modified",oldValue:h[g],newValue:f[g]})}for(const g in f)g in h||m.push({path:y?`${y}.${g}`:g,type:"added",oldValue:void 0,newValue:f[g]})};return x(o.configuration.printerSettings,d.configuration.printerSettings),{snapshot1:{name:o.name,timestamp:o.timestamp},snapshot2:{name:d.name,timestamp:d.timestamp},differences:m}},resetStore:()=>{t({printers:[],activePrinterId:null})}}),{name:"3d-printer-suite-storage",partialize:t=>({printers:t.printers,activePrinterId:t.activePrinterId})}),{name:"PrintersStore",enabled:!1})),Ri=()=>je(t=>t.printers),za=()=>je(t=>t.activePrinterId),Mi=()=>je(t=>t.addPrinter),ki=()=>je(t=>t.deletePrinter),Ga=()=>je(t=>t.setActivePrinter),Ai=()=>je(t=>t.resetStore),Ii=()=>je(t=>t.updateProfile),Di=()=>je(t=>({addProfile:t.addProfile,updateProfile:t.updateProfile,deleteProfile:t.deleteProfile,duplicateProfile:t.duplicateProfile,setActiveProfile:t.setActiveProfile,revertProfileToVersion:t.revertProfileToVersion})),Li=()=>je(t=>({addMaterial:t.addMaterial,updateMaterial:t.updateMaterial,deleteMaterial:t.deleteMaterial,setProfileMaterial:t.setProfileMaterial})),yr=()=>je(t=>t.getActivePrinter),Oi=[115200,25e4,57600,38400,9600],te=bt(yt(vi((t,a)=>{let r=null,s=null,i=null,n=new TextEncoder,l=!1,c=null;const o=(v,j="sys")=>{const S=new Date().toLocaleTimeString(),L=Date.now();t(V=>{const F=[...V.serialLogs,{timestamp:S,message:v,type:j,timestampMs:L}],$=1e3,U=60*60*1e3;let D=F;return F.length>$/2&&(D=F.filter(Z=>L-(Z.timestampMs||0)<U)),D.length>$&&(D=D.slice(-$)),{serialLogs:D}},!1,"appendSerialLog")},d=v=>{const j={units:{linear:"mm",temperature:"C"},filament:{diameter:1.75,type:"PLA"},stepsPerUnit:{x:80,y:80,z:400,e:93},feedrates:{x:500,y:500,z:5,e:25},acceleration:{max:1e3,print:1e3,retract:1e3,travel:1e3,jerk:{x:0,y:0,z:0,e:0}},homeOffset:{x:0,y:0,z:0},bedLeveling:{enabled:!1,mesh:[],fadeHeight:10},materialHeating:{pla:{hotend:200,bed:60},abs:{hotend:240,bed:100},petg:{hotend:230,bed:80}},pid:{hotend:{p:21.73,i:1.54,d:73.76},bed:{p:301.25,i:24.2,d:73.76}},powerLossRecovery:!0,zProbeOffset:{x:0,y:0,z:0},linearAdvance:0,filamentLoadUnload:{loadLength:0,unloadLength:0},lastUpdated:new Date().toISOString()},S=v.split(`
`).map(L=>L.trim()).filter(L=>L.length>0);for(const L of S)try{const V=L.match(/M92\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if(V){j.stepsPerUnit={x:parseFloat(V[1]),y:parseFloat(V[2]),z:parseFloat(V[3]),e:parseFloat(V[4])};continue}const F=L.match(/M203\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if(F){j.feedrates={x:parseFloat(F[1]),y:parseFloat(F[2]),z:parseFloat(F[3]),e:parseFloat(F[4])};continue}const $=L.match(/M201\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if($){j.acceleration.max=Math.max(parseFloat($[1]),parseFloat($[2]),parseFloat($[3]),parseFloat($[4]));continue}const U=L.match(/M204\s+P(\d+(?:\.\d+)?)\s+R(\d+(?:\.\d+)?)\s+T(\d+(?:\.\d+)?)/i);if(U){j.acceleration.print=parseFloat(U[1]),j.acceleration.retract=parseFloat(U[2]),j.acceleration.travel=parseFloat(U[3]);continue}const D=L.match(/M205\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if(D){j.acceleration.jerk={x:parseFloat(D[1]),y:parseFloat(D[2]),z:parseFloat(D[3]),e:parseFloat(D[4])};continue}const Z=L.match(/M206\s+X(-?\d+(?:\.\d+)?)\s+Y(-?\d+(?:\.\d+)?)\s+Z(-?\d+(?:\.\d+)?)/i);if(Z){j.homeOffset={x:parseFloat(Z[1]),y:parseFloat(Z[2]),z:parseFloat(Z[3])};continue}const oe=L.match(/M420\s+S(\d+)\s+Z(\d+(?:\.\d+)?)/i);if(oe){j.bedLeveling.enabled=parseInt(oe[1])===1,j.bedLeveling.fadeHeight=parseFloat(oe[2]);continue}const he=L.match(/G29\s+W\s+(\d+)\s+(\d+)\s+(-?\d+(?:\.\d+)?)/i);if(he){j.bedLeveling.mesh||(j.bedLeveling.mesh=[]),j.bedLeveling.mesh.push({i:parseInt(he[1]),j:parseInt(he[2]),z:parseFloat(he[3])});continue}const W=L.match(/M145\s+S(\d+)\s+B(\d+)\s+H(\d+)\s+F(\d+)/i);if(W){const le=parseInt(W[1])===0?"pla":parseInt(W[1])===1?"abs":"petg";j.materialHeating[le]={hotend:parseInt(W[2]),bed:parseInt(W[3])};continue}const me=L.match(/M301\s+P(\d+(?:\.\d+)?)\s+I(\d+(?:\.\d+)?)\s+D(\d+(?:\.\d+)?)/i);if(me){j.pid.hotend={p:parseFloat(me[1]),i:parseFloat(me[2]),d:parseFloat(me[3])};continue}const xe=L.match(/M304\s+P(\d+(?:\.\d+)?)\s+I(\d+(?:\.\d+)?)\s+D(\d+(?:\.\d+)?)/i);if(xe){j.pid.bed={p:parseFloat(xe[1]),i:parseFloat(xe[2]),d:parseFloat(xe[3])};continue}const O=L.match(/M413\s+S(\d+)/i);if(O){j.powerLossRecovery=parseInt(O[1])===1;continue}const K=L.match(/M851\s+X(-?\d+(?:\.\d+)?)\s+Y(-?\d+(?:\.\d+)?)\s+Z(-?\d+(?:\.\d+)?)/i);if(K){j.zProbeOffset={x:parseFloat(K[1]),y:parseFloat(K[2]),z:parseFloat(K[3])};continue}const ae=L.match(/M900\s+K(\d+(?:\.\d+)?)/i);if(ae){j.linearAdvance=parseFloat(ae[1]);continue}const Y=L.match(/M603\s+T(\d+(?:\.\d+)?)\s+L(\d+(?:\.\d+)?)\s+U(\d+(?:\.\d+)?)/i);if(Y){j.filamentLoadUnload={loadLength:parseFloat(Y[2]),unloadLength:parseFloat(Y[3])};continue}}catch(V){console.warn("Error parsing M503 line:",L,V)}return j},m=v=>{try{if((v.includes("echo:")||v.includes("Bed")||v.includes("Mesh")||v.includes("[")||v.includes("X:")||v.includes("Y:")||v.includes("Z:")||v.includes("eeprom:")||v.includes("ok")||v.includes("M503"))&&console.log("M503 Response:",v),v.trim()&&!v.includes("ok")&&!v.includes("echo:busy")&&console.log("Potential bed mesh data:",v),v.includes("Bed Leveling Grid:")||v.includes("Bilinear Leveling Grid:")||v.includes("Mesh Bed Leveling")||v.includes("Bilinear Leveling")){const S=v.match(/Size (\d+)x(\d+)/);if(S)return{type:"grid_size",gridSize:{x:parseInt(S[1]),y:parseInt(S[2])}}}if(v.includes("Bed Leveling:")||v.includes("Bilinear Leveling:")||v.includes("Mesh Bed Leveling:"))return{type:"bed_leveling_status",message:v};const j=v.match(/G29\s+W\s+I(\d+)\s+J(\d+)\s+Z(-?\d+(?:\.\d+)?)/i);if(j){const S=parseInt(j[1]),L=parseInt(j[2]),V=parseFloat(j[3]);return{type:"mesh_point",i:S,j:L,z:V}}if(v.includes("echo:")&&v.includes("0.000")){const S=v.replace("echo:","").trim().split(/\s+/).map(Number).filter(L=>!isNaN(L));if(S.length>0)return{type:"mesh_row",values:S}}if(v.includes("Bed leveling done")||v.includes("G29 finished")||v.includes("Bilinear Leveling Grid:"))return{type:"leveling_complete"};if(v.includes("No bed leveling data")||v.includes("Bed leveling not active")||v.includes("Bed leveling OFF"))return{type:"no_bed_data"};if(v.includes("eeprom:"))return{type:"eeprom_response",message:v};if(v.trim().match(/^[-+]?\d*\.?\d+(\s+[-+]?\d*\.?\d+)*$/)){const S=v.trim().split(/\s+/).map(Number).filter(L=>!isNaN(L));if(S.length>=3)return{type:"mesh_row",values:S}}if(v.trim().match(/^\s*[-+]?\d*\.?\d+/)&&v.includes(".")){const S=v.trim().split(/\s+/).map(Number).filter(L=>!isNaN(L));if(S.length>=3)return{type:"mesh_row",values:S}}if(v.trim().startsWith("[")&&v.includes(",")){const S=v.trim().replace(/[\[\]]/g,"").split(",").map(L=>parseFloat(L.trim())).filter(L=>!isNaN(L));if(S.length>=3)return{type:"mesh_point",x:S[0],y:S[1],z:S[2]}}if(v.trim().startsWith("[")&&!v.includes(",")){const S=v.trim().replace(/[\[\]]/g,"").split(/\s+/).filter(Boolean).map(Number).filter(L=>!isNaN(L));if(S.length>0)return{type:"mesh_row",values:S}}if(v.trim().match(/^\s*[-+]?\d*\.?\d+\s+[-+]?\d*\.?\d+\s+[-+]?\d*\.?\d+/)){const S=v.trim().split(/\s+/).map(Number).filter(L=>!isNaN(L));if(S.length>=3)return{type:"mesh_row",values:S}}if(v.includes("Bed X:")&&v.includes("Y:")&&v.includes("Z:")){const S=v.match(/X:\s*([-\d.]+)/),L=v.match(/Y:\s*([-\d.]+)/),V=v.match(/Z:\s*([-\d.]+)/);if(S&&L&&V)return{type:"mesh_point",x:parseFloat(S[1]),y:parseFloat(L[1]),z:parseFloat(V[1])}}return null}catch(j){return console.warn("Error parsing bed mesh data:",j),null}},x=v=>{if(!v||!v.data.length)return;const j=v.data.flat(),S=Math.min(...j),L=Math.max(...j),V=L-S;t(F=>({bedMesh:{data:v.data,gridSize:v.gridSize,min:S,max:L,range:V,timestamp:Date.now(),rawData:F.bedMesh.rawData}}),!1,"updateBedMesh")},h=()=>{var U;const j=a().bedMesh.rawData||[];if(j.length===0)return;let S={x:0,y:0};const L=[],V=[];let F=!1,$=!1;console.log("Processing bed mesh data:",j);for(const D of j)D.type==="grid_size"?(S=D.gridSize,console.log("Found grid size:",S)):D.type==="mesh_row"?(L.push(D.values),console.log("Found mesh row:",D.values)):D.type==="mesh_point"?(V.push({i:D.i,j:D.j,z:D.z}),console.log("Found mesh point:",{i:D.i,j:D.j,z:D.z})):D.type==="leveling_complete"?(F=!0,console.log("Found leveling complete signal")):D.type==="no_bed_data"?($=!0,console.log("Found no bed data signal")):D.type==="bed_leveling_status"?console.log("Found bed leveling status:",D.message):D.type==="eeprom_response"&&console.log("Found eeprom response:",D.message);if($){o("No bed leveling data found on printer. Run G29 to create bed leveling mesh.","sys"),t(D=>({bedMesh:{...D.bedMesh,rawData:[]}}),!1,"clearBedMeshRawData");return}if(F||S.x>0&&S.y>0&&L.length>0||L.length>=3||V.length>0){if(V.length>0){if(S.x===0||S.y===0){const D=Math.max(...V.map(oe=>oe.i)),Z=Math.max(...V.map(oe=>oe.j));S={x:D+1,y:Z+1}}console.log("Processing G29 W mesh points with grid size:",S,"and",V.length,"points"),x({data:V,gridSize:S}),o(`Bed leveling data loaded: ${S.x}x${S.y} grid with ${V.length} points`,"sys")}else if(L.length>0){if(S.x===0||S.y===0){const D=L.length;if(D===9)S={x:3,y:3};else if(D===16)S={x:4,y:4};else if(D===25)S={x:5,y:5};else if(D===49)S={x:7,y:7};else{const Z=((U=L[0])==null?void 0:U.length)||0;Z>0&&(S={x:Z,y:Math.ceil(D/Z)})}}console.log("Processing mesh with grid size:",S,"and",L.length,"rows"),x({data:L,gridSize:S}),o(`Bed leveling data loaded: ${S.x}x${S.y} grid with ${L.length} points`,"sys")}t(D=>({bedMesh:{...D.bedMesh,rawData:[]}}),!1,"clearBedMeshRawData"),F&&o("Bed leveling procedure completed successfully","sys")}else j.length>0&&console.log("Insufficient bed mesh data to process:",{gridSize:S,meshRows:L.length,meshPoints:V.length,hasLevelingComplete:F})},f=async()=>{var j;const v=a();if(v.status==="connected"&&((j=v.port)!=null&&j.writable))try{o("Processing collected bed level data...","sys"),h()}catch(S){o(`Failed to process bed level data: ${S.message}`,"err")}},y=async()=>{var j;const v=a();if(v.status==="connected"&&((j=v.port)!=null&&j.writable))try{o("Starting automatic bed leveling procedure...","sys"),o("This will take several minutes. Do not interrupt the process.","sys"),t(S=>({bedMesh:{data:[],gridSize:{x:0,y:0},min:0,max:0,range:0,timestamp:null,rawData:[]}}),!1,"clearBedMesh"),await N("G29"),setTimeout(()=>{h()},3e4)}catch(S){o(`Failed to run bed leveling: ${S.message}`,"err")}},g=()=>{const v=Date.now(),j=60*60*1e3;t(S=>({serialLogs:S.serialLogs.filter(L=>v-(L.timestampMs||0)<j)}),!1,"cleanupOldLogs")},p=async()=>{var v;try{if(s&&(s.abort(),s=null),r){try{await r.cancel()}catch(j){if(!((v=j.message)!=null&&v.includes("locked")))throw j}try{await r.releaseLock()}catch{}}}catch(j){o(`Warning: Error closing reader: ${j.message}`,"sys")}finally{r=null}},b=async()=>{var v;try{await p()}catch{}try{i&&((v=i.readable)==null||v.cancel())}catch{}i=null},w=v=>{const j={};let S=v.match(/T:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);S&&(j.hotend={current:parseFloat(S[1]),target:parseFloat(S[2])}),j.hotend||(S=v.match(/T:(\d+\.?\d*)\/(\d+\.?\d*)/),S&&(j.hotend={current:parseFloat(S[1]),target:parseFloat(S[2])})),j.hotend||(S=v.match(/ok\s+T:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/),S&&(j.hotend={current:parseFloat(S[1]),target:parseFloat(S[2])}));let L=v.match(/B:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);return L&&(j.bed={current:parseFloat(L[1]),target:parseFloat(L[2])}),j.bed||(L=v.match(/B:(\d+\.?\d*)\/(\d+\.?\d*)/),L&&(j.bed={current:parseFloat(L[1]),target:parseFloat(L[2])})),j},_=async v=>{try{s&&(s.abort(),s=null),s=new AbortController,i=new TextDecoderStream;try{const j=v.readable.pipeTo(i.writable),S=i.readable.getReader();r=S;let L="",V=Date.now();for(;!(s!=null&&s.signal.aborted);)try{const{value:F,done:$}=await S.read();if($){o("Read stream closed","sys");break}if(F){L+=F;let U;for(;(U=L.indexOf(`
`))>=0;){const D=L.slice(0,U).replace(/\r$/,"");if(L=L.slice(U+1),D.trim().length>0){if(V=Date.now(),o(D,"rx"),D.includes("T:")||D.includes("B:")){const oe=w(D);(oe.hotend||oe.bed)&&t(he=>({temperatures:{...he.temperatures,...oe,timestamp:Date.now()}}),!1,"updateTemperatures")}const Z=m(D);if(Z&&t(oe=>({bedMesh:{...oe.bedMesh,rawData:[...oe.bedMesh.rawData||[],Z]}}),!1,"addBedMeshRawData"),(D.includes("M92")||D.includes("M203")||D.includes("M201")||D.includes("M204")||D.includes("M205")||D.includes("M206")||D.includes("M420")||D.includes("G29 W")||D.includes("M145")||D.includes("M301")||D.includes("M304")||D.includes("M413")||D.includes("M851")||D.includes("M900")||D.includes("M603"))&&t(oe=>({m503Response:[...oe.m503Response||[],D]}),!1,"addM503Response"),D.toLowerCase().includes("error"))o(`Printer error: ${D}`,"err");else if(D.toLowerCase()==="ok")continue}}}Date.now()-V>1e4&&(o("Warning: No response from printer for 10 seconds","sys"),V=Date.now())}catch(F){if((F==null?void 0:F.name)!=="AbortError")throw o(`Read error: ${F.message}`,"err"),F;break}await j.catch(F=>{(F==null?void 0:F.name)!=="AbortError"&&o(`Stream closed with error: ${F.message}`,"err")})}catch(j){if((j==null?void 0:j.name)!=="AbortError")throw o(`Read loop error: ${(j==null?void 0:j.message)||j}`,"err"),j}}catch(j){throw o(`Failed to start read loop: ${(j==null?void 0:j.message)||j}`,"err"),j}},A=async(v,j)=>{if(!v)throw new Error("No port provided");o(`Opening port @ ${j}…`,"sys");try{try{s&&(s.abort(),s=null),await b(),(v.readable||v.writable)&&await v.close(),await new Promise(V=>setTimeout(V,1e3))}catch(V){o(`Warning: Error while closing port: ${V.message}`,"sys"),await new Promise(F=>setTimeout(F,1e3))}const S={baudRate:j,dataBits:8,stopBits:1,parity:"none",bufferSize:255,flowControl:"none"};o(`Configuring port with baud ${j}`,"sys"),await v.open(S),o("Port opened successfully","sys"),t({port:v,status:"connected"},!1,"setPort"),await new Promise(V=>setTimeout(V,500)),setTimeout(async()=>{if(a().m503SentOnConnection)o("Printer configuration already fetched on connection","sys");else{try{await a().fetchAllPrinterSettings(),t({m503SentOnConnection:!0},!1,"markM503Sent"),await a().fetchBedLevel(),o("Printer configuration and bed level data fetched automatically","sys")}catch(F){o(`Error fetching printer data: ${F.message}`,"err")}setTimeout(()=>{a().bedMesh.data.length===0&&o("No existing bed leveling data found. Consider running G29 for automatic bed leveling.","sys")},5e3)}},1e3);const L=setInterval(()=>{g()},10*60*1e3);if(t(V=>({...V,logCleanupInterval:L}),!1,"setLogCleanupInterval"),!v.readable||!v.writable)throw new Error("Port closed unexpectedly after opening");return await _(v),!0}catch(S){throw o(`Failed to open port @ ${j}: ${S.message}`,"err"),S}},C=async(v=!1)=>{const j=a();try{if(!v&&j.status==="disconnected")return;(j.status==="connected"||j.status==="connecting")&&o("Disconnecting...","sys");const S=j.port;t({port:null,status:"disconnected",m503SentOnConnection:!1},!1,"disconnect");try{s&&(s.abort(),s=null);const L=a();L.logCleanupInterval&&(clearInterval(L.logCleanupInterval),t({logCleanupInterval:null},!1,"clearLogCleanupInterval")),await b(),S&&(S.readable||S.writable)&&(await S.close(),o("Port closed","sys"))}catch(L){o(`Warning during cleanup: ${L.message}`,"sys")}}catch(S){o(`Error during disconnect: ${S.message}`,"err")}},M=async(v={})=>{var S,L,V,F,$,U;const j=a();try{if(t({error:null},!1,"connect/clearError"),!("serial"in navigator))throw new Error("Web Serial API not supported in this browser");if(j.status==="connected")return;if(j.status==="connecting")throw new Error("Connection already in progress");l=!0,await C(!0),t({port:null,status:"connecting"},!1,"connect/setConnecting"),await new Promise(D=>setTimeout(D,500));try{const D=await navigator.serial.getPorts();o(`Cleaning up ${D.length} existing ports...`,"sys");for(const Z of D)try{const oe=Z.getInfo();o(`Closing port VID: 0x${((S=oe.usbVendorId)==null?void 0:S.toString(16))||"none"}, PID: 0x${((L=oe.usbProductId)==null?void 0:L.toString(16))||"none"}`,"sys"),(Z.readable||Z.writable)&&await Z.close()}catch(oe){o(`Warning: Error closing port: ${oe.message}`,"sys")}await new Promise(Z=>setTimeout(Z,1e3))}catch(D){o(`Warning: Error during port cleanup: ${D.message}`,"sys")}try{let D;try{const W=await navigator.serial.getPorts();o(`Found ${W.length} previously authorized ports`,"sys");for(const me of W){const xe=me.getInfo();if(o(`Port: VID: 0x${((V=xe.usbVendorId)==null?void 0:V.toString(16))||"none"}, PID: 0x${((F=xe.usbProductId)==null?void 0:F.toString(16))||"none"}`,"sys"),xe.usbVendorId===6790){o("Found previously authorized CH340 device","sys"),D=me;break}}D||(o("Requesting port selection...","sys"),D=await navigator.serial.requestPort({filters:[{usbVendorId:6790,usbProductId:29987},{usbVendorId:6790,usbProductId:21795},{usbVendorId:6790,usbProductId:29986},{usbVendorId:6790,usbProductId:21778},{usbVendorId:6790}]}),o("New CH340 device selected","sys")),o("CH340 USB-Serial adapter detected","sys")}catch{o("No CH340 device found, trying any available port...","sys"),D=await navigator.serial.requestPort({filters:[]})}if(!D)throw new Error("No port selected");let Z=!1,oe=null;const he=v.autoDetect??j.autoDetect?Oi:[v.baudRate||j.baudRate];for(const W of he)try{await A(D,W),Z=!0,oe=W,t({baudRate:W},!1,"connect/setBaud");break}catch(me){o(`Failed @ ${W}: ${(me==null?void 0:me.message)||me}`,"err");try{(D.readable||D.writable)&&await D.close()}catch{}}if(!Z)throw new Error("Unable to establish serial communication at common baud rates");if(!D||!D.readable||!D.writable)throw new Error("Port validation failed after opening");o(`Connected @ ${oe}`,"sys")}catch(D){throw o(`Communication check failed: ${D.message}`,"err"),await C(!0),new Error(`Failed to verify communication: ${D.message}`)}}catch(D){t({status:"disconnected"},!1,"connect/error");let Z=(D==null?void 0:D.message)||String(D);Z.includes("Could not establish connection")||Z.includes("Receiving end does not exist")?Z=`Browser connection error. Please try:
1. Refresh the page
2. Close and reopen browser
3. Disable browser extensions
4. Try a different browser (Chrome recommended)`:Z.includes("Connection already in progress")?Z="Already trying to connect. Please wait...":Z.includes("Still verifying connection")?Z="Please wait - verifying connection to printer...":Z.includes("No response from printer")?Z=`No response from printer. Please check:
1. Printer is powered on and not in a menu
2. Correct baud rate (115200 for Ender 3)
3. USB cable is firmly connected
4. Try unplugging and reconnecting USB cable`:Z.includes("Port open timeout")?Z=`Port open timed out. The port might be locked. Please try:
1. Close ALL applications that might use COM3:
   - Pronterface
   - Cura
   - PuTTY
   - Arduino IDE
2. Open Task Manager and end these processes if found:
   - Pronterface.exe
   - python.exe (if running Pronterface)
   - Cura.exe
3. Open Device Manager:
   - Find "USB-SERIAL CH340 (COM3)"
   - Right-click -> Disable
   - Wait 5 seconds
   - Right-click -> Enable`:Z.includes("NetworkError")||Z.includes('Failed to execute "open"')?Z=`Could not open serial port. Please check:
1. In Device Manager, verify:
   - "USB-SERIAL CH340 (COM3)" is present
   - Driver provider is wch.cn
   - Driver version is 3.9.2024.9
2. Try these steps in order:
   a. Unplug USB cable
   b. Wait 10 seconds
   c. Open Device Manager
   d. Plug in USB cable
   e. Watch Device Manager - should show COM3
   f. If COM3 doesn't appear, uninstall driver and reinstall
3. If still failing:
   - Try a different USB port
   - Try a different USB cable
   - Check if printer powers on via USB`:Z.includes("No valid Marlin response")&&(Z=`No response from printer. Please check:
1. The correct baud rate is selected (usually 115200)
2. The printer is not in a boot/flash mode
3. The USB-Serial adapter is working properly`),t({error:Z},!1,"connect/setError"),o(`Connection error: ${Z}`,"err");try{await((U=($=j.port)==null?void 0:$.close)==null?void 0:U.call($))}catch{}t({port:null},!1,"connect/clearPort")}finally{l=!1}};let T=null,G=null;const E=async()=>{T&&await T,T=new Promise(v=>{G=v})},k=()=>{G&&(G(),T=null,G=null)},N=async v=>{var V,F;const j=a();if(!j.port||!j.port.writable||j.status!=="connected"){o(`Cannot send command - not connected. Status: ${j.status}`,"err");return}if(!v||v.trim().length===0)return;await E();let S=null;const L=$=>{const U=String($&&$.message?$.message:$).toLowerCase();return/receiving end does not exist|disconnected|device has been lost|invalidstateerror|failed to write|port.*closed|not connected/.test(U)};try{try{S=j.port.writable.getWriter()}catch{k(),o("Writer was locked, retrying shortly…","sys"),await new Promise(me=>setTimeout(me,50)),await E(),S=j.port.writable.getWriter()}const $=v.trim().toUpperCase();o($,"tx");const U=`${$}\r
`;n||(n=new TextEncoder);const D=n.encode(U);console.log("Sending command:",$,"Command text:",U,"Encoded data:",D);const Z=new TextDecoder().decode(D);if(Z!==U)throw console.error("Data corruption detected! Original:",U,"Decoded:",Z),new Error("Data corruption detected in command encoding");await S.write(D);const he=a().isStreamingProgram?5:50;await new Promise(W=>setTimeout(W,he))}catch($){if(o(`Send error: ${$.message}`,"err"),L($)){try{const U=a();U.isStreamingProgram&&(t({isStreamingProgram:!1},!1,"connectionLostStopStream"),U.currentExecution&&((F=(V=a()).cancelExecution)==null||F.call(V))),t(({temperatures:D})=>({status:"disconnected",port:null,error:"Serial connection lost",temperatures:D}),!1,"connectionLost"),o("Serial connection lost. Please reconnect the printer.","err")}catch{}throw new Error("Serial connection lost")}throw $}finally{if(S)try{S.releaseLock()}catch($){o(`Warning: Error releasing writer: ${$.message}`,"err")}k()}},R=async(v,j=50)=>{for(const S of v)!S||/^\s*(;|#)/.test(S)||(await N(S),j&&await new Promise(L=>setTimeout(L,j)))},I=async(v,j={})=>{const{delayMs:S=0,waitForReady:L=!0}=j;for(const V of v)!V||/^\s*(;|#)/.test(V)||(await ce(V,{waitForReady:L}),S&&await new Promise(F=>setTimeout(F,S)))},J=async(v=9e5)=>{const j=Date.now();let S=j;for(;;){const L=a();if(L.status!=="connected"||!L.port)throw new Error("Not connected");const V=L.serialLogs.slice(-10),F=V.some(D=>D.type==="rx"&&/busy: processing/i.test(String(D.message))),$=V.some(D=>D.type==="rx"&&/(wait for user|paused for user|click to resume|waiting for user input)/i.test(String(D.message)));if(!F&&!$)return!0;const U=Date.now();if(U-j>v)throw o(`Printer busy for too long (${Math.round(v/1e3)}s) - aborting execution`,"err"),new Error("Printer busy timeout - execution aborted");if(U-S>5e3){const D=Math.round((U-j)/1e3);o($?`Waiting for user to resume on printer... (${D}s)`:`Waiting for printer to be ready... (${D}s)`,"info"),S=U}await new Promise(D=>setTimeout(D,100))}},ce=async(v,j={})=>{const{waitForReady:S=!0,maxRetries:L=3,retryDelay:V=1e3,postSendDelayMs:F}=j;if(!v||v.trim().length===0)return;const $=a();if(!$.port||!$.port.writable||$.status!=="connected"){o(`Cannot send command - not connected. Status: ${$.status}`,"err");return}S&&await J(),await N(v);const U=a(),D=typeof F=="number"?F:U.isStreamingProgram?0:20;D>0&&await new Promise(Z=>setTimeout(Z,D))},q=async(v,j={})=>{const{delayMs:S=0,waitForReady:L=!0,waitForOk:V=!0,okTimeoutMs:F=6e4,onProgress:$,executionData:U={}}=j,D=a();if(!D.port||!D.port.writable||D.status!=="connected")throw o(`Cannot start program - not connected. Status: ${D.status}`,"err"),new Error("Not connected");const Z=String(v).split(/\r?\n/).map(W=>W.trim()).filter(W=>W.length>0&&!W.startsWith(";")&&!W.startsWith("#"));let oe=0;c=new AbortController,U.stepName&&a().startExecution({...U,totalCommands:Z.length});const he=()=>new Promise((W,me)=>{if(!V){setTimeout(W,50);return}let xe=!1;const O=Date.now(),K=te.subscribe(ae=>ae.serialLogs.length,()=>{const ae=a();if(ae.status!=="connected"||!ae.port)return xe=!0,K(),me(new Error("Not connected"));const Y=ae.serialLogs.slice(-10),le=Y.some(ie=>ie.type==="rx"&&/^ok\b/i.test(String(ie.message).trim())),de=Y.some(ie=>ie.type==="rx"&&/busy: processing/i.test(String(ie.message).trim())),se=Y.some(ie=>ie.type==="rx"&&/(wait for user|paused for user|click to resume|waiting for user input)/i.test(String(ie.message).trim())),ve=Y.some(ie=>ie.type==="rx"&&/error|unknown|invalid/i.test(ie.message));if(Date.now()-O>1e3&&!xe&&(console.log("Awaiting OK - Recent logs:",Y.map(ie=>`${ie.type}: ${ie.message}`).slice(-3)),console.log("hasOk:",le,"hasBusy:",de,"isWaitingForUser:",se,"hasErr:",ve)),le&&!xe)xe=!0,K(),W();else if(ve&&!xe)xe=!0,K(),me(new Error("Printer error reported"));else if(Date.now()-O>F&&!xe){if(se||de)return;xe=!0,K(),W()}})});t({isStreamingProgram:!0},!1,"startProgramStream");try{for(let me=0;me<Z.length;me++){if(c!=null&&c.signal.aborted)throw o("G-code execution aborted by user","warn"),new Error("Execution aborted by user");try{await ce(Z[me],{waitForReady:L,postSendDelayMs:0}),S&&await new Promise(xe=>setTimeout(xe,S));try{await he(),console.log(`G-code line ${me+1}/${Z.length} acknowledged: ${Z[me]}`)}catch(xe){console.warn(`G-code line ${me+1}/${Z.length} timeout/error: ${Z[me]}`,xe.message)}}catch(xe){throw xe.message.includes("Printer busy timeout")&&o(`G-code execution aborted - printer busy timeout at line ${me+1}/${Z.length}`,"err"),xe}oe=me+1,U.stepName&&a().updateExecutionProgress({sent:oe,total:Z.length}),typeof $=="function"&&$(oe,Z.length)}const W={sent:oe,total:Z.length};try{await ce("M25",{waitForReady:!1,postSendDelayMs:0}),await ce("M26",{waitForReady:!1,postSendDelayMs:0}),await ce("M27",{waitForReady:!1,postSendDelayMs:0}),await ce("M105",{waitForReady:!1,postSendDelayMs:0}),await ce("M18",{waitForReady:!1,postSendDelayMs:0}),o("Print job completed - printer returned to ready state","info")}catch{o("Warning: Could not clear print status","warn")}return U.stepName&&a().completeExecution(W),W}catch(W){throw U.stepName&&a().cancelExecution(),/serial connection lost|not connected/i.test(String(W.message))?o("Program stopped: serial connection lost. Reconnect and retry.","err"):o(`Program error: ${W.message}`,"err"),W}finally{t({isStreamingProgram:!1},!1,"endProgramStream"),c=null}},ne=async(v,j={})=>{const{delayMs:S=100,maxRetries:L=3,retryDelayMs:V=500,onProgress:F=null,onError:$=null}=j,U=[];let D=0,Z=0;for(let oe=0;oe<v.length;oe++){const he=v[oe];let W=0,me=!1;for(;W<L&&!me;)try{if(o(`Sending command ${oe+1}/${v.length}: ${he}`,"sys"),await N(he),await new Promise(K=>setTimeout(K,S)),a().serialLogs.slice(-5).some(K=>K.message.toLowerCase().includes("error")||K.message.toLowerCase().includes("invalid")||K.message.toLowerCase().includes("unknown")))throw new Error("Command failed - error response detected");me=!0,D++,U.push({command:he,success:!0,attempts:W+1}),F&&F(oe+1,v.length,he,!0)}catch(xe){W++,o(`Command failed (attempt ${W}/${L}): ${he} - ${xe.message}`,"err"),W<L?(o(`Retrying in ${V}ms...`,"sys"),await new Promise(O=>setTimeout(O,V))):(Z++,U.push({command:he,success:!1,attempts:W,error:xe.message}),$&&$(he,xe,oe+1,v.length))}oe<v.length-1&&await new Promise(xe=>setTimeout(xe,S))}return o(`Bulk configuration complete: ${D} successful, ${Z} failed`,"sys"),{results:U,successCount:D,failureCount:Z,total:v.length}},Q=(v,j)=>{const S=Array.isArray(j)?j:[j];for(const L of S){const V=L.message||L;if(V.toLowerCase().includes("ok"))return{success:!0,message:"Command acknowledged"};if(V.toLowerCase().includes("error")||V.toLowerCase().includes("invalid")||V.toLowerCase().includes("unknown"))return{success:!1,error:V};if(v.startsWith("M92")){const F=V.match(/echo:Steps per unit:\s*X:(\d+(?:\.\d+)?)\s*Y:(\d+(?:\.\d+)?)\s*Z:(\d+(?:\.\d+)?)\s*E:(\d+(?:\.\d+)?)/i);if(F)return{success:!0,data:{x:parseFloat(F[1]),y:parseFloat(F[2]),z:parseFloat(F[3]),e:parseFloat(F[4])}}}if(v.startsWith("M203")){const F=V.match(/echo:Maximum feedrates:\s*X:(\d+(?:\.\d+)?)\s*Y:(\d+(?:\.\d+)?)\s*Z:(\d+(?:\.\d+)?)\s*E:(\d+(?:\.\d+)?)/i);if(F)return{success:!0,data:{x:parseFloat(F[1]),y:parseFloat(F[2]),z:parseFloat(F[3]),e:parseFloat(F[4])}}}if(v.startsWith("M301")){const F=V.match(/echo:Hotend PID:\s*P:(\d+(?:\.\d+)?)\s*I:(\d+(?:\.\d+)?)\s*D:(\d+(?:\.\d+)?)/i);if(F)return{success:!0,data:{p:parseFloat(F[1]),i:parseFloat(F[2]),d:parseFloat(F[3])}}}if(v.startsWith("M304")){const F=V.match(/echo:Bed PID:\s*P:(\d+(?:\.\d+)?)\s*I:(\d+(?:\.\d+)?)\s*D:(\d+(?:\.\d+)?)/i);if(F)return{success:!0,data:{p:parseFloat(F[1]),i:parseFloat(F[2]),d:parseFloat(F[3])}}}}return{success:!0,message:"Command sent"}},X=async()=>{try{o("EMERGENCY STOP ACTIVATED","err");const v=["M112","M410","M84"];for(const j of v)try{await N(j),await new Promise(S=>setTimeout(S,100))}catch(S){o(`Emergency command ${j} failed: ${S.message}`,"err")}return o("Emergency stop sequence completed","sys"),!0}catch(v){return o(`Emergency stop failed: ${v.message}`,"err"),!1}};return{port:null,status:"disconnected",baudRate:115200,autoDetect:!0,isConnecting:!1,error:null,serialLogs:[],temperatures:{hotend:{current:0,target:0},bed:{current:0,target:0},timestamp:Date.now(),lastPoll:Date.now()},bedMesh:{data:[],gridSize:{x:0,y:0},min:0,max:0,range:0,timestamp:null,rawData:[]},m503Response:[],m503SentOnConnection:!1,writerLock:null,writerPromise:null,logCleanupInterval:null,isStreamingProgram:!1,activeExecution:null,executionHistory:[],setPort:v=>t({port:v},!1,"setPort"),setStatus:v=>t({status:v},!1,"setStatus"),setBaudRate:v=>t({baudRate:v},!1,"setBaudRate"),setAutoDetect:v=>t({autoDetect:v},!1,"setAutoDetect"),setIsConnecting:v=>t({isConnecting:v},!1,"setIsConnecting"),setError:v=>t({error:v},!1,"setError"),appendSerialLog:o,updateTemperatures:v=>t(j=>({temperatures:{...j.temperatures,...v,timestamp:Date.now()}}),!1,"updateTemperatures"),setWriterLock:v=>t({writerLock:v},!1,"setWriterLock"),setWriterPromise:v=>t({writerPromise:v},!1,"setWriterPromise"),clearLogs:()=>t({serialLogs:[]},!1,"clearLogs"),reset:()=>t({port:null,status:"disconnected",baudRate:115200,autoDetect:!0,isConnecting:!1,error:null,serialLogs:[],temperatures:{hotend:{current:0,target:0},bed:{current:0,target:0},timestamp:Date.now()},bedMesh:{data:[],gridSize:{x:0,y:0},min:0,max:0,range:0,timestamp:null,rawData:[]},writerLock:null,writerPromise:null,logCleanupInterval:null},!1,"reset"),connect:M,disconnect:C,sendCommand:N,sendCommands:R,sendCommandWithWait:ce,sendCommandsWithWait:I,emergencyStop:X,waitForPrinterReady:J,sendGcodeProgram:q,fetchBedLevel:f,runBedLeveling:y,processBedMeshData:h,updateBedMesh:x,cleanupOldLogs:g,processCollectedBedMeshData:()=>{const v=a();v.bedMesh.rawData&&v.bedMesh.rawData.length>0?(o("Manually processing collected bed mesh data...","sys"),h()):o("No bed mesh data collected to process. Try fetching bed level data first.","sys")},processM503Response:()=>{const j=a().m503Response||[];if(j.length===0)return o("No M503 response data to process","sys"),null;try{const S=j.join(`
`),L=d(S);return o(`Successfully parsed M503 response with ${j.length} lines`,"sys"),o(`Parsed settings: ${Object.keys(L).join(", ")}`,"sys"),t({m503Response:[]},!1,"clearM503Response"),L}catch(S){return o(`Error processing M503 response: ${S.message}`,"err"),null}},clearM503Response:()=>t({m503Response:[]},!1,"clearM503Response"),fetchAllPrinterSettings:async()=>{var j;const v=a();if(v.status==="connected"&&((j=v.port)!=null&&j.writable))try{o("Fetching all printer settings (M503)...","sys"),o("This will capture all current settings including bed leveling data","sys"),t(S=>({bedMesh:{...S.bedMesh,rawData:[]},m503Response:[]}),!1,"clearRawData"),await new Promise(S=>setTimeout(S,100)),await N("M503"),setTimeout(()=>{const S=a(),L=S.bedMesh.rawData||[],V=S.m503Response||[];if(o(`Captured ${L.length} bed mesh items and ${V.length} M503 lines`,"sys"),V.length>0){const F=d(V.join(`
`));o(`Parsed M503 settings: ${Object.keys(F).join(", ")}`,"sys");try{const $=je.getState();let U=$.activePrinterId;if(console.log("SerialStore: Storing M503 settings"),console.log("SerialStore: activePrinterId:",U),console.log("SerialStore: parsedSettings:",F),console.log("SerialStore: printersState:",$),!U){const D={name:"Connected Printer",model:"Unknown",firmware:"Unknown",bedSize:{x:220,y:220,z:250},firmwareConfiguration:{},calibrationSteps:[],lastUpdated:new Date().toISOString()};je.getState().addPrinter(D),U=je.getState().activePrinterId,console.log("SerialStore: Created default printer with ID:",U),o(`Created default printer with ID: ${U}`,"sys")}U&&F?(je.getState().updatePrinterSettings(U,F),o(`Printer settings stored for printer ${U}`,"sys")):(console.log("SerialStore: Cannot store settings - activePrinterId:",U,"parsedSettings:",F),o(`Cannot store settings - activePrinterId: ${U}, parsedSettings: ${!!F}`,"err"))}catch($){console.log("SerialStore: Error storing printer settings:",$),o(`Error storing printer settings: ${$.message}`,"err")}t({m503Response:[]},!1,"clearM503Response")}h()},5e3)}catch(S){o(`Failed to fetch printer settings: ${S.message}`,"err")}},sendBulkConfiguration:ne,parseConfigurationResponse:Q,startExecution:v=>t({activeExecution:{id:Date.now().toString(),type:"calibration",stepName:v.stepName,progress:{sent:0,total:v.totalCommands},startTime:Date.now(),status:"running",...v}},!1,"startExecution"),updateExecutionProgress:v=>t(j=>({activeExecution:j.activeExecution?{...j.activeExecution,progress:{...j.activeExecution.progress,...v}}:null}),!1,"updateExecutionProgress"),completeExecution:v=>t(j=>{const S=j.activeExecution?{...j.activeExecution,status:"completed",endTime:Date.now(),result:v}:null;return{activeExecution:null,executionHistory:S?[...j.executionHistory,S].slice(-10):j.executionHistory}},!1,"completeExecution"),abortExecution:async()=>{console.log("Aborting execution..."),c&&(c.abort(),c=null),t({isStreamingProgram:!1},!1,"stopProgramStream");try{await a().sendCommand("M25"),await a().sendCommand("M26"),await a().sendCommand("M105"),o("Print job stopped by user","warn")}catch(S){console.error("Failed to send stop commands:",S),o(`Failed to send stop commands: ${S.message}`,"err")}const v=a(),j=v.activeExecution?{...v.activeExecution,status:"cancelled",endTime:Date.now()}:null;t({activeExecution:null,executionHistory:j?[...v.executionHistory,j].slice(-10):v.executionHistory},!1,"abortExecution"),console.log("Execution aborted successfully")},cancelExecution:()=>t(v=>{const j=v.activeExecution?{...v.activeExecution,status:"cancelled",endTime:Date.now()}:null;return{activeExecution:null,executionHistory:j?[...v.executionHistory,j].slice(-10):v.executionHistory}},!1,"cancelExecution"),clearExecutionHistory:()=>t({executionHistory:[]},!1,"clearExecutionHistory")}}))),Fi=()=>te(t=>({sendCommand:t.sendCommand,connect:t.connect,disconnect:t.disconnect,clearLogs:t.clearLogs})),tt=bt(yt(Bt((t,a)=>({gcodeFiles:[],printQueue:[],activePrint:null,addFile:r=>{const s={id:crypto.randomUUID(),name:r.name,size:r.size,uploadDate:new Date().toISOString(),content:r.content,estimatedPrintTime:r.estimatedPrintTime||null};return t(i=>({gcodeFiles:[...i.gcodeFiles,s]})),s.id},removeFile:r=>{t(s=>({gcodeFiles:s.gcodeFiles.filter(i=>i.id!==r),printQueue:s.printQueue.filter(i=>i.fileId!==r)}))},addToQueue:r=>{if(!a().gcodeFiles.find(n=>n.id===r))return;const i={fileId:r,status:"queued",addedDate:new Date().toISOString(),startDate:null,endDate:null};t(n=>({printQueue:[...n.printQueue,i]}))},removeFromQueue:r=>{t(s=>({printQueue:s.printQueue.filter(i=>i.fileId!==r)}))},updateQueueOrder:r=>{t(s=>({printQueue:r.map(n=>s.printQueue.find(l=>l.fileId===n)).filter(Boolean)}))},startPrint:r=>{const s=a().gcodeFiles.find(i=>i.id===r);s&&t(i=>({printQueue:i.printQueue.map(n=>n.fileId===r?{...n,status:"printing",startDate:new Date().toISOString()}:n),activePrint:{fileId:r,progress:0,startTime:new Date().toISOString(),estimatedEndTime:s.estimatedPrintTime?new Date(Date.now()+s.estimatedPrintTime*1e3).toISOString():null,status:"printing"}}))},pausePrint:()=>{t(r=>r.activePrint?{printQueue:r.printQueue.map(s=>s.fileId===r.activePrint.fileId?{...s,status:"paused"}:s),activePrint:{...r.activePrint,status:"paused"}}:r)},resumePrint:()=>{t(r=>r.activePrint?{printQueue:r.printQueue.map(s=>s.fileId===r.activePrint.fileId?{...s,status:"printing"}:s),activePrint:{...r.activePrint,status:"printing"}}:r)},stopPrint:()=>{t(r=>r.activePrint?{printQueue:r.printQueue.map(s=>s.fileId===r.activePrint.fileId?{...s,status:"cancelled",endDate:new Date().toISOString()}:s),activePrint:null}:r)},completePrint:()=>{t(r=>r.activePrint?{printQueue:r.printQueue.map(s=>s.fileId===r.activePrint.fileId?{...s,status:"completed",endDate:new Date().toISOString()}:s),activePrint:null}:r)},updatePrintProgress:r=>{t(s=>s.activePrint?{activePrint:{...s.activePrint,progress:r}}:s)},getFile:r=>a().gcodeFiles.find(s=>s.id===r),getQueueItem:r=>a().printQueue.find(s=>s.fileId===r),resetStore:()=>{t({gcodeFiles:[],printQueue:[],activePrint:null})}}),{name:"gcode-files-storage",partialize:t=>({gcodeFiles:t.gcodeFiles.map(a=>({...a,content:void 0})),printQueue:t.printQueue,activePrint:null})}),{name:"GcodeFilesStore",enabled:!1})),Va=()=>tt(t=>t.gcodeFiles),Ui=()=>tt(t=>t.activePrint),Bi=()=>tt(t=>t.getFile),zi=bt(yt(Bt((t,a)=>({calibrationFiles:[],calibrationResults:[],calibrationWorkflows:[],activeWorkflow:null,addCalibrationFile:r=>{const s={id:crypto.randomUUID(),...r,type:"calibration",createdAt:new Date().toISOString(),results:null,settings:r.settings||{},analysisData:null};return t(i=>({calibrationFiles:[...i.calibrationFiles,s]})),s.id},updateCalibrationFile:(r,s)=>{t(i=>({calibrationFiles:i.calibrationFiles.map(n=>n.id===r?{...n,...s}:n)}))},addCalibrationResult:(r,s)=>{const i={id:crypto.randomUUID(),fileId:r,timestamp:new Date().toISOString(),data:s,recommendations:[],appliedSettings:null};return t(n=>({calibrationResults:[...n.calibrationResults,i],calibrationFiles:n.calibrationFiles.map(l=>l.id===r?{...l,results:i.id}:l)})),i.id},updateCalibrationResult:(r,s)=>{t(i=>({calibrationResults:i.calibrationResults.map(n=>n.id===r?{...n,...s}:n)}))},addCalibrationWorkflow:r=>{const s={id:crypto.randomUUID(),...r,createdAt:new Date().toISOString(),status:"pending",currentStep:0,results:[],recommendations:[]};return t(i=>({calibrationWorkflows:[...i.calibrationWorkflows,s]})),s.id},startWorkflow:r=>{t(s=>({activeWorkflow:r,calibrationWorkflows:s.calibrationWorkflows.map(i=>i.id===r?{...i,status:"running",currentStep:0}:i)}))},updateWorkflowStep:(r,s,i,n=null)=>{t(l=>{const c=l.calibrationWorkflows.find(d=>d.id===r);if(!c)return l;const o={...c,currentStep:s+1,results:[...c.results]};return n&&(o.results[s]=n),s+1>=c.steps.length&&(o.status="completed",o.recommendations=Gi(o.results)),{calibrationWorkflows:l.calibrationWorkflows.map(d=>d.id===r?o:d),activeWorkflow:o.status==="completed"?null:l.activeWorkflow}})},analyzeFirstLayerAdhesion:r=>({score:.85,issues:["slight_warping_corners"],recommendations:[{setting:"bed_temperature",value:65,confidence:.8},{setting:"first_layer_height",value:.24,confidence:.7}]}),analyzeStringingTest:r=>({score:.75,stringCount:12,stringThickness:.1,recommendations:[{setting:"retraction_distance",value:6.5,confidence:.85},{setting:"retraction_speed",value:45,confidence:.75}]}),analyzeBedLevel:r=>({maxDeviation:.15,problemAreas:[{x:10,y:10,deviation:.15},{x:190,y:190,deviation:-.12}],recommendations:[{corner:"front_left",adjustment:"+0.1mm"},{corner:"back_right",adjustment:"-0.1mm"}]}),getCalibrationFile:r=>a().calibrationFiles.find(s=>s.id===r),getCalibrationResult:r=>a().calibrationResults.find(s=>s.id===r),getWorkflow:r=>a().calibrationWorkflows.find(s=>s.id===r),resetStore:()=>{t({calibrationFiles:[],calibrationResults:[],calibrationWorkflows:[],activeWorkflow:null})}}),{name:"calibration-storage"}),{name:"CalibrationStore",enabled:!1}));function Gi(t){const a=[];return t.forEach(r=>{r.recommendations&&r.recommendations.forEach(s=>{const i=a.find(n=>n.setting===s.setting);if(i){const n=i.confidence+s.confidence;i.value=(i.value*i.confidence+s.value*s.confidence)/n,i.confidence=Math.max(i.confidence,s.confidence)}else a.push({...s})})}),a}const Vi=bt(yt(Bt((t,a)=>({printHistory:[],statistics:{totalPrints:0,successfulPrints:0,failedPrints:0,totalPrintTime:0,averagePrintTime:0,filamentUsed:0},addPrintRecord:r=>{const s={id:crypto.randomUUID(),timestamp:new Date().toISOString(),...r};return t(i=>{const n=[...i.printHistory,s],l={totalPrints:i.statistics.totalPrints+1,successfulPrints:i.statistics.successfulPrints+(r.status==="completed"?1:0),failedPrints:i.statistics.failedPrints+(r.status==="failed"?1:0),totalPrintTime:i.statistics.totalPrintTime+(r.duration||0),filamentUsed:i.statistics.filamentUsed+(r.filamentUsed||0)};return l.averagePrintTime=l.totalPrintTime/l.totalPrints,{printHistory:n,statistics:l}}),s.id},updatePrintRecord:(r,s)=>{t(i=>{const n=i.printHistory.findIndex(m=>m.id===r);if(n===-1)return i;const l=i.printHistory[n],c={...l,...s},o=[...i.printHistory];o[n]=c;let d={...i.statistics};return s.status&&s.status!==l.status&&(l.status==="completed"&&d.successfulPrints--,l.status==="failed"&&d.failedPrints--,s.status==="completed"&&d.successfulPrints++,s.status==="failed"&&d.failedPrints++),(s.duration!==void 0||s.filamentUsed!==void 0)&&(d.totalPrintTime+=(s.duration||0)-(l.duration||0),d.filamentUsed+=(s.filamentUsed||0)-(l.filamentUsed||0),d.averagePrintTime=d.totalPrintTime/i.statistics.totalPrints),{printHistory:o,statistics:d}})},deletePrintRecord:r=>{t(s=>{const i=s.printHistory.find(c=>c.id===r);if(!i)return s;const n=s.printHistory.filter(c=>c.id!==r),l={totalPrints:s.statistics.totalPrints-1,successfulPrints:s.statistics.successfulPrints-(i.status==="completed"?1:0),failedPrints:s.statistics.failedPrints-(i.status==="failed"?1:0),totalPrintTime:s.statistics.totalPrintTime-(i.duration||0),filamentUsed:s.statistics.filamentUsed-(i.filamentUsed||0)};return l.averagePrintTime=l.totalPrints>0?l.totalPrintTime/l.totalPrints:0,{printHistory:n,statistics:l}})},addPrintNote:(r,s)=>{t(i=>({printHistory:i.printHistory.map(n=>n.id===r?{...n,notes:[...n.notes||[],{id:crypto.randomUUID(),text:s,timestamp:new Date().toISOString()}]}:n)}))},updatePrintRating:(r,s)=>{t(i=>({printHistory:i.printHistory.map(n=>n.id===r?{...n,rating:s}:n)}))},getPrintRecord:r=>a().printHistory.find(s=>s.id===r),getStatistics:()=>a().statistics,resetStore:()=>{t({printHistory:[],statistics:{totalPrints:0,successfulPrints:0,failedPrints:0,totalPrintTime:0,averagePrintTime:0,filamentUsed:0}})}}),{name:"print-history-storage"}),{name:"PrintHistoryStore",enabled:!1})),vt=bt(yt(Bt((t,a)=>({queueItems:[],templates:[],folders:[],notifications:[],addToQueue:(r,s={})=>{const{priority:i=1,scheduledTime:n=null,dependencies:l=[],requiredMaterial:c=null,cooldownTime:o=0,templateId:d=null,parameterOverrides:m={},copies:x=1,folder:h=null,tags:f=[],notes:y="",requiredTemperature:g=null,conditionalExecution:p=null}=s,b={id:crypto.randomUUID(),fileId:r,addedAt:new Date().toISOString(),status:"pending",priority:i,scheduledTime:n,dependencies:l,requiredMaterial:c,cooldownTime:o,templateId:d,parameterOverrides:m,copies:x,folder:h,tags:f,notes:y,requiredTemperature:g,conditionalExecution:p,estimatedStartTime:null,estimatedEndTime:null};return t(w=>({queueItems:[...w.queueItems,b]})),a().recalculateQueueTimes(),b.id},updateQueueItem:(r,s)=>{t(i=>({queueItems:i.queueItems.map(n=>n.id===r?{...n,...s}:n)})),(s.scheduledTime||s.cooldownTime||s.copies)&&a().recalculateQueueTimes()},removeFromQueue:r=>{t(s=>({queueItems:s.queueItems.filter(i=>i.id!==r)})),a().recalculateQueueTimes()},reorderQueue:(r,s)=>{t(i=>{const n=[...i.queueItems],l=n.findIndex(o=>o.id===r);if(l===-1)return i;const[c]=n.splice(l,1);return n.splice(s,0,c),{queueItems:n}}),a().recalculateQueueTimes()},addTemplate:r=>{const s={id:crypto.randomUUID(),createdAt:new Date().toISOString(),...r};return t(i=>({templates:[...i.templates,s]})),s.id},updateTemplate:(r,s)=>{t(i=>({templates:i.templates.map(n=>n.id===r?{...n,...s}:n)}))},deleteTemplate:r=>{t(s=>({templates:s.templates.filter(i=>i.id!==r)}))},addFolder:(r,s=null)=>{const i={id:crypto.randomUUID(),name:r,parentId:s,createdAt:new Date().toISOString()};return t(n=>({folders:[...n.folders,i]})),i.id},updateFolder:(r,s)=>{t(i=>({folders:i.folders.map(n=>n.id===r?{...n,...s}:n)}))},deleteFolder:r=>{t(s=>({folders:s.folders.filter(i=>i.id!==r)}))},addNotification:r=>{const s={id:crypto.randomUUID(),timestamp:new Date().toISOString(),read:!1,...r};return t(i=>({notifications:[...i.notifications,s]})),s.id},markNotificationRead:r=>{t(s=>({notifications:s.notifications.map(i=>i.id===r?{...i,read:!0}:i)}))},clearNotifications:()=>{t({notifications:[]})},getNextPrintable:()=>{const r=a(),s=new Date;return r.queueItems.filter(i=>{if(i.status!=="pending"||i.scheduledTime&&new Date(i.scheduledTime)>s||i.dependencies.length>0&&i.dependencies.filter(l=>{const c=r.queueItems.find(o=>o.id===l);return!c||c.status!=="completed"}).length>0)return!1;if(i.conditionalExecution){const n=r.queueItems.find(l=>l.id===i.conditionalExecution.dependsOn);if(!n||n.status!==i.conditionalExecution.requiredStatus)return!1}return!0}).sort((i,n)=>{if(i.priority!==n.priority)return n.priority-i.priority;const l=i.scheduledTime||i.addedAt,c=n.scheduledTime||n.addedAt;return new Date(l)-new Date(c)})[0]},recalculateQueueTimes:()=>{const r=a();let s=new Date,i=null,n=null;const l=r.queueItems.map(c=>{c.requiredMaterial&&c.requiredMaterial!==i&&(s=new Date(s.getTime()+5*6e4),i=c.requiredMaterial),c.requiredTemperature&&c.requiredTemperature!==n&&(s=new Date(s.getTime()+3*6e4),n=c.requiredTemperature);const o=new Date(Math.max(s.getTime(),c.scheduledTime?new Date(c.scheduledTime).getTime():0)),d=(c.estimatedDuration||3600)*c.copies,m=new Date(o.getTime()+d*1e3);return s=new Date(m.getTime()+(c.cooldownTime||0)*1e3),{...c,estimatedStartTime:o.toISOString(),estimatedEndTime:m.toISOString()}});t({queueItems:l})},bulkAddToQueue:(r,s={})=>{r.forEach(i=>{a().addToQueue(i,s)})},bulkUpdateQueue:(r,s)=>{t(i=>({queueItems:i.queueItems.map(n=>r.includes(n.id)?{...n,...s}:n)})),a().recalculateQueueTimes()},bulkRemoveFromQueue:r=>{t(s=>({queueItems:s.queueItems.filter(i=>!r.includes(i.id))})),a().recalculateQueueTimes()},resetStore:()=>{t({queueItems:[],templates:[],folders:[],notifications:[]})}}),{name:"advanced-queue-storage"}),{name:"AdvancedQueueStore",enabled:!1})),Hi=()=>vt(t=>({addToQueue:t.addToQueue,updateQueueItem:t.updateQueueItem,removeFromQueue:t.removeFromQueue,reorderQueue:t.reorderQueue,getNextPrintable:t.getNextPrintable,recalculateQueueTimes:t.recalculateQueueTimes})),$i=()=>vt(t=>t.templates),Xi=()=>vt(t=>({addTemplate:t.addTemplate,updateTemplate:t.updateTemplate,deleteTemplate:t.deleteTemplate})),Yi=()=>vt(t=>t.folders),Zi=()=>vt(t=>({addFolder:t.addFolder,updateFolder:t.updateFolder,deleteFolder:t.deleteFolder}));class Wi{constructor(){this.stores={printers:je,serial:te,gcodeFiles:tt,calibration:zi,printHistory:Vi,advancedQueue:vt},this.initializeGlobalExposure()}initializeGlobalExposure(){typeof window<"u"&&(window.__3D_PRINTER_SUITE_STORES__={stores:this.stores,getStoreState:a=>{const r=this.stores[a];if(!r)throw new Error(`Store '${a}' not found. Available stores: ${Object.keys(this.stores).join(", ")}`);return r.getState()},subscribeToStore:(a,r)=>{const s=this.stores[a];if(!s)throw new Error(`Store '${a}' not found. Available stores: ${Object.keys(this.stores).join(", ")}`);return s.subscribe(r)},getAllStates:()=>{const a={};return Object.keys(this.stores).forEach(r=>{a[r]=this.stores[r].getState()}),a},getStoreInfo:()=>Object.keys(this.stores).map(a=>({name:a,hasState:!!this.stores[a].getState,hasSubscribe:!!this.stores[a].subscribe,hasSetState:!!this.stores[a].setState})),storeNames:Object.keys(this.stores)},Object.keys(this.stores).forEach(a=>{window[`__${a.toUpperCase()}_STORE__`]=this.stores[a]}),console.log("🔧 3D Printer Suite stores exposed globally:",{main:"window.__3D_PRINTER_SUITE_STORES__",individual:Object.keys(this.stores).map(a=>`window.__${a.toUpperCase()}_STORE__`),availableStores:Object.keys(this.stores)}))}getStore(a){return this.stores[a]}getAllStores(){return this.stores}getStoreNames(){return Object.keys(this.stores)}subscribeToAllStores(a){const r=Object.keys(this.stores).map(s=>this.stores[s].subscribe(a));return()=>{r.forEach(s=>s())}}}new Wi;const qi=[{name:"Ender 3 Pro",model:"Ender 3 Pro",firmware:"Marlin 2.1.2",bedSize:{x:235,y:235,z:250},calibrationSteps:{pidAutotune:{completed:!1,lastUpdated:null},extruderEsteps:{completed:!1,lastUpdated:null},retractionTuning:{completed:!1,lastUpdated:null},firstLayer:{completed:!1,lastUpdated:null},flowRate:{completed:!1,lastUpdated:null},temperatureTower:{completed:!1,lastUpdated:null},firmwareConfig:{completed:!1,lastUpdated:null}},firmwareConfiguration:{maxTemp:250,maxBedTemp:100,stepsPerMm:{x:80,y:80,z:400,e:93}},issues:[{id:"issue_1704110400000_abc123",timestamp:"2024-01-01T12:00:00Z",category:"mechanical",title:"Under-extrusion on first layer",description:"The printer is not extruding enough material during the first layer, causing poor bed adhesion and gaps between lines. This seems to happen mostly in the center of the bed.",status:"open",resolvedTimestamp:null,followUpActions:[{id:"action_1704110460000_def456",description:"Check extruder tension and ensure proper grip on filament",completed:!0,timestamp:"2024-01-01T12:01:00Z"},{id:"action_1704110520000_ghi789",description:"Calibrate E-Steps to ensure accurate extrusion amounts",completed:!1,timestamp:"2024-01-01T12:02:00Z"}]},{id:"issue_1704196800000_jkl012",timestamp:"2024-01-02T12:00:00Z",category:"electrical",title:"Temperature fluctuations during printing",description:"The hotend temperature keeps fluctuating ±3°C during prints, causing inconsistent extrusion and layer quality.",status:"resolved",resolvedTimestamp:"2024-01-03T15:30:00Z",followUpActions:[{id:"action_1704196860000_mno345",description:"Run PID autotune for hotend and bed",completed:!0,timestamp:"2024-01-02T12:01:00Z"},{id:"action_1704196920000_pqr678",description:"Check thermistor connections",completed:!0,timestamp:"2024-01-02T12:02:00Z"}]},{id:"issue_1704283200000_stu901",timestamp:"2024-01-03T12:00:00Z",category:"firmware",title:"Stringing between towers",description:"Getting significant stringing when printing multiple objects or tower tests. Retraction settings may need adjustment.",status:"in-progress",resolvedTimestamp:null,followUpActions:[{id:"action_1704283260000_vwx234",description:"Increase retraction distance (try 0.5-1mm more)",completed:!0,timestamp:"2024-01-03T12:01:00Z"},{id:"action_1704283320000_yza567",description:"Lower nozzle temperature by 5-10°C",completed:!1,timestamp:"2024-01-03T12:02:00Z"}]}]},{name:"Prusa i3 MK3S+",model:"Prusa i3 MK3S+",firmware:"Prusa Firmware 3.12.1",bedSize:{x:250,y:210,z:200},calibrationSteps:{pidAutotune:{completed:!0,lastUpdated:"2024-01-15T10:30:00Z"},extruderEsteps:{completed:!0,lastUpdated:"2024-01-15T10:35:00Z"},retractionTuning:{completed:!1,lastUpdated:null},firstLayer:{completed:!0,lastUpdated:"2024-01-15T10:40:00Z"},flowRate:{completed:!1,lastUpdated:null},temperatureTower:{completed:!1,lastUpdated:null},firmwareConfig:{completed:!1,lastUpdated:null}},firmwareConfiguration:{maxTemp:300,maxBedTemp:120,stepsPerMm:{x:100,y:100,z:400,e:280}},issues:[]}],Ha=u.createContext(),$a=()=>{const t=u.useContext(Ha);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t},Qi=({children:t})=>{const[a,r]=u.useState(()=>{const n=localStorage.getItem("theme");return n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});u.useEffect(()=>{const n=window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(a),localStorage.setItem("theme",a)},[a]);const i={theme:a,toggleTheme:()=>{r(n=>n==="light"?"dark":"light")},isDark:a==="dark"};return e.jsx(Ha.Provider,{value:i,children:t})},vr=({className:t="h-8 w-8"})=>{const{isDark:a}=$a(),r=a?"#000064":"#D4DDF6",s=a?"#D4DDF6":"#000064";return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"61",fill:"none",viewBox:"0 0 56 61",className:t,children:[e.jsx("defs",{}),e.jsx("path",{fill:r,stroke:s,strokeWidth:".769",d:"M18.662 50.518l-9.626 2.588V25.924l9.626-1.737v26.331z"}),e.jsx("path",{fill:s,d:"M16.627.808c8.771 0 11.163 3.2 11.163 3.2V15.21l-14.352-6.4L.744 13.726C.744.925 16.627.808 16.627.808z"}),e.jsx("path",{fill:s,d:"M38.905.808c-8.771 0-11.163 3.2-11.163 3.2V15.21l14.352-6.4 12.694 4.917C54.788.925 38.905.808 38.905.808z"}),e.jsx("path",{fill:s,d:"M36.67 17.893l10.191 1.042 1.23-.417V7.892H36.67v10.001zM36.671 34.77l9.968 2.5 1.66-1.042v-6.875l-11.42.208-.208 5.209zM8.652 53.608L.538 50.769v-36c0-12.801 12.898-12.362 12.898-12.362 14.353.8 14.353 9.6 14.353 14.4v44.001l-9.569-3.536V36.227c0-4.8-9.568-7.867-9.568-2.864v20.245zM36.462 23.102l15.576 2.5-15.576 3.334v-5.834z"}),e.jsx("path",{fill:r,stroke:`#${r}064`,strokeWidth:".769",d:"M8.651 15.208c0-4.8 9.569-3.2 9.569 1.6v11.2l-9.569-2.4v-10.4z"}),e.jsx("path",{fill:r,stroke:r,strokeWidth:".769",d:"M18.278 28.046L8.65 25.608v-10.4c0-4.685 9.627-3.645 9.627 1.214v11.624z"}),e.jsx("path",{fill:r,stroke:s,strokeWidth:".769",d:"M8.359 25.433l-.022.751 10.175 2.5.477.117v-5.327l-.455.083L8.36 25.433zM36.972 27.477v.437l.434-.055 14.247-1.82v9.478l-4.63 1.25v-3.872a1.83 1.83 0 00-.504-1.291c-.315-.333-.747-.556-1.227-.691-.957-.269-2.192-.212-3.398.127-2.397.672-4.922 2.542-4.922 5.605V57.33l-8.799 2.943V40.607v-23.8c0-2.413.008-5.704 1.737-8.498 1.707-2.76 5.154-5.121 12.24-5.519h.023l.104.003c.093.003.23.008.404.018.35.021.852.063 1.454.145 1.208.166 2.81.495 4.402 1.146 1.594.652 3.162 1.618 4.325 3.05 1.157 1.424 1.93 3.33 1.906 5.9h0v3.901l-7.538 1.512v-3.489c0-1.17-.71-2.037-1.683-2.566-.969-.525-2.233-.743-3.478-.636-1.248.106-2.516.54-3.48 1.367-.974.834-1.617 2.052-1.617 3.666v10.67z"}),e.jsx("path",{fill:r,stroke:s,strokeWidth:".769",d:"M36.972 27.477h14.247v3.2H36.972v-3.2z"})]})},Nr=()=>{const{theme:t,toggleTheme:a}=$a();return e.jsx("button",{onClick:a,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx(Bn,{className:"h-5 w-5"}):e.jsx(zn,{className:"h-5 w-5"})})},Ki=({onPrinterSelect:t})=>{const[a,r]=u.useState(!1),[s,i]=u.useState({name:"",model:"",firmware:"",bedSize:{x:220,y:220,z:250}}),n=Ri(),l=Mi(),c=ki(),o=Ga(),d=Ai(),m=["Ender 3","Ender 3 Pro","Ender 3 V2","Ender 3 S1","Ender 3 S1 Pro","Ender 5","Ender 5 Plus","Prusa i3 MK3S+","Prusa i3 MK4","Prusa Mini+","Voron 2.4","Voron Trident","RatRig V-Core 3","Custom"],x=["Marlin 2.0.x","Marlin 2.1.x","Marlin 2.2.x","Prusa Firmware","Klipper","RepRapFirmware","Custom"],h=()=>{s.name&&s.model&&(l(s),i({name:"",model:"",firmware:"",bedSize:{x:220,y:220,z:250}}),r(!1))},f=b=>{o(b),t(b)},y=()=>{qi.forEach(b=>l(b))},g=b=>b.calibrationSteps?Object.values(b.calibrationSteps).filter(w=>w==null?void 0:w.completed).length:0,p=b=>b.calibrationSteps?Object.keys(b.calibrationSteps).length:0;return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-800 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(vr,{className:"h-8 w-8 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"3D Printer Suite"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Nr,{}),e.jsxs("button",{onClick:y,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(Gn,{className:"h-4 w-4"}),e.jsx("span",{children:"Load Sample Data"})]}),e.jsx("button",{onClick:()=>d(),className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors flex items-center space-x-2",children:e.jsx("span",{children:"Reset Store"})}),e.jsxs("button",{onClick:()=>r(!a),className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx("span",{children:"Add New Printer"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Printer"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Printer Name *"}),e.jsx("input",{type:"text",placeholder:"e.g., My Ender 3",value:s.name,onChange:b=>i({...s,name:b.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Model *"}),e.jsxs("select",{value:s.model,onChange:b=>i({...s,model:b.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Model"}),m.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Firmware"}),e.jsxs("select",{value:s.firmware,onChange:b=>i({...s,firmware:b.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Firmware"}),x.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bed Size (mm)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"number",placeholder:"X",value:s.bedSize.x,onChange:b=>i({...s,bedSize:{...s.bedSize,x:parseInt(b.target.value)||0}}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("input",{type:"number",placeholder:"Y",value:s.bedSize.y,onChange:b=>i({...s,bedSize:{...s.bedSize,y:parseInt(b.target.value)||0}}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("input",{type:"number",placeholder:"Z",value:s.bedSize.z,onChange:b=>i({...s,bedSize:{...s.bedSize,z:parseInt(b.target.value)||0}}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:!s.name||!s.model,className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Printer"})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ot,{className:"h-16 w-16 text-gray-300 dark:text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Printers Added"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Get started by adding your first 3D printer"}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white px-6 py-3 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2 mx-auto",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Your First Printer"})]})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-6",children:"Your Printers"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(b=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>f(b.id),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ot,{className:"h-6 w-6 text-gray-600 dark:text-gray-300 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:b.name})]}),e.jsx("button",{onClick:w=>{w.stopPropagation(),c(b.id)},className:"text-gray-400 dark:text-gray-500 dark:text-gray-400 hover:text-red-500 transition-colors p-1",children:e.jsx(_s,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",b.model]}),b.firmware&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Firmware:"})," ",b.firmware]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Bed Size:"})," ",b.bedSize.x," × ",b.bedSize.y," × ",b.bedSize.z," mm"]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Calibration Progress"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g(b),"/",p(b)]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 h-2 rounded-full transition-all duration-300",style:{width:`${p(b)>0?g(b)/p(b)*100:0}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[e.jsxs("button",{onClick:w=>{w.stopPropagation(),f(b.id)},className:"text-gray-600 dark:text-gray-300 hover:text-blue-600 text-sm font-medium flex items-center",children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),"Configure"]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[g(b)>0&&e.jsx(Ee,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:g(b)>0?"Ready":"Setup Required"})]})]})]})},b.id))})]})]})]})};function Ts(){const t=te(h=>h.status),a=te(h=>h.baudRate),r=te(h=>h.autoDetect),s=te(h=>h.error),i=te(h=>h.port),n=te(h=>h.connect),l=te(h=>h.disconnect),c=te(h=>h.sendCommand),o=te(h=>h.sendCommands),d=te(h=>h.clearLogs),m=te(h=>h.setBaudRate),x=te(h=>h.setAutoDetect);return{status:t,baudRate:a,setBaudRate:m,autoDetect:r,setAutoDetect:x,port:i,error:s,connect:n,disconnect:l,sendCommand:c,sendCommands:o,clearLogs:d}}var Xa={exports:{}},Ya={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function a(Q,X){var v=Q.length;Q.push(X);e:for(;0<v;){var j=v-1>>>1,S=Q[j];if(0<i(S,X))Q[j]=X,Q[v]=S,v=j;else break e}}function r(Q){return Q.length===0?null:Q[0]}function s(Q){if(Q.length===0)return null;var X=Q[0],v=Q.pop();if(v!==X){Q[0]=v;e:for(var j=0,S=Q.length,L=S>>>1;j<L;){var V=2*(j+1)-1,F=Q[V],$=V+1,U=Q[$];if(0>i(F,v))$<S&&0>i(U,F)?(Q[j]=U,Q[$]=v,j=$):(Q[j]=F,Q[V]=v,j=V);else if($<S&&0>i(U,v))Q[j]=U,Q[$]=v,j=$;else break e}}return X}function i(Q,X){var v=Q.sortIndex-X.sortIndex;return v!==0?v:Q.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var o=[],d=[],m=1,x=null,h=3,f=!1,y=!1,g=!1,p=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(Q){for(var X=r(d);X!==null;){if(X.callback===null)s(d);else if(X.startTime<=Q)s(d),X.sortIndex=X.expirationTime,a(o,X);else break;X=r(d)}}function A(Q){if(g=!1,_(Q),!y)if(r(o)!==null)y=!0,q(C);else{var X=r(d);X!==null&&ne(A,X.startTime-Q)}}function C(Q,X){y=!1,g&&(g=!1,b(G),G=-1),f=!0;var v=h;try{for(_(X),x=r(o);x!==null&&(!(x.expirationTime>X)||Q&&!N());){var j=x.callback;if(typeof j=="function"){x.callback=null,h=x.priorityLevel;var S=j(x.expirationTime<=X);X=t.unstable_now(),typeof S=="function"?x.callback=S:x===r(o)&&s(o),_(X)}else s(o);x=r(o)}if(x!==null)var L=!0;else{var V=r(d);V!==null&&ne(A,V.startTime-X),L=!1}return L}finally{x=null,h=v,f=!1}}var M=!1,T=null,G=-1,E=5,k=-1;function N(){return!(t.unstable_now()-k<E)}function R(){if(T!==null){var Q=t.unstable_now();k=Q;var X=!0;try{X=T(!0,Q)}finally{X?I():(M=!1,T=null)}}else M=!1}var I;if(typeof w=="function")I=function(){w(R)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,ce=J.port2;J.port1.onmessage=R,I=function(){ce.postMessage(null)}}else I=function(){p(R,0)};function q(Q){T=Q,M||(M=!0,I())}function ne(Q,X){G=p(function(){Q(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){y||f||(y=!0,q(C))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(o)},t.unstable_next=function(Q){switch(h){case 1:case 2:case 3:var X=3;break;default:X=h}var v=h;h=X;try{return Q()}finally{h=v}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,X){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var v=h;h=Q;try{return X()}finally{h=v}},t.unstable_scheduleCallback=function(Q,X,v){var j=t.unstable_now();switch(typeof v=="object"&&v!==null?(v=v.delay,v=typeof v=="number"&&0<v?j+v:j):v=j,Q){case 1:var S=-1;break;case 2:S=250;break;case 5:S=1073741823;break;case 4:S=1e4;break;default:S=5e3}return S=v+S,Q={id:m++,callback:X,priorityLevel:Q,startTime:v,expirationTime:S,sortIndex:-1},v>j?(Q.sortIndex=v,a(d,Q),r(o)===null&&Q===r(d)&&(g?(b(G),G=-1):g=!0,ne(A,v-j))):(Q.sortIndex=S,a(o,Q),y||f||(y=!0,q(C))),Q},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(Q){var X=h;return function(){var v=h;h=X;try{return Q.apply(this,arguments)}finally{h=v}}}})(Ya);Xa.exports=Ya;var td=Xa.exports,Ji=Object.defineProperty,el=Object.defineProperties,tl=Object.getOwnPropertyDescriptors,na=Object.getOwnPropertySymbols,sl=Object.prototype.hasOwnProperty,rl=Object.prototype.propertyIsEnumerable,ia=(t,a,r)=>a in t?Ji(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,la=(t,a)=>{for(var r in a||(a={}))sl.call(a,r)&&ia(t,r,a[r]);if(na)for(var r of na(a))rl.call(a,r)&&ia(t,r,a[r]);return t},al=(t,a)=>el(t,tl(a)),oa,ca;typeof window<"u"&&((oa=window.document)!=null&&oa.createElement||((ca=window.navigator)==null?void 0:ca.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function Za(t,a,r){if(!t)return;if(r(t)===!0)return t;let s=a?t.return:t.child;for(;s;){const i=Za(s,a,r);if(i)return i;s=a?null:s.sibling}}function Wa(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const da=console.error;console.error=function(){const t=[...arguments].join("");if(t!=null&&t.startsWith("Warning:")&&t.includes("useContext")){console.error=da;return}return da.apply(this,arguments)};const jr=Wa(u.createContext(null));class nl extends u.Component{render(){return u.createElement(jr.Provider,{value:this._reactInternals},this.props.children)}}function il(){const t=u.useContext(jr);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const a=u.useId();return u.useMemo(()=>{for(const s of[t,t==null?void 0:t.alternate]){if(!s)continue;const i=Za(s,!1,n=>{let l=n.memoizedState;for(;l;){if(l.memoizedState===a)return!0;l=l.next}});if(i)return i}},[t,a])}function ll(){const t=il(),[a]=u.useState(()=>new Map);a.clear();let r=t;for(;r;){if(r.type&&typeof r.type=="object"){const i=r.type._context===void 0&&r.type.Provider===r.type?r.type:r.type._context;i&&i!==jr&&!a.has(i)&&a.set(i,u.useContext(Wa(i)))}r=r.return}return a}function sd(){const t=ll();return u.useMemo(()=>Array.from(t.keys()).reduce((a,r)=>s=>u.createElement(a,null,u.createElement(r.Provider,al(la({},s),{value:t.get(r)}))),a=>u.createElement(nl,la({},a))),[t])}function ma(){return ma=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},ma.apply(null,arguments)}function ol(){var t=Object.create(null);function a(i,n){var l=i.id,c=i.name,o=i.dependencies;o===void 0&&(o=[]);var d=i.init;d===void 0&&(d=function(){});var m=i.getTransferables;if(m===void 0&&(m=null),!t[l])try{o=o.map(function(h){return h&&h.isWorkerModule&&(a(h,function(f){if(f instanceof Error)throw f}),h=t[h.id].value),h}),d=s("<"+c+">.init",d),m&&(m=s("<"+c+">.getTransferables",m));var x=null;typeof d=="function"?x=d.apply(void 0,o):console.error("worker module init function failed to rehydrate"),t[l]={id:l,value:x,getTransferables:m},n(x)}catch(h){h&&h.noLog||console.error(h),n(h)}}function r(i,n){var l,c=i.id,o=i.args;(!t[c]||typeof t[c].value!="function")&&n(new Error("Worker module "+c+": not found or its 'init' did not return a function"));try{var d=(l=t[c]).value.apply(l,o);d&&typeof d.then=="function"?d.then(m,function(x){return n(x instanceof Error?x:new Error(""+x))}):m(d)}catch(x){n(x)}function m(x){try{var h=t[c].getTransferables&&t[c].getTransferables(x);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),n(x,h)}catch(f){console.error(f),n(f)}}}function s(i,n){var l=void 0;self.troikaDefine=function(o){return l=o};var c=URL.createObjectURL(new Blob(["/** "+i.replace(/\*/g,"")+` **/

troikaDefine(
`+n+`
)`],{type:"application/javascript"}));try{importScripts(c)}catch(o){console.error(o)}return URL.revokeObjectURL(c),delete self.troikaDefine,l}self.addEventListener("message",function(i){var n=i.data,l=n.messageId,c=n.action,o=n.data;try{c==="registerModule"&&a(o,function(d){d instanceof Error?postMessage({messageId:l,success:!1,error:d.message}):postMessage({messageId:l,success:!0,result:{isCallable:typeof d=="function"}})}),c==="callModule"&&r(o,function(d,m){d instanceof Error?postMessage({messageId:l,success:!1,error:d.message}):postMessage({messageId:l,success:!0,result:d},m||void 0)})}catch(d){postMessage({messageId:l,success:!1,error:d.stack})}})}function cl(t){var a=function(){for(var r=[],s=arguments.length;s--;)r[s]=arguments[s];return a._getInitResult().then(function(i){if(typeof i=="function")return i.apply(void 0,r);throw new Error("Worker module function was called but `init` did not return a callable function")})};return a._getInitResult=function(){var r=t.dependencies,s=t.init;r=Array.isArray(r)?r.map(function(n){return n&&(n=n.onMainThread||n,n._getInitResult&&(n=n._getInitResult())),n}):[];var i=Promise.all(r).then(function(n){return s.apply(null,n)});return a._getInitResult=function(){return i},i},a}var qa=function(){var t=!1;if(typeof window<"u"&&typeof window.document<"u")try{var a=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));a.terminate(),t=!0}catch(r){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+r.message+"]")}return qa=function(){return t},t},dl=0,ml=0,tr=!1,At=Object.create(null),It=Object.create(null),cr=Object.create(null);function ul(t){if((!t||typeof t.init!="function")&&!tr)throw new Error("requires `options.init` function");var a=t.dependencies,r=t.init,s=t.getTransferables,i=t.workerId,n=cl(t);i==null&&(i="#default");var l="workerModule"+ ++dl,c=t.name||l,o=null;a=a&&a.map(function(m){return typeof m=="function"&&!m.workerModuleData&&(tr=!0,m=ul({workerId:i,name:"<"+c+"> function dependency: "+m.name,init:`function(){return (
`+os(m)+`
)}`}),tr=!1),m&&m.workerModuleData&&(m=m.workerModuleData),m});function d(){for(var m=[],x=arguments.length;x--;)m[x]=arguments[x];if(!qa())return n.apply(void 0,m);if(!o){o=ua(i,"registerModule",d.workerModuleData);var h=function(){o=null,It[i].delete(h)};(It[i]||(It[i]=new Set)).add(h)}return o.then(function(f){var y=f.isCallable;if(y)return ua(i,"callModule",{id:l,args:m});throw new Error("Worker module function was called but `init` did not return a callable function")})}return d.workerModuleData={isWorkerModule:!0,id:l,name:c,dependencies:a,init:os(r),getTransferables:s&&os(s)},d.onMainThread=n,d}function rd(t){It[t]&&It[t].forEach(function(a){a()}),At[t]&&(At[t].terminate(),delete At[t])}function os(t){var a=t.toString();return!/^function/.test(a)&&/^\w+\s*\(/.test(a)&&(a="function "+a),a}function xl(t){var a=At[t];if(!a){var r=os(ol);a=At[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+` **/

;(`+r+")()"],{type:"application/javascript"}))),a.onmessage=function(s){var i=s.data,n=i.messageId,l=cr[n];if(!l)throw new Error("WorkerModule response with empty or unknown messageId");delete cr[n],l(i)}}return a}function ua(t,a,r){return new Promise(function(s,i){var n=++ml;cr[n]=function(l){l.success?s(l.result):i(new Error("Error in worker "+a+" call: "+l.error))},xl(t).postMessage({messageId:n,action:a,data:r})})}function ad(){var t=function(a){function r(X,v,j,S,L,V,F,$){var U=1-F;$.x=U*U*X+2*U*F*j+F*F*L,$.y=U*U*v+2*U*F*S+F*F*V}function s(X,v,j,S,L,V,F,$,U,D){var Z=1-U;D.x=Z*Z*Z*X+3*Z*Z*U*j+3*Z*U*U*L+U*U*U*F,D.y=Z*Z*Z*v+3*Z*Z*U*S+3*Z*U*U*V+U*U*U*$}function i(X,v){for(var j=/([MLQCZ])([^MLQCZ]*)/g,S,L,V,F,$;S=j.exec(X);){var U=S[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(D){return parseFloat(D)});switch(S[1]){case"M":F=L=U[0],$=V=U[1];break;case"L":(U[0]!==F||U[1]!==$)&&v("L",F,$,F=U[0],$=U[1]);break;case"Q":{v("Q",F,$,F=U[2],$=U[3],U[0],U[1]);break}case"C":{v("C",F,$,F=U[4],$=U[5],U[0],U[1],U[2],U[3]);break}case"Z":(F!==L||$!==V)&&v("L",F,$,L,V);break}}}function n(X,v,j){j===void 0&&(j=16);var S={x:0,y:0};i(X,function(L,V,F,$,U,D,Z,oe,he){switch(L){case"L":v(V,F,$,U);break;case"Q":{for(var W=V,me=F,xe=1;xe<j;xe++)r(V,F,D,Z,$,U,xe/(j-1),S),v(W,me,S.x,S.y),W=S.x,me=S.y;break}case"C":{for(var O=V,K=F,ae=1;ae<j;ae++)s(V,F,D,Z,oe,he,$,U,ae/(j-1),S),v(O,K,S.x,S.y),O=S.x,K=S.y;break}}})}var l="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",c="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",o=new WeakMap,d={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function m(X,v){var j=X.getContext?X.getContext("webgl",d):X,S=o.get(j);if(!S){let Z=function(O){var K=V[O];if(!K&&(K=V[O]=j.getExtension(O),!K))throw new Error(O+" not supported");return K},oe=function(O,K){var ae=j.createShader(K);return j.shaderSource(ae,O),j.compileShader(ae),ae},he=function(O,K,ae,Y){if(!F[O]){var le={},de={},se=j.createProgram();j.attachShader(se,oe(K,j.VERTEX_SHADER)),j.attachShader(se,oe(ae,j.FRAGMENT_SHADER)),j.linkProgram(se),F[O]={program:se,transaction:function(ie){j.useProgram(se),ie({setUniform:function(B,z){for(var P=[],H=arguments.length-2;H-- >0;)P[H]=arguments[H+2];var ee=de[z]||(de[z]=j.getUniformLocation(se,z));j["uniform"+B].apply(j,[ee].concat(P))},setAttribute:function(B,z,P,H,ee){var re=le[B];re||(re=le[B]={buf:j.createBuffer(),loc:j.getAttribLocation(se,B),data:null}),j.bindBuffer(j.ARRAY_BUFFER,re.buf),j.vertexAttribPointer(re.loc,z,j.FLOAT,!1,0,0),j.enableVertexAttribArray(re.loc),L?j.vertexAttribDivisor(re.loc,H):Z("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(re.loc,H),ee!==re.data&&(j.bufferData(j.ARRAY_BUFFER,ee,P),re.data=ee)}})}}}F[O].transaction(Y)},W=function(O,K){U++;try{j.activeTexture(j.TEXTURE0+U);var ae=$[O];ae||(ae=$[O]=j.createTexture(),j.bindTexture(j.TEXTURE_2D,ae),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.NEAREST),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.NEAREST)),j.bindTexture(j.TEXTURE_2D,ae),K(ae,U)}finally{U--}},me=function(O,K,ae){var Y=j.createFramebuffer();D.push(Y),j.bindFramebuffer(j.FRAMEBUFFER,Y),j.activeTexture(j.TEXTURE0+K),j.bindTexture(j.TEXTURE_2D,O),j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,O,0);try{ae(Y)}finally{j.deleteFramebuffer(Y),j.bindFramebuffer(j.FRAMEBUFFER,D[--D.length-1]||null)}},xe=function(){V={},F={},$={},U=-1,D.length=0};var L=typeof WebGL2RenderingContext<"u"&&j instanceof WebGL2RenderingContext,V={},F={},$={},U=-1,D=[];j.canvas.addEventListener("webglcontextlost",function(O){xe(),O.preventDefault()},!1),o.set(j,S={gl:j,isWebGL2:L,getExtension:Z,withProgram:he,withTexture:W,withTextureFramebuffer:me,handleContextLoss:xe})}v(S)}function x(X,v,j,S,L,V,F,$){F===void 0&&(F=15),$===void 0&&($=null),m(X,function(U){var D=U.gl,Z=U.withProgram,oe=U.withTexture;oe("copy",function(he,W){D.texImage2D(D.TEXTURE_2D,0,D.RGBA,L,V,0,D.RGBA,D.UNSIGNED_BYTE,v),Z("copy",l,c,function(me){var xe=me.setUniform,O=me.setAttribute;O("aUV",2,D.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),xe("1i","image",W),D.bindFramebuffer(D.FRAMEBUFFER,$||null),D.disable(D.BLEND),D.colorMask(F&8,F&4,F&2,F&1),D.viewport(j,S,L,V),D.scissor(j,S,L,V),D.drawArrays(D.TRIANGLES,0,3)})})})}function h(X,v,j){var S=X.width,L=X.height;m(X,function(V){var F=V.gl,$=new Uint8Array(S*L*4);F.readPixels(0,0,S,L,F.RGBA,F.UNSIGNED_BYTE,$),X.width=v,X.height=j,x(F,$,0,0,S,L)})}var f=Object.freeze({__proto__:null,withWebGLContext:m,renderImageData:x,resizeWebGLCanvasWithoutClearing:h});function y(X,v,j,S,L,V){V===void 0&&(V=1);var F=new Uint8Array(X*v),$=S[2]-S[0],U=S[3]-S[1],D=[];n(j,function(O,K,ae,Y){D.push({x1:O,y1:K,x2:ae,y2:Y,minX:Math.min(O,ae),minY:Math.min(K,Y),maxX:Math.max(O,ae),maxY:Math.max(K,Y)})}),D.sort(function(O,K){return O.maxX-K.maxX});for(var Z=0;Z<X;Z++)for(var oe=0;oe<v;oe++){var he=me(S[0]+$*(Z+.5)/X,S[1]+U*(oe+.5)/v),W=Math.pow(1-Math.abs(he)/L,V)/2;he<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),F[oe*X+Z]=W}return F;function me(O,K){for(var ae=1/0,Y=1/0,le=D.length;le--;){var de=D[le];if(de.maxX+Y<=O)break;if(O+Y>de.minX&&K-Y<de.maxY&&K+Y>de.minY){var se=b(O,K,de.x1,de.y1,de.x2,de.y2);se<ae&&(ae=se,Y=Math.sqrt(ae))}}return xe(O,K)&&(Y=-Y),Y}function xe(O,K){for(var ae=0,Y=D.length;Y--;){var le=D[Y];if(le.maxX<=O)break;var de=le.y1>K!=le.y2>K&&O<(le.x2-le.x1)*(K-le.y1)/(le.y2-le.y1)+le.x1;de&&(ae+=le.y1<le.y2?1:-1)}return ae!==0}}function g(X,v,j,S,L,V,F,$,U,D){V===void 0&&(V=1),$===void 0&&($=0),U===void 0&&(U=0),D===void 0&&(D=0),p(X,v,j,S,L,V,F,null,$,U,D)}function p(X,v,j,S,L,V,F,$,U,D,Z){V===void 0&&(V=1),U===void 0&&(U=0),D===void 0&&(D=0),Z===void 0&&(Z=0);for(var oe=y(X,v,j,S,L,V),he=new Uint8Array(oe.length*4),W=0;W<oe.length;W++)he[W*4+Z]=oe[W];x(F,he,U,D,X,v,1<<3-Z,$)}function b(X,v,j,S,L,V){var F=L-j,$=V-S,U=F*F+$*$,D=U?Math.max(0,Math.min(1,((X-j)*F+(v-S)*$)/U)):0,Z=X-(j+D*F),oe=v-(S+D*$);return Z*Z+oe*oe}var w=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:g,generateIntoFramebuffer:p}),_="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",A="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",C="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",M=new Float32Array([0,0,2,0,0,2]),T=null,G=!1,E={},k=new WeakMap;function N(X){if(!G&&!ce(X))throw new Error("WebGL generation not supported")}function R(X,v,j,S,L,V,F){if(V===void 0&&(V=1),F===void 0&&(F=null),!F&&(F=T,!F)){var $=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!$)throw new Error("OffscreenCanvas or DOM canvas not supported");F=T=$.getContext("webgl",{depth:!1})}N(F);var U=new Uint8Array(X*v*4);m(F,function(he){var W=he.gl,me=he.withTexture,xe=he.withTextureFramebuffer;me("readable",function(O,K){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,X,v,0,W.RGBA,W.UNSIGNED_BYTE,null),xe(O,K,function(ae){J(X,v,j,S,L,V,W,ae,0,0,0),W.readPixels(0,0,X,v,W.RGBA,W.UNSIGNED_BYTE,U)})})});for(var D=new Uint8Array(X*v),Z=0,oe=0;Z<U.length;Z+=4)D[oe++]=U[Z];return D}function I(X,v,j,S,L,V,F,$,U,D){V===void 0&&(V=1),$===void 0&&($=0),U===void 0&&(U=0),D===void 0&&(D=0),J(X,v,j,S,L,V,F,null,$,U,D)}function J(X,v,j,S,L,V,F,$,U,D,Z){V===void 0&&(V=1),U===void 0&&(U=0),D===void 0&&(D=0),Z===void 0&&(Z=0),N(F);var oe=[];n(j,function(he,W,me,xe){oe.push(he,W,me,xe)}),oe=new Float32Array(oe),m(F,function(he){var W=he.gl,me=he.isWebGL2,xe=he.getExtension,O=he.withProgram,K=he.withTexture,ae=he.withTextureFramebuffer,Y=he.handleContextLoss;if(K("rawDistances",function(le,de){(X!==le._lastWidth||v!==le._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,le._lastWidth=X,le._lastHeight=v,0,W.RGBA,W.UNSIGNED_BYTE,null),O("main",_,A,function(se){var ve=se.setAttribute,ie=se.setUniform,fe=!me&&xe("ANGLE_instanced_arrays"),B=!me&&xe("EXT_blend_minmax");ve("aUV",2,W.STATIC_DRAW,0,M),ve("aLineSegment",4,W.DYNAMIC_DRAW,1,oe),ie.apply(void 0,["4f","uGlyphBounds"].concat(S)),ie("1f","uMaxDistance",L),ie("1f","uExponent",V),ae(le,de,function(z){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,X,v),W.scissor(0,0,X,v),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,me?W.MAX:B.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),me?W.drawArraysInstanced(W.TRIANGLES,0,3,oe.length/4):fe.drawArraysInstancedANGLE(W.TRIANGLES,0,3,oe.length/4)})}),O("post",l,C,function(se){se.setAttribute("aUV",2,W.STATIC_DRAW,0,M),se.setUniform("1i","tex",de),W.bindFramebuffer(W.FRAMEBUFFER,$),W.disable(W.BLEND),W.colorMask(Z===0,Z===1,Z===2,Z===3),W.viewport(U,D,X,v),W.scissor(U,D,X,v),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw Y(),new Error("webgl context lost")})}function ce(X){var v=!X||X===T?E:X.canvas||X,j=k.get(v);if(j===void 0){G=!0;var S=null;try{var L=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],V=R(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,X);j=V&&L.length===V.length&&V.every(function(F,$){return F===L[$]}),j||(S="bad trial run results",console.info(L,V))}catch(F){j=!1,S=F.message}S&&console.warn("WebGL SDF generation not supported:",S),G=!1,k.set(v,j)}return j}var q=Object.freeze({__proto__:null,generate:R,generateIntoCanvas:I,generateIntoFramebuffer:J,isSupported:ce});function ne(X,v,j,S,L,V){L===void 0&&(L=Math.max(S[2]-S[0],S[3]-S[1])/2),V===void 0&&(V=1);try{return R.apply(q,arguments)}catch(F){return console.info("WebGL SDF generation failed, falling back to JS",F),y.apply(w,arguments)}}function Q(X,v,j,S,L,V,F,$,U,D){L===void 0&&(L=Math.max(S[2]-S[0],S[3]-S[1])/2),V===void 0&&(V=1),$===void 0&&($=0),U===void 0&&(U=0),D===void 0&&(D=0);try{return I.apply(q,arguments)}catch(Z){return console.info("WebGL SDF generation failed, falling back to JS",Z),g.apply(w,arguments)}}return a.forEachPathCommand=i,a.generate=ne,a.generateIntoCanvas=Q,a.javascript=w,a.pathToLineSegments=n,a.webgl=q,a.webglUtils=f,Object.defineProperty(a,"__esModule",{value:!0}),a}({});return t}function nd(){var t=function(a){var r={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},s={},i={};s.L=1,i[1]="L",Object.keys(r).forEach(function(Y,le){s[Y]=1<<le+1,i[s[Y]]=Y}),Object.freeze(s);var n=s.LRI|s.RLI|s.FSI,l=s.L|s.R|s.AL,c=s.B|s.S|s.WS|s.ON|s.FSI|s.LRI|s.RLI|s.PDI,o=s.BN|s.RLE|s.LRE|s.RLO|s.LRO|s.PDF,d=s.S|s.WS|s.B|n|s.PDI|o,m=null;function x(){if(!m){m=new Map;var Y=function(de){if(r.hasOwnProperty(de)){var se=0;r[de].split(",").forEach(function(ve){var ie=ve.split("+"),fe=ie[0],B=ie[1];fe=parseInt(fe,36),B=B?parseInt(B,36):0,m.set(se+=fe,s[de]);for(var z=0;z<B;z++)m.set(++se,s[de])})}};for(var le in r)Y(le)}}function h(Y){return x(),m.get(Y.codePointAt(0))||s.L}function f(Y){return i[h(Y)]}var y={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(Y,le){var de=36,se=0,ve=new Map,ie=le&&new Map,fe;return Y.split(",").forEach(function B(z){if(z.indexOf("+")!==-1)for(var P=+z;P--;)B(fe);else{fe=z;var H=z.split(">"),ee=H[0],re=H[1];ee=String.fromCodePoint(se+=parseInt(ee,de)),re=String.fromCodePoint(se+=parseInt(re,de)),ve.set(ee,re),le&&ie.set(re,ee)}}),{map:ve,reverseMap:ie}}var p,b,w;function _(){if(!p){var Y=g(y.pairs,!0),le=Y.map,de=Y.reverseMap;p=le,b=de,w=g(y.canonical,!1).map}}function A(Y){return _(),p.get(Y)||null}function C(Y){return _(),b.get(Y)||null}function M(Y){return _(),w.get(Y)||null}var T=s.L,G=s.R,E=s.EN,k=s.ES,N=s.ET,R=s.AN,I=s.CS,J=s.B,ce=s.S,q=s.ON,ne=s.BN,Q=s.NSM,X=s.AL,v=s.LRO,j=s.RLO,S=s.LRE,L=s.RLE,V=s.PDF,F=s.LRI,$=s.RLI,U=s.FSI,D=s.PDI;function Z(Y,le){for(var de=125,se=new Uint32Array(Y.length),ve=0;ve<Y.length;ve++)se[ve]=h(Y[ve]);var ie=new Map;function fe(ke,Fe){var Ae=se[ke];se[ke]=Fe,ie.set(Ae,ie.get(Ae)-1),Ae&c&&ie.set(c,ie.get(c)-1),ie.set(Fe,(ie.get(Fe)||0)+1),Fe&c&&ie.set(c,(ie.get(c)||0)+1)}for(var B=new Uint8Array(Y.length),z=new Map,P=[],H=null,ee=0;ee<Y.length;ee++)H||P.push(H={start:ee,end:Y.length-1,level:le==="rtl"?1:le==="ltr"?0:Jr(ee,!1)}),se[ee]&J&&(H.end=ee,H=null);for(var re=L|S|j|v|n|D|V|J,pe=function(ke){return ke+(ke&1?1:2)},ye=function(ke){return ke+(ke&1?2:1)},Ne=0;Ne<P.length;Ne++){H=P[Ne];var ue=[{_level:H.level,_override:0,_isolate:0}],ge=void 0,we=0,Me=0,Pe=0;ie.clear();for(var _e=H.start;_e<=H.end;_e++){var Re=se[_e];if(ge=ue[ue.length-1],ie.set(Re,(ie.get(Re)||0)+1),Re&c&&ie.set(c,(ie.get(c)||0)+1),Re&re)if(Re&(L|S)){B[_e]=ge._level;var Tr=(Re===L?ye:pe)(ge._level);Tr<=de&&!we&&!Me?ue.push({_level:Tr,_override:0,_isolate:0}):we||Me++}else if(Re&(j|v)){B[_e]=ge._level;var Pr=(Re===j?ye:pe)(ge._level);Pr<=de&&!we&&!Me?ue.push({_level:Pr,_override:Re&j?G:T,_isolate:0}):we||Me++}else if(Re&n){Re&U&&(Re=Jr(_e+1,!0)===1?$:F),B[_e]=ge._level,ge._override&&fe(_e,ge._override);var Cr=(Re===$?ye:pe)(ge._level);Cr<=de&&we===0&&Me===0?(Pe++,ue.push({_level:Cr,_override:0,_isolate:1,_isolInitIndex:_e})):we++}else if(Re&D){if(we>0)we--;else if(Pe>0){for(Me=0;!ue[ue.length-1]._isolate;)ue.pop();var Rs=ue[ue.length-1]._isolInitIndex;Rs!=null&&(z.set(Rs,_e),z.set(_e,Rs)),ue.pop(),Pe--}ge=ue[ue.length-1],B[_e]=ge._level,ge._override&&fe(_e,ge._override)}else Re&V?(we===0&&(Me>0?Me--:!ge._isolate&&ue.length>1&&(ue.pop(),ge=ue[ue.length-1])),B[_e]=ge._level):Re&J&&(B[_e]=H.level);else B[_e]=ge._level,ge._override&&Re!==ne&&fe(_e,ge._override)}for(var st=[],Be=null,Ze=H.start;Ze<=H.end;Ze++){var Ms=se[Ze];if(!(Ms&o)){var Rr=B[Ze],Mr=Ms&n,An=Ms===D;Be&&Rr===Be._level?(Be._end=Ze,Be._endsWithIsolInit=Mr):st.push(Be={_start:Ze,_end:Ze,_level:Rr,_startsWithPDI:An,_endsWithIsolInit:Mr})}}for(var ks=[],zt=0;zt<st.length;zt++){var Gt=st[zt];if(!Gt._startsWithPDI||Gt._startsWithPDI&&!z.has(Gt._start)){for(var As=[Be=Gt],kr=void 0;Be&&Be._endsWithIsolInit&&(kr=z.get(Be._end))!=null;)for(var Vt=zt+1;Vt<st.length;Vt++)if(st[Vt]._start===kr){As.push(Be=st[Vt]);break}for(var rt=[],Is=0;Is<As.length;Is++)for(var Ar=As[Is],Ds=Ar._start;Ds<=Ar._end;Ds++)rt.push(Ds);for(var In=B[rt[0]],Ir=H.level,Ht=rt[0]-1;Ht>=0;Ht--)if(!(se[Ht]&o)){Ir=B[Ht];break}var Ls=rt[rt.length-1],Dn=B[Ls],Dr=H.level;if(!(se[Ls]&n)){for(var $t=Ls+1;$t<=H.end;$t++)if(!(se[$t]&o)){Dr=B[$t];break}}ks.push({_seqIndices:rt,_sosType:Math.max(Ir,In)%2?G:T,_eosType:Math.max(Dr,Dn)%2?G:T})}}for(var Os=0;Os<ks.length;Os++){var Fs=ks[Os],be=Fs._seqIndices,Nt=Fs._sosType,Ln=Fs._eosType,at=B[be[0]]&1?G:T;if(ie.get(Q))for(var Xt=0;Xt<be.length;Xt++){var Lr=be[Xt];if(se[Lr]&Q){for(var Us=Nt,Yt=Xt-1;Yt>=0;Yt--)if(!(se[be[Yt]]&o)){Us=se[be[Yt]];break}fe(Lr,Us&(n|D)?q:Us)}}if(ie.get(E))for(var Zt=0;Zt<be.length;Zt++){var Or=be[Zt];if(se[Or]&E)for(var Wt=Zt-1;Wt>=-1;Wt--){var Fr=Wt===-1?Nt:se[be[Wt]];if(Fr&l){Fr===X&&fe(Or,R);break}}}if(ie.get(X))for(var Bs=0;Bs<be.length;Bs++){var Ur=be[Bs];se[Ur]&X&&fe(Ur,G)}if(ie.get(k)||ie.get(I))for(var jt=1;jt<be.length-1;jt++){var zs=be[jt];if(se[zs]&(k|I)){for(var nt=0,Gs=0,Vs=jt-1;Vs>=0&&(nt=se[be[Vs]],!!(nt&o));Vs--);for(var Hs=jt+1;Hs<be.length&&(Gs=se[be[Hs]],!!(Gs&o));Hs++);nt===Gs&&(se[zs]===k?nt===E:nt&(E|R))&&fe(zs,nt)}}if(ie.get(E))for(var ze=0;ze<be.length;ze++){var On=be[ze];if(se[On]&E){for(var qt=ze-1;qt>=0&&se[be[qt]]&(N|o);qt--)fe(be[qt],E);for(ze++;ze<be.length&&se[be[ze]]&(N|o|E);ze++)se[be[ze]]!==E&&fe(be[ze],E)}}if(ie.get(N)||ie.get(k)||ie.get(I))for(var wt=0;wt<be.length;wt++){var Br=be[wt];if(se[Br]&(N|k|I)){fe(Br,q);for(var Qt=wt-1;Qt>=0&&se[be[Qt]]&o;Qt--)fe(be[Qt],q);for(var Kt=wt+1;Kt<be.length&&se[be[Kt]]&o;Kt++)fe(be[Kt],q)}}if(ie.get(E))for(var $s=0,zr=Nt;$s<be.length;$s++){var Gr=be[$s],Xs=se[Gr];Xs&E?zr===T&&fe(Gr,T):Xs&l&&(zr=Xs)}if(ie.get(c)){var Et=G|E|R,Vr=Et|T,Jt=[];{for(var it=[],lt=0;lt<be.length;lt++)if(se[be[lt]]&c){var St=Y[be[lt]],Hr=void 0;if(A(St)!==null)if(it.length<63)it.push({char:St,seqIndex:lt});else break;else if((Hr=C(St))!==null)for(var _t=it.length-1;_t>=0;_t--){var Ys=it[_t].char;if(Ys===Hr||Ys===C(M(St))||A(M(Ys))===St){Jt.push([it[_t].seqIndex,lt]),it.length=_t;break}}}Jt.sort(function(ke,Fe){return ke[0]-Fe[0]})}for(var Zs=0;Zs<Jt.length;Zs++){for(var $r=Jt[Zs],es=$r[0],Ws=$r[1],Xr=!1,Oe=0,qs=es+1;qs<Ws;qs++){var Yr=be[qs];if(se[Yr]&Vr){Xr=!0;var Zr=se[Yr]&Et?G:T;if(Zr===at){Oe=Zr;break}}}if(Xr&&!Oe){Oe=Nt;for(var Qs=es-1;Qs>=0;Qs--){var Wr=be[Qs];if(se[Wr]&Vr){var qr=se[Wr]&Et?G:T;qr!==at?Oe=qr:Oe=at;break}}}if(Oe){if(se[be[es]]=se[be[Ws]]=Oe,Oe!==at){for(var Tt=es+1;Tt<be.length;Tt++)if(!(se[be[Tt]]&o)){h(Y[be[Tt]])&Q&&(se[be[Tt]]=Oe);break}}if(Oe!==at){for(var Pt=Ws+1;Pt<be.length;Pt++)if(!(se[be[Pt]]&o)){h(Y[be[Pt]])&Q&&(se[be[Pt]]=Oe);break}}}}for(var Ve=0;Ve<be.length;Ve++)if(se[be[Ve]]&c){for(var Qr=Ve,Ks=Ve,Js=Nt,Ct=Ve-1;Ct>=0;Ct--)if(se[be[Ct]]&o)Qr=Ct;else{Js=se[be[Ct]]&Et?G:T;break}for(var Kr=Ln,Rt=Ve+1;Rt<be.length;Rt++)if(se[be[Rt]]&(c|o))Ks=Rt;else{Kr=se[be[Rt]]&Et?G:T;break}for(var er=Qr;er<=Ks;er++)se[be[er]]=Js===Kr?Js:at;Ve=Ks}}}for(var Ie=H.start;Ie<=H.end;Ie++){var Fn=B[Ie],ts=se[Ie];if(Fn&1?ts&(T|E|R)&&B[Ie]++:ts&G?B[Ie]++:ts&(R|E)&&(B[Ie]+=2),ts&o&&(B[Ie]=Ie===0?H.level:B[Ie-1]),Ie===H.end||h(Y[Ie])&(ce|J))for(var ss=Ie;ss>=0&&h(Y[ss])&d;ss--)B[ss]=H.level}}return{levels:B,paragraphs:P};function Jr(ke,Fe){for(var Ae=ke;Ae<Y.length;Ae++){var He=se[Ae];if(He&(G|X))return 1;if(He&(J|T)||Fe&&He===D)return 0;if(He&n){var ea=Un(Ae);Ae=ea===-1?Y.length:ea}}return 0}function Un(ke){for(var Fe=1,Ae=ke+1;Ae<Y.length;Ae++){var He=se[Ae];if(He&J)break;if(He&D){if(--Fe===0)return Ae}else He&n&&Fe++}return-1}}var oe="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",he;function W(){if(!he){var Y=g(oe,!0),le=Y.map,de=Y.reverseMap;de.forEach(function(se,ve){le.set(ve,se)}),he=le}}function me(Y){return W(),he.get(Y)||null}function xe(Y,le,de,se){var ve=Y.length;de=Math.max(0,de==null?0:+de),se=Math.min(ve-1,se==null?ve-1:+se);for(var ie=new Map,fe=de;fe<=se;fe++)if(le[fe]&1){var B=me(Y[fe]);B!==null&&ie.set(fe,B)}return ie}function O(Y,le,de,se){var ve=Y.length;de=Math.max(0,de==null?0:+de),se=Math.min(ve-1,se==null?ve-1:+se);var ie=[];return le.paragraphs.forEach(function(fe){var B=Math.max(de,fe.start),z=Math.min(se,fe.end);if(B<z){for(var P=le.levels.slice(B,z+1),H=z;H>=B&&h(Y[H])&d;H--)P[H]=fe.level;for(var ee=fe.level,re=1/0,pe=0;pe<P.length;pe++){var ye=P[pe];ye>ee&&(ee=ye),ye<re&&(re=ye|1)}for(var Ne=ee;Ne>=re;Ne--)for(var ue=0;ue<P.length;ue++)if(P[ue]>=Ne){for(var ge=ue;ue+1<P.length&&P[ue+1]>=Ne;)ue++;ue>ge&&ie.push([ge+B,ue+B])}}}),ie}function K(Y,le,de,se){var ve=ae(Y,le,de,se),ie=[].concat(Y);return ve.forEach(function(fe,B){ie[B]=(le.levels[fe]&1?me(Y[fe]):null)||Y[fe]}),ie.join("")}function ae(Y,le,de,se){for(var ve=O(Y,le,de,se),ie=[],fe=0;fe<Y.length;fe++)ie[fe]=fe;return ve.forEach(function(B){for(var z=B[0],P=B[1],H=ie.slice(z,P+1),ee=H.length;ee--;)ie[P-ee]=H[ee]}),ie}return a.closingToOpeningBracket=C,a.getBidiCharType=h,a.getBidiCharTypeName=f,a.getCanonicalBracket=M,a.getEmbeddingLevels=Z,a.getMirroredCharacter=me,a.getMirroredCharactersMap=xe,a.getReorderSegments=O,a.getReorderedIndices=ae,a.getReorderedString=K,a.openingToClosingBracket=A,Object.defineProperty(a,"__esModule",{value:!0}),a}({});return t}const hl="modulepreload",pl=function(t){return"/"+t},xa={},Ps=function(a,r,s){if(!r||r.length===0)return a();const i=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=pl(n),n in xa)return;xa[n]=!0;const l=n.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!s)for(let m=i.length-1;m>=0;m--){const x=i[m];if(x.href===n&&(!l||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":hl,l||(d.as="script",d.crossOrigin=""),d.href=n,document.head.appendChild(d),l)return new Promise((m,x)=>{d.addEventListener("load",m),d.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>a()).catch(n=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n})};var Qa={exports:{}};(function(t,a){(function(r,s){t.exports=s()})(Pi,function(){var r=function(){function s(f){return l.appendChild(f.dom),f}function i(f){for(var y=0;y<l.children.length;y++)l.children[y].style.display=y===f?"block":"none";n=f}var n=0,l=document.createElement("div");l.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",l.addEventListener("click",function(f){f.preventDefault(),i(++n%l.children.length)},!1);var c=(performance||Date).now(),o=c,d=0,m=s(new r.Panel("FPS","#0ff","#002")),x=s(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=s(new r.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:l,addPanel:s,showPanel:i,begin:function(){c=(performance||Date).now()},end:function(){d++;var f=(performance||Date).now();if(x.update(f-c,200),f>o+1e3&&(m.update(1e3*d/(f-o),100),o=f,d=0,h)){var y=performance.memory;h.update(y.usedJSHeapSize/1048576,y.jsHeapSizeLimit/1048576)}return f},update:function(){c=this.end()},domElement:l,setMode:i}};return r.Panel=function(s,i,n){var l=1/0,c=0,o=Math.round,d=o(window.devicePixelRatio||1),m=80*d,x=48*d,h=3*d,f=2*d,y=3*d,g=15*d,p=74*d,b=30*d,w=document.createElement("canvas");w.width=m,w.height=x,w.style.cssText="width:80px;height:48px";var _=w.getContext("2d");return _.font="bold "+9*d+"px Helvetica,Arial,sans-serif",_.textBaseline="top",_.fillStyle=n,_.fillRect(0,0,m,x),_.fillStyle=i,_.fillText(s,h,f),_.fillRect(y,g,p,b),_.fillStyle=n,_.globalAlpha=.9,_.fillRect(y,g,p,b),{dom:w,update:function(A,C){l=Math.min(l,A),c=Math.max(c,A),_.fillStyle=n,_.globalAlpha=1,_.fillRect(0,0,m,g),_.fillStyle=i,_.fillText(o(A)+" "+s+" ("+o(l)+"-"+o(c)+")",h,f),_.drawImage(w,y+d,g,p-d,b,y,g,p-d,b),_.fillRect(y+p-d,g,d,b),_.fillStyle=n,_.globalAlpha=.9,_.fillRect(y+p-d,g,d,o((1-A/C)*b))}}},r})})(Qa);var gl=Qa.exports;const id=Ci(gl),fl=({meshData:t,colorScheme:a,showValues:r,showGrid:s})=>{const i=u.useRef(null),[n,l]=u.useState({width:600,height:400}),c=u.useMemo(()=>{if(!t||!t.mesh||t.mesh.length===0)return null;const d=t.mesh,m=Math.max(...d.map(b=>b.i)),x=Math.max(...d.map(b=>b.j)),h=Array(m+1).fill().map(()=>Array(x+1).fill(null));d.forEach(b=>{h[b.i][b.j]=b.z});const f=d.map(b=>b.z),y=Math.min(...f),g=Math.max(...f),p=g-y;return{matrix:h,minZ:y,maxZ:g,range:p,gridSize:{x:m+1,y:x+1}}},[t]),o=u.useCallback((d,m,x,h)=>{if(h===0)return"#808080";const f=(d-m)/h;switch(a){case"heatmap":if(f<.5){const p=f*2;return`rgb(${Math.round(255*p)}, ${Math.round(255*p)}, 255)`}else{const p=(f-.5)*2;return`rgb(255, ${Math.round(255*(1-p))}, ${Math.round(255*(1-p))})`}case"grayscale":const y=Math.round(255*f);return`rgb(${y}, ${y}, ${y})`;case"rainbow":return`hsl(${(1-f)*240}, 100%, 50%)`;default:return"#808080"}},[a]);return u.useEffect(()=>{const d=i.current;if(!d||!c)return;const m=d.getContext("2d"),{width:x,height:h}=n,{matrix:f,minZ:y,maxZ:g,range:p,gridSize:b}=c;m.clearRect(0,0,x,h);const w=x/b.x,_=h/b.y;f.forEach((A,C)=>{A.forEach((M,T)=>{if(M!==null){const G=T*w,E=C*_;m.fillStyle=o(M,y,g,p),m.fillRect(G,E,w,_),s&&(m.strokeStyle="#333",m.lineWidth=1,m.strokeRect(G,E,w,_)),r&&(m.fillStyle=M>(y+g)/2?"#000":"#fff",m.font="10px monospace",m.textAlign="center",m.textBaseline="middle",m.fillText(M.toFixed(3),G+w/2,E+_/2))}})}),m.strokeStyle="#000",m.lineWidth=2,m.strokeRect(0,0,x,h)},[c,n,a,r,s,o]),c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:"2D Heatmap"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Range: ",c.minZ.toFixed(3),"mm to ",c.maxZ.toFixed(3),"mm"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("canvas",{ref:i,width:n.width,height:n.height,className:"border border-gray-300 rounded"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Scale:"}),e.jsx("div",{className:"flex-1 h-4 bg-gradient-to-r from-blue-500 via-white to-red-500 rounded border"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c.minZ.toFixed(2),"mm"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c.maxZ.toFixed(2),"mm"]})]})]}):e.jsx("div",{className:"w-full h-[400px] bg-gray-100 rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(hs,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No bed mesh data available"})]})})},bl=({meshData:t,showWireframe:a,showPoints:r})=>{const s=u.useRef(),{geometry:i,points:n,zMin:l,zMax:c}=u.useMemo(()=>{if(!t||!t.mesh||t.mesh.length===0)return{geometry:null,points:[],zMin:0,zMax:0};const y=t.mesh,g=Math.max(...y.map(T=>T.i)),p=Math.max(...y.map(T=>T.j)),b=Math.min(...y.map(T=>T.z)),w=Math.max(...y.map(T=>T.z)),_=Array(g+1).fill().map(()=>Array(p+1).fill(0));y.forEach(T=>{_[T.i][T.j]=T.z});const A=new Ni(p,g,p,g),C=A.attributes.position.array,M=new Float32Array((g+1)*(p+1)*3);for(let T=0;T<=g;T++)for(let G=0;G<=p;G++){const E=T*(p+1)+G;if(E<C.length/3){C[E*3+2]=_[T][G]*10;const k=(_[T][G]-b)/Math.max(1e-6,w-b),N=k,R=.2+.6*(1-Math.abs(k-.5)*2),I=1-k;M[E*3+0]=N,M[E*3+1]=R,M[E*3+2]=I}}return A.attributes.position.needsUpdate=!0,A.setAttribute("color",new ji(M,3)),A.computeVertexNormals(),{geometry:A,points:y,zMin:b,zMax:w}},[t]);if(!i)return e.jsx("div",{className:"w-full h-[500px] bg-gray-100 rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(hs,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No bed mesh data available"})]})});const o=Math.max(...n.map(y=>y.i)),d=Math.max(...n.map(y=>y.j)),m=l,x=c,h=x-m,f=10;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:"3D Surface"}),e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded",children:[e.jsxs("div",{children:["Grid: ",o+1,"×",d+1," points"]}),e.jsxs("div",{children:["Z Range: ",m.toFixed(3)," to ",x.toFixed(3)," mm"]}),e.jsxs("div",{children:["Scale: 1 unit = 1mm (Z ×",f," for visibility)"]})]})]}),e.jsxs("div",{className:"h-[500px] border border-gray-300 rounded relative",children:[e.jsxs(fr,{camera:{position:[6,6,10],fov:50},children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[5,5,5],intensity:.8}),e.jsx("gridHelper",{args:[10,20,"#cccccc","#cccccc"]}),e.jsxs("mesh",{position:[4,4,0],children:[e.jsx("boxGeometry",{args:[.1,.1,.1]}),e.jsx("meshStandardMaterial",{color:"#666666",transparent:!0,opacity:.7})]}),e.jsx(Ge,{position:[4.2,4,0],fontSize:.15,color:"#666666",rotation:[-Math.PI/2,0,0],children:"1mm"}),e.jsxs("mesh",{position:[-4,4,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-2.5,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,2.5,0],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[Math.PI/2,0,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsxs("mesh",{position:[-4,4,.5],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsx("mesh",{ref:s,geometry:i,rotation:[-Math.PI/2,0,0],position:[0,-.3,0],children:e.jsx("meshStandardMaterial",{vertexColors:!0,wireframe:a,transparent:!0,opacity:.95,side:aa})}),r&&n.map((y,g)=>e.jsxs("mesh",{position:[y.j-2.5,y.i-2.5,y.z*10],rotation:[-Math.PI/2,0,0],children:[e.jsx("sphereGeometry",{args:[.05]}),e.jsx("meshStandardMaterial",{color:"#ef4444"})]},g)),!a&&e.jsx("mesh",{geometry:i,rotation:[-Math.PI/2,0,0],position:[0,-.3,0],children:e.jsx("meshBasicMaterial",{color:"#000000",wireframe:!0,transparent:!0,opacity:.3,side:aa})}),e.jsx(br,{enablePan:!0,enableZoom:!0,enableRotate:!0,minPolarAngle:Math.PI/6,maxPolarAngle:5*Math.PI/12,target:[0,-.3,0]}),e.jsx(Ge,{position:[-2.2,4,0],fontSize:.25,color:"#ff0000",rotation:[-Math.PI/2,0,0],children:"X"}),e.jsx(Ge,{position:[-4,2.2,0],fontSize:.25,color:"#00ff00",rotation:[-Math.PI/2,0,0],children:"Y"}),e.jsx(Ge,{position:[-4,4,.7],fontSize:.25,color:"#0000ff",children:"Z"})]}),e.jsxs("div",{className:"absolute left-2 top-2 bottom-2 w-16 bg-white bg-opacity-90 rounded p-2 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Z Scale"}),e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[x.toFixed(2),"mm"]}),e.jsx("div",{className:"w-1 h-16 bg-gradient-to-b from-red-500 via-yellow-500 to-green-500 rounded"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[m.toFixed(2),"mm"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Range: ",h.toFixed(2),"mm"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-red-500"}),e.jsx("span",{className:"text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-green-500"}),e.jsx("span",{className:"text-xs",children:"Y"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-blue-500"}),e.jsx("span",{className:"text-xs",children:"Z"})]})]})]}),e.jsx("div",{className:"absolute right-2 top-2 bottom-2 w-12 bg-white bg-opacity-90 rounded p-2 flex flex-col justify-between",children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Height"}),e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:x.toFixed(2)}),e.jsx("div",{className:"w-1 h-20 bg-gradient-to-b from-blue-400 via-blue-500 to-blue-600 rounded"}),e.jsx("div",{className:"text-xs text-gray-600",children:m.toFixed(2)})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"mm"})]})})]})]})},Ka=({showStatus:t=!0,showActions:a=!0})=>{var k;const[r,s]=u.useState("3d"),[i,n]=u.useState("heatmap"),[l,c]=u.useState(!0),[o,d]=u.useState(!0),[m,x]=u.useState(!1),[h,f]=u.useState(!1),y=te(N=>N.status),g=te(N=>N.bedMesh),p=te(N=>N.fetchBedLevel),b=te(N=>N.runBedLeveling),w=te(N=>N.processCollectedBedMeshData);je(N=>N.activePrinterId);const _=je(N=>{const R=N.printers.find(I=>I.id===N.activePrinterId);return R==null?void 0:R.printerSettings}),A=u.useCallback(async()=>{if(y!=="connected"){alert("Please connect to printer first");return}await p()},[y,p]),C=u.useCallback(async()=>{if(y!=="connected"){alert("Please connect to printer first");return}confirm("This will run automatic bed leveling (G29). This process takes several minutes. Continue?")&&await b()},[y,b]),M=u.useCallback(()=>{w()},[w]),T=(g==null?void 0:g.data)&&g.data.length>0,G=((k=_==null?void 0:_.bedLeveling)==null?void 0:k.mesh)&&_.bedLeveling.mesh.length>0,E=T?{mesh:g.data,gridSize:g.gridSize,min:g.min,max:g.max,range:g.range}:G?{mesh:_.bedLeveling.mesh,gridSize:{x:Math.max(..._.bedLeveling.mesh.map(N=>N.i))+1,y:Math.max(..._.bedLeveling.mesh.map(N=>N.j))+1},min:Math.min(..._.bedLeveling.mesh.map(N=>N.z)),max:Math.max(..._.bedLeveling.mesh.map(N=>N.z)),range:Math.max(..._.bedLeveling.mesh.map(N=>N.z))-Math.min(..._.bedLeveling.mesh.map(N=>N.z))}:null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Bed Mesh Visualization"}),e.jsx("div",{className:"text-sm text-gray-600",children:E?e.jsxs(e.Fragment,{children:[E.gridSize.x,"×",E.gridSize.y," grid • Range: ",E.min.toFixed(3),"mm to ",E.max.toFixed(3),"mm •",T?e.jsxs(e.Fragment,{children:["Last updated: ",g.timestamp?new Date(g.timestamp).toLocaleTimeString():"Unknown"]}):e.jsx(e.Fragment,{children:"Data from printer settings"})]}):"No mesh data available"})]}),a&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:A,disabled:y!=="connected",className:"px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Vn,{className:"w-4 h-4 mr-2"}),"Process Data"]}),!T&&e.jsxs("button",{onClick:C,disabled:y!=="connected",className:"px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Run G29"]}),e.jsxs("button",{onClick:M,className:"px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Process Data"]})]})]}),t&&(_==null?void 0:_.bedLeveling)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Bed Leveling Status"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[_.bedLeveling.enabled?"Enabled":"Disabled"," • Fade Height: ",_.bedLeveling.fadeHeight,"mm"]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${_.bedLeveling.enabled?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:_.bedLeveling.enabled?"Active":"Inactive"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>s("2d"),className:`px-3 py-1 rounded text-sm font-medium ${r==="2d"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(mt,{className:"w-4 h-4 mr-1 inline"}),"2D View"]}),e.jsxs("button",{onClick:()=>s("3d"),className:`px-3 py-1 rounded text-sm font-medium ${r==="3d"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Ft,{className:"w-4 h-4 mr-1 inline"}),"3D View"]})]}),e.jsx("div",{className:"flex items-center space-x-6",children:r==="2d"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Color:"}),e.jsxs("select",{value:i,onChange:N=>n(N.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"heatmap",children:"Heatmap"}),e.jsx("option",{value:"grayscale",children:"Grayscale"}),e.jsx("option",{value:"rainbow",children:"Rainbow"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showValues",checked:l,onChange:N=>c(N.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showValues",className:"text-sm text-gray-700",children:"Show Values"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showGrid",checked:o,onChange:N=>d(N.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showGrid",className:"text-sm text-gray-700",children:"Show Grid"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showWireframe",checked:m,onChange:N=>x(N.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showWireframe",className:"text-sm text-gray-700",children:"Show Wireframe"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showPoints",checked:h,onChange:N=>f(N.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showPoints",className:"text-sm text-gray-700",children:"Show Points"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:r==="2d"?e.jsx(fl,{meshData:E,colorScheme:i,showValues:l,showGrid:o}):e.jsx(bl,{meshData:E,showWireframe:m,showPoints:h})}),E&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Min Height:"}),e.jsxs("div",{className:"font-mono text-sm",children:[E.min.toFixed(3),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Max Height:"}),e.jsxs("div",{className:"font-mono text-sm",children:[E.max.toFixed(3),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Range:"}),e.jsxs("div",{className:"font-mono text-sm",children:[E.range.toFixed(3),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Points:"}),e.jsx("div",{className:"font-mono text-sm",children:E.mesh.length})]})]})})]})},yl={stepsPerUnit:{min:1,max:1e3,warning:"Values outside normal range may cause dimensional inaccuracy",critical:"Extreme values can damage the printer"},feedrates:{min:1,max:1e4,warning:"High feedrates may cause skipped steps",critical:"Excessive feedrates can damage motors"},acceleration:{min:1,max:1e4,warning:"High acceleration may cause print quality issues",critical:"Excessive acceleration can damage the printer"},pid:{min:0,max:100,warning:"Incorrect PID values can cause temperature instability",critical:"Extreme PID values can cause thermal runaway"},zProbeOffset:{min:-10,max:10,warning:"Incorrect Z probe offset affects first layer height",critical:"Extreme Z probe offset can cause nozzle crashes"},linearAdvance:{min:0,max:10,warning:"High linear advance values may cause extrusion issues",critical:"Extreme linear advance can damage the extruder"}},vl=({settingKey:t,value:a,settingType:r})=>{const s=u.useMemo(()=>{if(a==null||a==="")return{level:"info",message:"No value set"};const l=parseFloat(a);if(isNaN(l))return{level:"error",message:"Invalid numeric value"};let c=null;for(const[m,x]of Object.entries(yl))if(t.includes(m)){c=x;break}if(!c)return{level:"info",message:"No safety validation available"};if(l<c.min*.1||l>c.max*10)return{level:"critical",message:c.critical};if(l<c.min||l>c.max)return{level:"warning",message:c.warning};const o=c.max-c.min,d=(l-c.min)/o;return d<.1||d>.9?{level:"caution",message:"Value is at extreme end of safe range"}:{level:"safe",message:"Value is within safe range"}},[t,a,r]),i=()=>{switch(s.level){case"critical":return e.jsx(Te,{className:"w-4 h-4 text-red-600"});case"warning":return e.jsx(Te,{className:"w-4 h-4 text-yellow-600"});case"caution":return e.jsx(pt,{className:"w-4 h-4 text-blue-600"});case"safe":return e.jsx(Ee,{className:"w-4 h-4 text-green-600"});default:return e.jsx(pt,{className:"w-4 h-4 text-gray-600"})}},n=()=>{switch(s.level){case"critical":return"text-red-800 bg-red-50 border-red-200";case"warning":return"text-yellow-800 bg-yellow-50 border-yellow-200";case"caution":return"text-blue-800 bg-blue-50 border-blue-200";case"safe":return"text-green-800 bg-green-50 border-green-200";default:return"text-gray-800 bg-gray-50 border-gray-200"}};return s.level==="info"?null:e.jsx("div",{className:`mt-2 p-2 rounded border text-xs ${n()}`,children:e.jsxs("div",{className:"flex items-center",children:[i(),e.jsx("span",{className:"ml-1 font-medium",children:s.message})]})})},Nl=["pid.hotend.p","pid.hotend.i","pid.hotend.d","pid.bed.p","pid.bed.i","pid.bed.d","stepsPerUnit.x","stepsPerUnit.y","stepsPerUnit.z","stepsPerUnit.e","zProbeOffset.z","homeOffset.z"],jl=({setting:t,value:a,onChange:r,onSend:s,hasChanges:i,isDangerous:n=!1,documentation:l=null})=>{const[c,o]=u.useState(!1),[d,m]=u.useState(!0),[x,h]=u.useState(""),f=u.useCallback(b=>{if(!t.validation)return m(!0),h(""),!0;const{min:w,max:_,pattern:A,required:C}=t.validation;return C&&(b===""||b===null||b===void 0)?(m(!1),h("This field is required"),!1):w!==void 0&&parseFloat(b)<w?(m(!1),h(`Value must be at least ${w}`),!1):_!==void 0&&parseFloat(b)>_?(m(!1),h(`Value must be at most ${_}`),!1):A&&!A.test(String(b))?(m(!1),h("Invalid format"),!1):(m(!0),h(""),!0)},[t.validation]),y=u.useCallback(b=>{f(b),r(b)},[r,f]),g=u.useCallback(()=>{if(d&&i){if(Nl.includes(t.key)&&!confirm(`Warning: ${t.label} is a potentially dangerous setting. Are you sure you want to send this command?`))return;s()}},[d,i,s,t.key,t.label]),p=()=>{var w,_,A;const b={value:a||"",onChange:C=>y(C.target.value),className:`w-full px-3 py-2 border rounded text-sm ${d?i?"border-yellow-300 bg-yellow-50":"border-gray-300":"border-red-300 bg-red-50"}`,placeholder:t.placeholder||""};switch(t.type){case"number":return e.jsx("input",{...b,type:"number",step:t.step||"any",min:(w=t.validation)==null?void 0:w.min,max:(_=t.validation)==null?void 0:_.max});case"boolean":return e.jsxs("select",{...b,value:a?"1":"0",onChange:C=>y(C.target.value==="1"),children:[e.jsx("option",{value:"0",children:"Disabled"}),e.jsx("option",{value:"1",children:"Enabled"})]});case"select":return e.jsx("select",{...b,children:(A=t.options)==null?void 0:A.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))});case"text":default:return e.jsx("input",{...b,type:"text"})}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:t.label}),n&&e.jsx(Te,{className:"w-4 h-4 text-red-500",title:"Dangerous setting"}),l&&e.jsx("button",{onClick:()=>o(!c),className:"text-gray-400 hover:text-gray-600",children:e.jsx(pt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[i&&e.jsx("span",{className:"text-xs text-yellow-600 bg-yellow-100 px-2 py-1 rounded",children:"Changed"}),e.jsxs("button",{onClick:g,disabled:!d||!i,className:"px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Hn,{className:"w-3 h-3 mr-1"}),"Send"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[p(),e.jsx("span",{className:"text-xs text-gray-500 self-center",children:t.unit||""})]}),!d&&x&&e.jsx("div",{className:"text-xs text-red-600",children:x}),c&&l&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-sm",children:[e.jsx("div",{className:"font-medium text-blue-900 mb-1",children:"Documentation"}),e.jsx("div",{className:"text-blue-800",children:l.description}),l.marlinRef&&e.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:["Marlin Reference: ",l.marlinRef]}),l.warning&&e.jsxs("div",{className:"mt-2 text-xs text-red-600 font-medium",children:["⚠️ ",l.warning]})]}),e.jsx(vl,{settingKey:t.key,value:a,settingType:t.type})]})},wl=({category:t,settings:a,values:r,onChange:s,onSend:i,changedSettings:n,isExpanded:l,onToggle:c})=>{const o=Object.keys(n).filter(d=>a.some(m=>m.key===d&&n[d])).length;return e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("button",{onClick:c,className:"w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-t-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l?e.jsx(Ra,{className:"w-5 h-5"}):e.jsx(ps,{className:"w-5 h-5"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",a.length," settings)"]}),o>0&&e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded",children:[o," changed"]})]}),e.jsx(t.icon,{className:"w-5 h-5 text-gray-400"})]}),l&&e.jsx("div",{className:"p-4 space-y-4",children:a.map(d=>e.jsx(jl,{setting:d,value:r[d.key],onChange:m=>s(d.key,m),onSend:()=>i(d),hasChanges:n[d.key],isDangerous:d.dangerous,documentation:d.documentation},d.key))})]})},El=()=>{const[t,a]=u.useState(""),[r,s]=u.useState("all"),[i,n]=u.useState({}),[l,c]=u.useState({}),[o,d]=u.useState({}),m=te(E=>E.status),x=te(E=>E.sendCommand),h=te(E=>E.sendBulkConfiguration);te(E=>E.processM503Response),te(E=>E.fetchAllPrinterSettings);const f=je(E=>E.activePrinterId),y=je(E=>{const k=E.printers.find(N=>N.id===E.activePrinterId);return k==null?void 0:k.printerSettings}),g=je(E=>E.updatePrinterSettings),p=u.useMemo(()=>[{category:"motion",name:"Motion Settings",icon:Se,settings:[{key:"stepsPerUnit.x",label:"X Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for X-axis movement",marlinRef:"M92 X<value>",warning:"Incorrect values can cause dimensional inaccuracy"}},{key:"stepsPerUnit.y",label:"Y Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for Y-axis movement",marlinRef:"M92 Y<value>"}},{key:"stepsPerUnit.z",label:"Z Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for Z-axis movement",marlinRef:"M92 Z<value>"}},{key:"stepsPerUnit.e",label:"E Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for extruder",marlinRef:"M92 E<value>"}},{key:"feedrates.x",label:"X Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e4},documentation:{description:"Maximum feedrate for X-axis movement",marlinRef:"M203 X<value>"}},{key:"feedrates.y",label:"Y Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e4},documentation:{description:"Maximum feedrate for Y-axis movement",marlinRef:"M203 Y<value>"}},{key:"feedrates.z",label:"Z Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e3},documentation:{description:"Maximum feedrate for Z-axis movement",marlinRef:"M203 Z<value>"}},{key:"feedrates.e",label:"E Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e4},documentation:{description:"Maximum feedrate for extruder",marlinRef:"M203 E<value>"}}]},{category:"acceleration",name:"Acceleration Settings",icon:Se,settings:[{key:"acceleration.max",label:"Max Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Maximum acceleration for all axes",marlinRef:"M201",warning:"Too high values can cause skipped steps"}},{key:"acceleration.print",label:"Print Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Acceleration used during printing",marlinRef:"M204 P<value>"}},{key:"acceleration.retract",label:"Retract Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Acceleration used for retraction moves",marlinRef:"M204 R<value>"}},{key:"acceleration.travel",label:"Travel Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Acceleration used for travel moves",marlinRef:"M204 T<value>"}},{key:"acceleration.jerk.x",label:"X Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for X-axis",marlinRef:"M205 X<value>"}},{key:"acceleration.jerk.y",label:"Y Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for Y-axis",marlinRef:"M205 Y<value>"}},{key:"acceleration.jerk.z",label:"Z Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for Z-axis",marlinRef:"M205 Z<value>"}},{key:"acceleration.jerk.e",label:"E Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for extruder",marlinRef:"M205 E<value>"}}]},{category:"temperature",name:"Temperature Settings",icon:Se,settings:[{key:"pid.hotend.p",label:"Hotend PID P",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Proportional gain for hotend PID controller",marlinRef:"M301 P<value>",warning:"Incorrect PID values can cause temperature instability"},dangerous:!0},{key:"pid.hotend.i",label:"Hotend PID I",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Integral gain for hotend PID controller",marlinRef:"M301 I<value>"},dangerous:!0},{key:"pid.hotend.d",label:"Hotend PID D",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Derivative gain for hotend PID controller",marlinRef:"M301 D<value>"},dangerous:!0},{key:"pid.bed.p",label:"Bed PID P",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Proportional gain for bed PID controller",marlinRef:"M304 P<value>"},dangerous:!0},{key:"pid.bed.i",label:"Bed PID I",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Integral gain for bed PID controller",marlinRef:"M304 I<value>"},dangerous:!0},{key:"pid.bed.d",label:"Bed PID D",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Derivative gain for bed PID controller",marlinRef:"M304 D<value>"},dangerous:!0}]},{category:"bedLeveling",name:"Bed Leveling Settings",icon:Se,settings:[{key:"bedLeveling.enabled",label:"Bed Leveling Enabled",type:"boolean",documentation:{description:"Enable or disable automatic bed leveling compensation",marlinRef:"M420 S<0|1>"}},{key:"bedLeveling.fadeHeight",label:"Fade Height",type:"number",unit:"mm",validation:{min:0,max:100},documentation:{description:"Height at which bed leveling compensation fades out",marlinRef:"M420 Z<value>"}},{key:"zProbeOffset.x",label:"Z Probe X Offset",type:"number",unit:"mm",validation:{min:-100,max:100},documentation:{description:"X offset of the Z probe relative to the nozzle",marlinRef:"M851 X<value>"}},{key:"zProbeOffset.y",label:"Z Probe Y Offset",type:"number",unit:"mm",validation:{min:-100,max:100},documentation:{description:"Y offset of the Z probe relative to the nozzle",marlinRef:"M851 Y<value>"}},{key:"zProbeOffset.z",label:"Z Probe Z Offset",type:"number",unit:"mm",validation:{min:-10,max:10},documentation:{description:"Z offset of the Z probe relative to the nozzle",marlinRef:"M851 Z<value>",warning:"Critical for first layer height"}}]},{category:"advanced",name:"Advanced Settings",icon:Se,settings:[{key:"homeOffset.x",label:"Home X Offset",type:"number",unit:"mm",validation:{min:-1e3,max:1e3},documentation:{description:"X offset from home position",marlinRef:"M206 X<value>"}},{key:"homeOffset.y",label:"Home Y Offset",type:"number",unit:"mm",validation:{min:-1e3,max:1e3},documentation:{description:"Y offset from home position",marlinRef:"M206 Y<value>"}},{key:"homeOffset.z",label:"Home Z Offset",type:"number",unit:"mm",validation:{min:-1e3,max:1e3},documentation:{description:"Z offset from home position",marlinRef:"M206 Z<value>"}},{key:"linearAdvance",label:"Linear Advance",type:"number",unit:"",validation:{min:0,max:10},documentation:{description:"Linear advance K-factor for pressure advance",marlinRef:"M900 K<value>"}},{key:"powerLossRecovery",label:"Power Loss Recovery",type:"boolean",documentation:{description:"Enable power loss recovery feature",marlinRef:"M413 S<0|1>"}}]}],[]);Ce.useEffect(()=>{if(y){const E={};p.forEach(k=>{k.settings.forEach(N=>{const R=N.key.split(".");let I=y;for(const J of R)I=I==null?void 0:I[J];E[N.key]=I})}),d(E)}},[y,p]);const b=u.useCallback((E,k)=>{d(N=>({...N,[E]:k})),c(N=>({...N,[E]:!0}))},[]),w=u.useCallback(async E=>{if(m!=="connected"){alert("Please connect to printer first");return}try{const k=o[E.key];let N="";switch(E.key){case"stepsPerUnit.x":N=`M92 X${k}`;break;case"stepsPerUnit.y":N=`M92 Y${k}`;break;case"stepsPerUnit.z":N=`M92 Z${k}`;break;case"stepsPerUnit.e":N=`M92 E${k}`;break;case"feedrates.x":N=`M203 X${k}`;break;case"feedrates.y":N=`M203 Y${k}`;break;case"feedrates.z":N=`M203 Z${k}`;break;case"feedrates.e":N=`M203 E${k}`;break;case"acceleration.max":N=`M201 X${k} Y${k} Z${k} E${k}`;break;case"acceleration.print":N=`M204 P${k}`;break;case"acceleration.retract":N=`M204 R${k}`;break;case"acceleration.travel":N=`M204 T${k}`;break;case"acceleration.jerk.x":N=`M205 X${k}`;break;case"acceleration.jerk.y":N=`M205 Y${k}`;break;case"acceleration.jerk.z":N=`M205 Z${k}`;break;case"acceleration.jerk.e":N=`M205 E${k}`;break;case"pid.hotend.p":case"pid.hotend.i":case"pid.hotend.d":const R=o["pid.hotend.p"]||0,I=o["pid.hotend.i"]||0,J=o["pid.hotend.d"]||0;N=`M301 P${R} I${I} D${J}`;break;case"pid.bed.p":case"pid.bed.i":case"pid.bed.d":const ce=o["pid.bed.p"]||0,q=o["pid.bed.i"]||0,ne=o["pid.bed.d"]||0;N=`M304 P${ce} I${q} D${ne}`;break;case"bedLeveling.enabled":N=`M420 S${k?1:0}`;break;case"bedLeveling.fadeHeight":N=`M420 Z${k}`;break;case"zProbeOffset.x":case"zProbeOffset.y":case"zProbeOffset.z":const Q=o["zProbeOffset.x"]||0,X=o["zProbeOffset.y"]||0,v=o["zProbeOffset.z"]||0;N=`M851 X${Q} Y${X} Z${v}`;break;case"homeOffset.x":case"homeOffset.y":case"homeOffset.z":const j=o["homeOffset.x"]||0,S=o["homeOffset.y"]||0,L=o["homeOffset.z"]||0;N=`M206 X${j} Y${S} Z${L}`;break;case"linearAdvance":N=`M900 K${k}`;break;case"powerLossRecovery":N=`M413 S${k?1:0}`;break;default:console.warn("Unknown setting:",E.key);return}await x(N),c(R=>({...R,[E.key]:!1}))}catch(k){console.error("Error sending setting:",k),alert(`Error sending setting: ${k.message}`)}},[m,x,o]),_=u.useCallback(async()=>{if(m!=="connected"){alert("Please connect to printer first");return}if(confirm("Are you sure you want to save all changed settings to the printer? This will overwrite current printer configuration."))try{const E=Object.keys(l).filter(J=>l[J]),k=[],N={};for(const J of E){const ce=p.flatMap(q=>q.settings).find(q=>q.key===J);if(ce){const q=o[ce.key];let ne="";switch(ce.key){case"stepsPerUnit.x":case"stepsPerUnit.y":case"stepsPerUnit.z":case"stepsPerUnit.e":const Q=o["stepsPerUnit.x"]||0,X=o["stepsPerUnit.y"]||0,v=o["stepsPerUnit.z"]||0,j=o["stepsPerUnit.e"]||0;ne=`M92 X${Q} Y${X} Z${v} E${j}`,N.M92=ne;break;case"feedrates.x":case"feedrates.y":case"feedrates.z":case"feedrates.e":const S=o["feedrates.x"]||0,L=o["feedrates.y"]||0,V=o["feedrates.z"]||0,F=o["feedrates.e"]||0;ne=`M203 X${S} Y${L} Z${V} E${F}`,N.M203=ne;break;case"acceleration.max":const $=o["acceleration.max"]||0;ne=`M201 X${$} Y${$} Z${$} E${$}`,N.M201=ne;break;case"acceleration.print":case"acceleration.retract":case"acceleration.travel":const U=o["acceleration.print"]||0,D=o["acceleration.retract"]||0,Z=o["acceleration.travel"]||0;ne=`M204 P${U} R${D} T${Z}`,N.M204=ne;break;case"acceleration.jerk.x":case"acceleration.jerk.y":case"acceleration.jerk.z":case"acceleration.jerk.e":const oe=o["acceleration.jerk.x"]||0,he=o["acceleration.jerk.y"]||0,W=o["acceleration.jerk.z"]||0,me=o["acceleration.jerk.e"]||0;ne=`M205 X${oe} Y${he} Z${W} E${me}`,N.M205=ne;break;case"pid.hotend.p":case"pid.hotend.i":case"pid.hotend.d":const xe=o["pid.hotend.p"]||0,O=o["pid.hotend.i"]||0,K=o["pid.hotend.d"]||0;ne=`M301 P${xe} I${O} D${K}`,N.M301=ne;break;case"pid.bed.p":case"pid.bed.i":case"pid.bed.d":const ae=o["pid.bed.p"]||0,Y=o["pid.bed.i"]||0,le=o["pid.bed.d"]||0;ne=`M304 P${ae} I${Y} D${le}`,N.M304=ne;break;case"bedLeveling.enabled":case"bedLeveling.fadeHeight":const de=o["bedLeveling.enabled"]?1:0,se=o["bedLeveling.fadeHeight"]||0;ne=`M420 S${de} Z${se}`,N.M420=ne;break;case"zProbeOffset.x":case"zProbeOffset.y":case"zProbeOffset.z":const ve=o["zProbeOffset.x"]||0,ie=o["zProbeOffset.y"]||0,fe=o["zProbeOffset.z"]||0;ne=`M851 X${ve} Y${ie} Z${fe}`,N.M851=ne;break;case"homeOffset.x":case"homeOffset.y":case"homeOffset.z":const B=o["homeOffset.x"]||0,z=o["homeOffset.y"]||0,P=o["homeOffset.z"]||0;ne=`M206 X${B} Y${z} Z${P}`,N.M206=ne;break;case"linearAdvance":ne=`M900 K${q}`,N.M900=ne;break;case"powerLossRecovery":ne=`M413 S${q?1:0}`,N.M413=ne;break}}}const R=Object.values(N);if(R.length===0){alert("No settings to save");return}R.push("M500");const I=await h(R,{delayMs:150,maxRetries:2,onProgress:(J,ce,q)=>{console.log(`Sending ${J}/${ce}: ${q}`)}});if(I.failureCount>0?alert(`Settings saved with ${I.failureCount} failures. Check serial log for details.`):alert("All settings saved successfully!"),f){const J={...y};E.forEach(ce=>{const q=ce.split(".");let ne=J;for(let Q=0;Q<q.length-1;Q++)ne[q[Q]]||(ne[q[Q]]={}),ne=ne[q[Q]];ne[q[q.length-1]]=o[ce]}),g(f,J)}c({})}catch(E){console.error("Error saving settings:",E),alert(`Error saving settings: ${E.message}`)}},[m,h,l,p,o,f,y,g]),A=u.useCallback(async()=>{},[]),C=u.useCallback(()=>{if(c({}),y){const E={};p.forEach(k=>{k.settings.forEach(N=>{const R=N.key.split(".");let I=y;for(const J of R)I=I==null?void 0:I[J];E[N.key]=I})}),d(E)}},[y,p]),M=u.useCallback(E=>{n(k=>({...k,[E]:!k[E]}))},[]),T=u.useMemo(()=>p.filter(E=>r==="all"||E.category===r).map(E=>({...E,settings:E.settings.filter(k=>t===""||k.label.toLowerCase().includes(t.toLowerCase())||k.key.toLowerCase().includes(t.toLowerCase()))})).filter(E=>E.settings.length>0),[p,t,r]),G=Object.values(l).filter(Boolean).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Printer Settings Editor"}),e.jsx("p",{className:"text-gray-600",children:"Configure and manage all printer settings"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:A,disabled:m!=="connected",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Fetch Settings"]}),G>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 flex items-center",children:[e.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Reset Changes"]}),e.jsxs("button",{onClick:_,disabled:m!=="connected",className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Save All (",G,")"]})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ut,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search settings...",value:t,onChange:E=>a(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"min-w-48",children:e.jsxs("select",{value:r,onChange:E=>s(E.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Categories"}),p.map(E=>e.jsx("option",{value:E.category,children:E.name},E.category))]})})]})}),e.jsx("div",{className:"space-y-4",children:T.map(E=>e.jsx(wl,{category:E,settings:E.settings,values:o,onChange:b,onSend:w,changedSettings:l,isExpanded:i[E.category]||!1,onToggle:()=>M(E.category)},E.category))}),G>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 text-yellow-600 mr-2"}),e.jsxs("span",{className:"text-yellow-800 font-medium",children:[G," setting",G!==1?"s":""," have been modified"]})]}),e.jsxs("button",{onClick:_,disabled:m!=="connected",className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Save All"]})]})})]})},Sl=()=>{var o,d,m,x,h,f,y,g,p,b,w,_,A,C,M,T;const[t,a]=u.useState("editor");te(G=>G.status),je(G=>G.activePrinterId);const r=je(G=>{const E=G.printers.find(k=>k.id===G.activePrinterId);return E==null?void 0:E.printerSettings}),s=()=>{var E,k,N,R,I,J,ce,q,ne,Q;return r?{motion:{stepsPerUnit:r.stepsPerUnit,feedrates:r.feedrates},acceleration:{max:(E=r.acceleration)==null?void 0:E.max,print:(k=r.acceleration)==null?void 0:k.print,retract:(N=r.acceleration)==null?void 0:N.retract,travel:(R=r.acceleration)==null?void 0:R.travel},temperature:{pidHotend:(I=r.pid)==null?void 0:I.hotend,pidBed:(J=r.pid)==null?void 0:J.bed},bedLeveling:{enabled:(ce=r.bedLeveling)==null?void 0:ce.enabled,fadeHeight:(q=r.bedLeveling)==null?void 0:q.fadeHeight,meshPoints:((Q=(ne=r.bedLeveling)==null?void 0:ne.mesh)==null?void 0:Q.length)||0},advanced:{homeOffset:r.homeOffset,zProbeOffset:r.zProbeOffset,linearAdvance:r.linearAdvance,powerLossRecovery:r.powerLossRecovery}}:null},i=()=>{if(!r)return{status:"no-data",message:"No configuration data available",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",icon:Te};const G=r.lastUpdated;return G&&Date.now()-new Date(G).getTime()<24*60*60*1e3?{status:"current",message:"Configuration is up to date",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",icon:Ee}:{status:"outdated",message:"Configuration may be outdated",color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",icon:Te}},n=s(),l=i(),c=l.icon;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuration Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and configure all printer settings"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded flex items-center",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Settings Auto-Fetched on Connection"]})})]}),e.jsx("div",{className:`rounded-lg border-2 ${l.borderColor} ${l.bgColor} p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:`w-6 h-6 mr-3 ${l.color}`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold ${l.color}`,children:"Configuration Status"}),e.jsx("p",{className:`text-sm ${l.color}`,children:l.message})]})]}),(r==null?void 0:r.lastUpdated)&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm ${l.color}`,children:new Date(r.lastUpdated).toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-500",children:"Last Updated"})]})]})}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>a("editor"),className:`flex-1 px-4 py-2 rounded text-sm font-medium ${t==="editor"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Se,{className:"w-4 h-4 mr-2 inline"}),"Settings Editor"]}),e.jsxs("button",{onClick:()=>a("summary"),className:`flex-1 px-4 py-2 rounded text-sm font-medium ${t==="summary"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(De,{className:"w-4 h-4 mr-2 inline"}),"Summary"]}),e.jsxs("button",{onClick:()=>a("documentation"),className:`flex-1 px-4 py-2 rounded text-sm font-medium ${t==="documentation"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx($n,{className:"w-4 h-4 mr-2 inline"}),"Documentation"]})]}),t==="editor"&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsx(El,{})}),t==="summary"&&e.jsx("div",{className:"space-y-6",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Motion Settings"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"X Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((o=n.motion.stepsPerUnit)==null?void 0:o.x)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Y Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((d=n.motion.stepsPerUnit)==null?void 0:d.y)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Z Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((m=n.motion.stepsPerUnit)==null?void 0:m.z)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"E Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((x=n.motion.stepsPerUnit)==null?void 0:x.e)||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Acceleration Settings"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Max Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((h=n.acceleration)==null?void 0:h.max)||"N/A"," mm/s²"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Print Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((f=n.acceleration)==null?void 0:f.print)||"N/A"," mm/s²"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Retract Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((y=n.acceleration)==null?void 0:y.retract)||"N/A"," mm/s²"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Travel Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((g=n.acceleration)==null?void 0:g.travel)||"N/A"," mm/s²"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Temperature Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Hotend PID"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"P:"}),e.jsx("span",{className:"font-mono",children:((p=n.temperature.pidHotend)==null?void 0:p.p)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"I:"}),e.jsx("span",{className:"font-mono",children:((b=n.temperature.pidHotend)==null?void 0:b.i)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"D:"}),e.jsx("span",{className:"font-mono",children:((w=n.temperature.pidHotend)==null?void 0:w.d)||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Bed PID"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"P:"}),e.jsx("span",{className:"font-mono",children:((_=n.temperature.pidBed)==null?void 0:_.p)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"I:"}),e.jsx("span",{className:"font-mono",children:((A=n.temperature.pidBed)==null?void 0:A.i)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"D:"}),e.jsx("span",{className:"font-mono",children:((C=n.temperature.pidBed)==null?void 0:C.d)||"N/A"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Bed Leveling"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("div",{className:`text-lg font-semibold ${n.bedLeveling.enabled?"text-green-600":"text-red-600"}`,children:n.bedLeveling.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Fade Height"}),e.jsxs("div",{className:"text-xl font-bold",children:[n.bedLeveling.fadeHeight||"N/A"," mm"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Mesh Points"}),e.jsx("div",{className:"text-xl font-bold",children:n.bedLeveling.meshPoints})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Advanced Settings"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Linear Advance"}),e.jsx("div",{className:"text-xl font-bold",children:n.advanced.linearAdvance||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Power Loss Recovery"}),e.jsx("div",{className:`text-lg font-semibold ${n.advanced.powerLossRecovery?"text-green-600":"text-red-600"}`,children:n.advanced.powerLossRecovery?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Z Probe Z Offset"}),e.jsxs("div",{className:"text-xl font-bold",children:[((M=n.advanced.zProbeOffset)==null?void 0:M.z)||"N/A"," mm"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Home Z Offset"}),e.jsxs("div",{className:"text-xl font-bold",children:[((T=n.advanced.homeOffset)==null?void 0:T.z)||"N/A"," mm"]})]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(Se,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Configuration Data"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Connect to printer to automatically fetch configuration"}),e.jsxs("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded flex items-center justify-center mx-auto max-w-xs",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Auto-Fetch on Connection"]})]})}),t==="documentation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Marlin G-code Reference"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Motion Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M92"})," - Set steps per unit"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M203"})," - Set maximum feedrate"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M201"})," - Set maximum acceleration"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M204"})," - Set acceleration"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M205"})," - Set advanced settings"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Temperature Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M301"})," - Set hotend PID"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M304"})," - Set bed PID"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M145"})," - Set material presets"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Bed Leveling Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M420"})," - Enable/disable bed leveling"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"G29"})," - Auto bed leveling"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M851"})," - Set Z probe offset"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Advanced Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M206"})," - Set home offset"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M900"})," - Set linear advance"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M413"})," - Power loss recovery"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M500"})," - Save to EEPROM"]})]})]})]})})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Safety Information"]}),e.jsxs("div",{className:"space-y-3 text-sm text-yellow-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"PID Settings:"})," Incorrect PID values can cause temperature instability and potential damage to your printer."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Steps per Unit:"})," Wrong values will cause dimensional inaccuracy in your prints."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Acceleration/Jerk:"})," Too high values can cause skipped steps and print failures."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Z Probe Offset:"})," Critical for first layer height and print quality."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Always test changes:"})," Make small adjustments and test thoroughly before making major changes."]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(pt,{className:"w-5 h-5 mr-2 text-blue-600"}),"Best Practices"]}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Backup First:"})," Always fetch and save your current configuration before making changes."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"One at a Time:"})," Make one setting change at a time and test the results."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Document Changes:"})," Keep track of what you've changed and why."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Save to EEPROM:"}),` Always use "Save All" to permanently save changes to the printer's memory.`]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Test Prints:"})," Run test prints after making significant changes to verify everything works correctly."]})]})]})]})]})},ha=()=>{var M,T,G,E,k,N;const[t,a]=u.useState(!1),[r,s]=u.useState({}),[i,n]=u.useState("basic"),{updatePrinter:l}=je(),c=je(R=>R.activePrinterId),o=je(R=>{const I=R.printers.find(J=>J.id===c);return I||null}),d=te(R=>R.status),m=te(R=>R.bedMesh),x=te(R=>R.fetchBedLevel),h=te(R=>R.runBedLeveling),f=te(R=>R.processCollectedBedMeshData),y=je(R=>{const I=R.printers.find(J=>J.id===c);return I==null?void 0:I.printerSettings}),g=(m==null?void 0:m.data)&&m.data.length>0,p=(M=y==null?void 0:y.bedLeveling)==null?void 0:M.enabled;if(u.useCallback(async()=>{if(d!=="connected"){alert("Please connect to printer first");return}await x()},[d,x]),u.useCallback(async()=>{if(d!=="connected"){alert("Please connect to printer first");return}confirm("This will run automatic bed leveling (G29). This process takes several minutes. Continue?")&&await h()},[d,h]),u.useCallback(async()=>{await f()},[f]),!o)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ot,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Printer Selected"}),e.jsx("p",{className:"text-gray-500",children:"Please select a printer to view configuration"})]});const b=()=>{s({name:o.name,model:o.model,firmware:o.firmware||"",bedSize:{...o.bedSize}}),a(!0)},w=()=>{l(o.id,r),a(!1),s({})},_=()=>{a(!1),s({})},A=(R,I)=>{s(R==="bedSize"?J=>({...J,bedSize:{...J.bedSize,...I}}):J=>({...J,[R]:I}))},C=(R,I,J,ce="text")=>t&&r[J]!==void 0?J==="bedSize"?e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"number",placeholder:"X",value:r.bedSize.x,onChange:q=>A("bedSize",{x:parseInt(q.target.value)||0}),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"number",placeholder:"Y",value:r.bedSize.y,onChange:q=>A("bedSize",{y:parseInt(q.target.value)||0}),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"number",placeholder:"Z",value:r.bedSize.z,onChange:q=>A("bedSize",{z:parseInt(q.target.value)||0}),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}):e.jsx("input",{type:ce,value:r[J],onChange:q=>A(J,q.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):J==="bedSize"?e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("span",{className:"text-gray-900 font-medium",children:[I.x," × ",I.y," × ",I.z," mm"]})}):e.jsx("span",{className:"text-gray-900",children:I||"Not specified"});return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Printer Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your printer's basic settings and bed leveling"})]}),e.jsx("div",{className:"flex space-x-3",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:w,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Changes"})]}),e.jsxs("button",{onClick:_,className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors flex items-center space-x-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs("button",{onClick:b,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Configuration"})]})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>n("basic"),className:`py-2 px-1 border-b-2 font-medium text-sm ${i==="basic"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Se,{className:"h-4 w-4 inline mr-2"}),"Basic Configuration"]}),e.jsxs("button",{onClick:()=>n("bedLevel"),className:`py-2 px-1 border-b-2 font-medium text-sm ${i==="bedLevel"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(hs,{className:"h-4 w-4 inline mr-2"}),"Bed Leveling"]}),e.jsxs("button",{onClick:()=>n("config"),className:`py-2 px-1 border-b-2 font-medium text-sm ${i==="config"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ft,{className:"h-4 w-4 inline mr-2"}),"Configuration Management"]})]})}),i==="basic"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ot,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Printer Name"}),C("Printer Name",o.name,"name")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),C("Model",o.model,"model")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Firmware"}),C("Firmware",o.firmware,"firmware")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bed Size (X × Y × Z)"}),C("Bed Size",o.bedSize,"bedSize")]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Se,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Firmware Configuration"})]}),e.jsxs("div",{className:"space-y-3",children:[((T=o.firmwareConfiguration)==null?void 0:T.maxHotendTemp)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Hotend Temperature"}),e.jsxs("span",{className:"text-gray-900",children:[o.firmwareConfiguration.maxHotendTemp,"°C"]})]}),((G=o.firmwareConfiguration)==null?void 0:G.maxBedTemp)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Bed Temperature"}),e.jsxs("span",{className:"text-gray-900",children:[o.firmwareConfiguration.maxBedTemp,"°C"]})]}),((E=o.firmwareConfiguration)==null?void 0:E.stepsPerMm)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Steps per mm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"X:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.x})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Y:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.y})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Z:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.z})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"E:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.e})]})]})]}),!o.firmwareConfiguration||Object.keys(o.firmwareConfiguration).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No firmware configuration data available"}):null]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx($e,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Calibration Status"})]}),e.jsxs("div",{className:"space-y-3",children:[o.calibrationSteps&&Object.entries(o.calibrationSteps).map(([R,I])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:R.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"flex items-center space-x-2",children:I!=null&&I.completed?e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"Completed"}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Pending"})})]},R)),!o.calibrationSteps||Object.keys(o.calibrationSteps).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No calibration steps configured"}):null]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx($e,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Additional Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Printer ID"}),e.jsx("p",{className:"text-sm text-gray-600 font-mono bg-gray-100 p-2 rounded",children:o.id})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Last Updated"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.lastUpdated?new Date(o.lastUpdated).toLocaleDateString():"Never"})]})]})]})]}),i==="bedLevel"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(hs,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bed Leveling Status"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:p?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Enabled"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Disabled"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m!=null&&m.gridSize?`${m.gridSize.x}×${m.gridSize.y}`:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Grid Size"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g?m.data.length:0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Mesh Points"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m!=null&&m.variance?`${m.variance.toFixed(3)}`:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Variance (mm)"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ns,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bed Mesh Visualization"})]}),e.jsx(Ka,{})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(pt,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bed Leveling Information"})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fade Height:"})," ",((k=y==null?void 0:y.bedLeveling)==null?void 0:k.fadeHeight)||"Not set"," mm"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mesh Type:"})," ",((N=y==null?void 0:y.bedLeveling)==null?void 0:N.type)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Updated:"})," ",m!=null&&m.lastUpdated?new Date(m.lastUpdated).toLocaleString():"Never"]})]})]})]}),i==="config"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Sl,{})})]})};function _l(t,a=!1){if(!t||typeof t!="string")return[];const r=t.split(`
`),s=[];for(let l=0;l<r.length;l++){const c=r[l].trim();if(!c||c.startsWith("//")&&!c.includes("#define")||c.startsWith("/*"))continue;let o=c.match(/^(\s*\/\/\s*)?#define\s+([A-Za-z0-9_]+)\s*(.*)/);if(o){const[,d,m,x]=o,h=!!d;let f="",y="";if(x){const g=x.split(/(?:\/\/|\/\*)/),p=g[0].trim();h&&!p?f=!1:p&&(p==="true"||p==="false"?f=p==="true":p==="1"||p==="0"?f=p==="1":!isNaN(p)&&p!==""?p.includes(".")||p.startsWith("-")?f=parseFloat(p):f=parseInt(p,10):p.startsWith('"')&&p.endsWith('"')||p.startsWith("'")&&p.endsWith("'")?f=p.slice(1,-1):f=p),g.length>1&&(y=g[1].trim())}if(!y&&l+1<r.length){const g=r[l+1].trim();g.startsWith("//")&&!g.includes("#define")&&(y=g.substring(2).trim())}if(!y&&l>0){const g=r[l-1].trim();g.startsWith("//")&&!g.includes("#define")&&(y=g.substring(2).trim())}h&&console.log(`Found commented define: ${m} (line ${l+1})`),s.push({name:m,value:f,enabled:!h,description:y,lineNumber:l+1,fileType:a?"advanced":"basic"})}}const i=s.filter(l=>l.enabled).length,n=s.filter(l=>!l.enabled).length;return console.log(`Parsed ${s.length} defines: ${i} enabled, ${n} disabled`),s}function Tl(t,a="name",r="asc"){return[...t].sort((s,i)=>{let n=s[a],l=i[a];if(typeof n=="boolean"&&(n=n?1:0),typeof l=="boolean"&&(l=l?1:0),typeof n=="number"&&typeof l=="number")return r==="asc"?n-l:l-n;if(typeof n=="string"&&typeof l=="string"){const o=n.localeCompare(l);return r==="asc"?o:-o}const c=String(n).localeCompare(String(l));return r==="asc"?c:-c})}const sr={"Machine Configuration":{subcategories:{"Basic Info":["MACHINE_NAME","MACHINE_UUID","STRING_CONFIG_H_AUTHOR"],"Board & Serial":["MOTHERBOARD","SERIAL_PORT","BAUDRATE","SERIAL_PORT_2"],"Printer Type":["DELTA","SCARA","COREXY","COREXZ","COREYZ","MARKFORGED_XY"]}},"Geometry & Kinematics":{subcategories:{"Build Volume":["X_BED_SIZE","Y_BED_SIZE","X_MIN_POS","X_MAX_POS","Y_MIN_POS","Y_MAX_POS","Z_MIN_POS","Z_MAX_POS"],"Bed Configuration":["BED_CENTER_AT_0_0","MANUAL_X_HOME_POS","MANUAL_Y_HOME_POS","MANUAL_Z_HOME_POS","BED_TRAMMING_INSET_LFRONT","BED_TRAMMING_INSET_RFRONT","BED_TRAMMING_INSET_LBACK","BED_TRAMMING_INSET_RBACK","BED_TRAMMING_HEIGHT","BED_TRAMMING_Z_HOP","BED_TRAMMING_USE_PROBE","BED_TRAMMING_INCLUDE_CENTER","BED_TRAMMING_VERIFY_RAISED","BED_TRAMMING_AUTO_LEVEL","BED_TRAMMING_REPORT_AVERAGE","BED_TRAMMING_ACCEPTABLE_TOLERANCE"],"Extruder Count":["EXTRUDERS","TEMP_SENSOR_1","TEMP_SENSOR_2","TEMP_SENSOR_3"],"Bed Leveling":["BED_LEVELING_COMMANDS","BED_LEVELING_REPEATABLE","BED_LEVELING_GRID","BED_LEVELING_GRID_POINTS","BED_LEVELING_GRID_SIZE","BED_LEVELING_GRID_OFFSET","BED_LEVELING_GRID_OFFSET_X","BED_LEVELING_GRID_OFFSET_Y","BED_LEVELING_GRID_OFFSET_Z","BED_LEVELING_GRID_OFFSET_RIGHT","BED_LEVELING_GRID_OFFSET_FRONT","BED_LEVELING_GRID_OFFSET_LEFT","BED_LEVELING_GRID_OFFSET_BACK"]}},"Motion & Mechanics":{subcategories:{"Steps & Direction":["DEFAULT_AXIS_STEPS_PER_UNIT","INVERT_X_DIR","INVERT_Y_DIR","INVERT_Z_DIR","INVERT_E0_DIR","INVERT_E1_DIR","INVERT_E2_DIR","INVERT_E3_DIR","INVERT_E4_DIR","INVERT_E5_DIR","INVERT_E6_DIR","INVERT_E7_DIR","X_DRIVER_TYPE","Y_DRIVER_TYPE","Z_DRIVER_TYPE","E0_DRIVER_TYPE","E1_DRIVER_TYPE","E2_DRIVER_TYPE","E3_DRIVER_TYPE","E4_DRIVER_TYPE","E5_DRIVER_TYPE","E6_DRIVER_TYPE","E7_DRIVER_TYPE"],"Speed & Acceleration":["DEFAULT_MAX_FEEDRATE","DEFAULT_MAX_ACCELERATION","DEFAULT_ACCELERATION","DEFAULT_RETRACT_ACCELERATION"],"Jerk Control":["CLASSIC_JERK","DEFAULT_XJERK","DEFAULT_YJERK","DEFAULT_ZJERK","DEFAULT_EJERK"],"Junction Deviation":["JUNCTION_DEVIATION","JD_HANDLE_SMALL_SEGMENTS"],"Stepper Driver Configuration":["X_DRIVER_TYPE","Y_DRIVER_TYPE","Z_DRIVER_TYPE","E0_DRIVER_TYPE","E1_DRIVER_TYPE","E2_DRIVER_TYPE","E3_DRIVER_TYPE","E4_DRIVER_TYPE","E5_DRIVER_TYPE","E6_DRIVER_TYPE","E7_DRIVER_TYPE","X_RSENSE","Y_RSENSE","Z_RSENSE","E0_RSENSE","E1_RSENSE","E2_RSENSE","E3_RSENSE","E4_RSENSE","E5_RSENSE","E6_RSENSE","E7_RSENSE","X_CHOPPER_TIMING","Y_CHOPPER_TIMING","Z_CHOPPER_TIMING","E0_CHOPPER_TIMING","E1_CHOPPER_TIMING","E2_CHOPPER_TIMING","E3_CHOPPER_TIMING","E4_CHOPPER_TIMING","E5_CHOPPER_TIMING","E6_CHOPPER_TIMING","E7_CHOPPER_TIMING"]}},"Endstops & Homing":{subcategories:{"Endstop Configuration":["USE_XMIN_PLUG","USE_YMIN_PLUG","USE_ZMIN_PLUG","USE_XMAX_PLUG","USE_YMAX_PLUG","USE_ZMAX_PLUG","X_MIN_ENDSTOP_INVERTING","Y_MIN_ENDSTOP_INVERTING","Z_MIN_ENDSTOP_INVERTING","X_MAX_ENDSTOP_INVERTING","Y_MAX_ENDSTOP_INVERTING","Z_MAX_ENDSTOP_INVERTING","X_MIN_ENDSTOP_PULLUP","Y_MIN_ENDSTOP_PULLUP","Z_MIN_ENDSTOP_PULLUP","X_MAX_ENDSTOP_PULLUP","Y_MAX_ENDSTOP_PULLUP","Z_MAX_ENDSTOP_PULLUP","ENDSTOPPULLUPS","ENDSTOPPULLUP_XMIN","ENDSTOPPULLUP_YMIN","ENDSTOPPULLUP_ZMIN","ENDSTOPPULLUP_XMAX","ENDSTOPPULLUP_YMAX","ENDSTOPPULLUP_ZMAX","ENDSTOP_INTERRUPTS_FEATURE","ENDSTOP_NOISE_FILTER","ENDSTOP_NOISE_THRESHOLD"],"Endstop Logic":["X_MIN_ENDSTOP_INVERTING","Y_MIN_ENDSTOP_INVERTING","Z_MIN_ENDSTOP_INVERTING"],Homing:["HOMING_FEEDRATE_XY","HOMING_FEEDRATE_Z","HOMING_BUMP_FEEDRATE","X_HOME_BUMP_MM","Y_HOME_BUMP_MM","Z_HOME_BUMP_MM"]}},"Temperature Control":{subcategories:{Sensors:["TEMP_SENSOR_0","TEMP_SENSOR_BED","TEMP_SENSOR_CHAMBER","TEMP_SENSOR_PROBE","TEMP_SENSOR_1","TEMP_SENSOR_2","TEMP_SENSOR_3","TEMP_SENSOR_4","TEMP_SENSOR_5","TEMP_SENSOR_6","TEMP_SENSOR_7","TEMP_SENSOR_COOLER","TEMP_SENSOR_REDUNDANT","TEMP_SENSOR_REDUNDANT_SOURCE","TEMP_SENSOR_REDUNDANT_TARGET","TEMP_SENSOR_REDUNDANT_MAX_DIFF"],"Safety Limits":["HEATER_0_MAXTEMP","HEATER_0_MINTEMP","BED_MAXTEMP","BED_MINTEMP"],"PID Settings":["PIDTEMP","DEFAULT_Kp","DEFAULT_Ki","DEFAULT_Kd","PIDTEMPBED"],"Thermal Protection":["THERMAL_PROTECTION_HOTENDS","THERMAL_PROTECTION_BED","THERMAL_PROTECTION_CHAMBER"],"Temperature Control Features":["BABYSTEPPING","BABYSTEP_XY","BABYSTEP_INVERT_Z","BABYSTEP_MULTIPLICATOR_Z","BABYSTEP_MULTIPLICATOR_XY","BABYSTEP_ZPROBE_OFFSET","BABYSTEP_HOTEND_Z_OFFSET","BABYSTEP_ZPROBE_GFX_OVERLAY","BABYSTEP_ZPROBE_GFX_REVERSE","BABYSTEP_ZPROBE_GFX_START_LEFT","BABYSTEP_ZPROBE_GFX_START_TOP","BABYSTEP_ZPROBE_GFX_START_RIGHT","BABYSTEP_ZPROBE_GFX_START_BOTTOM","BABYSTEP_ZPROBE_GFX_START_CENTER","BABYSTEP_ZPROBE_GFX_START_CENTER_LEFT","BABYSTEP_ZPROBE_GFX_START_CENTER_RIGHT","BABYSTEP_ZPROBE_GFX_START_CENTER_TOP","BABYSTEP_ZPROBE_GFX_START_CENTER_BOTTOM"]}},"Bed Leveling":{subcategories:{"Auto Bed Leveling":["AUTO_BED_LEVELING_3POINT","AUTO_BED_LEVELING_LINEAR","AUTO_BED_LEVELING_BILINEAR","AUTO_BED_LEVELING_UBL"],"Manual Leveling":["MESH_BED_LEVELING","MANUAL_MESH_BED_LEVELING"],"Probe Configuration":["BLTOUCH","FIX_MOUNTED_PROBE","NOZZLE_AS_PROBE","Z_PROBE_OFFSET_FROM_EXTRUDER"],"Grid Settings":["GRID_MAX_POINTS_X","GRID_MAX_POINTS_Y","LEFT_PROBE_BED_POSITION","RIGHT_PROBE_BED_POSITION"],Babystepping:["BABYSTEPPING","BABYSTEP_XY","BABYSTEP_INVERT_Z","BABYSTEP_MULTIPLICATOR_Z","BABYSTEP_MULTIPLICATOR_XY","BABYSTEP_ZPROBE_OFFSET","BABYSTEP_HOTEND_Z_OFFSET","BABYSTEP_ZPROBE_GFX_OVERLAY","BABYSTEP_ZPROBE_GFX_REVERSE"]}},"Extruder & Filament":{subcategories:{"Extruder Mechanics":["PREVENT_COLD_EXTRUSION","EXTRUDE_MINTEMP","PREVENT_LENGTHY_EXTRUDE","EXTRUDE_MAXLENGTH"],"Linear Advance":["LIN_ADVANCE","LIN_ADVANCE_K"],"Filament Handling":["FILAMENT_RUNOUT_SENSOR","FILAMENT_RUNOUT_SCRIPT","ADVANCED_PAUSE_FEATURE"],"Pressure Control":["FWRETRACT","RETRACT_LENGTH","RETRACT_FEEDRATE","RETRACT_ZRAISE"]}},"Display & Interface":{subcategories:{"LCD Type":["REPRAP_DISCOUNT_SMART_CONTROLLER","REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER","CR10_STOCKDISPLAY"],"Interface Features":["ULTIPANEL","NEWPANEL","LCD_BED_LEVELING","LCD_UBL_MESH_EDITING"],"SD Card":["SDSUPPORT","SD_CHECK_AND_RETRY","SDCARD_SORT_ALPHA"]}},"Advanced Features":{subcategories:{"Motion Features":["S_CURVE_ACCELERATION","BEZIER_JERK_CONTROL","EXPERIMENTAL_SCURVE"],"Stepper Drivers":["TMC2130","TMC2208","TMC2209","TMC5130","TMC5160"],Networking:["WIFI_CUSTOM_COMMAND","ESP3D_WIFISUPPORT"],Experimental:["EXPERIMENTAL_I2CBUS","EMERGENCY_PARSER","REALTIME_REPORTING_COMMANDS"],"Advanced Motion":["ADVANCED_PAUSE_FEATURE","ADVANCED_PAUSE_CONTINUOUS_PURGE","ADVANCED_PAUSE_PURGE_LENGTH","ADVANCED_PAUSE_PURGE_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT","ADVANCED_PAUSE_PURGE_RETRACT_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_SPEED","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_SPEED"],"Advanced Features":["ADVANCED_PAUSE_FEATURE","ADVANCED_PAUSE_CONTINUOUS_PURGE","ADVANCED_PAUSE_PURGE_LENGTH","ADVANCED_PAUSE_PURGE_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT","ADVANCED_PAUSE_PURGE_RETRACT_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_SPEED","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_SPEED"]}},"Custom Menus & UI":{subcategories:{"Menu Items":["CUSTOM_MENU_MAIN","CUSTOM_MENU_CONFIGURATION","CUSTOM_MENU_MOVE","CUSTOM_MENU_TEMPERATURE","CUSTOM_MENU_CONTROL","CUSTOM_MENU_UTILITY","CUSTOM_MENU_MAINTENANCE","CUSTOM_MENU_INFO","CUSTOM_MENU_DEBUG","CUSTOM_MENU_CALIBRATION"],"Menu Actions":["CUSTOM_MENU_ACTION_1","CUSTOM_MENU_ACTION_2","CUSTOM_MENU_ACTION_3","CUSTOM_MENU_ACTION_4","CUSTOM_MENU_ACTION_5","CUSTOM_MENU_ACTION_6","CUSTOM_MENU_ACTION_7","CUSTOM_MENU_ACTION_8","CUSTOM_MENU_ACTION_9","CUSTOM_MENU_ACTION_10"],"Menu Labels":["CUSTOM_MENU_LABEL_1","CUSTOM_MENU_LABEL_2","CUSTOM_MENU_LABEL_3","CUSTOM_MENU_LABEL_4","CUSTOM_MENU_LABEL_5","CUSTOM_MENU_LABEL_6","CUSTOM_MENU_LABEL_7","CUSTOM_MENU_LABEL_8","CUSTOM_MENU_LABEL_9","CUSTOM_MENU_LABEL_10"]}},"Printer-Specific Features":{subcategories:{"Delta Printer":["DELTA_PRINTER","DELTA_ENDSTOP_ADJ","DELTA_DIAGONAL_ROD","DELTA_HEIGHT","DELTA_RADIUS","DELTA_SEGMENTS_PER_SECOND","DELTA_PRINTABLE_RADIUS","DELTA_PROBEABLE_RADIUS","DELTA_TOWER_ANGLE_TRIM","DELTA_ENDSTOP_OFFSET","DELTA_CARRIAGE_OFFSET","DELTA_DIAGONAL_ROD_TRIM_TOWER_1","DELTA_DIAGONAL_ROD_TRIM_TOWER_2","DELTA_DIAGONAL_ROD_TRIM_TOWER_3"],"SCARA Printer":["SCARA_PRINTER","SCARA_LINKAGE_1","SCARA_LINKAGE_2","SCARA_OFFSET_X","SCARA_OFFSET_Y","SCARA_THETA_OFFSET","SCARA_PSI_OFFSET"],"CoreXY Printer":["COREXY_PRINTER","COREXY_BELT_DRIVE","COREXY_BELT_DRIVE_XY","COREXY_BELT_DRIVE_XZ","COREXY_BELT_DRIVE_YZ"],"Dual X Carriage":["DUAL_X_CARRIAGE","X_DUAL_STEPPER_DRIVERS","X2_DRIVER_TYPE","X2_HOME_DIR","X2_HOME_POS","X2_MAX_ENDSTOP_INVERTING","X2_MIN_ENDSTOP_INVERTING","X2_USE_ENDSTOP","X2_STEP_PIN","X2_DIR_PIN","X2_ENABLE_PIN","X2_MS1_PIN","X2_MS2_PIN","X2_RESET_PIN","X2_SLEEP_PIN","X2_STEPPER_DRIVER","X2_STEPPER_DRIVER_TYPE","X2_STEPPER_DRIVER_ADDRESS","X2_STEPPER_DRIVER_RSENSE","X2_STEPPER_DRIVER_RSENSE_OHMS","X2_STEPPER_DRIVER_RSENSE_OHMS_DEFAULT","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_DEFAULT","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR_DEFAULT"],"Dual Y Carriage":["DUAL_Y_CARRIAGE","Y_DUAL_STEPPER_DRIVERS","Y2_DRIVER_TYPE","Y2_HOME_DIR","Y2_HOME_POS","Y2_MAX_ENDSTOP_INVERTING","Y2_MIN_ENDSTOP_INVERTING","Y2_USE_ENDSTOP","Y2_STEP_PIN","Y2_DIR_PIN","Y2_ENABLE_PIN","Y2_MS1_PIN","Y2_MS2_PIN","Y2_RESET_PIN","Y2_SLEEP_PIN","Y2_STEPPER_DRIVER","Y2_STEPPER_DRIVER_TYPE","Y2_STEPPER_DRIVER_ADDRESS","Y2_STEPPER_DRIVER_RSENSE","Y2_STEPPER_DRIVER_RSENSE_OHMS","Y2_STEPPER_DRIVER_RSENSE_OHMS_DEFAULT","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_DEFAULT","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR_DEFAULT"],"Dual Z Carriage":["DUAL_Z_CARRIAGE","Z_DUAL_STEPPER_DRIVERS","Z2_DRIVER_TYPE","Z2_HOME_DIR","Z2_HOME_POS","Z2_MAX_ENDSTOP_INVERTING","Z2_MIN_ENDSTOP_INVERTING","Z2_USE_ENDSTOP","Z2_STEP_PIN","Z2_DIR_PIN","Z2_ENABLE_PIN","Z2_MS1_PIN","Z2_MS2_PIN","Z2_RESET_PIN","Z2_SLEEP_PIN","Z2_STEPPER_DRIVER","Z2_STEPPER_DRIVER_TYPE","Z2_STEPPER_DRIVER_ADDRESS","Z2_STEPPER_DRIVER_RSENSE","Z2_STEPPER_DRIVER_RSENSE_OHMS","Z2_STEPPER_DRIVER_RSENSE_OHMS_DEFAULT","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_DEFAULT","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR_DEFAULT"]}},"Safety & Protection":{subcategories:{"Thermal Protection":["THERMAL_PROTECTION_HOTENDS","THERMAL_PROTECTION_BED","THERMAL_PROTECTION_CHAMBER","THERMAL_PROTECTION_COOLER","THERMAL_PROTECTION_COOLER_PERIOD","THERMAL_PROTECTION_COOLER_HYSTERESIS","THERMAL_PROTECTION_COOLER_FAN_SPEED","THERMAL_PROTECTION_COOLER_FAN_SPEED_MIN","THERMAL_PROTECTION_COOLER_FAN_SPEED_MAX"],"Emergency Features":["EMERGENCY_PARSER","HOST_ACTION_COMMANDS","HOST_PROMPT_SUPPORT","HOST_KEEPALIVE_FEATURE","HOST_KEEPALIVE_TIMEOUT","HOST_KEEPALIVE_INTERVAL","HOST_KEEPALIVE_TIMEOUT_SECONDS","HOST_KEEPALIVE_INTERVAL_SECONDS"],"Filament Safety":["FILAMENT_RUNOUT_SENSOR","FILAMENT_RUNOUT_SCRIPT","FILAMENT_RUNOUT_DISTANCE_MM","FILAMENT_RUNOUT_SECONDS","FILAMENT_RUNOUT_PULLUP","FILAMENT_RUNOUT_ON_STATE","FILAMENT_RUNOUT_SENSOR_STATE","FILAMENT_RUNOUT_SENSOR_STATE_HIGH","FILAMENT_RUNOUT_SENSOR_STATE_LOW"]}},"Communication & Host":{subcategories:{"Serial Communication":["SERIAL_PORT","SERIAL_PORT_2","BAUDRATE","SERIAL_BAUDRATE","SERIAL_BAUDRATE_2","SERIAL_BAUDRATE_3","SERIAL_BAUDRATE_4","SERIAL_BAUDRATE_5","SERIAL_BAUDRATE_6","SERIAL_BAUDRATE_7","SERIAL_BAUDRATE_8","SERIAL_BAUDRATE_9","SERIAL_BAUDRATE_10"],"Host Interface":["HOST_ACTION_COMMANDS","HOST_PROMPT_SUPPORT","HOST_KEEPALIVE_FEATURE","HOST_KEEPALIVE_TIMEOUT","HOST_KEEPALIVE_INTERVAL","HOST_KEEPALIVE_TIMEOUT_SECONDS","HOST_KEEPALIVE_INTERVAL_SECONDS"],"Network Features":["WIFI_CUSTOM_COMMAND","ESP3D_WIFISUPPORT","ESP3D_WIFISUPPORT_SSID","ESP3D_WIFISUPPORT_PASSWORD","ESP3D_WIFISUPPORT_IP","ESP3D_WIFISUPPORT_GATEWAY","ESP3D_WIFISUPPORT_SUBNET","ESP3D_WIFISUPPORT_AP_SSID","ESP3D_WIFISUPPORT_AP_PASSWORD","ESP3D_WIFISUPPORT_AP_IP","ESP3D_WIFISUPPORT_AP_GATEWAY","ESP3D_WIFISUPPORT_AP_SUBNET"]}},"Fans & Cooling":{subcategories:{"Fan Configuration":["FANMUX0","FANMUX1","FANMUX2","FANMUX3","FANMUX4","FANMUX5","FANMUX6","FANMUX7","FANMUX8","FANMUX9","FANMUX10","FANMUX11","FANMUX12","FANMUX13","FANMUX14","FANMUX15","FANMUX16","FANMUX17","FANMUX18","FANMUX19","FANMUX20","FANMUX21","FANMUX22","FANMUX23","FANMUX24","FANMUX25","FANMUX26","FANMUX27","FANMUX28","FANMUX29","FANMUX30","FANMUX31"],"Cooling Fans":["USE_CONTROLLER_FAN","CONTROLLER_FAN_PIN","CONTROLLER_FAN_EDITABLE","CONTROLLER_FAN_EDITABLE_SPEED","CONTROLLER_FAN_EDITABLE_TEMP","CONTROLLER_FAN_EDITABLE_TEMP_MIN","CONTROLLER_FAN_EDITABLE_TEMP_MAX","CONTROLLER_FAN_EDITABLE_TEMP_STEP","CONTROLLER_FAN_EDITABLE_TEMP_DEFAULT","CONTROLLER_FAN_EDITABLE_SPEED_MIN","CONTROLLER_FAN_EDITABLE_SPEED_MAX","CONTROLLER_FAN_EDITABLE_SPEED_STEP","CONTROLLER_FAN_EDITABLE_SPEED_DEFAULT"],"Part Cooling":["EXTRUDER_AUTO_FAN_TEMPERATURE","EXTRUDER_AUTO_FAN_SPEED","EXTRUDER_AUTO_FAN_DURATION","EXTRUDER_AUTO_FAN_SPEED_MIN","EXTRUDER_AUTO_FAN_SPEED_MAX","EXTRUDER_AUTO_FAN_SPEED_STEP","EXTRUDER_AUTO_FAN_SPEED_DEFAULT","EXTRUDER_AUTO_FAN_TEMP_MIN","EXTRUDER_AUTO_FAN_TEMP_MAX","EXTRUDER_AUTO_FAN_TEMP_STEP","EXTRUDER_AUTO_FAN_TEMP_DEFAULT"]}},"Hardware & Pins":{subcategories:{"Pin Assignments":["X_STEP_PIN","X_DIR_PIN","X_ENABLE_PIN","X_MS1_PIN","X_MS2_PIN","X_RESET_PIN","X_SLEEP_PIN","Y_STEP_PIN","Y_DIR_PIN","Y_ENABLE_PIN","Y_MS1_PIN","Y_MS2_PIN","Y_RESET_PIN","Y_SLEEP_PIN","Z_STEP_PIN","Z_DIR_PIN","Z_ENABLE_PIN","Z_MS1_PIN","Z_MS2_PIN","Z_RESET_PIN","Z_SLEEP_PIN","E0_STEP_PIN","E0_DIR_PIN","E0_ENABLE_PIN","E0_MS1_PIN","E0_MS2_PIN","E0_RESET_PIN","E0_SLEEP_PIN"],"Heater Pins":["HEATER_0_PIN","HEATER_1_PIN","HEATER_2_PIN","HEATER_3_PIN","HEATER_4_PIN","HEATER_5_PIN","HEATER_6_PIN","HEATER_7_PIN","HEATER_BED_PIN","HEATER_CHAMBER_PIN","HEATER_COOLER_PIN"],"Fan Pins":["FAN_PIN","FAN1_PIN","FAN2_PIN","FAN3_PIN","FAN4_PIN","FAN5_PIN","FAN6_PIN","FAN7_PIN","CONTROLLER_FAN_PIN","EXTRUDER_AUTO_FAN_PIN"],"Sensor Pins":["TEMP_0_PIN","TEMP_1_PIN","TEMP_2_PIN","TEMP_3_PIN","TEMP_4_PIN","TEMP_5_PIN","TEMP_6_PIN","TEMP_7_PIN","TEMP_BED_PIN","TEMP_CHAMBER_PIN","TEMP_COOLER_PIN","TEMP_PROBE_PIN"],"Endstop Pins":["X_MIN_PIN","X_MAX_PIN","Y_MIN_PIN","Y_MAX_PIN","Z_MIN_PIN","Z_MAX_PIN","X_STOP_PIN","Y_STOP_PIN","Z_STOP_PIN"],"Probe Pins":["Z_MIN_PROBE_PIN","Z_MIN_PROBE_PIN_INVERTING","Z_MIN_PROBE_PIN_PULLUP","Z_MIN_PROBE_PIN_PULLDOWN","Z_MIN_PROBE_PIN_PULLUP_INVERTING","Z_MIN_PROBE_PIN_PULLDOWN_INVERTING"]}}},Ja={BAUDRATE:{type:"enum",values:[9600,19200,38400,57600,115200,230400,25e4,5e5,1e6],default:115200,description:"Serial communication baud rate. 115200 is standard for most printers."},EXTRUDERS:{type:"number",min:1,max:8,default:1,description:"Number of extruders. Most printers have 1, multi-color printers may have 2-4."},X_BED_SIZE:{type:"number",min:50,max:1e3,default:220,description:"Build volume width in mm. Should match your printer's physical bed size."},Y_BED_SIZE:{type:"number",min:50,max:1e3,default:220,description:"Build volume depth in mm. Should match your printer's physical bed size."},DEFAULT_AXIS_STEPS_PER_UNIT:{type:"array",elementType:"number",length:4,description:"Steps per mm for X, Y, Z, E axes. Critical for dimensional accuracy.",validation:t=>!Array.isArray(t)||t.length!==4?"Must be array of 4 numbers":t.some(a=>a<10||a>2e3)?"Values should be between 10-2000":null},DEFAULT_MAX_FEEDRATE:{type:"array",elementType:"number",length:4,description:"Maximum feedrates in mm/s for X, Y, Z, E axes.",validation:t=>!Array.isArray(t)||t.length!==4?"Must be array of 4 numbers":t[0]<10||t[0]>1e3?"X feedrate should be 10-1000 mm/s":t[1]<10||t[1]>1e3?"Y feedrate should be 10-1000 mm/s":t[2]<1||t[2]>100?"Z feedrate should be 1-100 mm/s":t[3]<1||t[3]>200?"E feedrate should be 1-200 mm/s":null},HEATER_0_MAXTEMP:{type:"number",min:200,max:500,default:275,description:"Maximum hotend temperature in °C. Set based on your hotend capabilities."},BED_MAXTEMP:{type:"number",min:60,max:200,default:130,description:"Maximum bed temperature in °C. Set based on your heated bed capabilities."},LIN_ADVANCE_K:{type:"number",min:0,max:10,default:0,description:"Linear Advance K factor. 0 disables, typical values 0.05-0.5 for direct drive, 0.3-1.5 for Bowden."},DEFAULT_MAX_ACCELERATION:{type:"array",elementType:"number",length:4,description:"Maximum acceleration in mm/s² for X, Y, Z, E axes.",validation:t=>!Array.isArray(t)||t.length!==4?"Must be array of 4 numbers":t[0]<100||t[0]>1e4?"X acceleration should be 100-10000 mm/s²":t[1]<100||t[1]>1e4?"Y acceleration should be 100-10000 mm/s²":t[2]<10||t[2]>1e3?"Z acceleration should be 10-1000 mm/s²":t[3]<100||t[3]>5e4?"E acceleration should be 100-50000 mm/s²":null},DEFAULT_ACCELERATION:{type:"number",min:100,max:1e4,default:3e3,description:"Default acceleration in mm/s² for print moves."},DEFAULT_RETRACT_ACCELERATION:{type:"number",min:100,max:5e4,default:3e3,description:"Default acceleration in mm/s² for retraction moves."},CLASSIC_JERK:{type:"boolean",default:!1,description:"Enable classic jerk control instead of junction deviation."},DEFAULT_XJERK:{type:"number",min:0,max:100,default:10,description:"Default X-axis jerk in mm/s."},DEFAULT_YJERK:{type:"number",min:0,max:100,default:10,description:"Default Y-axis jerk in mm/s."},DEFAULT_ZJERK:{type:"number",min:0,max:20,default:.3,description:"Default Z-axis jerk in mm/s."},DEFAULT_EJERK:{type:"number",min:0,max:100,default:5,description:"Default E-axis jerk in mm/s."},JUNCTION_DEVIATION:{type:"number",min:.01,max:1,default:.013,description:"Junction deviation for smooth motion planning."},RETRACT_LENGTH:{type:"number",min:0,max:50,default:6.5,description:"Retraction length in mm. 1-2mm for direct drive, 4-8mm for Bowden."},RETRACT_FEEDRATE:{type:"number",min:10,max:200,default:45,description:"Retraction feedrate in mm/s."},RETRACT_ZRAISE:{type:"number",min:0,max:10,default:0,description:"Z-axis raise during retraction in mm."},HOMING_FEEDRATE_XY:{type:"number",min:100,max:1e4,default:3e3,description:"Homing feedrate for X and Y axes in mm/s."},HOMING_FEEDRATE_Z:{type:"number",min:100,max:2e3,default:1500,description:"Homing feedrate for Z axis in mm/s."},GRID_MAX_POINTS_X:{type:"number",min:2,max:15,default:5,description:"Number of probe points in X direction for bed leveling."},GRID_MAX_POINTS_Y:{type:"number",min:2,max:15,default:5,description:"Number of probe points in Y direction for bed leveling."}},cs={"Direct Drive Conversion":{description:"Optimized settings for direct drive extruder conversion",settings:{LIN_ADVANCE:!0,LIN_ADVANCE_K:.2,RETRACT_LENGTH:1,RETRACT_FEEDRATE:60,DEFAULT_AXIS_STEPS_PER_UNIT:[80,80,400,140],DEFAULT_MAX_ACCELERATION:[500,500,100,1e4]}},"High Speed Printing":{description:"Settings optimized for high-speed printing",settings:{CLASSIC_JERK:!1,JUNCTION_DEVIATION:.05,S_CURVE_ACCELERATION:!0,DEFAULT_MAX_FEEDRATE:[500,500,15,120],DEFAULT_MAX_ACCELERATION:[3e3,3e3,100,1e4],LIN_ADVANCE:!0,LIN_ADVANCE_K:.4}},"Silent Operation":{description:"Reduced noise settings for quiet operation",settings:{TMC2208:!0,STEALTHCHOP:!0,HYBRID_THRESHOLD:!0,DEFAULT_MAX_FEEDRATE:[200,200,8,50],DEFAULT_MAX_ACCELERATION:[800,800,50,5e3],DEFAULT_XJERK:8,DEFAULT_YJERK:8,DEFAULT_ZJERK:.3}},"Auto Bed Leveling":{description:"Complete auto bed leveling setup",settings:{AUTO_BED_LEVELING_BILINEAR:!0,GRID_MAX_POINTS_X:5,GRID_MAX_POINTS_Y:5,LCD_BED_LEVELING:!0,RESTORE_LEVELING_AFTER_G28:!0,ENABLE_LEVELING_FADE_HEIGHT:!0,DEFAULT_LEVELING_FADE_HEIGHT:10}},"Safety Enhanced":{description:"Enhanced safety features and thermal protection",settings:{THERMAL_PROTECTION_HOTENDS:!0,THERMAL_PROTECTION_BED:!0,THERMAL_PROTECTION_CHAMBER:!0,PREVENT_COLD_EXTRUSION:!0,PREVENT_LENGTHY_EXTRUDE:!0,EMERGENCY_PARSER:!0,HOST_ACTION_COMMANDS:!0,HOST_PROMPT_SUPPORT:!0}}};function Pl(t){const a={},r=[];return Object.keys(sr).forEach(s=>{a[s]={},Object.keys(sr[s].subcategories).forEach(i=>{a[s][i]=[]})}),t.forEach(s=>{let i=!1;for(const[n,l]of Object.entries(sr)){for(const[c,o]of Object.entries(l.subcategories))if(o.includes(s.name)){a[n][c].push(s),i=!0;break}if(i)break}i||r.push(s)}),r.length>0&&(a.Other||(a.Other={Uncategorized:[]}),a.Other.Uncategorized=r),a}function pa(t,a){const r=Ja[t];if(!r)return a==null||a===""?{isValid:!1,error:"Value cannot be empty"}:{isValid:!0,error:null};if(r.validation){const s=r.validation(a);return{isValid:!s,error:s}}switch(r.type){case"number":const s=parseFloat(a);if(isNaN(s))return{isValid:!1,error:"Must be a number"};if(r.min!==void 0&&s<r.min)return{isValid:!1,error:`Must be at least ${r.min}`};if(r.max!==void 0&&s>r.max)return{isValid:!1,error:`Must be at most ${r.max}`};break;case"enum":const i=typeof r.values[0]=="number"?parseFloat(a):a;if(!r.values.includes(i))return{isValid:!1,error:`Must be one of: ${r.values.join(", ")}`};break;case"boolean":if(typeof a!="boolean"&&a!=="true"&&a!=="false")return{isValid:!1,error:"Must be true or false"};break;case"array":if(!Array.isArray(a))return{isValid:!1,error:"Must be an array"};if(r.length&&a.length!==r.length)return{isValid:!1,error:`Must have exactly ${r.length} elements`};break}return{isValid:!0,error:null}}function ds(t){const a=Ja[t];return{description:(a==null?void 0:a.description)||"No description available",type:(a==null?void 0:a.type)||"unknown",default:a==null?void 0:a.default,constraints:{min:a==null?void 0:a.min,max:a==null?void 0:a.max,values:a==null?void 0:a.values}}}function Cl(t,a){const r=cs[a];if(!r)return t;const s=[...t];return Object.entries(r.settings).forEach(([i,n])=>{const l=s.findIndex(c=>c.name===i);l!==-1?s[l]={...s[l],value:n,enabled:!0}:s.push({name:i,value:n,enabled:!0,description:ds(i).description,fileType:"basic"})}),s}function ga(t,a="cartesian"){const r={delta:["DELTA_PRINTER","DELTA_ENDSTOP_ADJ","DELTA_DIAGONAL_ROD","DELTA_HEIGHT","DELTA_RADIUS","DELTA_SEGMENTS_PER_SECOND","DELTA_PRINTABLE_RADIUS","DELTA_PROBEABLE_RADIUS","DELTA_TOWER_ANGLE_TRIM","DELTA_ENDSTOP_OFFSET","DELTA_CARRIAGE_OFFSET","DELTA_DIAGONAL_ROD_TRIM_TOWER_1","DELTA_DIAGONAL_ROD_TRIM_TOWER_2","DELTA_DIAGONAL_ROD_TRIM_TOWER_3"],scara:["SCARA_PRINTER","SCARA_LINKAGE_1","SCARA_LINKAGE_2","SCARA_OFFSET_X","SCARA_OFFSET_Y","SCARA_THETA_OFFSET","SCARA_PSI_OFFSET"],corexy:["COREXY_PRINTER","COREXY_BELT_DRIVE","COREXY_BELT_DRIVE_XY","COREXY_BELT_DRIVE_XZ","COREXY_BELT_DRIVE_YZ"],dual_x:["DUAL_X_CARRIAGE","X_DUAL_STEPPER_DRIVERS","X2_DRIVER_TYPE","X2_HOME_DIR","X2_HOME_POS","X2_MAX_ENDSTOP_INVERTING","X2_MIN_ENDSTOP_INVERTING","X2_USE_ENDSTOP"],dual_y:["DUAL_Y_CARRIAGE","Y_DUAL_STEPPER_DRIVERS","Y2_DRIVER_TYPE","Y2_HOME_DIR","Y2_HOME_POS","Y2_MAX_ENDSTOP_INVERTING","Y2_MIN_ENDSTOP_INVERTING","Y2_USE_ENDSTOP"],dual_z:["DUAL_Z_CARRIAGE","Z_DUAL_STEPPER_DRIVERS","Z2_DRIVER_TYPE","Z2_HOME_DIR","Z2_HOME_POS","Z2_MAX_ENDSTOP_INVERTING","Z2_MIN_ENDSTOP_INVERTING","Z2_USE_ENDSTOP"]};for(const[s,i]of Object.entries(r))if(i.includes(t))return s===a||a==="cartesian";return!0}function Rl(t,a){if(!a)return t;const r=a.toLowerCase();return t.filter(s=>s.name.toLowerCase().includes(r)||s.description.toLowerCase().includes(r)||String(s.value).toLowerCase().includes(r))}const Ml=()=>{const[t,a]=u.useState(null),[r,s]=u.useState(null),[i,n]=u.useState([]),[l,c]=u.useState([]),[o,d]=u.useState(""),[m,x]=u.useState("name"),[h,f]=u.useState("asc"),[y,g]=u.useState(!0),[p,b]=u.useState(!0),[w,_]=u.useState(!1),[A,C]=u.useState(new Set),[M,T]=u.useState({}),[G,E]=u.useState({}),[k,N]=u.useState(new Set),[R,I]=u.useState(!1),[J,ce]=u.useState("");u.useState([]);const[q,ne]=u.useState({}),[Q,X]=u.useState(!1),[v,j]=u.useState(!0),[S,L]=u.useState(!0),V=u.useRef(null),{getActivePrinter:F,updatePrinter:$}=je(),U=F();if(u.useEffect(()=>{var B,z;if(U&&U.firmwareConfiguration){const P=U.firmwareConfiguration;P.basic&&P.basic.length>0&&(n(P.basic),(B=P.summary)!=null&&B.basicFile&&a({name:P.summary.basicFile})),P.advanced&&P.advanced.length>0&&(c(P.advanced),(z=P.summary)!=null&&z.advancedFile&&s({name:P.summary.advancedFile}))}},[U]),!U)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(De,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Printer Selected"}),e.jsx("p",{className:"text-gray-500",children:"Please select a printer to configure firmware"})]});const D=async(B,z)=>{if(B)try{_(!0);const P=await B.text(),H=_l(P,z);z?(c(H),s(B)):(n(H),a(B)),await Z(H,z,B)}catch(P){console.error("Error reading file:",P),alert("Error reading file. Please make sure it's a valid text file.")}finally{_(!1)}},Z=async(B,z,P)=>{var H,ee;try{const re=U.firmwareConfiguration||{basic:[],advanced:[]},pe=z?re.basic||[]:B,ye=z?B:re.advanced||[],Ne={basic:pe,advanced:ye,lastUpdated:new Date().toISOString(),summary:{totalDefines:pe.length+ye.length,enabledDefines:pe.filter(ue=>ue.enabled).length+ye.filter(ue=>ue.enabled).length,basicFile:z?((H=re.summary)==null?void 0:H.basicFile)||null:P.name,advancedFile:z?P.name:((ee=re.summary)==null?void 0:ee.advancedFile)||null}};$(U.id,{firmwareConfiguration:Ne}),$(U.id,{calibrationSteps:{...U.calibrationSteps,firmwareConfig:{completed:!0,lastUpdated:new Date().toISOString(),configCount:Ne.summary.totalDefines}}}),console.log(`Configuration ${z?"advanced":"basic"} saved automatically`),X(!0),setTimeout(()=>X(!1),3e3)}catch(re){console.error("Error auto-saving configuration:",re),alert("Error saving configuration automatically. Please try saving manually.")}},oe=()=>{if(i.length===0&&l.length===0){alert("Please upload at least one configuration file first.");return}_(!0);try{const B={basic:i,advanced:l,lastUpdated:new Date().toISOString(),summary:{totalDefines:i.length+l.length,enabledDefines:i.filter(z=>z.enabled).length+l.filter(z=>z.enabled).length,basicFile:(t==null?void 0:t.name)||null,advancedFile:(r==null?void 0:r.name)||null}};$(U.id,{firmwareConfiguration:B}),$(U.id,{calibrationSteps:{...U.calibrationSteps,firmwareConfig:{completed:!0,lastUpdated:new Date().toISOString(),configCount:B.summary.totalDefines}}}),alert("Firmware configuration saved successfully!")}catch(B){console.error("Error saving configuration:",B),alert("Error saving configuration. Please try again.")}finally{_(!1)}},he=()=>{const z=["Feature Name,Enabled,Value,Description,File Type,Line Number",...[...i,...l].map(re=>`"${re.name}",${re.enabled?"Yes":"No"},"${re.value}","${re.description}","${re.fileType}",${re.lineNumber}`)].join(`
`),P=new Blob([z],{type:"text/csv"}),H=window.URL.createObjectURL(P),ee=document.createElement("a");ee.href=H,ee.download=`${U.name}_firmware_config.csv`,ee.click(),window.URL.revokeObjectURL(H)},W=()=>{let B=[...i];y&&(B=[...B,...l]);let z=Rl(B,o);if(v||(z=z.filter(P=>P.enabled)),S&&U){const P=me(U);z=z.filter(H=>ga(H.name,P))}return Tl(z,m,h)},me=B=>{var H,ee;const z=((H=B.model)==null?void 0:H.toLowerCase())||"",P=((ee=B.firmware)==null?void 0:ee.toLowerCase())||"";return z.includes("delta")||P.includes("delta")?"delta":z.includes("scara")||P.includes("scara")?"scara":z.includes("corexy")||z.includes("corexz")||z.includes("coreyz")||P.includes("corexy")||P.includes("corexz")||P.includes("coreyz")?"corexy":z.includes("dual")&&z.includes("x")?"dual_x":z.includes("dual")&&z.includes("y")?"dual_y":z.includes("dual")&&z.includes("z")?"dual_z":"cartesian"},xe=B=>{const z=[...i,...l].find(P=>P.name===B);z&&(C(P=>new Set([...P,B])),T(P=>({...P,[B]:z.value})))},O=B=>{C(z=>{const P=new Set(z);return P.delete(B),P}),T(z=>{const P={...z};return delete P[B],P}),E(z=>{const P={...z};return delete P[B],P})},K=B=>{const z=M[B],P=ds(B);let H=z;if(P.type==="number"){if(H=parseFloat(z),isNaN(H)){E(pe=>({...pe,[B]:"Must be a valid number"}));return}}else P.type==="boolean"?H=z==="true":P.constraints.values&&typeof P.constraints.values[0]=="number"&&(H=parseFloat(z));const ee=pa(B,H);if(!ee.isValid){E(pe=>({...pe,[B]:ee.error}));return}const re=pe=>pe.map(ye=>ye.name===B?{...ye,value:H}:ye);i.find(pe=>pe.name===B)?n(re):l.find(pe=>pe.name===B)&&c(re),O(B)},ae=B=>{var re,pe,ye,Ne;const z=ue=>ue.map(ge=>ge.name===B?{...ge,enabled:!ge.enabled}:ge);i.find(ue=>ue.name===B)?n(z):l.find(ue=>ue.name===B)&&c(z);const P=i.find(ue=>ue.name===B)?z(i):i,H=l.find(ue=>ue.name===B)?z(l):l,ee={basic:P,advanced:H,lastUpdated:new Date().toISOString(),summary:{totalDefines:P.length+H.length,enabledDefines:P.filter(ue=>ue.enabled).length+H.filter(ue=>ue.enabled).length,basicFile:((pe=(re=U.firmwareConfiguration)==null?void 0:re.summary)==null?void 0:pe.basicFile)||null,advancedFile:((Ne=(ye=U.firmwareConfiguration)==null?void 0:ye.summary)==null?void 0:Ne.advancedFile)||null}};$(U.id,{firmwareConfiguration:ee})},Y=()=>{if(!J)return;const B=[...i,...l],z=Cl(B,J),P=z.filter(ee=>ee.fileType==="basic"),H=z.filter(ee=>ee.fileType==="advanced");n(P),c(H),ce("")},le=B=>{N(z=>{const P=new Set(z);return P.has(B)?P.delete(B):P.add(B),P})},de=B=>{ne(z=>({...z,[B]:!z[B]}))},se=B=>{const z=A.has(B.name),P=M[B.name],H=G[B.name],ee=ds(B.name),re=q[B.name],pe=U?me(U):"cartesian",ye=ga(B.name,pe);return e.jsxs("div",{className:`bg-white border rounded-lg p-3 hover:shadow-md transition-shadow ${B.enabled?ye?"border-gray-200":"border-yellow-300 bg-yellow-50":"border-gray-300 bg-gray-50"}`,children:[!ye&&e.jsxs("div",{className:"mb-2 p-1 bg-yellow-100 border border-yellow-200 rounded text-xs text-yellow-800",children:["⚠️ May not be relevant for ",pe," printers"]}),e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono truncate",children:B.name}),e.jsx("button",{onClick:()=>de(B.name),className:"text-gray-400 hover:text-blue-600 transition-colors flex-shrink-0",children:e.jsx(pt,{className:"h-3 w-3"})})]})}),e.jsx("button",{onClick:()=>ae(B.name),className:`ml-2 p-1 rounded transition-colors ${B.enabled?"text-green-600 hover:text-green-700 hover:bg-green-50":"text-red-600 hover:text-red-700 hover:bg-red-50"}`,title:B.enabled?"Disable setting":"Enable setting",children:B.enabled?e.jsx(Ee,{className:"h-4 w-4"}):e.jsx(Zn,{className:"h-4 w-4"})})]}),re&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-xs text-blue-800",children:[e.jsx("p",{children:ee.description}),ee.constraints.min!==void 0&&e.jsxs("p",{className:"mt-1",children:["Min: ",ee.constraints.min]}),ee.constraints.max!==void 0&&e.jsxs("p",{children:["Max: ",ee.constraints.max]}),ee.constraints.values&&e.jsxs("p",{children:["Valid values: ",ee.constraints.values.join(", ")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:z?e.jsxs("div",{className:"space-y-1",children:[ee.constraints.values?e.jsxs("select",{value:P||"",onChange:Ne=>{const ue=Ne.target.value;T(ge=>({...ge,[B.name]:ue})),ue&&E(ge=>{const we={...ge};return delete we[B.name],we})},className:`w-full px-2 py-1 text-xs border rounded ${H?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a value..."}),ee.constraints.values.map(Ne=>e.jsx("option",{value:Ne,children:Ne},Ne))]}):ee.type==="boolean"?e.jsxs("select",{value:P||"",onChange:Ne=>{const ue=Ne.target.value;T(ge=>({...ge,[B.name]:ue})),ue&&E(ge=>{const we={...ge};return delete we[B.name],we})},className:`w-full px-2 py-1 text-xs border rounded ${H?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}):e.jsx("input",{type:ee.type==="number"?"number":"text",value:P||"",onChange:Ne=>{const ue=Ne.target.value;if(T(ge=>({...ge,[B.name]:ue})),ue){const ge=ds(B.name);let we=ue;if(ge.type==="number"){if(we=parseFloat(ue),isNaN(we)){E(Pe=>({...Pe,[B.name]:"Must be a valid number"}));return}}else ge.type==="boolean"?we=ue==="true":ge.constraints.values&&typeof ge.constraints.values[0]=="number"&&(we=parseFloat(ue));const Me=pa(B.name,we);Me.isValid?E(Pe=>{const _e={...Pe};return delete _e[B.name],_e}):E(Pe=>({...Pe,[B.name]:Me.error}))}else E(ge=>{const we={...ge};return delete we[B.name],we})},className:`w-full px-2 py-1 text-xs border rounded ${H?"border-red-300 bg-red-50":"border-gray-300"}`,min:ee.constraints.min,max:ee.constraints.max,step:ee.type==="number"?"any":void 0}),H&&e.jsxs("p",{className:"text-xs text-red-600 flex items-center",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),H]})]}):e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:String(B.value)})}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${B.fileType==="basic"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:B.fileType}),z?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>K(B.name),className:"text-green-600 hover:text-green-800 p-1",title:"Save",children:e.jsx(Ia,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>O(B.name),className:"text-red-600 hover:text-red-800 p-1",title:"Cancel",children:e.jsx(Le,{className:"h-3 w-3"})})]}):e.jsx("button",{onClick:()=>xe(B.name),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit value",children:e.jsx(ft,{className:"h-3 w-3"})})]})]}),B.description&&!re&&e.jsx("p",{className:"text-xs text-gray-600 mt-2 truncate",title:B.description,children:B.description})]},B.name)},ve=B=>{const z=Pl(B);return e.jsx("div",{className:"space-y-6",children:Object.entries(z).map(([P,H])=>{const ee=k.has(P),re=Object.values(H).flat().length;return re===0?null:e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsx("button",{onClick:()=>le(P),className:"w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 flex items-center justify-between text-left transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[ee?e.jsx(Ra,{className:"h-4 w-4 text-gray-500"}):e.jsx(ps,{className:"h-4 w-4 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:P}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",re," settings)"]})]})}),ee&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:Object.entries(H).map(([pe,ye])=>ye.length===0?null:e.jsxs("div",{className:"mb-6 last:mb-0",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 border-b border-gray-100 pb-1",children:[pe," (",ye.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:ye.map(se)})]},pe))})]},P)})})},ie=i.length+l.length,fe=i.filter(B=>B.enabled).length+l.filter(B=>B.enabled).length;return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Firmware Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Upload and analyze your Marlin firmware configuration files to understand your printer's capabilities"})]}),Q&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-800",children:"Configuration saved automatically! Your changes are now persistent."})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Configuration Files"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Configuration.h"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors",children:t?e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{className:"h-8 w-8 text-green-500 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.length," defines found"]}),e.jsx("button",{onClick:()=>a(null),className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(gs,{className:"h-8 w-8 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),e.jsx("input",{type:"file",accept:".h,.txt,.conf",onChange:B=>D(B.target.files[0],!1),className:"hidden",ref:V}),e.jsx("button",{onClick:()=>{var B;return(B=V.current)==null?void 0:B.click()},className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm",children:"Choose File"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Configuration_adv.h (Optional)"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors",children:r?e.jsxs("div",{className:"space-y-2",children:[e.jsx(De,{className:"h-8 w-8 text-purple-500 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-900",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.length," defines found"]}),e.jsx("button",{onClick:()=>s(null),className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(gs,{className:"h-8 w-8 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),e.jsx("input",{type:"file",accept:".h,.txt,.conf",onChange:B=>D(B.target.files[0],!0),className:"hidden"}),e.jsx("button",{onClick:()=>{var B;return(B=document.querySelector('input[type="file"]:last-of-type'))==null?void 0:B.click()},className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors text-sm",children:"Choose File"})]})})]})]}),ie>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-600",children:[e.jsxs("span",{children:["Total: ",e.jsx("strong",{className:"text-gray-900",children:ie})]}),e.jsxs("span",{children:["Enabled: ",e.jsx("strong",{className:"text-green-600",children:fe})]}),e.jsxs("span",{children:["Disabled: ",e.jsx("strong",{className:"text-red-600",children:ie-fe})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ma,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:J,onChange:B=>ce(B.target.value),className:"border border-gray-300 rounded-md px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:"Select Preset..."}),Object.keys(cs).map(B=>e.jsx("option",{value:B,children:B},B))]}),e.jsx("button",{onClick:Y,disabled:!J,className:"bg-purple-600 text-white px-3 py-1 rounded-md hover:bg-purple-700 transition-colors text-sm disabled:opacity-50",children:"Apply"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>I(!R),className:"bg-orange-600 text-white px-3 py-2 rounded-md hover:bg-orange-700 transition-colors flex items-center space-x-2 text-sm",children:[e.jsx(ka,{className:"h-4 w-4"}),e.jsx("span",{children:"Diff"})]}),e.jsxs("button",{onClick:he,className:"bg-gray-600 text-white px-3 py-2 rounded-md hover:bg-gray-700 transition-colors flex items-center space-x-2 text-sm",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{onClick:oe,disabled:w,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2 disabled:opacity-50",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{children:w?"Saving...":"Save"})]})]})]}),J&&cs[J]&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-purple-800",children:[e.jsxs("strong",{children:[J,":"]})," ",cs[J].description]})})]})]}),ie>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configuration Analysis"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ut,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search configurations...",value:o,onChange:B=>d(B.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("button",{onClick:()=>g(!y),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${y?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:[y?e.jsx(mt,{className:"h-4 w-4"}):e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Advanced"})]}),e.jsxs("button",{onClick:()=>b(!p),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${p?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[e.jsx(Aa,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Group"})]}),e.jsxs("button",{onClick:()=>j(!v),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${v?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"}`,children:[v?e.jsx(mt,{className:"h-4 w-4"}):e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Disabled"})]}),e.jsxs("button",{onClick:()=>L(!S),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${S?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,title:S?"Show only relevant settings for this printer":"Show all settings including irrelevant ones",children:[S?e.jsx(mt,{className:"h-4 w-4"}):e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Relevant"})]}),e.jsx("button",{onClick:()=>f(h==="asc"?"desc":"asc"),className:"px-3 py-2 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:h==="asc"?e.jsx(Xn,{className:"h-4 w-4"}):e.jsx(Yn,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"overflow-hidden",children:ve(W())})]}),ie===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Getting Started"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"To analyze your printer's firmware configuration:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-800 space-y-2",children:[e.jsxs("li",{children:["Upload your ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"Configuration.h"})," file"]}),e.jsxs("li",{children:["Optionally upload your ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"Configuration_adv.h"})," file"]}),e.jsx("li",{children:"Review the parsed configuration items"}),e.jsx("li",{children:"Save the configuration to your printer profile"})]}),e.jsxs("p",{className:"text-blue-800 mt-4 text-sm",children:[e.jsx("strong",{children:"Note:"})," These files are typically located in your Marlin source code folder."]})]})]})},kl=Ce.memo(function({className:a=""}){const r=te(o=>o.status),s=te(o=>o.connect),i=te(o=>o.disconnect),n=r==="connected",l=r==="connecting",c=()=>{n?i():l||s()};return e.jsx("button",{onClick:c,disabled:l,className:`inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-md transition-colors
        ${n?"bg-green-100 text-green-700 hover:bg-green-200":l?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"} ${a}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(ta,{size:16}),"Connected"]}):l?e.jsxs(e.Fragment,{children:[e.jsx(ta,{size:16,className:"animate-pulse"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Wn,{size:16}),"Connect"]})})}),Dt={hotendTemp:200,bedTemp:60,nozzleDiameter:.4,layerHeight:.2,printSpeed:50,retractionDistance:5,retractionSpeed:45,primeSpeed:45,flowRate:100,wallThickness:.4,enableABL:!0,firstLayerSpeed:20},en={"pid-autotune":{hotendTemp:200,bedTemp:60,cycles:8,target:"hotend"},"extruder-esteps":{hotendTemp:200,bedTemp:60,extrudeLength:100,currentEsteps:93},"retraction-tuning":{hotendTemp:200,bedTemp:60,retractionDistance:5,retractionSpeed:45,primeSpeed:45},"first-layer":{hotendTemp:200,bedTemp:60,layerHeight:.2,firstLayerSpeed:20,enableABL:!0},"flow-rate":{hotendTemp:200,bedTemp:60,flowRate:100,wallThickness:.4},"temperature-tower":{hotendTemp:200,bedTemp:60,startTemp:180,endTemp:220,tempStep:5},"calibration-cube":{hotendTemp:200,bedTemp:60,cubeSize:20,layerHeight:.2,printSpeed:50},"speed-calibration":{hotendTemp:200,bedTemp:60,startSpeed:40,endSpeed:120,stepSpeed:10,lineLength:160}},tn={"pid-autotune":{hotendTemp:"M301",bedTemp:"M304"},"extruder-esteps":{currentEsteps:"M92"},"retraction-tuning":{retractionDistance:"M207",retractionSpeed:"M207"},"flow-rate":{flowRate:"M221"}},fs=t=>en[t]||{},Al=async t=>{try{const a=te.getState().sendCommand,r={...fs(t)},s=tn[t];if(s)for(const[i,n]of Object.entries(s))try{await a(n)}catch(l){console.warn(`Failed to load ${n}:`,l)}return r}catch(a){return console.error("Error loading parameters from settings:",a),fs(t)}},Il=async(t,a)=>{try{const r=te.getState().sendCommand,s=tn[t];if(s){for(const[i,n]of Object.entries(s)){const l=a[i];if(l!==void 0)try{n==="M92"&&i==="currentEsteps"?await r(`M92 E${l}`):n==="M207"&&i==="retractionDistance"?await r(`M207 S${l}`):n==="M207"&&i==="retractionSpeed"?await r(`M207 F${l*60}`):n==="M221"&&i==="flowRate"&&await r(`M221 S${l}`)}catch(c){console.warn(`Failed to save ${n} with value ${l}:`,c)}}await r("M500")}}catch(r){throw console.error("Error saving parameters to settings:",r),r}},xt=t=>{try{const a=localStorage.getItem(`calibration_parameters_${t}`);return a?JSON.parse(a):[]}catch(a){return console.error("Error loading parameter history:",a),[]}},Dl=(t,a,r)=>{try{const s=xt(t),i={parameters:{...a},result:r,timestamp:Date.now()};s.push(i),s.length>10&&s.splice(0,s.length-10),localStorage.setItem(`calibration_parameters_${t}`,JSON.stringify(s))}catch(s){console.error("Error saving parameter history:",s)}},Ll=t=>{const a=xt(t);if(a.length===0)return fs(t);const r=a.filter(s=>{var i;return(i=s.result)==null?void 0:i.success});return r.length>0?r[r.length-1].parameters:a[a.length-1].parameters},Ol=t=>{try{localStorage.removeItem(`calibration_parameters_${t}`)}catch(a){console.error("Error clearing parameter history:",a)}},Fl=()=>{try{const t={};Object.keys(en).forEach(n=>{t[n]=xt(n)});const a=JSON.stringify(t,null,2),r=new Blob([a],{type:"application/json"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`calibration_parameters_${new Date().toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(s)}catch(t){console.error("Error exporting parameter history:",t)}},sn=t=>`printer_${t}_global_parameters`,Je=t=>{try{const a=localStorage.getItem(sn(t));if(a){const r=JSON.parse(a);return{...Dt,...r}}return{...Dt}}catch(a){return console.error("Error loading globalThis parameters:",a),{...Dt}}},Ul=(t,a)=>{try{const r={};Object.keys(Dt).forEach(s=>{a[s]!==void 0&&(r[s]=a[s])}),localStorage.setItem(sn(t),JSON.stringify(r)),console.log("Saved globalThis parameters for printer",t,":",r)}catch(r){console.error("Error saving globalThis parameters:",r)}},dr=(t,a,r)=>{const i={...Je(t)};return Object.keys(Dt).forEach(n=>{r[n]!==void 0&&(i[n]=r[n])}),Ul(t,i),i},Bl=({isOpen:t,onClose:a,step:r,stepData:s,printer:i})=>{if(!t)return null;const n=u.useMemo(()=>{const c=[];return c.push(`# Calibration Report: ${r.title}`),c.push(`Printer: ${(i==null?void 0:i.name)||""}`),c.push(`Date: ${new Date((s==null?void 0:s.lastUpdated)||Date.now()).toLocaleString()}`),c.push(""),c.push("Inputs:"),Object.entries((s==null?void 0:s.inputValues)||{}).forEach(([o,d])=>c.push(`- ${o}: ${d}`)),c.push(""),s!=null&&s.results&&(c.push("Results:"),Object.entries(s.results.measurements||{}).forEach(([o,d])=>c.push(`- ${o}: ${d}`)),s.results.notes&&c.push(`Notes: ${s.results.notes}`)),c.push(""),c.push("Recommendations:"),c.push(r.expectedOutcomes||"See notes above."),c.join(`
`)},[r,s,i]),l=()=>{const c=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(c),d=document.createElement("a");d.href=o,d.download=`${r.id}-calibration-report.txt`,d.click(),URL.revokeObjectURL(o)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[e.jsx("div",{className:"font-semibold",children:"Calibration Report"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:"Close"})]}),e.jsx("div",{className:"p-4",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 border border-gray-200 rounded p-3",children:n})}),e.jsx("div",{className:"px-4 py-2 border-t flex justify-end",children:e.jsx("button",{onClick:l,className:"px-3 py-1.5 bg-blue-600 text-white rounded",children:"Export TXT"})})]})})},zl=()=>{const t=te(y=>y.status);te(y=>y.sendCommand);const a=te(y=>{var g;return((g=y.serialLogs)==null?void 0:g.length)||0}),[r,s]=u.useState([]),[i,n]=u.useState([]),[l,c]=u.useState([]);u.useEffect(()=>{const y=te.getState().serialLogs||[],g=y.filter(w=>w.type==="rx"&&/\bX:\s*[-\d.]+/.test(w.message)&&/\bY:\s*[-\d.]+/.test(w.message)&&/\bZ:\s*[-\d.]+/.test(w.message)),p=y.filter(w=>w.type==="rx"&&/\bok\b/i.test(w.message)),b=y.filter(w=>w.type==="rx"&&/error[:\s]/i.test(w.message));s(g),n(p),c(b)},[a]);const[o,d]=u.useState({x:0,y:0,z:0}),[m,x]=u.useState(0),[h,f]=u.useState(0);return u.useEffect(()=>{if(r.length===0)return;const g=r[r.length-1].message,p={x:parseFloat((g.match(/X:\s*([-\d.]+)/)||[])[1]||0),y:parseFloat((g.match(/Y:\s*([-\d.]+)/)||[])[1]||0),z:parseFloat((g.match(/Z:\s*([-\d.]+)/)||[])[1]||0)};d(b=>b.x!==p.x||b.y!==p.y||b.z!==p.z?p:b)},[r]),u.useEffect(()=>{x(i.length)},[i]),u.useEffect(()=>{f(l.length)},[l]),{position:o,okCount:m,errCount:h,status:t}},Gl=Ce.memo(({position:t,okCount:a,errCount:r})=>{var s,i,n,l,c,o;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:["Pos: ",e.jsxs("span",{className:"font-mono",children:["X",((i=(s=t.x).toFixed)==null?void 0:i.call(s,2))??t.x," Y",((l=(n=t.y).toFixed)==null?void 0:l.call(n,2))??t.y," Z",((o=(c=t.z).toFixed)==null?void 0:o.call(c,2))??t.z]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-green-700",children:["ok: ",a]}),e.jsxs("span",{className:"text-red-700",children:["err: ",r]})]})]})}),Vl=Ce.memo(()=>{const{position:t,okCount:a,errCount:r}=zl();return e.jsx("div",{className:"bg-white border border-gray-200 rounded p-3 space-y-3",children:e.jsx(Gl,{position:t,okCount:a,errCount:r})})}),fa={PLA:{hotend:205,bed:60},PETG:{hotend:235,bed:80},ABS:{hotend:245,bed:100}};function Hl(t,a){const[r,s]=u.useState({hotendCurrent:0,hotendTarget:0,bedCurrent:0,bedTarget:0}),i=u.useRef({hotendCurrent:0,hotendTarget:0,bedCurrent:0,bedTarget:0}),n=u.useRef(0),l=u.useRef(0),c=u.useRef(null);return u.useEffect(()=>{if(!t){s({hotendCurrent:0,hotendTarget:0,bedCurrent:0,bedTarget:0}),l.current=0;return}const o=f=>{const y={};let g=f.match(/T:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);g||(g=f.match(/T:(\d+\.?\d*)\/(\d+\.?\d*)/)),g||(g=f.match(/T:(\d+\.?\d*)\s*B:/)),g||(g=f.match(/T:(\d+\.?\d*)/)),g||(g=f.match(/T(\d+\.?\d*)/)),g&&(y.hotend={current:parseFloat(g[1]),target:g[2]?parseFloat(g[2]):0});let p=f.match(/B:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);return p||(p=f.match(/B:(\d+\.?\d*)\/(\d+\.?\d*)/)),p||(p=f.match(/B:(\d+\.?\d*)/)),p||(p=f.match(/B(\d+\.?\d*)/)),p&&(y.bed={current:parseFloat(p[1]),target:p[2]?parseFloat(p[2]):0}),y},d=()=>{var b,w,_,A;const y=te.getState().serialLogs||[];let g=Math.max(0,l.current),p=null;for(;g<y.length;g++){const C=y[g];if((C==null?void 0:C.type)==="rx"&&typeof C.message=="string"&&(C.message.includes("T:")||C.message.includes("B:"))){const M=o(C.message);(M.hotend||M.bed)&&(p={hotendCurrent:((b=M.hotend)==null?void 0:b.current)??i.current.hotendCurrent,hotendTarget:((w=M.hotend)==null?void 0:w.target)??i.current.hotendTarget,bedCurrent:((_=M.bed)==null?void 0:_.current)??i.current.bedCurrent,bedTarget:((A=M.bed)==null?void 0:A.target)??i.current.bedTarget})}}l.current=y.length,p&&(i.current=p,n.current=Date.now(),s(p))},m=te.subscribe(f=>f.temperatures,f=>{var g,p,b,w;const y={hotendCurrent:((g=f==null?void 0:f.hotend)==null?void 0:g.current)??i.current.hotendCurrent,hotendTarget:((p=f==null?void 0:f.hotend)==null?void 0:p.target)??i.current.hotendTarget,bedCurrent:((b=f==null?void 0:f.bed)==null?void 0:b.current)??i.current.bedCurrent,bedTarget:((w=f==null?void 0:f.bed)==null?void 0:w.target)??i.current.bedTarget};i.current=y,n.current=Date.now(),s(y)}),x=te.subscribe(f=>f.serialLogs?f.serialLogs.length:0,(f,y)=>{t&&f>y&&d()});c.current=setInterval(async()=>{var y;const f=te.getState();if(!(f.status!=="connected"||!((y=f.port)!=null&&y.writable))&&!f.isStreamingProgram)try{const g=f.port.writable.getWriter(),p=new TextEncoder,b=`M105\r
`,w=p.encode(b);await g.write(w),g.releaseLock(),te.getState().appendSerialLog("M105","tx")}catch{}},2e3);const h=setInterval(d,750);return()=>{clearInterval(h),c.current&&(clearInterval(c.current),c.current=null),m(),x()}},[t,a]),r}const rn=Ce.memo(function({send:a,isConnected:r=!1}){const{hotendCurrent:s,hotendTarget:i,bedCurrent:n,bedTarget:l}=Hl(r,a),c=te(_=>_.serialLogs?_.serialLogs.length:0),[o,d]=u.useState({hotend:"",bed:""}),m=u.useRef(null),[x,h]=u.useState([]),[f,y]=u.useState(0);u.useEffect(()=>{},[c]),u.useEffect(()=>{if(!r)return;const _=setInterval(()=>{y(A=>A+1)},1e3);return()=>{clearInterval(_)}},[r]),u.useEffect(()=>{if(!r){h([]);return}h(_=>{const A={hotend:s,bed:n,targetHotend:i,targetBed:l,timestamp:Date.now()},C=[..._,A];return C.length>60?C.slice(-60):C}),y(_=>_+1)},[r,s,i,n,l]),u.useEffect(()=>{const _=m.current;if(!_)return;const A=_.getContext("2d"),C=_.width,M=_.height;if(A.clearRect(0,0,C,M),x.length===0){A.fillStyle="#666",A.font="16px sans-serif",A.textAlign="center",A.fillText("No temperature data",C/2,M/2),A.fillText("Connect to printer to see live temperatures",C/2,M/2+20);return}const T=x.map(S=>S.hotend||0),G=x.map(S=>S.bed||0),E=x.map(S=>S.targetHotend||0),k=x.map(S=>S.targetBed||0),N=[...T,...G,...E,...k],R=Math.max(0,...N),I=0,J=Math.max(R+20,100),ce={left:40,right:10,top:10,bottom:20},q=C-ce.left-ce.right,ne=M-ce.top-ce.bottom,Q=S=>ce.left+S/Math.max(1,x.length-1)*q,X=S=>ce.top+ne-(S-I)/Math.max(1,J-I)*ne;A.strokeStyle="#e5e7eb",A.lineWidth=1,A.setLineDash([]),A.textAlign="right",A.textBaseline="middle",A.font="10px sans-serif";const v=Math.ceil((J-I)/5/10)*10;for(let S=Math.ceil(I/v)*v;S<=J;S+=v){const L=X(S);A.beginPath(),A.moveTo(ce.left,L),A.lineTo(C-ce.right,L),A.stroke(),A.fillStyle="#6b7280",A.fillText(S.toString()+"°C",ce.left-5,L)}const j=(S,L,V=!1)=>{A.strokeStyle=L,A.lineWidth=2,A.setLineDash(V?[5,5]:[]),A.beginPath(),S.forEach((F,$)=>{const U=Q($),D=X(F);$===0?A.moveTo(U,D):A.lineTo(U,D)}),A.stroke(),V||(A.fillStyle=L,S.forEach((F,$)=>{const U=Q($),D=X(F);A.beginPath(),A.arc(U,D,3,0,Math.PI*2),A.fill()}))};j(E,"#ef4444",!0),j(k,"#3b82f6",!0),j(T,"#ef4444"),j(G,"#3b82f6")},[x,f]);const g=()=>{if(!r)return;const _=parseInt(o.hotend,10);isNaN(_)||a(`M104 S${_}`)},p=()=>{if(!r)return;const _=parseInt(o.bed,10);isNaN(_)||a(`M140 S${_}`)},b=_=>{if(!r)return;const A=fa[_];A&&(A.hotend&&a(`M104 S${A.hotend}`),A.bed&&a(`M140 S${A.bed}`))},w=()=>{r&&(a("M104 S0"),a("M140 S0"),a("M106 S0"))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Temperature"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Object.keys(fa).map(_=>e.jsx("button",{disabled:!r,className:`px-2 py-1 text-xs rounded ${r?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 text-gray-400 cursor-not-allowed"}`,onClick:()=>b(_),children:_},_)),e.jsx("button",{disabled:!r,className:`px-2 py-1 text-xs rounded ${r?"bg-red-600 text-white hover:bg-red-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:w,children:"Cool Down"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["H: ",s,"°C / ",i,"°C"]}),e.jsxs("span",{className:"ml-4",children:["B: ",n,"°C / ",l,"°C"]}),e.jsxs("span",{className:"ml-4",children:["Points: ",x.length]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hotend: ",e.jsxs("span",{className:"font-medium text-gray-900",children:[s,"°C"]}),i>0&&e.jsxs("span",{className:"text-gray-500",children:[" → ",i,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{placeholder:"Target °C",disabled:!r,className:`w-32 border rounded px-2 py-1 ${r?"border-gray-300":"border-gray-200 bg-gray-50 text-gray-400"}`,value:o.hotend,onChange:_=>d({...o,hotend:_.target.value})}),e.jsx("button",{disabled:!r,className:`px-3 py-2 rounded ${r?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:g,children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Bed: ",e.jsxs("span",{className:"font-medium text-gray-900",children:[n,"°C"]}),l>0&&e.jsxs("span",{className:"text-gray-500",children:[" → ",l,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{placeholder:"Target °C",disabled:!r,className:`w-32 border rounded px-2 py-1 ${r?"border-gray-300":"border-gray-200 bg-gray-50 text-gray-400"}`,value:o.bed,onChange:_=>d({...o,bed:_.target.value})}),e.jsx("button",{disabled:!r,className:`px-3 py-2 rounded ${r?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:p,children:"Set"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("canvas",{ref:m,width:600,height:160,className:"w-full h-40"}),e.jsxs("div",{className:"text-xs text-gray-500 flex justify-between",children:[e.jsx("span",{children:"Hotend (red, dashed = target)"}),e.jsx("span",{children:"Bed (blue, dashed = target)"})]})]})]})}),an=Ce.memo(()=>{const t=te(m=>m.bedMesh),a=te(m=>m.fetchBedLevel),r=te(m=>m.runBedLeveling),s=te(m=>m.processCollectedBedMeshData),i=te(m=>m.fetchAllPrinterSettings),n=te(m=>m.status),l=u.useMemo(()=>{if(t.data&&t.data.length>0){let m=t.data;if(Array.isArray(m)&&m.length>0&&!Array.isArray(m[0])){const x=t.gridSize||{x:5,y:5},h=[];for(let f=0;f<x.y;f++){const y=[];for(let g=0;g<x.x;g++){const p=f*x.x+g;y.push(m[p]||0)}h.push(y)}m=h}if(Array.isArray(m)&&m.length>0&&Array.isArray(m[0]))return{mesh:m,gridSize:t.gridSize||{x:m[0].length,y:m.length},min:t.min||Math.min(...m.flat()),max:t.max||Math.max(...m.flat()),range:t.range||Math.max(...m.flat())-Math.min(...m.flat())}}return{mesh:[[.1,.05,0,-.05,-.1],[.08,.03,-.02,-.07,-.12],[.05,0,-.05,-.1,-.15],[.02,-.03,-.08,-.13,-.18],[-.01,-.06,-.11,-.16,-.21]],gridSize:{x:5,y:5},min:-.21,max:.1,range:.31}},[t]),c=l.mesh&&Array.isArray(l.mesh)?Math.max(...l.mesh.flat().map(Math.abs)):0,o=l.mesh&&Array.isArray(l.mesh)?Math.min(...l.mesh.flat()):0,d=m=>{if(c===o)return"bg-gray-500";const x=(m-o)/(c-o);return x<.33?"bg-green-500":x<.66?"bg-yellow-500":"bg-red-500"};return e.jsx("div",{className:"space-y-4",children:t.data.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"No bed leveling data available"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:r,disabled:n!=="connected",className:"px-4 py-2 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Run Auto Bed Leveling (G29)"}),e.jsx("div",{className:"text-xs text-gray-400",children:"or"}),e.jsx("button",{onClick:a,disabled:n!=="connected",className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Fetch Existing Data (M503)"}),e.jsx("div",{className:"text-xs text-gray-400",children:"or"}),e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm bg-purple-500 text-white rounded hover:bg-purple-600",children:"Process Collected Data"}),e.jsx("div",{className:"text-xs text-gray-400",children:"or"}),e.jsx("button",{onClick:i,disabled:n!=="connected",className:"px-3 py-1 text-sm bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Fetch All Settings (M503)"})]}),n!=="connected"&&e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Connect to printer first"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:r,disabled:n!=="connected",className:"px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Run New Leveling"}),e.jsx("button",{onClick:a,disabled:n!=="connected",className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Refresh"})]}),e.jsx("div",{className:"grid gap-1 max-w-xs mx-auto",style:{gridTemplateColumns:`repeat(${l.gridSize.x}, minmax(0, 1fr))`,gridTemplateRows:`repeat(${l.gridSize.y}, minmax(0, 1fr))`},children:l.mesh&&Array.isArray(l.mesh)&&l.mesh.map((m,x)=>Array.isArray(m)&&m.map((h,f)=>e.jsx("div",{className:`h-8 w-8 rounded border flex items-center justify-center text-xs text-white font-mono ${d(h)}`,title:`X${f} Y${x}: ${h.toFixed(3)}mm`,children:h.toFixed(2)},`${x}-${f}`)))}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"Good"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:"Warning"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Critical"})]})]}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Max deviation: ",l.max.toFixed(3),"mm"]}),e.jsxs("p",{children:["Min deviation: ",l.min.toFixed(3),"mm"]}),e.jsxs("p",{children:["Range: ",l.range.toFixed(3),"mm"]}),e.jsxs("p",{children:["Grid: ",l.gridSize.x,"x",l.gridSize.y]}),t.timestamp&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Last updated: ",new Date(t.timestamp).toLocaleTimeString()]})]})]})})}),$l=({initialValue:t="",onChange:a,validate:r,syncWithStore:s=!1,getStoreValue:i,debounceMs:n=300})=>{const[l,c]=u.useState(t),[o,d]=u.useState(!0),[m,x]=u.useState(null),[h,f]=u.useState(!1),y=u.useRef(null),g=u.useRef(!1);u.useEffect(()=>{if(s&&i&&!g.current){const C=i();C!=null&&(c(C),g.current=!0)}},[s,i]);const p=u.useCallback(C=>{if(!r)return d(!0),x(null),!0;const M=r(C);return typeof M=="boolean"?(d(M),x(M?null:"Invalid value"),M):(d(!1),x(M),!1)},[r]),b=u.useCallback(C=>{c(C),f(!0),p(C),a&&n>0?(y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{p(C)&&a(C)},n)):a&&n===0&&p(C)&&a(C)},[a,p,n]),w=u.useCallback(C=>{c(C),f(!0),p(C)&&a&&a(C)},[a,p]),_=u.useCallback(()=>{c(t),f(!1),d(!0),x(null),y.current&&clearTimeout(y.current)},[t]),A=u.useCallback(()=>{if(i){const C=i();c(C),f(!1),p(C)}},[i,p]);return u.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),{value:l,setValue:b,setValueImmediate:w,isValid:o,error:m,isDirty:h,reset:_,resetToStore:A}},wr=u.forwardRef(({type:t="text",value:a,onChange:r,onInput:s,validate:i,syncWithStore:n=!1,getStoreValue:l,onChangeStore:c,debounceMs:o=300,initialValue:d="",className:m="",errorClassName:x="",label:h,placeholder:f,min:y,max:g,step:p,disabled:b=!1,required:w=!1,..._},A)=>{const C=a!==void 0&&r!==void 0,M=$l({initialValue:C?a:d,onChange:C?r:c,validate:i,syncWithStore:!C&&n,getStoreValue:l,debounceMs:o}),{value:T,setValue:G,setValueImmediate:E,isValid:k,error:N,isDirty:R}=M,I=v=>{const j=v.target.value;C?r==null||r(v):G(j)},J=v=>{const j=v.target.value;C?s==null||s(v):E(j)},ce=C?a:T,q=!k&&N,ne=`
    w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
    ${q?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300"}
    ${b?"bg-gray-100 cursor-not-allowed":"bg-white"}
    ${m}
  `.trim(),Q=`
    text-red-600 text-sm mt-1
    ${x}
  `.trim(),X=`
    block text-sm font-medium text-gray-700 mb-1
    ${q?"text-red-700":""}
  `.trim();return e.jsxs("div",{className:"w-full",children:[h&&e.jsxs("label",{className:X,children:[h,w&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:A,type:t,value:ce||"",onChange:I,onInput:J,placeholder:f,min:y,max:g,step:p,disabled:b,required:w,className:ne,..._}),q&&e.jsx("div",{className:Q,children:N}),!1]})});wr.displayName="Input";Ce.lazy(()=>Ps(()=>Promise.resolve().then(()=>Mn),void 0).then(t=>({default:t.GcodeViewer3D})));const Xl=Ce.lazy(()=>Ps(()=>Promise.resolve().then(()=>kn),void 0).then(t=>({default:t.SimpleGcodeViewer3D}))),Yl=["Instructions","Visuals","Configuration","Results"],ba={hotendTemp:!0,bedTemp:!0,nozzleDiameter:!0,layerHeight:!0,printSpeed:!0,retractionDistance:!0,retractionSpeed:!0,primeSpeed:!0,flowRate:!0,wallThickness:!0,enableABL:!0,firstLayerSpeed:!0},Zl=u.memo(()=>{const t=te(r=>r.status),a=te(r=>r.sendCommand);return e.jsx("div",{className:"mb-4",children:e.jsx(rn,{send:a,isConnected:t==="connected"})})}),Wl=(t,a)=>{var y,g,p,b,w,_;if(!t||!a)return;const{activePrinterId:r,printers:s}=je.getState(),i=s.find(A=>A.id===r),n=((y=i==null?void 0:i.name)==null?void 0:y.replace(/[^a-zA-Z0-9]/g,"_"))||"Unknown_Printer",l=((g=i==null?void 0:i.model)==null?void 0:g.replace(/[^a-zA-Z0-9]/g,"_"))||"Unknown_Model",c=((w=(b=(p=i==null?void 0:i.printerSettings)==null?void 0:p.filament)==null?void 0:b.type)==null?void 0:w.replace(/[^a-zA-Z0-9]/g,"_"))||"PLA",o=((_=a.title)==null?void 0:_.replace(/[^a-zA-Z0-9]/g,"_"))||"calibration",d=new Date().toISOString().slice(0,19).replace(/:/g,"-"),m=`${o}_${n}_${l}_${c}_${d}.gcode`,x=new Blob([t],{type:"text/plain"}),h=URL.createObjectURL(x),f=document.createElement("a");f.href=h,f.download=m,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(h)},ql=u.memo(({step:t,canProceed:a,execState:r,generateGcode:s,sendToPrinter:i,renderInput:n,pauseExec:l,resumeExec:c,abortExec:o,showGcode:d,setShowGcode:m,generatedGcode:x,copyGcode:h,activePrinterId:f,gcodeViewMode:y,setGcodeViewMode:g})=>{const p=te(w=>w.status),b=je(w=>w.printers.find(_=>_.id===f));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Configuration Parameters"}),e.jsx(kl,{className:"w-auto"})]}),f&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-3 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Global Parameters for Printer ",f]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:Object.entries(Je(f)).map(([w,_])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:[w,":"]}),e.jsx("span",{className:"text-blue-900 dark:text-blue-100 font-mono",children:_})]},w))}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:"These parameters persist across all calibration steps and are saved per printer."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(t.inputs||[]).map(n)}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-2 items-center",children:[e.jsxs("button",{onClick:s,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors flex items-center space-x-2 shadow-sm",children:[e.jsx(Da,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate G-code"})]}),e.jsx("button",{onClick:i,disabled:p!=="connected"||!x||r.running,className:`px-4 py-2 rounded-md transition-colors shadow-sm ${p==="connected"&&x&&!r.running?"bg-green-600 hover:bg-green-700 dark:bg-green-600 dark:hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:"Send to Printer"}),r.running&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-40 bg-gray-300 dark:bg-gray-600 rounded h-2 overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 dark:bg-blue-600",style:{width:`${r.total?Math.round(r.progress/r.total*100):0}%`}})}),e.jsxs("span",{children:[r.progress,"/",r.total]}),r.paused?e.jsx("button",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",onClick:c,children:"Resume"}):e.jsx("button",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",onClick:l,children:"Pause"}),e.jsx("button",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded",onClick:o,children:"Abort"})]})]}),x&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Generated G-code"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:h,className:"px-2 py-1 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded text-sm",children:"Copy"}),e.jsx("button",{onClick:()=>Wl(x,t),className:"px-2 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Download"}),e.jsx("button",{onClick:()=>{const w=!d;m(w);try{t!=null&&t.id&&sessionStorage.setItem(`gcode_show_${t.id}`,w?"1":"0")}catch{}},className:"px-2 py-1 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded text-sm",children:d?"Hide":"Show"})]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Preview Mode:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>g("text"),className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${y==="text"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Text"})]}),e.jsxs("button",{onClick:()=>g("3d"),className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${y==="3d"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:[e.jsx(La,{className:"w-4 h-4"}),e.jsx("span",{children:"3D"})]})]})]}),y==="text"?e.jsx("div",{className:"bg-gray-900 text-gray-400 dark:text-gray-500 p-4 rounded-md overflow-x-auto",children:e.jsx("pre",{className:"text-sm font-mono whitespace-pre-wrap",children:x})}):e.jsx("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",children:e.jsx(Ce.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[600px] bg-gray-100 dark:bg-gray-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading 3D viewer..."})]})}),children:e.jsx(Xl,{content:x,width:"100%",height:600,buildPlateSize:(b==null?void 0:b.bedSize)||{x:220,y:220}})})})]})]})]})},(t,a)=>t.canProceed===a.canProceed&&t.execState.running===a.execState.running&&t.execState.progress===a.execState.progress&&t.showGcode===a.showGcode&&t.generatedGcode===a.generatedGcode&&t.renderInput===a.renderInput),Ql=u.memo(({step:t,canProceed:a,execState:r,generateGcode:s,sendToPrinter:i,renderInput:n,pauseExec:l,resumeExec:c,abortExec:o,showGcode:d,setShowGcode:m,generatedGcode:x,copyGcode:h,activePrinterId:f,gcodeViewMode:y,setGcodeViewMode:g})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6 space-y-4",children:[e.jsx(Zl,{}),e.jsx("div",{className:"h-px bg-gray-300 dark:bg-gray-600"}),t.category==="Movement"&&t.id.includes("level")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Bed Level Visualization"}),e.jsx(an,{})]}),e.jsx("div",{className:"h-px bg-gray-300 dark:bg-gray-600"})]}),e.jsx(ql,{step:t,canProceed:a,execState:r,generateGcode:s,sendToPrinter:i,renderInput:n,pauseExec:l,resumeExec:c,abortExec:o,showGcode:d,setShowGcode:m,generatedGcode:x,copyGcode:h,activePrinterId:f,gcodeViewMode:y,setGcodeViewMode:g})]}),(t,a)=>t.canProceed===a.canProceed&&t.execState.running===a.execState.running&&t.execState.progress===a.execState.progress&&t.showGcode===a.showGcode&&t.generatedGcode===a.generatedGcode),Kl=u.memo(({step:t={},onComplete:a})=>{const r=te(P=>P.status),s=te(P=>P.sendCommand),i=te(P=>P.connect),n=te(P=>P.disconnect);u.useMemo(()=>({status:r,send:s,connect:i,disconnect:n}),[r,s,i,n]);const l=je(P=>P.activePrinterId);je(P=>P.printers.find(H=>H.id===P.activePrinterId));const c=je(P=>!!P.printers.find(H=>H.id===P.activePrinterId));u.useEffect(()=>{if(l){const P=Je(l);R(P),console.log("Loaded globalThis parameters for display:",P),console.log("Available globalThis parameters for printer",l,":",P)}},[l]),u.useEffect(()=>()=>{const{activeExecution:P}=te.getState();P&&P.stepId===t.id&&console.log("CalibrationStep unmounting, but keeping execution running globally")},[t.id]);const o=je(P=>{var ee;const H=P.printers.find(re=>re.id===P.activePrinterId);return(ee=H==null?void 0:H.calibrationSteps)==null?void 0:ee[t.id]}),d=je(P=>P.updateCalibrationStep),m=(o==null?void 0:o.activeTab)||"Instructions",[x,h]=u.useState(m),f=u.useCallback(P=>{h(P),l&&(t!=null&&t.id)&&d(l,t.id,{activeTab:P})},[l,t==null?void 0:t.id,d]);u.useEffect(()=>{m!==x&&h(m)},[m]);const y=u.useRef(!1),g=u.useRef(!1),p=u.useRef(!1),b=u.useRef(!1),w=u.useRef({}),[_,A]=u.useState({}),[C,M]=u.useState(0),[T,G]=u.useState(""),[E,k]=u.useState(!1),[N,R]=u.useState({}),[I,J]=u.useState(!1),[ce,q]=u.useState("3d"),[ne,Q]=u.useState({}),[X,v]=u.useState({measurements:{},notes:"",photos:[]}),j=u.useRef(null),[S,L]=u.useState(!1),V=te(P=>P.activeExecution),F=u.useMemo(()=>{var P,H;return V?{running:V.status==="running",paused:!1,progress:((P=V.progress)==null?void 0:P.sent)||0,total:((H=V.progress)==null?void 0:H.total)||0}:{running:!1,paused:!1,progress:0,total:0}},[V]);if(u.useEffect(()=>{if(!(t!=null&&t.id)||y.current===t.id)return;y.current=t.id;const P=o;if(!b.current){if(P!=null&&P.inputValues)console.log("Loading input values from store:",P.inputValues),A(P.inputValues),w.current=P.inputValues;else if(t.inputs){const H=l?Je(l):{};console.log("Loaded globalThis parameters:",H);const ee={};t.inputs.forEach(re=>{ee[re.key]=H[re.key]||re.defaultValue}),console.log("Initializing input values with globalThis + defaults:",ee),A(ee),w.current=ee}b.current=!0}if(!Object.keys(ne).length){if(P!=null&&P.checklist)Q(P.checklist);else if(t.checklist){const H={};t.checklist.forEach((ee,re)=>{H[re]=!1}),Q(H)}}P!=null&&P.completed&&!E&&k(!0)},[t==null?void 0:t.id]),u.useEffect(()=>{console.log("Active tab changed to:",x)},[x]),u.useEffect(()=>{g.current=!1,p.current=!1,b.current=!1},[t.id]),u.useEffect(()=>{if(o){const P=o;P.generatedGcode&&!g.current&&(G(P.generatedGcode),g.current=!0),P.results&&!p.current&&(v(P.results),p.current=!0)}},[c,t.id]),u.useEffect(()=>{if(!(t!=null&&t.id))return;if(t.id==="first-layer")try{sessionStorage.removeItem(`gcode_${t.id}`),sessionStorage.removeItem(`gcode_show_${t.id}`)}catch{}const P=sessionStorage.getItem(`gcode_${t.id}`),H=sessionStorage.getItem(`gcode_show_${t.id}`);P&&!g.current&&(G(P),g.current=!0),H!=null&&J(H==="1")},[t==null?void 0:t.id]),!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(qn,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Calibration Step Selected"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"Please select a calibration step from the sidebar"})]});const $=u.useCallback((P,H)=>{console.log(`handleInputChange called: ${P} = ${H}`),A(ee=>{const re={...ee,[P]:H};if(w.current=re,console.log("New input values:",re),l&&ba[P]){console.log("Updating globalThis parameter:",P,"=",H,"for printer:",l);const pe=dr(l,t.id,re);console.log("Updated globalThis parameters:",pe),R(ye=>({...ye,[P]:H}))}return re}),M(ee=>ee+1)},[l,t.id]);u.useEffect(()=>{let P;return t!=null&&t.gcode&&(P=setTimeout(()=>{U()},300)),()=>{P&&clearTimeout(P)}},[C,t==null?void 0:t.id]);const U=u.useCallback(async()=>{var P;if(console.log("Generating G-code for step:",t==null?void 0:t.id),console.log("Step gcode function:",t==null?void 0:t.gcode),console.log("Input values:",w.current),!(t!=null&&t.gcode)){console.error("No gcode generator found for step:",t==null?void 0:t.id);return}try{let H;if(typeof t.gcode=="function"){const ee=(P=t.inputs)==null?void 0:P.filter(re=>re.required&&(w.current[re.key]===void 0||w.current[re.key]===""));if((ee==null?void 0:ee.length)>0){console.error("Missing required inputs:",ee.map(re=>re.key)),alert(`Missing required inputs: ${ee.map(re=>re.label||re.key).join(", ")}`);return}console.log("Calling gcode function with inputs:",w.current),H=await t.gcode(w.current),console.log("Generated gcode:",H)}else typeof t.gcode=="string"&&(H=t.gcode,console.log("Using static gcode:",H));if(H){console.log("Setting generated gcode and showing preview"),G(H),J(!0),g.current=!0;try{t!=null&&t.id&&t.id!=="first-layer"&&(sessionStorage.setItem(`gcode_${t.id}`,H),sessionStorage.setItem(`gcode_show_${t.id}`,"1"))}catch{}}else console.error("No gcode generated"),alert("Failed to generate G-code. Please check the console for details.")}catch(H){console.error("Error generating gcode:",H),alert(`Error generating G-code: ${H.message}`)}},[t==null?void 0:t.gcode,t==null?void 0:t.id,t==null?void 0:t.inputs]),D=u.useCallback(async()=>{if(console.log("sendToPrinter called - serialStatus:",r,"generatedGcode length:",T==null?void 0:T.length),r!=="connected"){console.log("Cannot send to printer - not connected. Current status:",r);return}if(!T&&(console.log("No generated G-code, generating..."),await U(),await new Promise(pe=>setTimeout(pe,0)),!T)){console.log("Still no G-code after generation attempt");return}const P=T.toUpperCase();if((/\bE[+\-]?\d/.test(P)||/M109\s+S\d+/.test(P))&&!confirm("This routine may involve extrusion or heating. Ensure target temperatures are set and safe to proceed. Continue?"))return;const re=T.split(/\r?\n/).map(pe=>pe.trim()).filter(pe=>pe&&!pe.startsWith(";"));re.length;try{console.log("Attempting to send G-code program, payload length:",re.length);const pe=te.getState().sendGcodeProgram;if(console.log("sendGcodeProgram function available:",typeof pe=="function"),typeof pe=="function")console.log("Using sendGcodeProgram method"),await pe(re.join(`
`),{delayMs:0,waitForOk:!1,okTimeoutMs:2e3,executionData:{stepName:t.name,stepId:t.id,workflowId:`calibration-${Date.now()}`},onProgress:(ye,Ne)=>{console.log(`G-code progress: ${ye}/${Ne}`)}}),console.log("G-code program completed successfully");else{console.log("Using fallback line-by-line method");const{startExecution:ye,updateExecutionProgress:Ne,completeExecution:ue}=te.getState();ye({stepName:t.name,stepId:t.id,totalCommands:re.length,workflowId:`calibration-${Date.now()}`});try{for(let ge=0;ge<re.length;ge++){const we=te.getState().activeExecution;if((we==null?void 0:we.status)==="paused"){ge--,await new Promise(Pe=>setTimeout(Pe,200));continue}if((we==null?void 0:we.status)!=="running"){console.log("Execution stopped, breaking out of loop");break}if((we==null?void 0:we.status)==="cancelled"){console.log("Execution was cancelled, breaking out of loop");break}const{sendCommandWithWait:Me}=te.getState();await Me(re[ge],{waitForReady:!0}),console.log(`Sent line ${ge+1}/${re.length}: ${re[ge]}`),Ne({sent:ge+1,total:re.length}),await new Promise(Pe=>setTimeout(Pe,60))}ue({success:!0})}catch(ge){throw ue({success:!1,error:ge.message}),ge}}}finally{console.log("G-code execution completed")}},[r,T,F,U]),Z=u.useCallback(()=>{const P=te.getState().pauseExecution;P&&P()},[]),oe=u.useCallback(()=>{const P=te.getState().resumeExecution;P&&P()},[]),he=u.useCallback(()=>{const P=te.getState().abortExecution;P&&P()},[]),W=Object.values(ne).every(Boolean)||(t.checklist||[]).length===0,me=()=>{if(!c)return;const P={completed:!0,lastUpdated:new Date().toISOString(),inputValues:{...w.current},generatedGcode:T,category:t.category,checklist:{...ne},results:{...X}};d(l,t.id,P),k(!0),a&&a(t.id)},xe=()=>{navigator.clipboard.writeText(T).catch(()=>{})},K=(P=>{switch(P){case"Temperature":return $e;case"Movement":return Jn;case"Quality":return Se;default:return Ye}})(t.category),ae=u.useCallback(()=>f("Instructions"),[f]),Y=u.useCallback(()=>f("Visuals"),[f]),le=u.useCallback(()=>f("Configuration"),[f]),de=u.useCallback(()=>f("Results"),[f]),se=u.useMemo(()=>({Instructions:ae,Visuals:Y,Configuration:le,Results:de}),[ae,Y,le,de]),ve=u.useMemo(()=>({"first-layer":{good:{urls:["https://reprap.org/mediawiki/images/d/d8/First_layer_good_example.jpg","https://upload.wikimedia.org/wikipedia/commons/1/1b/3D_print_first_layer_good_example.jpg"],caption:"GOOD: Smooth lines, slight squish, even surface"},bad:{urls:["https://reprap.org/mediawiki/images/3/3b/First_layer_bad_example.jpg","https://upload.wikimedia.org/wikipedia/commons/5/57/3D_print_first_layer_bad_example.jpg"],caption:"BAD: Under-extruded/too high Z — lines separated and rough"}},"extruder-esteps":{good:{urls:["https://reprap.org/mediawiki/images/0/0e/Extrusion_good_example.jpg","https://upload.wikimedia.org/wikipedia/commons/7/7e/3D_print_good_extrusion_example.jpg"],caption:"GOOD: Accurate measured extrusion length"},bad:{urls:["https://reprap.org/mediawiki/images/4/4e/Extrusion_bad_example.jpg","https://upload.wikimedia.org/wikipedia/commons/4/4d/3D_print_under_over_extrusion_example.jpg"],caption:"BAD: Over/under extrusion — inaccurate length vs requested"}}}),[]),ie=({urls:P=[],alt:H="",caption:ee="",fallbackQuery:re=""})=>{const[pe,ye]=u.useState(0),Ne=P[pe];return e.jsxs("div",{children:[Ne?e.jsx("img",{src:Ne,alt:H,className:"w-full h-56 object-cover rounded",onError:()=>ye(ue=>ue+1)}):e.jsxs("div",{className:"w-full h-56 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500",children:["Image unavailable. ",re&&e.jsx("a",{className:"underline ml-1",href:`https://www.google.com/search?q=${encodeURIComponent(re)}`,target:"_blank",rel:"noreferrer",children:"Search examples"})]}),ee&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-2",children:ee})]})},fe=u.useCallback(P=>{if(!P)return null;try{const H=P.match(/[?&]v=([^&]+)|youtu\.be\/([^?&/]+)/),ee=H?H[1]||H[2]:null;return ee?`https://www.youtube-nocookie.com/embed/${ee}?rel=0&modestbranding=1&iv_load_policy=3&playsinline=1`:P.replace("watch?v=","embed/").replace("www.youtube.com","www.youtube-nocookie.com")+(P.includes("?")?"&":"?")+"rel=0&modestbranding=1"}catch{return P}},[]);u.useMemo(()=>e.jsx(Vl,{}),[]);const B=u.useCallback(P=>{const{type:H,label:ee,key:re,defaultValue:pe,min:ye,max:Ne,step:ue,required:ge}=P,we=ba[re],Me=Pe=>{if(ge&&(!Pe||Pe===""))return"This field is required";if(H==="number"&&Pe!==""){const _e=parseFloat(Pe);if(isNaN(_e))return"Must be a valid number";if(ye!==void 0&&_e<ye)return`Must be at least ${ye}`;if(Ne!==void 0&&_e>Ne)return`Must be at most ${Ne}`}return!0};return e.jsx(wr,{type:H,label:ee,placeholder:P.placeholder,min:ye,max:Ne,step:ue,required:ge,validate:Me,syncWithStore:we,getStoreValue:()=>N[re],onChangeStore:Pe=>{console.log("Store update for globalThis parameter:",re,"value:",Pe),$(re,Pe)},initialValue:we?"":_[re]||pe||"",className:we?"border-blue-300 bg-blue-50":"",errorClassName:"text-red-600"},re)},[_,$,N]),z=P=>{const ee=Array.from(P.target.files||[]).map(re=>new Promise(pe=>{const ye=new FileReader;ye.onload=()=>pe({name:re.name,dataUrl:ye.result}),ye.readAsDataURL(re)}));Promise.all(ee).then(re=>{v(pe=>({...pe,photos:[...pe.photos,...re]}))})};return e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(K,{className:"h-6 w-6 text-blue-50 dark:text-blue-9000"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.title}),E&&e.jsx(Ee,{className:"h-6 w-6 text-gray-500 dark:text-gray-400"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:t.description}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.category==="Temperature"||t.category==="Movement"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":t.category==="Quality"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:t.category})})]}),F.running&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-600 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Calibration in Progress"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t.name," - ",F.progress," / ",F.total," commands sent"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"⚠️ Do not navigate away or refresh the page during execution"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-mono text-blue-800",children:F.total>0?`${Math.round(F.progress/F.total*100)}%`:"0%"}),e.jsx("div",{className:"w-24 bg-blue-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${F.total>0?F.progress/F.total*100:0}%`}})}),e.jsx("button",{onClick:he,className:"mt-2 px-3 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200 text-xs",children:"Abort (Emergency Stop)"})]})]})}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:e.jsx("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:Yl.map(P=>e.jsx("button",{onClick:se[P],className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${x===P?"border-deep-900 text-blue-50 dark:text-blue-9000":"border-transparent text-gray-500 dark:text-gray-400 dark:text-gray-500 hover:text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:border-gray-600"}`,children:P},P))})}),x==="Configuration"&&!W&&e.jsx("div",{className:"mb-4 p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded text-sm text-light-800",children:"Complete the pre-calibration checklist in the Instructions tab before proceeding."}),x==="Instructions"&&e.jsxs("div",{className:"space-y-6",children:[t.checklist&&t.checklist.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Pre-Calibration Checklist"}),e.jsx(Qn,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 dark:text-gray-500"})]}),e.jsx("div",{className:"space-y-2",children:t.checklist.map((P,H)=>e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!ne[H],onChange:ee=>Q(re=>({...re,[H]:ee.target.checked}))}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:P})]},H))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Step-by-step Guide"}),t.instructions&&t.instructions.length>0?e.jsx("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-700 dark:text-gray-300",children:t.instructions.map((P,H)=>e.jsx("li",{children:P},H))}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"No detailed instructions available."}),t.commonIssues&&t.commonIssues.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Common Issues & Solutions"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300",children:t.commonIssues.map((P,H)=>e.jsxs("li",{children:[e.jsxs("span",{className:"font-medium",children:[P.issue,":"]})," ",P.solution]},H))})]}),t.expectedOutcomes&&e.jsxs("div",{className:"mt-4 p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded text-sm text-light-800",children:[e.jsx("span",{className:"font-medium",children:"Expected Outcome:"})," ",t.expectedOutcomes]})]})]}),x==="Visuals"&&e.jsxs("div",{className:"space-y-4",children:[t.videoUrl&&e.jsx("div",{className:"aspect-video bg-black rounded overflow-hidden",children:e.jsx("iframe",{className:"w-full h-full",src:fe(t.videoUrl),title:"Calibration Tutorial",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})}),t.visualAids&&t.visualAids.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.visualAids.map((P,H)=>e.jsxs("figure",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-2",children:[e.jsx("img",{src:P.imageUrl,alt:P.caption,className:"w-full h-48 object-cover rounded"}),e.jsx("figcaption",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:P.caption})]},H))}),ve[t.id]&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-light-700 mb-2",children:"GOOD RESULT"}),e.jsx(ie,{urls:ve[t.id].good.urls,alt:"Good result",caption:ve[t.id].good.caption,fallbackQuery:`${t.title} good result 3D print`})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"BAD RESULT"}),e.jsx(ie,{urls:ve[t.id].bad.urls,alt:"Bad result",caption:ve[t.id].bad.caption,fallbackQuery:`${t.title} bad result 3D print`})]})]}),!t.videoUrl&&(!t.visualAids||t.visualAids.length===0)&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"No visual references available."})]}),x==="Configuration"&&e.jsx(Ql,{step:t,canProceed:W,execState:F,generateGcode:U,sendToPrinter:D,renderInput:B,pauseExec:Z,resumeExec:oe,abortExec:he,showGcode:I,setShowGcode:J,generatedGcode:T,copyGcode:xe,activePrinterId:l,gcodeViewMode:ce,setGcodeViewMode:q}),x==="Results"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Record Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Primary Measurement"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-2 py-1",value:X.measurements.primary||"",onChange:P=>v(H=>({...H,measurements:{...H.measurements,primary:P.target.value}}))})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Secondary"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-2 py-1",value:X.measurements.secondary||"",onChange:P=>v(H=>({...H,measurements:{...H.measurements,secondary:P.target.value}}))})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Observation"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-2 py-1",value:X.measurements.observation||"",onChange:P=>v(H=>({...H,measurements:{...H.measurements,observation:P.target.value}}))})]})]}),t.id==="extruder-esteps"&&e.jsxs("div",{className:"mt-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Helper:"})," ",(()=>{const P=Number(w.current.currentEsteps||0),H=Number(w.current.extrudeDistance||0),ee=Number(X.measurements.primary||0);if(P>0&&H>0&&ee>0){const re=P*H/ee;return e.jsxs(e.Fragment,{children:["Suggested E-steps: ",e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:re.toFixed(2)}),e.jsx("button",{className:"ml-2 px-2 py-1 bg-accent-medium text-white rounded",onClick:()=>G(`M92 E${re.toFixed(2)}
M500`),children:"Generate Update G-code"})]})}return e.jsx("span",{children:"Enter actual extruded mm as Primary Measurement to calculate new E-steps."})})()]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Notes"}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 h-28",value:X.notes,onChange:P=>v(H=>({...H,notes:P.target.value}))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Photos"}),e.jsxs("button",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded",onClick:()=>{var P;return(P=j.current)==null?void 0:P.click()},children:[e.jsx(Kn,{className:"h-4 w-4 inline mr-1"}),"Upload"]}),e.jsx("input",{ref:j,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:z})]}),X.photos.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:X.photos.map((P,H)=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("img",{src:P.dataUrl,alt:P.name,className:"w-full h-24 object-cover"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 px-2 py-1 truncate",children:P.name})]},H))}):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"No photos uploaded."})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-3 text-sm text-light-800",children:"Suggestions will appear here based on recorded measurements."})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsxs("button",{onClick:me,disabled:!W,className:`px-4 py-2 rounded-md transition-colors flex items-center space-x-2 ${W?"bg-gray-600 dark:bg-gray-300 text-white hover:bg-gray-700 dark:bg-gray-200":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 dark:text-gray-500 cursor-not-allowed"}`,children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{children:E?"Update Results":"Save & Mark Complete"})]}),E&&e.jsx("button",{className:"ml-2 px-4 py-2 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded",onClick:()=>L(!0),children:"Generate Report"})]}),S&&e.jsx(Bl,{isOpen:S,onClose:()=>L(!1),step:t,stepData:{inputValues:w.current,results:X,generatedGcode:T,lastUpdated:new Date().toISOString()},printer:c?{id:l}:null})]})},(t,a)=>{var r,s;return t.serialProps.status===a.serialProps.status&&t.canProceed===a.canProceed&&t.activeTab===a.activeTab&&t.isCompleted===a.isCompleted&&((r=t.step)==null?void 0:r.id)===((s=a.step)==null?void 0:s.id)}),bs={mechanical:{label:"Mechanical",description:"Physical printer components, movement, and structural issues",color:"blue"},electrical:{label:"Electrical",description:"Wiring, sensors, heating elements, and power-related issues",color:"yellow"},firmware:{label:"Firmware",description:"Configuration, settings, and software-related issues",color:"purple"}},Jl={open:{label:"Open",description:"Issue reported and needs attention",color:"red"},"in-progress":{label:"In Progress",description:"Currently working on this issue",color:"yellow"},resolved:{label:"Resolved",description:"Issue has been fixed",color:"green"}},eo={"under-extrusion":["Check extruder tension and ensure proper grip on filament","Calibrate E-Steps to ensure accurate extrusion amounts","Increase nozzle temperature by 5-10°C","Check for partial nozzle clogs","Verify filament diameter settings in slicer","Check for worn extruder gear"],"under extrusion":["Check extruder tension and ensure proper grip on filament","Calibrate E-Steps to ensure accurate extrusion amounts","Increase nozzle temperature by 5-10°C","Check for partial nozzle clogs","Verify filament diameter settings in slicer"],"over-extrusion":["Reduce flow rate in slicer by 5-10%","Lower nozzle temperature by 5-10°C","Recalibrate E-Steps (may be too high)","Check linear advance settings","Verify filament diameter is correct"],"over extrusion":["Reduce flow rate in slicer by 5-10%","Lower nozzle temperature by 5-10°C","Recalibrate E-Steps (may be too high)","Check linear advance settings"],stringing:["Increase retraction distance (try 0.5-1mm more)","Increase retraction speed","Lower nozzle temperature by 5-10°C",'Enable "Wipe Nozzle" in slicer settings',"Reduce print speed for travel moves","Check for worn PTFE tube in Bowden setups"],oozing:["Increase retraction distance","Lower nozzle temperature","Enable retraction at layer change","Check nozzle for damage or wear"],"layer adhesion":["Increase nozzle temperature by 5-10°C","Reduce cooling fan speed for first few layers","Increase print speed slightly to improve heat transfer","Check for drafts affecting the print area","Clean the nozzle and check for partial clogs"],delamination:["Increase bed and nozzle temperatures","Reduce cooling fan speed","Check for environmental temperature fluctuations","Increase infill percentage for structural parts"],"bed adhesion":["Level the bed more precisely","Clean bed surface with isopropyl alcohol","Adjust first layer height (try 0.1-0.3mm)","Increase bed temperature by 5-10°C","Use adhesion aids (hairspray, glue stick, or specialized bed adhesives)","Check first layer extrusion width settings"],warping:["Increase bed temperature","Use a heated enclosure or reduce drafts","Apply adhesion aids to bed surface","Add brim or raft to print","Check bed level and first layer height"],"layer shifting":["Check belt tension (should be tight but not over-tensioned)","Verify stepper motor connections","Reduce print speed and acceleration","Check for mechanical obstructions in axis movement","Verify stepper driver current settings","Check for loose pulleys or set screws"],ghosting:["Reduce print speed and acceleration","Tighten frame connections and check for mechanical looseness","Add dampers to stepper motors","Check belt tension","Enable S-curve acceleration if supported"],ringing:["Reduce print speed, especially for outer perimeters","Lower acceleration and jerk settings","Check frame rigidity and tighten loose components","Enable pressure advance/linear advance","Consider adding anti-vibration feet to printer"],"temperature fluctuation":["Run PID autotune for hotend and bed","Check thermistor connections","Verify heater cartridge is properly secured","Check for loose wiring","Ensure adequate power supply capacity"],"thermal runaway":["Check thermistor and heater connections immediately","Verify thermistor is properly secured to hotend","Check for damaged wiring","Test heater cartridge resistance","Ensure thermal protection is enabled in firmware"],grinding:["Check extruder tension (may be too tight)","Verify filament path is clear","Check for nozzle clogs","Increase nozzle temperature","Check extruder gear for wear or damage"],clicking:["Check for nozzle clogs","Reduce extruder tension slightly","Increase nozzle temperature","Check filament diameter and quality","Verify correct steps/mm calibration"],jamming:["Check for nozzle clogs and perform cold pull","Verify PTFE tube is properly seated (Bowden setups)","Check for heat creep in hotend","Ensure proper filament storage (dry conditions)","Check extruder alignment and filament path"],overheating:["Check part cooling fan operation","Verify hotend cooling fan is working","Reduce print speed for small features","Add minimum layer time settings","Check for adequate ventilation around printer"],curling:["Increase part cooling fan speed","Reduce nozzle temperature","Add supports for overhanging features","Reduce print speed for overhangs","Check cooling fan duct alignment"]};function to(t,a){const r=`${t} ${a}`.toLowerCase(),s=new Set;Object.entries(eo).forEach(([n,l])=>{r.includes(n)&&l.forEach(c=>s.add(c))});const i=Array.from(s);return i.length===0?["Check basic printer maintenance (bed level, belt tension, cleanliness)","Verify slicer settings match printer specifications","Ensure filament quality and proper storage","Check for loose connections and mechanical issues","Review recent changes to printer or settings"]:i.slice(0,8)}function Lt(t){return bs[t]||{label:"Unknown",description:"Unknown category",color:"gray"}}function ys(t){return Jl[t]||{label:"Unknown",description:"Unknown status",color:"gray"}}function ms(t){const a=new Date(t),s=new Date-a,i=Math.floor(s/6e4),n=Math.floor(s/36e5),l=Math.floor(s/864e5);return i<1?"Just now":i<60?`${i} minute${i!==1?"s":""} ago`:n<24?`${n} hour${n!==1?"s":""} ago`:l<7?`${l} day${l!==1?"s":""} ago`:a.toLocaleDateString()}function so(t){if(!t||t.length===0)return{total:0,open:0,inProgress:0,resolved:0,byCategory:{mechanical:0,electrical:0,firmware:0}};const a={total:t.length,open:0,inProgress:0,resolved:0,byCategory:{mechanical:0,electrical:0,firmware:0}};return t.forEach(r=>{r.status==="open"?a.open++:r.status==="in-progress"?a.inProgress++:r.status==="resolved"&&a.resolved++,a.byCategory.hasOwnProperty(r.category)&&a.byCategory[r.category]++}),a}const ro=({onIssueSelect:t})=>{const[a,r]=u.useState(!1),[s,i]=u.useState(""),[n,l]=u.useState(""),[c,o]=u.useState(""),[d,m]=u.useState({category:"",title:"",description:""}),{getActivePrinter:x,addIssue:h}=je(),f=x();if(!f)return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No active printer selected"})]});const y=f.issues||[],g=so(y),b=y.filter(M=>{const T=!s||M.title.toLowerCase().includes(s.toLowerCase())||M.description.toLowerCase().includes(s.toLowerCase()),G=!n||M.category===n,E=!c||M.status===c;return T&&G&&E}).sort((M,T)=>new Date(T.timestamp)-new Date(M.timestamp)),w=()=>{if(!d.category||!d.title.trim()){alert("Please fill in all required fields");return}h(f.id,{category:d.category,title:d.title.trim(),description:d.description.trim()}),m({category:"",title:"",description:""}),r(!1)},_=M=>{switch(M){case"open":return e.jsx(Te,{className:"h-4 w-4"});case"in-progress":return e.jsx(Ue,{className:"h-4 w-4"});case"resolved":return e.jsx(Ee,{className:"h-4 w-4"});default:return e.jsx(Te,{className:"h-4 w-4"})}},A=M=>{const T=ys(M),G="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";switch(T.color){case"red":return`${G} bg-red-100 text-red-800`;case"yellow":return`${G} bg-yellow-100 text-yellow-800`;case"green":return`${G} bg-green-100 text-green-800`;default:return`${G} bg-gray-100 text-gray-800`}},C=M=>{const T=Lt(M),G="inline-flex items-center px-2 py-1 rounded text-xs font-medium";switch(T.color){case"blue":return`${G} bg-blue-100 text-blue-800`;case"yellow":return`${G} bg-yellow-100 text-yellow-800`;case"purple":return`${G} bg-purple-100 text-purple-800`;default:return`${G} bg-gray-100 text-gray-800`}};return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Issue Log"}),e.jsxs("p",{className:"text-gray-600",children:["Track and manage printer issues for ",f.name]})]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx("span",{children:"Log New Issue"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ei,{className:"h-8 w-8 text-gray-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Issues"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:g.total})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Open"}),e.jsx("p",{className:"text-2xl font-semibold text-red-600",children:g.open})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-semibold text-yellow-600",children:g.inProgress})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Resolved"}),e.jsx("p",{className:"text-2xl font-semibold text-green-600",children:g.resolved})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ut,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search issues...",value:s,onChange:M=>i(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Aa,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:n,onChange:M=>l(M.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Categories"}),Object.entries(bs).map(([M,T])=>e.jsx("option",{value:M,children:T.label},M))]})]}),e.jsx("div",{children:e.jsxs("select",{value:c,onChange:M=>o(M.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:b.length===0?e.jsx("div",{className:"text-center py-12",children:y.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No issues logged yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking printer issues to improve your printing experience"}),e.jsx("button",{onClick:()=>r(!0),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Log Your First Issue"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No issues match your filters"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria"})]})}):e.jsx("div",{className:"divide-y divide-gray-200",children:b.map(M=>e.jsx("div",{onClick:()=>t&&t(M),className:"p-6 hover:bg-gray-50 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("span",{className:C(M.category),children:[e.jsx(Oa,{className:"h-3 w-3 mr-1"}),Lt(M.category).label]}),e.jsxs("span",{className:A(M.status),children:[_(M.status),e.jsx("span",{className:"ml-1",children:ys(M.status).label})]})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:M.title}),M.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:M.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fa,{className:"h-4 w-4 mr-1"}),ms(M.timestamp)]}),M.followUpActions&&M.followUpActions.length>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),M.followUpActions.filter(T=>T.completed).length,"/",M.followUpActions.length," actions completed"]})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(ti,{className:"h-5 w-5 text-gray-400"})})]})},M.id))})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Log New Issue"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Le,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:d.category,onChange:M=>m(T=>({...T,category:M.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),Object.entries(bs).map(([M,T])=>e.jsx("option",{value:M,children:T.label},M))]}),d.category&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:Lt(d.category).description})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:d.title,onChange:M=>m(T=>({...T,title:M.target.value})),placeholder:"Brief description of the issue",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:M=>m(T=>({...T,description:M.target.value})),placeholder:"Detailed description of the issue, what you were printing, settings used, etc.",rows:4,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:"Log Issue"})]})]})})]})},ao=({issue:t,onBack:a})=>{var J,ce;const[r,s]=u.useState(!1),[i,n]=u.useState({title:t.title,description:t.description,category:t.category,status:t.status}),[l,c]=u.useState(""),[o,d]=u.useState(!1),[m,x]=u.useState([]),{getActivePrinter:h,updateIssue:f,deleteIssue:y,addFollowUpAction:g,updateFollowUpAction:p}=je(),b=h();if(u.useEffect(()=>{n({title:t.title,description:t.description,category:t.category,status:t.status})},[t]),!b)return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No active printer selected"})]});const w=()=>{f(b.id,t.id,i),s(!1)},_=()=>{n({title:t.title,description:t.description,category:t.category,status:t.status}),s(!1)},A=()=>{l.trim()&&(g(b.id,t.id,l.trim()),c(""))},C=(q,ne)=>{p(b.id,t.id,q,ne)},M=()=>{const q=to(t.title,t.description);x(q),d(!0)},T=q=>{g(b.id,t.id,q)},G=()=>{window.confirm("Are you sure you want to delete this issue? This action cannot be undone.")&&(y(b.id,t.id),a())},E=q=>{switch(q){case"open":return e.jsx(Te,{className:"h-5 w-5"});case"in-progress":return e.jsx(Ue,{className:"h-5 w-5"});case"resolved":return e.jsx(Ee,{className:"h-5 w-5"});default:return e.jsx(Te,{className:"h-5 w-5"})}},k=q=>{const ne=ys(q),Q="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(ne.color){case"red":return`${Q} bg-red-100 text-red-800`;case"yellow":return`${Q} bg-yellow-100 text-yellow-800`;case"green":return`${Q} bg-green-100 text-green-800`;default:return`${Q} bg-gray-100 text-gray-800`}},N=q=>{const ne=Lt(q),Q="inline-flex items-center px-3 py-1 rounded text-sm font-medium";switch(ne.color){case"blue":return`${Q} bg-blue-100 text-blue-800`;case"yellow":return`${Q} bg-yellow-100 text-yellow-800`;case"purple":return`${Q} bg-purple-100 text-purple-800`;default:return`${Q} bg-gray-100 text-gray-800`}},R=((J=t.followUpActions)==null?void 0:J.filter(q=>q.completed).length)||0,I=((ce=t.followUpActions)==null?void 0:ce.length)||0;return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:a,className:"flex items-center text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(pr,{className:"h-4 w-4 mr-2"}),"Back to Issue Log"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs("span",{className:N(t.category),children:[e.jsx(Oa,{className:"h-4 w-4 mr-1"}),Lt(t.category).label]}),e.jsxs("span",{className:k(t.status),children:[E(t.status),e.jsx("span",{className:"ml-2",children:ys(t.status).label})]})]}),r?e.jsx("input",{type:"text",value:i.title,onChange:q=>n(ne=>({...ne,title:q.target.value})),className:"text-2xl font-bold text-gray-900 border-b-2 border-blue-500 bg-transparent w-full focus:outline-none"}):e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.title})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:M,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(kt,{className:"h-4 w-4"}),e.jsx("span",{children:"Analyze Issue"})]}),e.jsxs("button",{onClick:()=>s(!0),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center space-x-2",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:G,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:"Delete"})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:w,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{children:"Save"})]}),e.jsxs("button",{onClick:_,className:"bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition-colors flex items-center space-x-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Cancel"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Issue Details"}),r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{value:i.category,onChange:q=>n(ne=>({...ne,category:q.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:Object.entries(bs).map(([q,ne])=>e.jsx("option",{value:q,children:ne.label},q))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:i.status,onChange:q=>n(ne=>({...ne,status:q.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:q=>n(ne=>({...ne,description:q.target.value})),rows:6,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.description?e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:t.description}):e.jsx("p",{className:"text-gray-500 italic",children:"No description provided"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Follow-up Actions"}),I>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[R,"/",I," completed"]})]}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[e.jsx("input",{type:"text",value:l,onChange:q=>c(q.target.value),placeholder:"Add a follow-up action...",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:q=>q.key==="Enter"&&A()}),e.jsx("button",{onClick:A,disabled:!l.trim(),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:e.jsx(ht,{className:"h-4 w-4"})})]}),t.followUpActions&&t.followUpActions.length>0?e.jsx("div",{className:"space-y-2",children:t.followUpActions.map(q=>e.jsxs("div",{className:`flex items-start space-x-3 p-3 rounded-lg border ${q.completed?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:[e.jsx("button",{onClick:()=>C(q.id,!q.completed),className:`mt-0.5 ${q.completed?"text-green-600 hover:text-green-700":"text-gray-400 hover:text-gray-600"}`,children:q.completed?e.jsx(Ee,{className:"h-5 w-5"}):e.jsx("div",{className:"h-5 w-5 border-2 border-gray-300 rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm ${q.completed?"line-through text-gray-500":"text-gray-900"}`,children:q.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Added ",ms(q.timestamp)]})]})]},q.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(si,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No follow-up actions yet"}),e.jsx("p",{className:"text-sm",children:"Add actions to track your progress on this issue"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Issue Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Fa,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:ms(t.timestamp)})]}),t.resolvedTimestamp&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Resolved:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:ms(t.resolvedTimestamp)})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Ua,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Printer:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:b.name})]})]})]}),I>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Progress"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Actions Completed"}),e.jsxs("span",{className:"text-gray-900",children:[R,"/",I]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${I>0?R/I*100:0}%`}})}),e.jsx("p",{className:"text-xs text-gray-500",children:R===I&&I>0?"All actions completed!":`${I-R} actions remaining`})]})]})]})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(kt,{className:"h-5 w-5 mr-2 text-yellow-500"}),"Issue Analysis Results"]}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Le,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Based on your issue description, here are some suggested solutions:"}),e.jsx("div",{className:"space-y-2",children:m.map((q,ne)=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-900 flex-1",children:q}),e.jsx("button",{onClick:()=>T(q),className:"ml-3 text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Add as Action"})]},ne))}),m.length===0&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(kt,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No specific suggestions found for this issue type"}),e.jsx("p",{className:"text-sm",children:"Try adding more details to the description for better analysis"})]})]})]})})]})},no=()=>{const[t,a]=u.useState(null),r=i=>{a(i)},s=()=>{a(null)};return t?e.jsx(ao,{issue:t,onBack:s}):e.jsx(ro,{onIssueSelect:r})};function ya(t,a=""){if(!t||typeof t!="string")return{name:a||"Unknown",type:"quality",settings:{},metadata:{},raw:{}};const{sections:r,raw:s}=io(t),i=r.general||{},n=r.metadata||{},l=r.values||r||{},c=n.name||i.name||oo(a)||"Imported Profile",o=mo(n.type||i.type||co(a)||"quality"),d={...l};return{name:c,type:o,settings:d,metadata:{...i,...n},raw:s}}function io(t){const a={},r={lines:[]};let s=null;const i=t.split(/\r?\n/);for(let n=0;n<i.length;n+=1){let l=i[n];r.lines.push(l);const c=l.trim();if(!c||c.startsWith(";")||c.startsWith("#"))continue;const o=c.match(/^\[([^\]]+)\]$/);if(o){s=o[1].toLowerCase(),a[s]||(a[s]={});continue}const d=c.match(/^(.*?)=(.*)$/);if(d){const m=d[1].trim(),x=d[2].trim(),h=lo(x);s?a[s][m]=h:(a.values||(a.values={}),a.values[m]=h)}}return{sections:a,raw:r}}function lo(t){const a=t.replace(/^"|"$/g,"").replace(/^'|'$/g,"");if(/^(true|false)$/i.test(a))return/^true$/i.test(a);if(/^[+-]?\d+(\.\d+)?$/.test(a))return Number(a);if(a.includes(",")&&!a.includes(" ")){const r=a.split(",").map(s=>s.trim()).filter(Boolean);return r.every(s=>/^[+-]?\d+(\.\d+)?$/.test(s))?r.map(Number):r.every(s=>/^(true|false)$/i.test(s))?r.map(s=>/^true$/i.test(s)):r}return a}function oo(t){return t?(t.split(/[\\/]/).pop()||"").replace(/\.(cfg|curaprofile)$/i,"").replace(/[_-]+/g," "):""}function co(t){const a=(t||"").toLowerCase();return a.includes("material")?"material":a.includes("print")?"print":(a.includes("quality"),"quality")}function mo(t){const a=String(t).toLowerCase();return["quality","material","print"].includes(a)?a:"quality"}const uo=t=>/\.(cfg|curaprofile)$/i.test(t),xo=({isOpen:t,onClose:a,onImported:r})=>{const{getActivePrinter:s,addProfile:i}=je(),n=s(),[l,c]=u.useState([]),[o,d]=u.useState({}),[m,x]=u.useState(null),[h,f]=u.useState(!1),[y,g]=u.useState(!1),[p,b]=u.useState(null),[w,_]=u.useState("");u.useEffect(()=>{t||(c([]),d({}),x(null),f(!1),g(!1),b(null),_(""))},[t]);const A=u.useMemo(()=>l.filter(k=>uo(k.name)),[l]),C=u.useMemo(()=>A.filter(k=>!!o[k.name]),[A,o]),M=k=>{const N=Array.from(k.target.files||[]);c(N)},T=k=>{d(N=>({...N,[k.name]:!N[k.name]}))},G=async k=>{try{f(!0);const N=await k.text(),R=ya(N,k.name);x({file:k,parsed:R})}catch{_("Failed to load preview")}finally{f(!1)}},E=async()=>{var N;if(!n)return;if(C.length===0){_("Select at least one profile to import");return}_(""),g(!0);const k={total:C.length,success:0,failed:0,details:[]};for(const R of C)try{const I=await R.text(),J=ya(I,R.name),ce={name:J.name,type:J.type,settings:J.settings,isActive:!1},q=((N=n.slicerProfiles)==null?void 0:N.profiles)||[];let ne=ce.name,Q=1;for(;q.some(X=>X.name.toLowerCase()===ne.toLowerCase());)ne=`${ce.name} (${Q})`,Q+=1;await i(n.id,{...ce,name:ne}),k.success+=1,k.details.push({file:R.name,status:"ok"})}catch(I){k.failed+=1,k.details.push({file:R.name,status:"error",message:String((I==null?void 0:I.message)||I)})}b(k),g(!1),r&&r(k)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Cura Profiles"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:e.jsx(Le,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Cura profiles folder"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"file",webkitdirectory:"true",directory:"true",multiple:!0,onChange:M,className:"hidden",id:"cura-folder-input",accept:".cfg,.curaprofile"}),e.jsxs("label",{htmlFor:"cura-folder-input",className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer",children:[e.jsx(ri,{className:"h-4 w-4 mr-2"})," Browse Folder"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Tip: AppData/Roaming/cura/",e.jsx("i",{children:"version"}),"/quality"]})]})]}),e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:["Found Files (",A.length,")"]}),e.jsx("div",{className:"max-h-64 overflow-auto divide-y",children:A.length===0?e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No .cfg or .curaprofile files found"}):A.map(k=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:!!o[k.name],onChange:()=>T(k)}),e.jsx(De,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-800",children:k.name})]}),e.jsx("button",{onClick:()=>G(k),className:"text-blue-600 hover:text-blue-700 text-sm",children:"Preview"})]},k.name))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Selected: ",C.length]}),e.jsx("button",{onClick:E,disabled:y||C.length===0,className:`px-4 py-2 rounded-md text-white ${y?"bg-gray-400":"bg-green-600 hover:bg-green-700"}`,children:y?e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(sa,{className:"h-4 w-4 mr-2 animate-spin"})," Importing..."]}):"Import Selected"})]}),p&&e.jsxs("div",{className:"mt-3 p-3 border rounded-md bg-gray-50 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:["Imported ",p.success," of ",p.total," (",p.failed," failed)"]})]}),e.jsx("div",{className:"max-h-32 overflow-auto divide-y",children:p.details.map((k,N)=>e.jsxs("div",{className:"py-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-800",children:k.file}),e.jsx("span",{className:`text-xs ${k.status==="ok"?"text-green-700":"text-red-700"}`,children:k.status==="ok"?"OK":`Error: ${k.message||"Malformed"}`})]},N))})]}),w&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 text-red-700 text-sm rounded border border-red-200 flex items-center",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"})," ",w]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b flex items-center justify-between",children:[e.jsx("span",{children:"Preview"}),h&&e.jsx(sa,{className:"h-4 w-4 animate-spin text-gray-500"})]}),e.jsx("div",{className:"max-h-96 overflow-auto p-3 text-xs",children:m?e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 mb-2",children:[m.parsed.name," ",e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:m.parsed.type})]}),e.jsx("div",{className:"text-gray-600 mb-2",children:m.file.name}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(m.parsed.settings).slice(0,50).map(([k,N])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700 mr-2 truncate",children:k}),e.jsx("span",{className:"text-gray-500 max-w-[60%] truncate",children:String(Array.isArray(N)?N.join(","):N)})]},k)),Object.keys(m.parsed.settings).length>50&&e.jsx("div",{className:"text-gray-400",children:"…and more"})]})]}):e.jsx("div",{className:"text-gray-500",children:"Select a profile and click Preview."})})]})})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex items-center justify-end",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"Close"})})]})}):null},rr={Quality:{layer_height:{type:"number",label:"Layer Height (mm)",step:.02,min:.04,max:1,description:"Height of each printed layer.",recommend:{default:.2}},line_width:{type:"number",label:"Line Width (mm)",step:.01,min:.1,max:1.2,description:"Width of extruded lines.",recommend:{default:.4}},wall_line_count:{type:"number",label:"Wall Line Count",step:1,min:0,max:10,description:"Number of perimeters.",recommend:{strong_parts:4,default:2}}},Speed:{print_speed:{type:"number",label:"Print Speed (mm/s)",step:1,min:5,max:300,description:"Default print speed.",recommend:{default:60,high_speed:150}},travel_speed:{type:"number",label:"Travel Speed (mm/s)",step:1,min:10,max:500,description:"Speed for non-printing moves.",recommend:{default:150}},infill_speed:{type:"number",label:"Infill Speed (mm/s)",step:1,min:5,max:300,description:"Speed for infill.",recommend:{default:80}}},Material:{material_print_temperature:{type:"number",label:"Printing Temperature (°C)",step:1,min:150,max:300,description:"Nozzle temperature.",recommend:{PLA:200,PETG:240}},material_bed_temperature:{type:"number",label:"Bed Temperature (°C)",step:1,min:0,max:120,description:"Bed temperature.",recommend:{PLA:60,PETG:80}},retraction_enable:{type:"boolean",label:"Enable Retraction",description:"Retract filament to reduce stringing."},retraction_distance:{type:"number",label:"Retraction Distance (mm)",step:.1,min:0,max:20,description:"Amount of filament to retract.",recommend:{direct:1.5,bowden:6}},retraction_speed:{type:"number",label:"Retraction Speed (mm/s)",step:1,min:1,max:100,description:"Retraction speed."}},Cooling:{cool_fan_enabled:{type:"boolean",label:"Enable Cooling Fan",description:"Use part cooling fan."},cool_fan_speed:{type:"number",label:"Fan Speed (%)",step:5,min:0,max:100,description:"Default fan speed."}},Support:{support_enable:{type:"boolean",label:"Enable Support",description:"Generate support structures."},support_overhang_angle:{type:"number",label:"Support Overhang Angle (°)",step:1,min:0,max:90,description:"Max overhang angle without support."},support_pattern:{type:"enum",label:"Support Pattern",options:["lines","grid","zigzag","gyroid"],description:"Support infill pattern."}},Adhesion:{adhesion_type:{type:"enum",label:"Build Plate Adhesion",options:["none","brim","raft","skirt"],description:"Adhesion helper."},brim_width:{type:"number",label:"Brim Width (mm)",step:1,min:0,max:50,description:"Brim width around model."}}};function ho(t){const a={},r=(n,l,c)=>{const o=t[n];if(!(o==null||o==="")){if(typeof o!="number"||Number.isNaN(o)){a[n]="Must be a number";return}l!==void 0&&o<l&&(a[n]=`Must be ≥ ${l}`),!a[n]&&c!==void 0&&o>c&&(a[n]=`Must be ≤ ${c}`)}},s=n=>{const l=t[n];l!==void 0&&typeof l!="boolean"&&(a[n]="Must be true/false")},i=(n,l)=>{const c=t[n];c===void 0||c===""||l.includes(c)||(a[n]=`Must be one of: ${l.join(", ")}`)};return r("layer_height",.04,1),r("line_width",.1,1.2),r("wall_line_count",0,20),r("print_speed",5,300),r("travel_speed",10,500),r("infill_speed",5,300),r("material_print_temperature",150,300),r("material_bed_temperature",0,120),s("retraction_enable"),r("retraction_distance",0,20),r("retraction_speed",1,100),s("cool_fan_enabled"),r("cool_fan_speed",0,100),s("support_enable"),r("support_overhang_angle",0,90),i("support_pattern",["lines","grid","zigzag","gyroid"]),i("adhesion_type",["none","brim","raft","skirt"]),r("brim_width",0,50),a}function po(t,a={}){const r=[],s=(l,c,o)=>r.push({key:l,message:c,suggestion:o,level:"warning"});t.iron_enable&&(t.infill_sparse_density??20)<10&&s("iron_enable","Ironing with very low infill can waste time with minimal benefit.","Increase infill density or disable ironing for speed.");const i=a.maxPrintSpeed??150;typeof t.print_speed=="number"&&t.print_speed>i&&s("print_speed",`Print speed ${t.print_speed} exceeds printer max ${i}.`,`Reduce print_speed ≤ ${i}.`);const n=a.maxBedTemp??110;return typeof t.material_bed_temperature=="number"&&t.material_bed_temperature>n&&s("material_bed_temperature",`Bed temp exceeds capability (${n}°C).`,`Use ≤ ${n}°C or upgrade bed insulation.`),r}function go(t){const a=[],r=(n,l,c)=>a.push({key:n,message:l,suggestion:c,level:"strength"});(t.wall_line_count??2)<2&&r("wall_line_count","Low wall count reduces part strength.","Use ≥ 3 walls for stronger parts.");const s=t.infill_pattern||"grid",i=t.infill_sparse_density??20;return i<15&&r("infill_sparse_density","Low infill density weakens parts.","Use ≥ 25% for functional parts."),["lines","zigzag"].includes(s)&&i<30&&r("infill_pattern","Selected infill pattern provides low shear strength at low density.","Use gyroid/cubic or increase density."),a}function fo(t){const a=[],r=(c,o,d)=>a.push({key:c,message:o,suggestion:d,level:"speed"}),s=t.print_speed??60,i=t.layer_height??.2,n=t.wall_line_count??2,l=(n*.4+1)*(.2/i)*(60/s);return s<30&&r("print_speed","Very low print speed increases print time.","Increase to 50-70 mm/s if quality allows."),i<.12&&r("layer_height","Very low layer height increases print time significantly.","Use 0.16-0.24 mm for general prints."),n>4&&r("wall_line_count","High wall count increases time and material.","Use 2-3 walls unless strength is critical."),{estimates:{estTimeFactor:l},hints:a}}function bo(t,a){const r=ho(t),s=po(t,a),i=go(t),n=fo(t);return{errors:r,conflicts:s,strength:i,speed:n}}const yo=({checked:t,onChange:a})=>e.jsx("button",{type:"button",onClick:()=>a(!t),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${t?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-4":"translate-x-1"}`})}),vo=({isOpen:t,onClose:a,profile:r,onSave:s})=>{var M;const i=yr(),n=Ii(),l=i(),[c,o]=u.useState((r==null?void 0:r.settings)||{}),[d,m]=u.useState(""),[x,h]=u.useState("all"),[f,y]=u.useState("all"),[g,p]=u.useState({errors:{},conflicts:[],strength:[],speed:{estimates:{},hints:[]}});u.useEffect(()=>{o((r==null?void 0:r.settings)||{})},[r]),u.useEffect(()=>{const T=(l==null?void 0:l.printerCapabilities)||{};p(bo(c,T))},[c,l]),u.useMemo(()=>Object.keys(rr),[]);const b=u.useMemo(()=>{const T=d.toLowerCase(),G=(N,R)=>T?N.toLowerCase().includes(T)||(R.label||"").toLowerCase().includes(T)||(R.description||"").toLowerCase().includes(T):!0,E=N=>x==="all"||N.type===x,k={};for(const[N,R]of Object.entries(rr)){if(f!=="all"&&f!==N)continue;const I=Object.entries(R).filter(([J,ce])=>G(J,ce)&&E(ce));I.length&&(k[N]=I)}return k},[d,x,f]);if(!t)return null;const w=(T,G,E)=>{o(k=>({...k,[T]:E}))},_=(T,G)=>{const E=c[T],k=g.errors[T];switch(G.type){case"boolean":return e.jsx(yo,{checked:!!E,onChange:N=>w(T,G,N)});case"enum":return e.jsxs("select",{value:E??"",onChange:N=>w(T,G,N.target.value),className:`w-full px-2 py-1 border rounded text-sm ${k?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select…"}),(G.options||[]).map(N=>e.jsx("option",{value:N,children:N},N))]});case"number":return e.jsxs("div",{children:[e.jsx("input",{type:"number",step:G.step??"any",min:G.min,max:G.max,value:E??"",onChange:N=>w(T,G,N.target.value===""?"":Number(N.target.value)),className:`w-full px-2 py-1 border rounded text-sm ${k?"border-red-300 bg-red-50":"border-gray-300"}`}),k&&e.jsxs("div",{className:"mt-1 text-[11px] text-red-600 flex items-center",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"})," ",k]})]});default:return e.jsx("input",{type:"text",value:E??"",onChange:N=>w(T,G,N.target.value),className:`w-full px-2 py-1 border rounded text-sm ${k?"border-red-300 bg-red-50":"border-gray-300"}`})}},A=Object.keys(g.errors).length>0,C=()=>{if(!r||A)return;const T={settings:c};n(l.id,r.id,T),s&&s(T),a()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex",children:e.jsxs("div",{className:"bg-white w-full h-full md:rounded-none overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Edit Profile: ",r==null?void 0:r.name]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ut,{className:"h-4 w-4 text-gray-400 absolute left-2 top-2"}),e.jsx("input",{className:"pl-7 pr-2 py-1 border rounded text-sm w-64",placeholder:"Search settings…",value:d,onChange:T=>m(T.target.value)})]}),e.jsxs("select",{value:f,onChange:T=>y(T.target.value),className:"border rounded text-sm px-2 py-1",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.keys(rr).map(T=>e.jsx("option",{value:T,children:T},T))]}),e.jsxs("select",{value:x,onChange:T=>h(T.target.value),className:"border rounded text-sm px-2 py-1",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"boolean",children:"Boolean"}),e.jsx("option",{value:"enum",children:"Enum"}),e.jsx("option",{value:"string",children:"String"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"hidden md:flex items-center text-xs text-gray-600",children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Est factor: ",((M=g.speed.estimates.estTimeFactor)==null?void 0:M.toFixed(2))??"-"]}),e.jsx("button",{onClick:a,className:"px-3 py-1.5 bg-gray-100 rounded text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:C,disabled:A,className:`px-3 py-1.5 rounded ${A?"bg-gray-300 text-gray-600":"bg-blue-600 text-white"}`,children:"Save"})]})]}),e.jsxs("div",{className:"px-4 pt-3 grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Conflicts"}),g.conflicts.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"No conflicts detected."}):e.jsx("ul",{className:"space-y-1 text-xs",children:g.conflicts.map((T,G)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Te,{className:"h-3 w-3 text-yellow-600 mr-1 mt-0.5"})," ",e.jsxs("span",{children:[e.jsx("strong",{children:T.key}),": ",T.message," ",T.suggestion&&e.jsxs("em",{className:"text-gray-600",children:["(",T.suggestion,")"]})]})]},G))})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Strength Checks"}),g.strength.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"No strength issues."}):e.jsx("ul",{className:"space-y-1 text-xs",children:g.strength.map((T,G)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Te,{className:"h-3 w-3 text-orange-600 mr-1 mt-0.5"})," ",e.jsxs("span",{children:[e.jsx("strong",{children:T.key}),": ",T.message," ",e.jsxs("em",{className:"text-gray-600",children:["(",T.suggestion,")"]})]})]},G))})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Speed Hints"}),g.speed.hints.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"No speed hints."}):e.jsx("ul",{className:"space-y-1 text-xs",children:g.speed.hints.map((T,G)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Te,{className:"h-3 w-3 text-blue-600 mr-1 mt-0.5"})," ",e.jsxs("span",{children:[e.jsx("strong",{children:T.key}),": ",T.message," ",e.jsxs("em",{className:"text-gray-600",children:["(",T.suggestion,")"]})]})]},G))})]})]}),e.jsx("div",{className:"p-4 h-[calc(100%-200px)] overflow-auto",children:Object.entries(b).length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No settings match your filters."}):Object.entries(b).map(([T,G])=>e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:T}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:G.map(([E,k])=>e.jsxs("div",{className:`border rounded p-3 hover:shadow-sm transition ${g.errors[E]?"border-red-300":"border-gray-200"}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"mr-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:k.label||E}),k.description&&e.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:k.description}),k.recommend&&e.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:Object.entries(k.recommend).map(([N,R])=>e.jsxs("span",{className:"mr-2",children:[N,": ",e.jsx("span",{className:"text-gray-800",children:String(R)})]},N))})]})}),e.jsx("div",{className:"mt-2",children:_(E,k)})]},E))})]},T))})]})})};function No(t,a){var i,n;const r=Array.from(new Set([...Object.keys(t.settings||{}),...Object.keys(a.settings||{})])),s=[];for(const l of r){const c=(i=t.settings)==null?void 0:i[l],o=(n=a.settings)==null?void 0:n[l];JSON.stringify(c)!==JSON.stringify(o)&&s.push({key:l,from:c,to:o})}return s}const va=({isOpen:t,onClose:a,leftProfile:r,rightProfile:s,onMerge:i})=>{const n=u.useMemo(()=>No(r,s),[r,s]),[l,c]=u.useState({});if(!t)return null;const o=m=>c(x=>({...x,[m]:!x[m]})),d=()=>{const m={};n.forEach(x=>{l[x.key]&&(m[x.key]=x.to)}),i(m)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded w-full max-w-3xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[e.jsx("div",{className:"font-semibold",children:"Compare Profiles"}),e.jsx("button",{onClick:a,children:e.jsx(Le,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-12 text-sm font-medium text-gray-700 mb-2",children:[e.jsx("div",{className:"col-span-5",children:r==null?void 0:r.name}),e.jsx("div",{className:"col-span-2 text-center"}),e.jsx("div",{className:"col-span-5 text-right",children:s==null?void 0:s.name})]}),e.jsxs("div",{className:"max-h-80 overflow-auto divide-y",children:[n.map(m=>e.jsxs("label",{className:"grid grid-cols-12 items-center py-2 gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!l[m.key],onChange:()=>o(m.key)}),e.jsx("div",{className:"col-span-4 truncate",title:m.key,children:m.key}),e.jsx("div",{className:"col-span-3 truncate text-gray-600",title:String(m.from),children:String(m.from)}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx(or,{className:"h-4 w-4"})}),e.jsx("div",{className:"col-span-3 truncate text-gray-800",title:String(m.to),children:String(m.to)})]},m.key)),n.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No differences"})]})]}),e.jsxs("div",{className:"px-4 py-2 border-t flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1.5 bg-gray-100 rounded",children:"Close"}),e.jsx("button",{onClick:d,className:"px-3 py-1.5 bg-blue-600 text-white rounded",disabled:Object.keys(l).length===0,children:"Merge selected →"})]})]})})},Er={quality:{id:"high-quality",name:"High Quality",description:"Best visual quality with fine details",category:"Quality",icon:"🎯",settings:{layer_height:.15,infill_sparse_density:20,speed_print:50,speed_infill:80,speed_wall_0:25,speed_wall_x:40,wall_thickness:1.2,top_thickness:.8,bottom_thickness:.8,support_enable:!0,support_angle:45,retraction_enable:!0,retraction_amount:5,retraction_speed:45,adhesion_type:"brim",brim_width:3}},draft:{id:"draft-fast",name:"Draft/Fast",description:"Quick prints with acceptable quality",category:"Speed",icon:"⚡",settings:{layer_height:.3,infill_sparse_density:10,speed_print:80,speed_infill:120,speed_wall_0:40,speed_wall_x:60,wall_thickness:.8,top_thickness:.6,bottom_thickness:.6,support_enable:!1,retraction_enable:!0,retraction_amount:4,retraction_speed:60,adhesion_type:"skirt"}},strong:{id:"strong-durable",name:"Strong & Durable",description:"Maximum strength for functional parts",category:"Strength",icon:"💪",settings:{layer_height:.2,infill_sparse_density:40,infill_pattern:"grid",speed_print:40,speed_infill:60,speed_wall_0:20,speed_wall_x:30,wall_thickness:1.6,wall_line_count:4,top_thickness:1.2,bottom_thickness:1.2,top_layers:6,bottom_layers:6,support_enable:!0,support_angle:60,retraction_enable:!0,retraction_amount:5.5,retraction_speed:40,adhesion_type:"brim",brim_width:5}},flexible:{id:"flexible-tpu",name:"Flexible Materials",description:"Optimized for TPU and flexible filaments",category:"Material",icon:"🤸",settings:{layer_height:.2,infill_sparse_density:25,infill_pattern:"gyroid",speed_print:20,speed_infill:15,speed_wall_0:10,speed_wall_x:15,wall_thickness:1,top_thickness:.8,bottom_thickness:.8,support_enable:!1,retraction_enable:!1,retraction_amount:.8,retraction_speed:25,adhesion_type:"raft",material_print_temperature:230,material_bed_temperature:50}},miniatures:{id:"miniatures-detail",name:"Miniatures & Details",description:"Ultra-fine details for small models",category:"Specialty",icon:"🎭",settings:{layer_height:.1,infill_sparse_density:15,speed_print:30,speed_infill:40,speed_wall_0:15,speed_wall_x:25,wall_thickness:.8,top_thickness:.6,bottom_thickness:.6,support_enable:!0,support_angle:30,support_density:15,retraction_enable:!0,retraction_amount:6,retraction_speed:35,adhesion_type:"raft"}},vase:{id:"vase-mode",name:"Vase Mode",description:"Single wall continuous print",category:"Specialty",icon:"🏺",settings:{layer_height:.2,wall_thickness:.4,wall_line_count:1,infill_sparse_density:0,top_thickness:0,support_enable:!1,retraction_enable:!1,magic_spiralize:!0,speed_print:60,speed_wall_0:30,adhesion_type:"brim",brim_width:2}}},mr={stronger:{name:"Stronger",description:"Increase infill and wall thickness for more durability",icon:"🔧",changes:{infill_sparse_density:"+15",wall_thickness:"+0.4",top_thickness:"+0.2",bottom_thickness:"+0.2"}},faster:{name:"Faster",description:"Increase speeds and reduce quality for quicker prints",icon:"🚀",changes:{speed_print:"+20",speed_infill:"+30",layer_height:"+0.05",infill_sparse_density:"-5"}},smoother:{name:"Smoother",description:"Reduce layer height and speeds for better surface quality",icon:"✨",changes:{layer_height:"-0.05",speed_print:"-15",speed_wall_0:"-10",wall_thickness:"+0.2"}},detailed:{name:"More Detail",description:"Optimize for fine details and overhangs",icon:"🔍",changes:{layer_height:"-0.05",support_angle:"-15",retraction_amount:"+1",speed_wall_0:"-10"}},economical:{name:"Save Material",description:"Reduce material usage while maintaining strength",icon:"💰",changes:{infill_sparse_density:"-10",wall_thickness:"-0.2",top_thickness:"-0.2",infill_pattern:"gyroid"}}},jo={strength:{id:"optimize-strength",name:"Optimize for Strength",description:"Step-by-step guide to maximize part strength",icon:"💪",steps:[{title:"Layer Adhesion",description:"Lower layer height improves layer bonding",setting:"layer_height",recommendation:.2,explanation:"Thinner layers create more interfaces between layers, improving strength"},{title:"Infill Density",description:"Higher infill provides more internal structure",setting:"infill_sparse_density",recommendation:40,explanation:"40% infill provides good strength without excessive material use"},{title:"Infill Pattern",description:"Grid pattern offers excellent strength in all directions",setting:"infill_pattern",recommendation:"grid",explanation:"Grid pattern distributes stress evenly throughout the part"},{title:"Wall Thickness",description:"Thicker walls resist bending and impact",setting:"wall_thickness",recommendation:1.6,explanation:"Multiple perimeters create a strong shell around the part"},{title:"Print Temperature",description:"Optimal temperature ensures proper layer bonding",setting:"material_print_temperature",recommendation:"+5°C",explanation:"Slightly higher temperature improves layer adhesion"}]},speed:{id:"optimize-speed",name:"Minimize Print Time",description:"Reduce print time while maintaining acceptable quality",icon:"⚡",steps:[{title:"Layer Height",description:"Thicker layers mean fewer total layers",setting:"layer_height",recommendation:.3,explanation:"Doubling layer height can halve print time"},{title:"Infill Reduction",description:"Lower infill prints faster with less material",setting:"infill_sparse_density",recommendation:10,explanation:"Minimal infill for non-structural parts saves significant time"},{title:"Print Speeds",description:"Increase movement speeds where quality allows",setting:"speed_print",recommendation:80,explanation:"Higher speeds reduce print time, monitor quality"},{title:"Fewer Walls",description:"Reduce perimeter count for faster printing",setting:"wall_line_count",recommendation:2,explanation:"Fewer perimeters print faster, ensure adequate strength"},{title:"Skip Supports",description:"Avoid supports when design allows",setting:"support_enable",recommendation:!1,explanation:"Supports add significant print time and material"}]},quality:{id:"optimize-quality",name:"Maximize Surface Quality",description:"Achieve the best possible surface finish",icon:"✨",steps:[{title:"Fine Layer Height",description:"Thinner layers create smoother surfaces",setting:"layer_height",recommendation:.15,explanation:"Fine layers reduce visible layer lines"},{title:"Slower Outer Walls",description:"Slow outer perimeter for better accuracy",setting:"speed_wall_0",recommendation:25,explanation:"Slower outer walls improve dimensional accuracy"},{title:"Optimal Temperature",description:"Perfect temperature prevents over/under-extrusion",setting:"material_print_temperature",recommendation:"calibrate",explanation:"Temperature towers help find optimal settings"},{title:"Retraction Tuning",description:"Proper retraction eliminates stringing",setting:"retraction_amount",recommendation:5,explanation:"Balanced retraction prevents oozing without jamming"},{title:"Support Settings",description:"Fine-tune supports for clean removal",setting:"support_angle",recommendation:45,explanation:"Appropriate support angle minimizes surface marks"}]}};function wo(t,a={}){const r=Er[t];return r?{...a,...r.settings}:a}function Eo(t,a){const r=mr[t];if(!r)return a;const s={...a};return Object.entries(r.changes).forEach(([i,n])=>{const l=a[i]||0;if(typeof n=="string")if(n.startsWith("+")){const c=parseFloat(n.substring(1));s[i]=l+c}else if(n.startsWith("-")){const c=parseFloat(n.substring(1));s[i]=Math.max(0,l-c)}else s[i]=n;else s[i]=n}),s}function So(){const t={};return Object.values(Er).forEach(a=>{t[a.category]||(t[a.category]=[]),t[a.category].push(a)}),t}const _o=({isOpen:t,onClose:a,onApplyTemplate:r})=>{const[s,i]=u.useState(null),[n,l]=u.useState("All");if(!t)return null;const c=So(),o=["All",...Object.keys(c)],d=n==="All"?Object.values(Er):c[n]||[],m=()=>{s&&(r(s.id,s),a())},x=h=>[{key:"layer_height",label:"Layer Height",unit:"mm"},{key:"infill_sparse_density",label:"Infill",unit:"%"},{key:"speed_print",label:"Print Speed",unit:"mm/s"},{key:"wall_thickness",label:"Wall Thickness",unit:"mm"}].filter(y=>h.settings[y.key]!==void 0).slice(0,3);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Choose Profile Template"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Start with optimized settings for your print type"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Le,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"w-48 border-r bg-gray-50 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Categories"}),e.jsx("div",{className:"space-y-1",children:o.map(h=>e.jsx("button",{onClick:()=>l(h),className:`w-full text-left px-3 py-2 rounded text-sm transition-colors ${n===h?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-100"}`,children:h},h))})]}),e.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(h=>e.jsxs("div",{onClick:()=>i(h),className:`border rounded-lg p-4 cursor-pointer transition-all ${(s==null?void 0:s.id)===h.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:h.name}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:h.category})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:h.description}),e.jsx("div",{className:"space-y-1",children:x(h).map(f=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:[f.label,":"]}),e.jsxs("span",{className:"font-medium",children:[h.settings[f.key],f.unit]})]},f.key))})]},h.id))})}),s&&e.jsxs("div",{className:"w-80 border-l bg-gray-50 p-6 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("span",{className:"text-3xl",children:s.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:"text-sm text-blue-600",children:s.category})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Key Settings"}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(s.settings).slice(0,8).map(([h,f])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[h.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-medium",children:String(f)})]},h)),Object.keys(s.settings).length>8&&e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["+",Object.keys(s.settings).length-8," more settings..."]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(gr,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Template Benefits"}),e.jsxs("p",{className:"text-yellow-700",children:[s.category==="Quality"&&"Optimized for visual appearance and detail",s.category==="Speed"&&"Balanced speed and quality for faster prints",s.category==="Strength"&&"Maximized durability and mechanical properties",s.category==="Material"&&"Tuned for specific material characteristics",s.category==="Specialty"&&"Specialized settings for unique applications"]})]})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:s?`${s.name} template selected`:"Select a template to continue"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!s,className:`px-4 py-2 rounded-md transition-colors ${s?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Apply Template"})]})]})]})})},To=({currentSettings:t,onApplyPreset:a,className:r=""})=>{const[s,i]=u.useState({}),[n,l]=u.useState(null),c=m=>{const x=Eo(m,t);a(x,m)},o=m=>{i(x=>({...x,[m]:!x[m]}))},d=m=>{const x=mr[m];return x?Object.entries(x.changes).map(([h,f])=>{const y=t[h]||0;let g=y,p="";if(typeof f=="string")if(f.startsWith("+")){const b=parseFloat(f.substring(1));g=y+b,p=`+${b}`}else if(f.startsWith("-")){const b=parseFloat(f.substring(1));g=Math.max(0,y-b),p=`-${b}`}else g=f,p=`→ ${f}`;else g=f,p=`→ ${f}`;return{key:h,currentValue:y,newValue:g,change:p,setting:h.replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase())}}):[]};return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Quick Adjustments"}),e.jsx(Ye,{className:"h-4 w-4 text-yellow-500"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.entries(mr).map(([m,x])=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`border rounded-lg p-3 cursor-pointer transition-all ${n===m?"border-blue-300 bg-blue-50 shadow-sm":"border-gray-200 hover:border-gray-300"}`,onMouseEnter:()=>l(m),onMouseLeave:()=>l(null),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:x.icon}),e.jsx("span",{className:"font-medium text-sm",children:x.name})]}),e.jsx("button",{onClick:h=>{h.stopPropagation(),o(m)},className:"text-gray-400 hover:text-gray-600 transition-colors",title:s[m]?"Hide preview":"Show preview",children:s[m]?e.jsx(is,{className:"h-4 w-4"}):e.jsx(mt,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:x.description}),s[m]&&e.jsxs("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Changes Preview:"}),e.jsx("div",{className:"space-y-1",children:d(m).map(h=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[h.setting,":"]}),e.jsxs("span",{className:"font-medium",children:[h.currentValue," ",h.change]})]},h.key))})]}),e.jsxs("button",{onClick:()=>c(m),className:"w-full py-2 px-3 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:["Apply ",x.name]})]}),n===m&&!s[m]&&e.jsxs("div",{className:"absolute z-10 bottom-full left-0 mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded shadow-lg",children:[e.jsx("div",{className:"font-medium mb-1",children:"Preview Changes:"}),e.jsxs("div",{className:"space-y-1",children:[d(m).slice(0,3).map(h=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-300",children:[h.setting,":"]}),e.jsxs("span",{children:[h.currentValue," ",h.change]})]},h.key)),d(m).length>3&&e.jsxs("div",{className:"text-gray-400 italic",children:["+",d(m).length-3," more changes..."]})]}),e.jsx("div",{className:"absolute top-full left-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]},m))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ye,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Quick Tip:"})," These presets apply multiple related changes at once. Preview changes before applying to understand the impact on your print."]})]})})]})},Po=({isOpen:t,onClose:a,wizardId:r,currentSettings:s,onApplyChanges:i})=>{const[n,l]=u.useState(0),[c,o]=u.useState({}),[d,m]=u.useState(!1),x=jo[r];if(u.useEffect(()=>{t&&x&&(l(0),o({}),m(!1))},[t,x]),!t||!x)return null;const h=x.steps[n],f=n===x.steps.length-1,y=c[h==null?void 0:h.setting]!==void 0,g=(C,M)=>{o(T=>({...T,[C]:M}))},p=()=>{f?m(!0):l(C=>C+1)},b=()=>{d?m(!1):l(C=>C-1)},w=()=>{const C={...s};Object.entries(c).forEach(([M,T])=>{if(typeof T=="string"&&T.includes("°C")){const G=s[M]||200,E=parseInt(T.replace(/[^-+\d]/g,""));C[M]=G+E}else{if(T==="calibrate")return;C[M]=T}}),i(C),a()},_=()=>{const C=h,M=s[C.setting],T=C.recommendation,G=()=>{switch(C.setting){case"layer_height":return e.jsx("div",{className:"space-y-2",children:[.1,.15,.2,.25,.3].map(R=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"layer_height",value:R,checked:c[C.setting]===R,onChange:()=>g(C.setting,R),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[R,"mm"]}),e.jsx("div",{className:"text-sm text-gray-600",children:R<=.15?"High detail":R<=.25?"Balanced":"Fast print"})]}),R===T&&e.jsx(Ee,{className:"h-5 w-5 text-green-600"})]},R))});case"infill_sparse_density":return e.jsx("div",{className:"space-y-2",children:[5,10,15,20,30,40,50].map(R=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"infill_density",value:R,checked:c[C.setting]===R,onChange:()=>g(C.setting,R),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[R,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:R<=15?"Light/decorative":R<=30?"Standard":"Heavy duty"})]}),R===T&&e.jsx(Ee,{className:"h-5 w-5 text-green-600"})]},R))});case"infill_pattern":const E=["lines","grid","triangles","cubic","gyroid","honeycomb"];return e.jsx("div",{className:"space-y-2",children:E.map(R=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"infill_pattern",value:R,checked:c[C.setting]===R,onChange:()=>g(C.setting,R),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium capitalize",children:R}),e.jsxs("div",{className:"text-sm text-gray-600",children:[R==="grid"&&"Strong in all directions",R==="lines"&&"Fast, directional strength",R==="gyroid"&&"Organic, good strength-to-weight",R==="honeycomb"&&"Excellent strength, slower print",R==="cubic"&&"Isotropic strength",R==="triangles"&&"Good strength, fast print"]})]}),R===T&&e.jsx(Ee,{className:"h-5 w-5 text-green-600"})]},R))});case"support_enable":return e.jsx("div",{className:"space-y-2",children:[!0,!1].map(R=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"supports",value:String(R),checked:c[C.setting]===R,onChange:()=>g(C.setting,R),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[R?"Enable":"Disable"," Supports"]}),e.jsx("div",{className:"text-sm text-gray-600",children:R?"Print overhangs and bridges":"Faster print, design dependent"})]}),R===T&&e.jsx(Ee,{className:"h-5 w-5 text-green-600"})]},String(R)))});default:const k=C.setting.includes("temperature"),N=C.setting.includes("speed");return typeof T=="string"?e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-blue-800",children:[e.jsx(kt,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-medium",children:["Recommendation: ",T]})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:C.explanation}),e.jsx("button",{onClick:()=>g(C.setting,T),className:"mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Accept Recommendation"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:C.setting.replace(/_/g," ").replace(/\b\w/g,R=>R.toUpperCase())}),e.jsx("input",{type:"number",value:c[C.setting]||M||"",onChange:R=>g(C.setting,parseFloat(R.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",step:k?1:N?5:.1})]}),T&&e.jsxs("button",{onClick:()=>g(C.setting,T),className:"px-3 py-2 bg-green-100 text-green-700 border border-green-300 rounded hover:bg-green-200",children:["Use ",T,k&&"°C",N&&" mm/s",!k&&!N&&typeof T=="number"&&" mm"]})]})})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:C.title}),e.jsx("p",{className:"text-gray-600",children:C.description})]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Current value:"}),e.jsx("span",{className:"ml-2",children:M||"Not set"})]})}),G(),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(kt,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-yellow-800",children:C.explanation})]})})]})},A=()=>{const C=Object.entries(c).map(([M,T])=>({setting:M,oldValue:s[M],newValue:T,label:M.replace(/_/g," ").replace(/\b\w/g,G=>G.toUpperCase())}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Review Changes"}),e.jsxs("p",{className:"text-gray-600",children:["These settings will be applied to optimize your profile for ",x.name.toLowerCase()]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b",children:e.jsx("h4",{className:"font-medium text-gray-900",children:"Setting Changes"})}),e.jsx("div",{className:"divide-y",children:C.map(M=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:M.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-500",children:String(M.oldValue)}),e.jsx(ps,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-blue-600",children:String(M.newValue)})]})]},M.setting))})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"Expected Results:"}),e.jsxs("p",{children:[x.id==="optimize-strength"&&"Improved layer adhesion, increased structural integrity, and better resistance to mechanical stress.",x.id==="optimize-speed"&&"Significantly reduced print time while maintaining acceptable quality for functional parts.",x.id==="optimize-quality"&&"Enhanced surface finish, better dimensional accuracy, and reduced visible layer lines."]})]})]})})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:x.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:x.name}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Le,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"px-6 py-2 bg-gray-50 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:d?"Review":`Step ${n+1} of ${x.steps.length}`}),e.jsxs("span",{children:[Math.round((d?x.steps.length:n)/x.steps.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(d?x.steps.length:n+1)/x.steps.length*100}%`}})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:d?A():_()}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsxs("button",{onClick:b,disabled:n===0&&!d,className:`px-4 py-2 rounded transition-colors ${n===0&&!d?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(ai,{className:"h-4 w-4 inline mr-1"}),"Previous"]}),e.jsx("div",{className:"text-sm text-gray-500",children:d?"Ready to apply changes":`${Object.keys(c).length} of ${x.steps.length} completed`}),d?e.jsx("button",{onClick:w,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Apply Changes"}):e.jsxs("button",{onClick:p,disabled:!y,className:`px-4 py-2 rounded transition-colors ${y?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[f?"Review":"Next",e.jsx(ps,{className:"h-4 w-4 inline ml-1"})]})]})]})})},Co=({isOpen:t,onClose:a,profile:r})=>{const{revertProfileToVersion:s}=je(),[i,n]=u.useState(null),[l,c]=u.useState(!1);if(!t||!r)return null;const o=r.history||[],d=[...o].sort((p,b)=>new Date(b.timestamp)-new Date(p.timestamp)),m=p=>{confirm("Are you sure you want to revert to this version? This will create a new history entry.")&&(s(r.printerId||"",r.id,p),a())},x=p=>{switch(p){case"template":return e.jsx(ii,{className:"h-4 w-4 text-blue-600"});case"preset":return e.jsx(Ye,{className:"h-4 w-4 text-yellow-600"});case"wizard":return e.jsx(ni,{className:"h-4 w-4 text-purple-600"});case"import":return e.jsx(gt,{className:"h-4 w-4 text-green-600"});case"revert":return e.jsx(Ft,{className:"h-4 w-4 text-orange-600"});default:return e.jsx(Ua,{className:"h-4 w-4 text-gray-600"})}},h=p=>{switch(p){case"template":return"Template Applied";case"preset":return"Preset Applied";case"wizard":return"Wizard Optimization";case"import":return"Import";case"revert":return"Reverted";default:return"Manual Edit"}},f=p=>{const b=new Date(p),_=new Date-b,A=Math.floor(_/6e4),C=Math.floor(_/36e5),M=Math.floor(_/864e5);return A<1?"Just now":A<60?`${A} minutes ago`:C<24?`${C} hours ago`:M<7?`${M} days ago`:b.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},y=(p,b)=>{const w=[];return new Set([...Object.keys(p.snapshot||{}),...Object.keys(b.snapshot||{})]).forEach(A=>{var T,G;const C=(T=p.snapshot)==null?void 0:T[A],M=(G=b.snapshot)==null?void 0:G[A];JSON.stringify(C)!==JSON.stringify(M)&&w.push({key:A,oldValue:C,newValue:M,label:A.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase())})}),w},g=()=>{if(!i||d.length<2)return null;const p=d.findIndex(_=>_.id===i.id),b=d[p+1];if(!b)return null;const w=y(b,i);return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4",children:["Changes from ",f(b.timestamp)]}),w.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No setting changes detected"}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"divide-y",children:w.map(_=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:_.label}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-red-600",children:String(_.oldValue)}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{className:"text-green-600",children:String(_.newValue)})]})]},_.key))})})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-3xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Profile History"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.name," - Version Timeline"]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Le,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No history available"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Changes will be tracked here as you modify the profile"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900",children:"Current Version"}),e.jsxs("div",{className:"text-sm text-green-700",children:["Last updated: ",f(r.updatedAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded",children:"Active"})})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:d.map((p,b)=>{var w;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 w-4 h-4 bg-white border-2 border-gray-300 rounded-full"}),e.jsxs("div",{className:"ml-12 bg-white border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[x(p.source),e.jsx("span",{className:"font-medium text-gray-900",children:h(p.source)}),p.revertedFrom&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(from version ",f((w=o.find(_=>_.id===p.revertedFrom))==null?void 0:w.timestamp),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{n((i==null?void 0:i.id)===p.id?null:p),c(!l||(i==null?void 0:i.id)!==p.id)},className:"text-gray-400 hover:text-gray-600 p-1",title:"View details",children:e.jsx(mt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(p.id),className:"text-blue-600 hover:text-blue-700 p-1",title:"Revert to this version",children:e.jsx(Ft,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:f(p.timestamp)}),p.changes&&p.changes.length>0&&e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Changes:"})," ",p.changes.includes("reverted")?"Reverted to previous version":p.changes.slice(0,3).map(_=>_.replace(/_/g," ")).join(", "),p.changes.length>3&&e.jsxs("span",{className:"text-gray-500",children:[" +",p.changes.length-3," more"]})]}),(i==null?void 0:i.id)===p.id&&l&&g()]})]},p.id)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:o.length>0?`${o.length} version${o.length!==1?"s":""} in history`:"No versions in history"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Close"})]})]})})};function Ro(t,a={}){const r=new Date().toISOString(),s={version:4,name:t.name,definition:a.definition||"fused_deposition"},i={type:t.type||"quality",setting_version:20,modified:r},n=t.settings||{},l=[];l.push("[general]");for(const[c,o]of Object.entries(s))l.push(`${c} = ${ar(o)}`);l.push(""),l.push("[metadata]");for(const[c,o]of Object.entries(i))l.push(`${c} = ${ar(o)}`);l.push(""),l.push("[values]");for(const[c,o]of Object.entries(n))l.push(`${c} = ${ar(o)}`);return l.push(""),l.join(`
`)}function Na(t){t.forEach(a=>{const r=Ro(a),s=new Blob([r],{type:"text/plain"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=`${Mo(a.name)}.cfg`,n.click(),URL.revokeObjectURL(i)})}function Mo(t){return String(t||"profile").replace(/[^a-z0-9-_]+/gi,"_")}function ar(t){return typeof t=="boolean"?t?"True":"False":Array.isArray(t)?t.join(","):t}const ko=()=>{var B;const{getActivePrinter:t,addProfile:a,updateProfile:r,deleteProfile:s,duplicateProfile:i,setActiveProfile:n,updateCuraPath:l}=je(),c=t(),[o,d]=u.useState(!1),[m,x]=u.useState(!1),[h,f]=u.useState(!1),[y,g]=u.useState(!1),[p,b]=u.useState(!1),[w,_]=u.useState(!1),[A,C]=u.useState(!1),[M,T]=u.useState(!1),[G,E]=u.useState(null),[k,N]=u.useState(null),[R,I]=u.useState(null),[J,ce]=u.useState(null),[q,ne]=u.useState(null),[Q,X]=u.useState(null),[v,j]=u.useState({name:"",type:"quality",settings:{}});if(!c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500",children:"No printer selected"})});const S=((B=c.slicerProfiles)==null?void 0:B.profiles)||[],L=S.find(z=>z.isActive),V=()=>{if(!v.name.trim()){alert("Profile name is required");return}if(S.find(P=>P.name.toLowerCase()===v.name.toLowerCase())){alert("A profile with this name already exists");return}a(c.id,v),j({name:"",type:"quality",settings:{}}),d(!1)},F=()=>{if(!q.name.trim()){alert("Profile name is required");return}if(S.find(P=>P.name.toLowerCase()===q.name.toLowerCase()&&P.id!==q.id)){alert("A profile with this name already exists");return}r(c.id,q.id,q),ne(null),x(!1)},$=z=>{confirm("Are you sure you want to delete this profile?")&&s(c.id,z)},U=z=>{i(c.id,z)},D=z=>{n(c.id,z)},Z=z=>{X(z),g(!0)},oe=()=>{Na(S)},he=z=>{Na([z])},W=(z,P)=>{I(z),ce(P),b(!0)},me=z=>{!R||!J||(r(c.id,R.id,{settings:{...R.settings,...z},source:"merge"}),b(!1))},xe=(z,P)=>{if(!L){alert("Please select an active profile first");return}const H=wo(z,L.settings);r(c.id,L.id,{settings:H,source:"template"}),_(!1)},O=(z,P)=>{if(!L){alert("Please select an active profile first");return}r(c.id,L.id,{settings:z,source:"preset"})},K=z=>{if(!L){alert("Please select an active profile first");return}r(c.id,L.id,{settings:z,source:"wizard"}),C(!1)},ae=z=>{N(z),T(!0)},Y=z=>{if(!L){alert("Please select an active profile first");return}E(z),C(!0)},le=async z=>{const H=Array.from(z.target.files||[]).filter(ee=>/\.cfg$/i.test(ee.name));for(const ee of H){const re=await ee.text(),pe=ee.name.replace(/\.cfg$/i,""),ye=S.find(Ne=>Ne.name.toLowerCase()===pe.toLowerCase());if(ye){const Ne={...ye,name:pe,settings:de(re)};W(ye,Ne)}}};function de(z){const P={},H=z.split(/\r?\n/);let ee=!1;for(const re of H){const pe=re.trim();if(pe==="[values]"){ee=!0;continue}if(/^\[/.test(pe)){ee=!1;continue}if(!ee)continue;const ye=pe.match(/^(.*?)=(.*)$/);if(ye){const Ne=ye[1].trim(),ue=ye[2].trim();P[Ne]=se(ue)}}return P}function se(z){return/^(true|false)$/i.test(z)?/^true$/i.test(z):/^[+-]?\d+(\.\d+)?$/.test(z)?Number(z):z.includes(",")&&!z.includes(" ")?z.split(",").map(P=>P.trim()):z}const ve=z=>{switch(z){case"quality":return e.jsx(Se,{className:"h-4 w-4"});case"material":return e.jsx(Ma,{className:"h-4 w-4"});case"print":return e.jsx(De,{className:"h-4 w-4"});default:return e.jsx(Se,{className:"h-4 w-4"})}},ie=z=>{switch(z){case"quality":return"bg-blue-100 text-blue-800";case"material":return"bg-green-100 text-green-800";case"print":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},fe=z=>new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Profile Management"}),e.jsxs("p",{className:"text-gray-600",children:["Manage slicer profiles for ",c.name]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx("span",{children:"Create New"})]}),e.jsxs("button",{onClick:()=>_(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[e.jsx(gr,{className:"h-4 w-4"}),e.jsx("span",{children:"From Template"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx("span",{children:"Import"})]}),e.jsxs("button",{onClick:oe,className:"bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 transition-colors flex items-center space-x-2",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{children:"Export All"})]}),e.jsx("input",{type:"file",id:"sync-folder",className:"hidden",webkitdirectory:"true",directory:"true",multiple:!0,onChange:le}),e.jsx("label",{htmlFor:"sync-folder",className:"px-3 py-2 bg-gray-100 text-gray-700 rounded cursor-pointer hover:bg-gray-200 transition-colors",children:"Sync Folder"})]})]}),h&&e.jsx(xo,{isOpen:h,onClose:()=>f(!1),onImported:()=>f(!1)}),w&&e.jsx(_o,{isOpen:w,onClose:()=>_(!1),onApplyTemplate:xe}),A&&G&&e.jsx(Po,{isOpen:A,onClose:()=>C(!1),wizardId:`optimize-${G}`,currentSettings:(L==null?void 0:L.settings)||{},onApplyChanges:K}),M&&k&&e.jsx(Co,{isOpen:M,onClose:()=>T(!1),profile:{...k,printerId:c.id}}),p&&R&&J&&e.jsx(va,{isOpen:p,onClose:()=>b(!1),leftProfile:R,rightProfile:J,onMerge:me}),L&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Active Profile"}),e.jsx("p",{className:"text-green-700",children:L.name})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>ae(L),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center space-x-1",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx("span",{children:"History"})]}),e.jsx("button",{onClick:()=>he(L),className:"text-sm text-blue-600 hover:text-blue-700",children:"Export"})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Optimization Wizards"}),e.jsx(li,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>Y("strength"),className:"flex items-center space-x-2 px-3 py-2 bg-red-50 text-red-700 border border-red-200 rounded hover:bg-red-100 transition-colors",children:[e.jsx("span",{children:"💪"}),e.jsx("span",{className:"text-sm font-medium",children:"Strength"})]}),e.jsxs("button",{onClick:()=>Y("speed"),className:"flex items-center space-x-2 px-3 py-2 bg-yellow-50 text-yellow-700 border border-yellow-200 rounded hover:bg-yellow-100 transition-colors",children:[e.jsx("span",{children:"⚡"}),e.jsx("span",{className:"text-sm font-medium",children:"Speed"})]}),e.jsxs("button",{onClick:()=>Y("quality"),className:"flex items-center space-x-2 px-3 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded hover:bg-blue-100 transition-colors",children:[e.jsx("span",{children:"✨"}),e.jsx("span",{className:"text-sm font-medium",children:"Quality"})]})]})]}),e.jsx(To,{currentSettings:L.settings||{},onApplyPreset:O})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Profiles (",S.length,")"]})}),S.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(De,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No profiles created yet"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Create Your First Profile"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:S.map(z=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[z.isActive?e.jsx(Ee,{className:"h-5 w-5 text-green-600"}):e.jsx(ls,{className:"h-5 w-5 text-gray-400"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ie(z.type)}`,children:[ve(z.type),e.jsx("span",{className:"ml-1",children:z.type})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:z.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Last modified: ",fe(z.updatedAt)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>ae(z),className:"text-gray-700 p-2",title:"View History",children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>he(z),className:"text-gray-700 p-2",title:"Export",children:e.jsx(gt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>W(L||S[0],z),className:"text-indigo-600 p-2",title:"Compare",children:e.jsx(ka,{className:"h-4 w-4"})}),!z.isActive&&e.jsx("button",{onClick:()=>D(z.id),className:"text-green-600 hover:text-green-700 p-2",title:"Set as active",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(z.id),className:"text-blue-600 hover:text-blue-700 p-2",title:"Duplicate profile",children:e.jsx(oi,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Z(z),className:"text-indigo-600 hover:text-indigo-700 p-2",title:"Open editor",children:e.jsx(ft,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$(z.id),className:"text-red-600 hover:text-red-700 p-2",title:"Delete profile",children:e.jsx(_s,{className:"h-4 w-4"})})]})]})},z.id))})]}),y&&Q&&e.jsx(vo,{isOpen:y,onClose:()=>g(!1),profile:Q,onSave:()=>g(!1)}),p&&R&&J&&e.jsx(va,{isOpen:p,onClose:()=>b(!1),leftProfile:R,rightProfile:J,onMerge:me}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Profile"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Name"}),e.jsx("input",{type:"text",value:v.name,onChange:z=>j({...v,name:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter profile name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text sm font-medium text-gray-700 mb-1",children:"Profile Type"}),e.jsxs("select",{value:v.type,onChange:z=>j({...v,type:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"quality",children:"Quality Profile"}),e.jsx("option",{value:"material",children:"Material Profile"}),e.jsx("option",{value:"print",children:"Print Profile"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:V,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Create Profile"})]})]})}),m&&q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Profile"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Name"}),e.jsx("input",{type:"text",value:q.name,onChange:z=>ne({...q,name:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter profile name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text sm font-medium text-gray-700 mb-1",children:"Profile Type"}),e.jsxs("select",{value:q.type,onChange:z=>ne({...q,type:z.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"quality",children:"Quality Profile"}),e.jsx("option",{value:"material",children:"Material Profile"}),e.jsx("option",{value:"print",children:"Print Profile"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Save Changes"})]})]})})]})},ja=[{id:"mat-pla",name:"PLA",type:"PLA",properties:{density:1.24,glass_transition:60},recommendedSettings:{material_print_temperature:200,material_bed_temperature:60,cool_fan_enabled:!0,cool_fan_speed:100,retraction_enable:!0,retraction_distance:1.5,retraction_speed:35}},{id:"mat-petg",name:"PETG",type:"PETG",properties:{density:1.27,glass_transition:80},recommendedSettings:{material_print_temperature:240,material_bed_temperature:80,cool_fan_enabled:!0,cool_fan_speed:40,retraction_enable:!0,retraction_distance:4,retraction_speed:35}},{id:"mat-abs",name:"ABS",type:"ABS",properties:{density:1.05,glass_transition:105},recommendedSettings:{material_print_temperature:250,material_bed_temperature:100,cool_fan_enabled:!1,retraction_enable:!0,retraction_distance:2,retraction_speed:35}}];function Ao(t,a=""){var r,s,i,n,l,c,o,d,m;try{const x=JSON.parse(t),h=x.name||a.replace(/\.json$/i,""),f=x.properties||{},y=x.settings||{},g={material_print_temperature:((r=y.material_print_temperature)==null?void 0:r.value)??((s=y.print_temperature)==null?void 0:s.value),material_bed_temperature:((i=y.material_bed_temperature)==null?void 0:i.value)??((n=y.bed_temperature)==null?void 0:n.value),cool_fan_enabled:((l=y.cool_fan_enabled)==null?void 0:l.value)??!0,cool_fan_speed:(c=y.cool_fan_speed)==null?void 0:c.value,retraction_enable:(o=y.retraction_enable)==null?void 0:o.value,retraction_distance:(d=y.retraction_distance)==null?void 0:d.value,retraction_speed:(m=y.retraction_speed)==null?void 0:m.value};return{name:h,type:x.guid||x.material||"Custom",properties:{density:f.density,glass_transition:f.glass_transition_temperature},recommendedSettings:g}}catch{return null}}const Io=()=>{var T,G;const t=yr(),{addMaterial:a,updateMaterial:r,deleteMaterial:s}=Li(),{updateProfile:i,setProfileMaterial:n}=Di(),l=t(),[c,o]=u.useState(!1),[d,m]=u.useState(null),[x,h]=u.useState({name:"",type:"PLA",properties:{},recommendedSettings:{}}),[f,y]=u.useState(null);if(!l)return e.jsx("div",{className:"p-6 text-gray-500",children:"No printer selected"});const g=((T=l.slicerProfiles)==null?void 0:T.materials)||[],b=(((G=l.slicerProfiles)==null?void 0:G.profiles)||[]).find(E=>E.isActive),w=E=>{h({name:E.name,type:E.type,properties:{...E.properties},recommendedSettings:{...E.recommendedSettings}}),o(!0)},_=()=>{if(!x.name.trim())return alert("Name is required");d?(r(l.id,d.id,x),m(null)):a(l.id,x),o(!1),h({name:"",type:"PLA",properties:{},recommendedSettings:{}})},A=async E=>{const k=Array.from(E.target.files||[]),N={total:k.length,success:0,failed:0};for(const R of k)try{const I=await R.text(),J=Ao(I,R.name);J?(a(l.id,J),N.success+=1):N.failed+=1}catch{N.failed+=1}y(N)},C=E=>{const k=JSON.stringify(E,null,2),N=new Blob([k],{type:"application/json"}),R=URL.createObjectURL(N),I=document.createElement("a");I.href=R,I.download=`${E.name.replace(/\s+/g,"_")}.json`,I.click(),URL.revokeObjectURL(R)},M=E=>{if(!b)return alert("No active profile to link");n(l.id,b.id,E,!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Materials"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Manage filament materials and link to profiles"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"file",accept:".json",multiple:!0,className:"hidden",id:"mat-import",onChange:A}),e.jsxs("label",{htmlFor:"mat-import",className:"px-3 py-2 bg-green-600 text-white rounded cursor-pointer flex items-center",children:[e.jsx(gs,{className:"h-4 w-4 mr-1"})," Import"]}),e.jsxs("button",{onClick:()=>w(ja[0]),className:"px-3 py-2 bg-blue-600 text-white rounded flex items-center",children:[e.jsx(ht,{className:"h-4 w-4 mr-1"})," New"]})]})]}),e.jsxs("div",{className:"bg-white border rounded",children:[e.jsx("div",{className:"px-4 py-2 border-b text-sm font-medium text-gray-700",children:"Templates"}),e.jsx("div",{className:"p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:ja.map(E=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium",children:E.name}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Tg: ",E.properties.glass_transition,"°C • Density: ",E.properties.density," g/cm³"]}),e.jsx("button",{onClick:()=>w(E),className:"mt-2 text-blue-600 text-sm",children:"Use Template"})]},E.id))})]}),e.jsxs("div",{className:"bg-white border rounded overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 border-b text-sm font-medium text-gray-700",children:["Materials (",g.length,")"]}),e.jsx("div",{className:"divide-y",children:g.map(E=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[E.name," ",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:E.type})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Print: ",E.recommendedSettings.material_print_temperature,"°C • Bed: ",E.recommendedSettings.material_bed_temperature,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(b==null?void 0:b.materialId)===E.id&&e.jsxs("span",{className:"text-green-700 text-xs inline-flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"})," Linked"]}),e.jsx("button",{onClick:()=>C(E),className:"text-gray-700 px-2 py-1",children:e.jsx(gt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{m(E),h({name:E.name,type:E.type,properties:{...E.properties},recommendedSettings:{...E.recommendedSettings}}),o(!0)},className:"text-blue-700 px-2 py-1",children:e.jsx(ft,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(E.id),className:"text-indigo-700 px-2 py-1",children:e.jsx(ci,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>s(l.id,E.id),className:"text-red-700 px-2 py-1",children:e.jsx(_s,{className:"h-4 w-4"})})]})]},E.id))})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded p-4 w-full max-w-lg",children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:d?"Edit Material":"New Material"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Name"}),e.jsx("input",{value:x.name,onChange:E=>h({...x,name:E.target.value}),className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Type"}),e.jsxs("select",{value:x.type,onChange:E=>h({...x,type:E.target.value}),className:"w-full px-2 py-1 border rounded",children:[e.jsx("option",{children:"PLA"}),e.jsx("option",{children:"PETG"}),e.jsx("option",{children:"ABS"}),e.jsx("option",{children:"TPU"}),e.jsx("option",{children:"Nylon"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Print Temp (°C)"}),e.jsx("input",{type:"number",value:x.recommendedSettings.material_print_temperature??"",onChange:E=>h({...x,recommendedSettings:{...x.recommendedSettings,material_print_temperature:Number(E.target.value)}}),className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Bed Temp (°C)"}),e.jsx("input",{type:"number",value:x.recommendedSettings.material_bed_temperature??"",onChange:E=>h({...x,recommendedSettings:{...x.recommendedSettings,material_bed_temperature:Number(E.target.value)}}),className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Notes"}),e.jsx("textarea",{value:x.properties.notes||"",onChange:E=>h({...x,properties:{...x.properties,notes:E.target.value}}),className:"w-full px-2 py-1 border rounded min-h-[60px]"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>{o(!1),m(null)},className:"px-3 py-1.5 bg-gray-100 rounded",children:"Cancel"}),e.jsx("button",{onClick:_,className:"px-3 py-1.5 bg-blue-600 text-white rounded",children:"Save"})]})]})}),f&&e.jsxs("div",{className:"text-xs text-gray-600",children:["Imported ",f.success,"/",f.total," (failed ",f.failed,")"]})]})},Do=()=>{const[t,a]=u.useState("profiles");return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"border-b border-gray-200 mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>a("profiles"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${t==="profiles"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(De,{className:"h-4 w-4 inline mr-2"}),"Profiles"]}),e.jsxs("button",{onClick:()=>a("materials"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${t==="materials"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(di,{className:"h-4 w-4 inline mr-2"}),"Materials"]})]})}),t==="profiles"?e.jsx(ko,{}):e.jsx(Io,{})]})},Lo=({status:t})=>{const a=t==="connected"?"bg-green-500":t==="connecting"?"bg-yellow-500":"bg-gray-400";return e.jsx("span",{className:`inline-block w-2.5 h-2.5 rounded-full ${a}`})},nn=({status:t,baudRate:a,setBaudRate:r,autoDetect:s,setAutoDetect:i,error:n,onConnect:l,onDisconnect:c})=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Lo,{status:t}),e.jsx("div",{className:"font-medium text-gray-900 capitalize",children:t})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Web Serial"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Baud Rate"}),e.jsx("select",{value:a,onChange:o=>r(parseInt(o.target.value,10)),disabled:s||t!=="disconnected",className:"mt-1 w-full border border-gray-300 rounded px-2 py-1",children:[25e4,230400,115200,57600,38400,9600].map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm mt-6 md:mt-0",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:o=>i(o.target.checked),disabled:t!=="disconnected"}),e.jsx("span",{className:"text-gray-700",children:"Auto-detect baud"})]}),e.jsx("div",{className:"flex items-center justify-end space-x-2",children:t!=="connected"?e.jsx("button",{onClick:l,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Connect"}):e.jsx("button",{onClick:c,className:"px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Disconnect"})})]}),n&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-200 rounded p-2",children:n})]}),ln=[{code:"G0/G1",name:"Linear Move",category:"Movement",syntax:"G0|G1 X<pos> Y<pos> Z<pos> E<len> F<feed>",params:[{key:"X",desc:"X position (mm)",type:"number"},{key:"Y",desc:"Y position (mm)",type:"number"},{key:"Z",desc:"Z position (mm)",type:"number"},{key:"E",desc:"Extruder length (mm)",type:"number"},{key:"F",desc:"Feedrate (mm/min)",type:"number"}],description:"Move in a straight line to the specified coordinates. G0 is treated as G1 in Marlin.",examples:["G1 X10 Y10 F6000","G1 Z0.2 F300"]},{code:"G28",name:"Auto Home",category:"Movement",syntax:"G28 [X] [Y] [Z]",params:[{key:"X",desc:"Home X axis",type:"flag"},{key:"Y",desc:"Home Y axis",type:"flag"},{key:"Z",desc:"Home Z axis",type:"flag"}],description:"Home one or more axes to their endstops.",examples:["G28","G28 X Y"]},{code:"G90",name:"Absolute Positioning",category:"Movement",syntax:"G90",params:[],description:"Set positioning to absolute for X/Y/Z/E.",examples:["G90"]},{code:"G91",name:"Relative Positioning",category:"Movement",syntax:"G91",params:[],description:"Set positioning to relative for X/Y/Z/E.",examples:["G91"]},{code:"M104",name:"Set Hotend Temperature",category:"Temperature",syntax:"M104 S<temp> [T<tool>]",params:[{key:"S",desc:"Target temperature (°C)",type:"number"},{key:"T",desc:"Tool index",type:"number"}],description:"Set the hotend temperature without waiting.",examples:["M104 S200","M104 S210 T0"]},{code:"M109",name:"Wait for Hotend Temp",category:"Temperature",syntax:"M109 S<temp> [T<tool>]",params:[{key:"S",desc:"Target temperature (°C)",type:"number"},{key:"T",desc:"Tool index",type:"number"}],description:"Set the hotend temperature and wait until reached.",examples:["M109 S200"]},{code:"M140",name:"Set Bed Temperature",category:"Temperature",syntax:"M140 S<temp>",params:[{key:"S",desc:"Target temperature (°C)",type:"number"}],description:"Set the bed temperature without waiting.",examples:["M140 S60"]},{code:"M190",name:"Wait for Bed Temp",category:"Temperature",syntax:"M190 S<temp>",params:[{key:"S",desc:"Target temperature (°C)",type:"number"}],description:"Set the bed temperature and wait until reached.",examples:["M190 S60"]},{code:"M106",name:"Fan On",category:"Cooling",syntax:"M106 [S<0-255>]",params:[{key:"S",desc:"Fan speed (0-255)",type:"number"}],description:"Set part cooling fan speed.",examples:["M106 S255","M106 S128"]},{code:"M107",name:"Fan Off",category:"Cooling",syntax:"M107",params:[],description:"Turn off part cooling fan.",examples:["M107"]},{code:"M114",name:"Get Current Position",category:"Information",syntax:"M114",params:[],description:"Report the current position of all axes and extruder.",examples:["M114"]},{code:"M115",name:"Firmware Info",category:"Information",syntax:"M115",params:[],description:"Request firmware capabilities and version.",examples:["M115"]},{code:"M303",name:"PID Autotune",category:"Temperature",syntax:"M303 E<hotend> S<temp> C<cycles>",params:[{key:"E",desc:"Hotend index (0 for first)",type:"number"},{key:"S",desc:"Target temp (°C)",type:"number"},{key:"C",desc:"Cycles count",type:"number"}],description:"Run PID autotune routine for the specified hotend.",examples:["M303 E0 S210 C8"]}],Oo=ln.reduce((t,a)=>(t[a.category]=t[a.category]||[],t[a.category].push(a),t),{}),Fo=({onInsert:t,onClose:a})=>{const{getActivePrinter:r,addMacro:s,updateMacro:i}=je(),n=r(),[l,c]=u.useState(""),[o,d]=u.useState("All"),[m,x]=u.useState({name:"",description:"",commands:""}),h=["All",...Object.keys(Oo)],f=u.useMemo(()=>{const b=l.trim().toLowerCase();return ln.filter(w=>{const _=!b||w.code.toLowerCase().includes(b)||w.name.toLowerCase().includes(b)||w.description.toLowerCase().includes(b),A=o==="All"||w.category===o;return _&&A})},[l,o]),y=b=>{var w;t(((w=b.examples)==null?void 0:w[0])||b.code)},g=()=>{if(!m.name.trim()||!m.commands.trim())return;const b=m.commands.split(/\r?\n/).map(w=>w.trim()).filter(Boolean);s(n.id,{name:m.name.trim(),description:m.description.trim(),commands:b}),x({name:"",description:"",commands:""})},p=b=>{i(n.id,b.id,{isFavorite:!b.isFavorite})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-end md:items-center justify-center",children:e.jsxs("div",{className:"bg-white w-full md:max-w-3xl rounded-t-lg md:rounded-lg overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gray-50",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"G-code Reference"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:"Close"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{placeholder:"Search commands…",value:l,onChange:b=>c(b.target.value),className:"border border-gray-300 rounded px-3 py-2"}),e.jsx("select",{value:o,onChange:b=>d(b.target.value),className:"border border-gray-300 rounded px-3 py-2",children:h.map(b=>e.jsx("option",{value:b,children:b},b))}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[f.length," results"]})]}),e.jsxs("div",{className:"max-h-64 overflow-auto border border-gray-200 rounded divide-y",children:[f.map(b=>e.jsxs("div",{className:"p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[b.code," — ",b.name]}),e.jsx("button",{onClick:()=>y(b),className:"text-blue-600 text-sm",children:"Insert"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:b.category}),e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:b.description}),b.params&&b.params.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Params:"})," ",b.params.map(w=>`${w.key} (${w.desc})`).join(", ")]}),b.examples&&b.examples.length>0&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Examples:"})," ",b.examples.map((w,_)=>e.jsx("button",{onClick:()=>t(w),className:"text-indigo-600 hover:underline ml-2",children:w},_))]})]},b.code+b.name)),f.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No commands match your search."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 mb-2",children:"Macros"}),e.jsxs("div",{className:"border border-gray-200 rounded divide-y max-h-48 overflow-auto",children:[(n.macros||[]).map(b=>{var w;return e.jsxs("div",{className:"p-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[b.name,e.jsx("button",{onClick:()=>p(b),className:"text-yellow-600",children:b.isFavorite?e.jsx(gr,{className:"h-4 w-4"}):e.jsx(mi,{className:"h-4 w-4"})})]}),b.description&&e.jsx("div",{className:"text-xs text-gray-600",children:b.description}),((w=b.commands)==null?void 0:w.length)>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-700",children:[b.commands.slice(0,3).map((_,A)=>e.jsx("div",{className:"font-mono",children:_},A)),b.commands.length>3&&e.jsxs("div",{className:"text-gray-400",children:["+",b.commands.length-3," more…"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"text-blue-600 text-sm",onClick:()=>b.commands.forEach(_=>t(_)),children:"Insert"})})]},b.id)}),(n.macros||[]).length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No macros saved yet."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 mb-2",children:"Create Macro"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{placeholder:"Macro name",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.name,onChange:b=>x({...m,name:b.target.value})}),e.jsx("input",{placeholder:"Description (optional)",className:"w-full border border-gray-300 rounded px-3 py-2",value:m.description,onChange:b=>x({...m,description:b.target.value})}),e.jsx("textarea",{placeholder:`Commands (one per line)
Example:
G28
M104 S200
M109 S200`,className:"w-full border border-gray-300 rounded px-3 py-2 h-28 font-mono text-sm",value:m.commands,onChange:b=>x({...m,commands:b.target.value})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:g,children:[e.jsx(et,{className:"h-4 w-4 inline mr-1"})," Save Macro"]})})]})]})]})]})]})})},Uo=({entry:t})=>{const a=t.type==="tx"?"text-blue-400":t.type==="rx"?"text-green-400":t.type==="err"?"text-red-400":"text-gray-300",r=t.type.toUpperCase(),s=t.type==="tx"?"bg-blue-600":t.type==="rx"?"bg-green-600":t.type==="err"?"bg-red-600":"bg-gray-600";return e.jsxs("div",{className:"text-xs leading-5",children:[e.jsx("span",{className:"text-gray-500 mr-2",children:t.timestamp}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-white text-xs font-bold mr-2 ${s}`,children:r}),e.jsx("span",{className:a,children:t.message})]})},Bo=Ce.memo(({onSend:t,onSendMany:a,onClear:r})=>{const s=te(C=>{var M;return((M=C.serialLogs)==null?void 0:M.length)||0}),[i,n]=u.useState([]);u.useEffect(()=>{const C=te.getState().serialLogs||[];n(C)},[s]),te(C=>C.fetchAllPrinterSettings),te(C=>C.status);const[l,c]=u.useState(""),[o,d]=u.useState([]),[m,x]=u.useState(-1),h=u.useRef(null),[f,y]=u.useState(!1),g=te(C=>C.sendCommand),p=()=>{const C=l.trim();C&&(t(C),d(M=>[...M,C].slice(-100)),x(-1),c(""))},b=C=>{if(C.key==="Enter"&&!C.shiftKey)C.preventDefault(),p();else if(C.key==="ArrowUp"){if(C.preventDefault(),o.length===0)return;const M=m<0?o.length-1:Math.max(0,m-1);x(M),c(o[M]||"")}else if(C.key==="ArrowDown"){if(C.preventDefault(),o.length===0)return;const M=m>=o.length-1?-1:m+1;x(M),c(M===-1?"":o[M]||"")}};u.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[i]);const w=()=>{const C=i.map(E=>`${E.timestamp}	${E.type}	${E.message}`).join(`
`),M=new Blob([C],{type:"text/plain"}),T=URL.createObjectURL(M),G=document.createElement("a");G.href=T,G.download="serial_log.txt",G.click(),URL.revokeObjectURL(T)},_=C=>{c(M=>(M?M+`
`:"")+C),y(!1)},A=u.useMemo(()=>{const C=l.trim().split(/\s+/)[0]||"";if(!C)return"";const M=C.toUpperCase();return M==="G1"||M==="G0"?"Syntax: G1 X<pos> Y<pos> Z<pos> E<len> F<feed>":M==="G28"?"Syntax: G28 [X] [Y] [Z]":M==="M104"?"Syntax: M104 S<temp> [T<tool>]":M==="M109"?"Syntax: M109 S<temp> [T<tool>] (wait)":M==="M140"?"Syntax: M140 S<temp>":M==="M190"?"Syntax: M190 S<temp> (wait)":M==="M106"?"Syntax: M106 S<0-255>":M==="M303"?"Syntax: M303 E<hotend> S<temp> C<cycles>":""},[l]);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Serial Terminal"}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs("button",{onClick:()=>y(!0),className:"px-3 py-1 text-sm bg-gray-100 rounded inline-flex items-center hover:bg-gray-200",children:[e.jsx(ui,{className:"h-4 w-4 mr-1"})," Help"]}),e.jsx("button",{onClick:r,className:"px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200",children:"Clear"}),e.jsx("button",{onClick:w,className:"px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200",children:"Export"})]})]}),e.jsx("div",{ref:h,className:"flex-1 min-h-0 overflow-auto bg-gray-900 border border-gray-300 rounded p-3 font-mono text-sm",children:i.length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"No messages yet. Connect to your printer to see serial communication."}):e.jsx("div",{className:"space-y-1",children:i.map((C,M)=>e.jsx(Uo,{entry:C},M))})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{value:l,onChange:C=>c(C.target.value),onKeyDown:b,placeholder:"Enter G-code (e.g., M114)",className:"flex-1 border border-gray-300 rounded px-3 py-2 text-sm"}),e.jsx("button",{onClick:p,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"}),e.jsx("button",{onClick:()=>g("M112"),className:"px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700",title:"Emergency Stop",children:"E-Stop"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center justify-between",children:[e.jsx("span",{children:"Tip: Use Up/Down arrows to navigate command history"}),A&&e.jsx("span",{className:"text-indigo-700",children:A})]}),f&&e.jsx(Fo,{onInsert:_,onClose:()=>y(!1)})]})},(t,a)=>t.onSend===a.onSend&&t.onSendMany===a.onSendMany&&t.onClear===a.onClear),zo=Ce.memo(()=>{const t=te(x=>x.status),a=te(x=>x.baudRate),r=te(x=>x.setBaudRate),s=te(x=>x.autoDetect),i=te(x=>x.setAutoDetect),n=te(x=>x.error),l=te(x=>x.connect),c=te(x=>x.disconnect),o=te(x=>x.sendCommand),d=te(x=>x.sendCommands),m=te(x=>x.clearLogs);return e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsx(nn,{status:t,baudRate:a,setBaudRate:r,autoDetect:s,setAutoDetect:i,error:n,onConnect:l,onDisconnect:c}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Bo,{onSend:o,onSendMany:d,onClear:m})})]})}),Go=[1,10,100];function Vo({send:t,requestPosition:a,lastPosition:r}){var x,h,f,y,g,p;const[s,i]=u.useState(10),[n,l]=u.useState({x:"",y:"",z:""}),c=(b,w)=>{t("G91"),t(`G0 ${b}${w*s} F6000`),t("G90")},o=b=>{t(`G28 ${b||""}`.trim())},d=()=>{const b=[];n.x!==""&&b.push(`X${n.x}`),n.y!==""&&b.push(`Y${n.y}`),n.z!==""&&b.push(`Z${n.z}`),b.length!==0&&(t("G90"),t(`G0 ${b.join(" ")} F6000`))};u.useEffect(()=>{const b=setInterval(()=>a&&a(),1500);return()=>clearInterval(b)},[a]);const m=r||{x:0,y:0,z:0,e:0};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Movement"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Step:"}),e.jsx("div",{className:"flex",children:Go.map(b=>e.jsxs("button",{onClick:()=>i(b),className:`px-2 py-1 border text-xs ${s===b?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"} first:rounded-l last:rounded-r -ml-px`,children:["±",b,"mm"]},b))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"X Axis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("X",-1),children:"−X"}),e.jsx("div",{className:"text-sm text-gray-600",children:((h=(x=m.x).toFixed)==null?void 0:h.call(x,2))??m.x}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("X",1),children:"+X"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"Y Axis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Y",-1),children:"−Y"}),e.jsx("div",{className:"text-sm text-gray-600",children:((y=(f=m.y).toFixed)==null?void 0:y.call(f,2))??m.y}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Y",1),children:"+Y"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"Z Axis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Z",-1),children:"−Z"}),e.jsx("div",{className:"text-sm text-gray-600",children:((p=(g=m.z).toFixed)==null?void 0:p.call(g,2))??m.z}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Z",1),children:"+Z"})]})]})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>o(""),children:"Home All"}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>o("X"),children:"Home X"}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>o("Y"),children:"Home Y"}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>o("Z"),children:"Home Z"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 items-end",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"X"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n.x,onChange:b=>l({...n,x:b.target.value})})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Y"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n.y,onChange:b=>l({...n,y:b.target.value})})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Z"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n.z,onChange:b=>l({...n,z:b.target.value})})]}),e.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:d,children:"Go To"})]})]})}function Ho({send:t,preheat:a}){const[r,s]=u.useState(5),[i,n]=u.useState(120),l=o=>{t("G91"),t(`G1 E${o*r} F${i}`),t("G90")},c=()=>{t("M600")};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Extrusion"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>a==null?void 0:a("PLA"),children:"Preheat PLA"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>a==null?void 0:a("PETG"),children:"Preheat PETG"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-end",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Length (mm)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-2 py-1",value:r,onChange:o=>s(parseFloat(o.target.value)||0)})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Speed (mm/min)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-2 py-1",value:i,onChange:o=>n(parseFloat(o.target.value)||0)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-green-600 text-white rounded",onClick:()=>l(1),children:"Extrude"}),e.jsx("button",{className:"px-3 py-2 bg-red-600 text-white rounded",onClick:()=>l(-1),children:"Retract"}),e.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:c,children:"Filament Change"})]})]})}function $o({send:t}){const[a,r]=u.useState(0),s=n=>{const l=Math.max(0,Math.min(100,n));r(l);const c=Math.round(l/100*255);t(`M106 S${c}`)},i=()=>{r(0),t("M106 S0")};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Fan"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>s(50),children:"50%"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>s(100),children:"100%"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-red-600 text-white rounded",onClick:i,children:"Off"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"range",min:0,max:100,value:a,onChange:n=>s(parseInt(n.target.value,10)),className:"w-full"}),e.jsxs("div",{className:"w-12 text-right text-sm text-gray-700",children:[a,"%"]})]})]})}const Xo=[-.05,-.02,-.01,.01,.02,.05],Yo=Ce.memo(function({send:a,isConnected:r=!1}){const[s,i]=u.useState(0),[n,l]=u.useState("0.02"),c=async d=>{if(!r)return;const m=Number(d);Number.isNaN(m)||m===0||(await a(`M290 Z${m}`),i(x=>Number((x+m).toFixed(3))))},o=async()=>{r&&(await a("M290 R"),i(0))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Z Babystep"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Δ ",s.toFixed(3)," mm"]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:Xo.map(d=>e.jsx("button",{disabled:!r,onClick:()=>c(d),className:`px-2 py-1 rounded text-sm ${r?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 text-gray-400 cursor-not-allowed"}`,title:`M290 Z${d}`,children:d>0?`+${d}`:`${d}`},d))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:`w-24 border rounded px-2 py-1 text-sm ${r?"border-gray-300":"border-gray-200 bg-gray-50 text-gray-400"}`,value:n,onChange:d=>l(d.target.value),placeholder:"0.02"}),e.jsx("button",{disabled:!r,onClick:()=>c(Number(n)),className:`px-3 py-2 rounded text-sm ${r?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:"Apply"}),e.jsx("button",{disabled:!r,onClick:o,className:`ml-auto px-3 py-2 rounded text-sm ${r?"bg-red-600 text-white hover:bg-red-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:"Reset"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Tip: Negative moves nozzle closer to bed; positive moves away. Real-time during first layer."})]})}),Zo=Ce.memo(()=>{const[t,a]=u.useState(null),[r,s]=u.useState(!1),[i,n]=u.useState(!1),l=te(g=>{var p;return((p=g.serialLogs)==null?void 0:p.length)||0}),[c,o]=u.useState([]);u.useEffect(()=>{const p=(te.getState().serialLogs||[]).filter(b=>b.type==="rx"&&(b.message.includes("FIRMWARE_NAME:")||b.message.includes("SOURCE_CODE_URL:")||b.message.includes("PROTOCOL_VERSION:")||b.message.includes("MACHINE_TYPE:")||b.message.includes("EXTRUDER_COUNT:")||b.message.includes("Cap:")));o(p)},[l]);const d=te(g=>g.sendCommand),m=te(g=>g.status);u.useEffect(()=>{if(c.length===0)return;const p=c[c.length-1].message;if(p.includes("FIRMWARE_NAME:")||p.includes("SOURCE_CODE_URL:")||p.includes("PROTOCOL_VERSION:")||p.includes("MACHINE_TYPE:")||p.includes("EXTRUDER_COUNT:")||p.includes("Cap:")){n(!1);const b={firmwareName:x(p,"FIRMWARE_NAME:"),sourceCodeUrl:x(p,"SOURCE_CODE_URL:"),protocolVersion:x(p,"PROTOCOL_VERSION:"),machineType:x(p,"MACHINE_TYPE:"),extruderCount:x(p,"EXTRUDER_COUNT:"),uuid:x(p,"UUID:"),kinematics:x(p,"KINEMATICS:"),capabilities:h(p),rawMessage:p};a(b),s(!0)}},[c]);const x=(g,p)=>{const b=new RegExp(`${p}\\s*([^\\s]+(?:\\s+[^\\s]+)*?)(?=\\s+[A-Z_]+:|$)`),w=g.match(b);return w?w[1].trim():null},h=g=>{const p=[],b=/Cap:([A-Z_]+):(\d+)/g;let w;for(;(w=b.exec(g))!==null;){const _=w[1],A=w[2];p.push({name:_,enabled:A==="1"})}return p},f=async()=>{if(m==="connected"){n(!0),a(null),s(!0);try{await d("M115")}catch(g){console.error("Failed to get firmware info:",g),n(!1)}}},y=()=>{s(!1),a(null)};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Firmware Information"}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Requesting firmware information..."})]}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.firmwareName&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Firmware Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.firmwareName})]}),t.protocolVersion&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Protocol Version"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.protocolVersion})]}),t.machineType&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Machine Type"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.machineType})]}),t.extruderCount&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Extruder Count"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.extruderCount})]}),t.kinematics&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Kinematics"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.kinematics})]}),t.uuid&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"UUID"}),e.jsx("p",{className:"text-sm text-gray-900 font-mono break-all",children:t.uuid})]})]}),t.sourceCodeUrl&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Source Code URL"}),e.jsx("a",{href:t.sourceCodeUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 break-all",children:t.sourceCodeUrl})]}),t.capabilities&&t.capabilities.length>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Capabilities"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2",children:t.capabilities.map((g,p)=>e.jsxs("div",{className:`px-2 py-1 text-xs rounded flex items-center justify-between ${g.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:[e.jsx("span",{children:g.name}),e.jsx("span",{className:"text-xs",children:g.enabled?"✓":"✗"})]},p))})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Raw Response"}),e.jsx("pre",{className:"text-xs text-gray-600 mt-1 whitespace-pre-wrap",children:t.rawMessage})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No firmware information received. Make sure your printer is connected and supports M115."})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Close"})})]})}):e.jsx("button",{onClick:f,disabled:m!=="connected",className:"px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Firmware Info"})});function Wo({send:t}){const a=()=>{t("M303 E0 S210 C8")},r=()=>{t("G29")},s=()=>{t("M112")};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Utilities"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:a,children:"PID Tune (E0)"}),e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:r,children:"Bed Leveling"}),e.jsx(Zo,{}),e.jsx("button",{className:"px-3 py-2 bg-red-600 text-white rounded",onClick:s,children:"Emergency Stop"})]})]})}const on=u.memo(()=>{var i,n,l,c,o,d,m;const t=je(x=>x.activePrinterId),a=je(x=>{const h=x.printers.find(f=>f.id===t);return console.log("PrinterSettingsDisplay: activePrinterId:",t),console.log("PrinterSettingsDisplay: activePrinter:",h),console.log("PrinterSettingsDisplay: printerSettings:",h==null?void 0:h.printerSettings),h==null?void 0:h.printerSettings}),r=x=>typeof x=="object"&&x!==null?JSON.stringify(x,null,2):String(x),s=(x,h,f)=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(Se,{className:"w-5 h-5 mr-2"}),x]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:f.map(y=>{const g=h==null?void 0:h[y];return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[y,":"]}),e.jsx("span",{className:"text-gray-900 font-mono text-sm",children:r(g)})]},y)})})]});return a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Printer Settings"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>window.location.href="#/configuration",className:"px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center",children:[e.jsx(xi,{className:"w-4 h-4 mr-2"}),"Edit Settings"]})})]}),a.lastUpdated&&e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:["Last updated: ",new Date(a.lastUpdated).toLocaleString()]}),s("Steps Per Unit (M92)",a.stepsPerUnit,["x","y","z","e"]),s("Feedrates (M203)",a.feedrates,["x","y","z","e"]),s("Acceleration (M201/M204)",a.acceleration,["max","print","retract","travel"]),s("Jerk Settings (M205)",(i=a.acceleration)==null?void 0:i.jerk,["x","y","z","e"]),s("Home Offset (M206)",a.homeOffset,["x","y","z"]),s("Z Probe Offset (M851)",a.zProbeOffset,["x","y","z"]),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(Se,{className:"w-5 h-5 mr-2"}),"Bed Leveling (M420)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Enabled:"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${(n=a.bedLeveling)!=null&&n.enabled?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(l=a.bedLeveling)!=null&&l.enabled?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Fade Height:"}),e.jsxs("span",{className:"text-gray-900 font-mono text-sm",children:[(c=a.bedLeveling)==null?void 0:c.fadeHeight,"mm"]})]})]}),((o=a.bedLeveling)==null?void 0:o.mesh)&&a.bedLeveling.mesh.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("h4",{className:"font-medium text-gray-700 mb-2",children:["Mesh Points (",a.bedLeveling.mesh.length,"):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-gray-50 rounded p-2",children:e.jsx("pre",{className:"text-xs font-mono",children:a.bedLeveling.mesh.map((x,h)=>`Point ${h+1}: (${x.i}, ${x.j}) = ${x.z.toFixed(3)}mm`).join(`
`)})})]})]}),s("PID Hotend (M301)",(d=a.pid)==null?void 0:d.hotend,["p","i","d"]),s("PID Bed (M304)",(m=a.pid)==null?void 0:m.bed,["p","i","d"]),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(Se,{className:"w-5 h-5 mr-2"}),"Material Heating (M145)"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Object.entries(a.materialHeating||{}).map(([x,h])=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2 capitalize",children:x}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Hotend:"}),e.jsxs("span",{className:"text-sm font-mono",children:[h.hotend,"°C"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bed:"}),e.jsxs("span",{className:"text-sm font-mono",children:[h.bed,"°C"]})]})]})]},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(Se,{className:"w-5 h-5 mr-2"}),"Other Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Power Loss Recovery:"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${a.powerLossRecovery?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.powerLossRecovery?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Linear Advance:"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm",children:a.linearAdvance})]})]})]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Se,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Printer Settings"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Connect to a printer to automatically fetch and view configuration"})]})})});on.displayName="PrinterSettingsDisplay";const qo=Ce.memo(()=>{const t=te(p=>p.status),a=te(p=>p.baudRate),r=te(p=>p.setBaudRate),s=te(p=>p.autoDetect),i=te(p=>p.setAutoDetect),n=te(p=>p.error),l=te(p=>p.connect),c=te(p=>p.disconnect),o=te(p=>p.sendCommand),d=u.useRef(0),[m,x]=u.useState(null),h=u.useCallback(()=>{const p=te.getState().serialLogs||[],b=p.length;if(b<=d.current)return;const w=p.slice(d.current).filter(_=>_.type==="rx"&&/\bX:\s*[-\d.]+/.test(_.message)&&/\bY:\s*[-\d.]+/.test(_.message)&&/\bZ:\s*[-\d.]+/.test(_.message));if(w.length>0){const A=w[w.length-1].message,C={x:parseFloat((A.match(/X:\s*([-\d.]+)/)||[])[1]||0),y:parseFloat((A.match(/Y:\s*([-\d.]+)/)||[])[1]||0),z:parseFloat((A.match(/Z:\s*([-\d.]+)/)||[])[1]||0),e:parseFloat((A.match(/E:\s*([-\d.]+)/)||[])[1]||0)};Number.isNaN(C.x)||x(M=>!M||M.x!==C.x||M.y!==C.y||M.z!==C.z||M.e!==C.e?C:M)}d.current=b},[]);u.useEffect(()=>{const p=setInterval(h,1e3);return()=>clearInterval(p)},[h]);const f=()=>o("M114"),y=p=>o(p),g=p=>{p==="PLA"&&(y("M104 S205"),y("M140 S60")),p==="PETG"&&(y("M104 S235"),y("M140 S80"))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(nn,{status:t,baudRate:a,setBaudRate:r,autoDetect:s,setAutoDetect:i,error:n,onConnect:l,onDisconnect:c}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(Vo,{send:y,requestPosition:f,lastPosition:m}),e.jsx(rn,{send:y,isConnected:t==="connected"}),e.jsx(Ho,{send:y,preheat:g}),e.jsx($o,{send:y}),e.jsx(Yo,{send:y,isConnected:t==="connected"}),e.jsx(Wo,{send:y})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Bed Leveling"}),e.jsx(Ka,{showStatus:!1,showActions:!1})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Printer Settings"}),e.jsx(on,{})]})]})},(t,a)=>!0),nr=new Map;async function Qo(t){if(nr.has(t))return nr.get(t);try{const a=await fetch(`/src/gcode/${t}`);if(!a.ok)throw new Error(`Failed to load ${t}: ${a.statusText}`);const r=await a.text();return nr.set(t,r),r}catch(a){throw console.error(`Error loading G-code file ${t}:`,a),a}}const Ko={"first-layer":{filename:"firstlayer.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0}},"temperature-tower":{filename:"temperature-tower.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:"G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:";M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!0,restoreABL:!1}},"retraction-tuning":{filename:"retraction.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-5",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:5,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0}},"flow-rate":{filename:"flow-rate.gcode",parameters:{bedTemp:{placeholder:"S90",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S255",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.4",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-3.2",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2700",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:90,hotendTemp:255,finalHotendTemp:235,layerHeight:.4,retractionDistance:3.2,retractionSpeed:2700,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!1}},"calibration-cube":{filename:"calibration-cube.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0}},"speed-calibration":{filename:"speed.gcode",parameters:{bedTemp:{placeholder:"S50",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S240",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S240",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.28",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2700",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F1500",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F7500",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:50,hotendTemp:240,finalHotendTemp:240,layerHeight:.28,retractionDistance:6,retractionSpeed:2700,printSpeed:1500,travelSpeed:7500,enableABL:!1,restoreABL:!1}}};async function Mt(t,a={}){const r=Ko[t];if(!r)throw new Error(`No G-code configuration found for step: ${t}`);const s=await Qo(r.filename),i={...r.defaultValues,...a};let n=s;for(const[l,c]of Object.entries(r.parameters)){const o=i[l],d=c.placeholder;if(console.log(`Replacing parameter ${l}: ${d} -> ${o}`),typeof o=="boolean")o?n=n.replace(`;${d}`,d):n=n.replace(d,`;${d}`);else{const m=new RegExp(d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),x=d.replace(/\d+\.?\d*/,o),h=(n.match(m)||[]).length;n=n.replace(m,x);const f=(n.match(new RegExp(x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"))||[]).length;console.log(`  Replaced ${h} instances, now has ${f} instances of ${x}`)}}if(t==="first-layer"){const l=n.split(`
`);let c=!1;const o=l.filter(d=>d.trim()==="G92 E0.0000"?c?!1:(c=!0,!0):!0);n=o.join(`
`),console.log(`Removed ${l.length-o.length} problematic G92 E0.0000 commands`)}return{gcode:n,parameters:i,stepConfig:r}}const Xe=[{id:"bed-leveling",title:"Bed Leveling",name:"Bed Leveling",description:"Probe the bed surface and analyze flatness to ensure proper first layer adhesion",category:"Movement",requiresSave:!0,videoUrl:"https://www.youtube.com/watch?v=Kj4x1P1R3sE",instructions:["Ensure your printer has a bed leveling probe (BLTouch, inductive sensor, etc.)","Clear the bed surface of any debris or residue","Make sure the bed is at room temperature","Run the bed leveling sequence (G29)","Analyze the mesh data for flatness and variation","Adjust bed screws or probe offset if needed"],visualAids:[],commonIssues:[{issue:"Bed not flat enough",solution:"Adjust bed screws, check for warped bed, or use manual leveling first"},{issue:"Probe not triggering",solution:"Check probe wiring, adjust trigger distance, or clean probe tip"},{issue:"Inconsistent readings",solution:"Check probe mounting, ensure stable bed temperature, clean bed surface"}],expectedOutcomes:"Bed flatness within ±0.1mm variation across the entire surface",checklist:["Bed leveling probe installed and calibrated","Bed surface clean and free of debris","Bed at room temperature","Probe trigger distance properly set","No obstructions in probe path"],inputs:[{type:"number",label:"Probe Speed (mm/min)",key:"probeSpeed",defaultValue:300,min:100,max:1e3,step:50,required:!0},{type:"number",label:"Probe Grid Size",key:"gridSize",defaultValue:5,min:3,max:9,step:1,required:!0},{type:"number",label:"Probe Z-Offset (mm)",key:"probeZOffset",defaultValue:0,min:-5,max:5,step:.01,required:!0},{type:"checkbox",label:"Enable Bed Heating",key:"enableBedHeating",defaultValue:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0}],gcode:t=>{const{probeSpeed:a,gridSize:r,probeZOffset:s,enableBedHeating:i,bedTemp:n}=t;let l=`; Bed Leveling Calibration
`;return l+=`; Grid size: ${r}x${r}, Probe speed: ${a}mm/min
`,l+=`; Z-offset: ${s}mm
`,l+=`G90
`,l+=`M82
`,l+=`; Home all axes
`,l+=`G28
`,i&&(l+=`; Heat bed to ${n}°C for consistent probing
`,l+=`M140 S${n}
`,l+=`M190 S${n}
`),l+=`; Set probe speed
`,l+=`M203 Z${a}
`,l+=`; Set probe Z-offset
`,l+=`M851 Z${s}
`,l+=`; Save probe settings
`,l+=`M500
`,l+=`; Enable bed leveling
`,l+=`M420 S1
`,l+=`; Run bed leveling (G29)
`,l+=`G29
`,l+=`; Get mesh data
`,l+=`M420 V
`,l+=`; Move to center for inspection
`,l+=`G0 X110 Y110 Z5
`,l+=`; Move up for safety
`,l+=`G0 Z20
`,i&&(l+=`; Turn off bed heater
`,l+=`M140 S0
`),l+=`M84
`,l}},{id:"pid-autotune",title:"PID Autotune",name:"PID Autotune",description:"Calibrate the PID values for your hotend and bed to achieve stable temperatures",category:"Temperature",requiresSave:!0,videoUrl:"https://www.youtube.com/watch?v=APzJfYAgFkQ",instructions:["Preheat the hotend and bed to approximate target temperatures.","Ensure no filament is loaded or disable extrusion during tuning.","Run PID autotune for the hotend and bed (if supported).","Save the tuned PID values to EEPROM with M500.","Test stability during a small print."],visualAids:[],commonIssues:[{issue:"Temperature oscillates after tuning",solution:"Increase cycles or re-run autotune closer to operating temp."},{issue:"Heater fault during tuning",solution:"Lower target temperature, ensure thermistor contact, check wiring."}],expectedOutcomes:"Stable temperature traces with minimal overshoot (≤2°C) and fast settling time.",checklist:["Printer powered and idle","Thermistors connected and reading correctly","Nozzle clear and safe (no filament required)"],inputs:[{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:200,min:150,max:280,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"number",label:"Number of Cycles",key:"cycles",defaultValue:8,min:3,max:20,step:1,required:!0},{type:"checkbox",label:"Include Bed PID Tune",key:"includeBed",defaultValue:!0}],gcode:t=>{const{hotendTemp:a,bedTemp:r,cycles:s,includeBed:i}=t;let n=`; PID Autotune for ${a}°C hotend, ${r}°C bed, ${s} cycles
`;return n+=`M303 E0 S${a} C${s}
`,i&&(n+=`M303 E-1 S${r} C${s}
`),n+="; After completion, save the new PID values with M500",n}},{id:"extruder-esteps",title:"Extruder E-Steps Calibration",name:"Extruder E-Steps Calibration",description:"Calibrate the extruder steps per mm to ensure accurate filament extrusion",category:"Movement",requiresSave:!0,videoUrl:"https://www.youtube.com/watch?v=7tCxO17XZtw",instructions:["Heat the hotend to printing temperature (e.g., 200°C).","Mark filament at 120mm from the extruder entry.","Extrude 100mm of filament using controlled feed.","Measure remaining distance to entry to find actual extruded amount.","Compute new E-steps = (Current E-steps × Requested) ÷ Actual."],visualAids:[],commonIssues:[{issue:"Under-extrusion",solution:"Increase E-steps using measured actual extrusion."},{issue:"Slipping",solution:"Increase idler tension, clean drive gear, slow extrusion speed."}],expectedOutcomes:"Extrusion distances match requested within ±1mm over 100mm.",checklist:["Hotend heated to target temperature","Filament loaded and feeding","Extruder gear clean and tension set"],inputs:[{type:"number",label:"Current E-Steps/mm",key:"currentEsteps",defaultValue:93,min:50,max:200,step:.1,required:!0},{type:"number",label:"Distance to Extrude (mm)",key:"extrudeDistance",defaultValue:100,min:50,max:200,step:5,required:!0},{type:"number",label:"Filament Diameter (mm)",key:"filamentDiameter",defaultValue:1.75,min:1,max:3,step:.01,required:!0},{type:"checkbox",label:"Use Filament Diameter",key:"useFilamentDiameter",defaultValue:!0}],gcode:t=>{const{currentEsteps:a,extrudeDistance:r,filamentDiameter:s,useFilamentDiameter:i}=t;let n=`; E-Steps Calibration
`;return n+=`; Current E-steps: ${a}
`,n+=`; Extrude distance: ${r}mm
`,i?(n+=`; Filament diameter: ${s}mm
`,n+=`M92 E${a}
`,n+=`M500
`,n+=`; Heat hotend to 200°C first
`,n+=`M104 S200
`,n+=`M190 S60
`,n+=`; Extrude filament
`,n+=`G92 E0
`,n+=`G1 E${r} F100
`,n+=`; Measure actual extrusion and calculate new E-steps
`,n+="; New E-steps = (Current E-steps × Requested distance) ÷ Actual distance"):(n+=`M92 E${a}
`,n+=`M500
`,n+=`; Heat hotend to 200°C first
`,n+=`M104 S200
`,n+=`M190 S60
`,n+=`; Extrude filament
`,n+=`G92 E0
`,n+=`G1 E${r} F100
`,n+=`; Measure actual extrusion and calculate new E-steps
`,n+="; New E-steps = (Current E-steps × Requested distance) ÷ Actual distance"),n}},{id:"retraction-tuning",title:"Retraction Tuning",name:"Retraction Tuning",description:"Optimize retraction settings to eliminate stringing and oozing",requiresSave:!0,category:"Quality",videoUrl:"https://www.youtube.com/watch?v=Z2hZKx9F9_s",instructions:["Load a stringing test model or use generated test moves.","Start with moderate retraction and speed.","Observe stringing between towers and adjust values.","Repeat until stringing is minimized without causing jams."],visualAids:[],commonIssues:[{issue:"Stringing persists",solution:"Increase retraction distance and/or temperature tuning; enable coasting."},{issue:"Grinding/jams",solution:"Reduce retraction speed and distance; check path and PTFE."}],expectedOutcomes:"Minimal or no stringing; clean travel moves; no filament grinding.",checklist:["Hotend clean and free of debris","Filament dry and within spec","Nozzle temperature verified"],inputs:[{type:"number",label:"Starting Retraction Distance (mm)",key:"startRetraction",defaultValue:5,min:0,max:20,step:.5,required:!0},{type:"number",label:"Ending Retraction Distance (mm)",key:"endRetraction",defaultValue:1.5,min:0,max:20,step:.5,required:!0},{type:"number",label:"Retraction Steps",key:"retractionSteps",defaultValue:5,min:2,max:10,step:1,required:!0},{type:"number",label:"Retraction Speed (mm/s)",key:"retractionSpeed",defaultValue:45,min:10,max:100,step:5,required:!0},{type:"number",label:"Z-Hop Height (mm)",key:"zHop",defaultValue:.2,min:0,max:1,step:.1,required:!0},{type:"checkbox",label:"Enable Z-Hop",key:"enableZHop",defaultValue:!0},{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:200,min:150,max:280,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"number",label:"Test Distance (mm)",key:"testDistance",defaultValue:50,min:20,max:100,step:5,required:!0}],gcode:async t=>{const{startRetraction:a,endRetraction:r,retractionSteps:s,retractionSpeed:i,zHop:n,enableZHop:l,testDistance:c,hotendTemp:o,bedTemp:d}=t,m={bedTemp:d,hotendTemp:o-50,finalHotendTemp:o,layerHeight:.28,retractionDistance:a,retractionSpeed:i*60,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0};try{return(await Mt("retraction-tuning",m)).gcode}catch(x){return console.error("Error generating parameterized G-code:",x),`; Retraction Tuning
G90
M82
M140 S${d}
M190 S${d}
M104 S${o}
M109 S${o}
G28
G0 Z3
; Add your retraction test pattern here`}}},{id:"first-layer",title:"First Layer Calibration",name:"First Layer Calibration",description:"Calibrate the first layer height and bed leveling for perfect adhesion",requiresSave:!1,category:"Quality",videoUrl:"https://www.youtube.com/watch?v=Kj4x1P1R3sE",instructions:["Clean the build surface and remove residue.","Home all axes and level bed using ABL or manual paper method.","Adjust Z-offset while printing a first-layer test.","Inspect line width, squish, and adhesion; adjust as needed."],visualAids:[],commonIssues:[{issue:"Poor adhesion",solution:"Increase bed temp, clean surface, adjust Z-offset lower (closer)."},{issue:"Elephant foot",solution:"Lower bed temp slightly, raise first layer Z-offset, add chamfer."}],expectedOutcomes:"Uniform, slightly squished lines with consistent width and strong adhesion.",checklist:["Bed is clean and free of oils","Nozzle is clean","Bed leveling completed"],inputs:[{type:"number",label:"Layer Height (mm)",key:"layerHeight",defaultValue:.2,min:.1,max:.4,step:.05,required:!0},{type:"number",label:"First Layer Height (mm)",key:"firstLayerHeight",defaultValue:.2,min:.1,max:.4,step:.05,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:200,min:150,max:280,step:5,required:!0},{type:"number",label:"Print Speed (mm/s)",key:"printSpeed",defaultValue:20,min:10,max:175,step:5,required:!0},{type:"checkbox",label:"Enable Bed Leveling",key:"enableBedLeveling",defaultValue:!0}],gcode:async t=>{const{layerHeight:a,firstLayerHeight:r,bedTemp:s,hotendTemp:i,printSpeed:n,enableBedLeveling:l}=t,c={bedTemp:s,hotendTemp:i-50,finalHotendTemp:i,layerHeight:r,retractionDistance:6,retractionSpeed:2400,printSpeed:n*60,travelSpeed:11e3,enableABL:l,restoreABL:l};try{return(await Mt("first-layer",c)).gcode}catch(o){return console.error("Error generating parameterized G-code:",o),`; First Layer Calibration
G90
M82
M140 S${s}
M190 S${s}
M104 S${i}
G28
M109 S${i}
G0 Z3
; Add your first layer test pattern here`}}},{id:"flow-rate",title:"Flow Rate Calibration",name:"Flow Rate Calibration",description:"Calibrate the flow rate to achieve accurate wall thickness and dimensions",requiresSave:!0,category:"Quality",videoUrl:"https://www.youtube.com/watch?v=3-p7u0qv2bM",instructions:["Print a single-wall cube or use a generated line.","Measure wall thickness accurately with calipers.","Compute new flow = expected × current ÷ actual.","Apply new flow and re-test."],visualAids:[],commonIssues:[{issue:"Walls too thin",solution:"Increase flow rate or check extrusion path for leaks."},{issue:"Walls too thick",solution:"Decrease flow rate; verify nozzle diameter and slicer settings."}],expectedOutcomes:"Measured wall thickness within ±0.02 mm of expected for single-wall test.",checklist:["Calipers available and zeroed","Nozzle diameter known and configured","Single-wall model sliced with correct width"],inputs:[{type:"number",label:"Current Flow Rate (%)",key:"currentFlow",defaultValue:100,min:50,max:150,step:1,required:!0},{type:"number",label:"Wall Thickness (mm)",key:"wallThickness",defaultValue:.4,min:.2,max:1,step:.1,required:!0},{type:"number",label:"Nozzle Diameter (mm)",key:"nozzleDiameter",defaultValue:.4,min:.2,max:1,step:.1,required:!0},{type:"checkbox",label:"Print Test Cube",key:"printTestCube",defaultValue:!0},{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:235,min:180,max:280,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:80,min:0,max:120,step:5,required:!0}],gcode:async t=>{const{currentFlow:a,wallThickness:r,nozzleDiameter:s,printTestCube:i,hotendTemp:n,bedTemp:l}=t,c={bedTemp:l||80,hotendTemp:(n||235)-50,finalHotendTemp:n||235,layerHeight:.4,retractionDistance:3.2,retractionSpeed:2700,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!1};try{const o=await Mt("flow-rate",c);let d=`; Flow Rate Calibration
`;return d+=`; Current flow: ${a}%, Wall thickness: ${r}mm
`,d+=`; Nozzle: ${s}mm
`,d+=`; Set flow rate
`,d+=`M221 S${a}
`,d+=`M500

`,i&&(d+=`; Print flow rate test cube
`,d+=`; Measure wall thickness with calipers
`,d+=`; Calculate new flow rate:
`,d+=`; New Flow = (Expected thickness × Current flow) ÷ Actual thickness
`,d+=`; Use M221 S<value> to set new flow rate
`,d+=`; Use M500 to save

`),d+=o.gcode,d}catch(o){return console.error("Error generating parameterized G-code:",o),`; Flow Rate Calibration
; Current flow: ${a}%, Wall thickness: ${r}mm
; Nozzle: ${s}mm
; Set flow rate
M221 S${a}
M500
; Print test cube and measure wall thickness`}}},{id:"temperature-tower",title:"Temperature Tower",name:"Temperature Tower",description:"Find the optimal printing temperature for your filament",requiresSave:!1,category:"Temperature",videoUrl:"https://www.youtube.com/watch?v=0Y2YxYf-7xU",instructions:["Slice a temperature tower with scripted temperature changes.","Print the model and note artifacts at each temperature.","Select the range with best surface quality and bridging."],visualAids:[],commonIssues:[{issue:"Poor bridging in all segments",solution:"Increase cooling, reduce speed, and adjust temperature lower."}],expectedOutcomes:"A selected temperature range with crisp details, minimal stringing, and strong layer adhesion.",checklist:["Cooling fan functional","Stable filament feed","Bed adhesion consistent"],inputs:[{type:"number",label:"Start Temperature (°C)",key:"startTemp",defaultValue:220,min:180,max:280,step:5,required:!0},{type:"number",label:"End Temperature (°C)",key:"endTemp",defaultValue:180,min:150,max:250,step:5,required:!0},{type:"number",label:"Temperature Step (°C)",key:"tempStep",defaultValue:10,min:5,max:20,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"checkbox",label:"Include Bed Temperature",key:"includeBed",defaultValue:!0}],gcode:async t=>{const{startTemp:a,endTemp:r,tempStep:s,bedTemp:i,includeBed:n}=t,l={bedTemp:n?i:0,hotendTemp:a-50,finalHotendTemp:a,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!0,restoreABL:!1};try{return(await Mt("temperature-tower",l)).gcode}catch(c){return console.error("Error generating parameterized G-code:",c),`; Temperature Tower
G90
M82
M140 S${i}
M190 S${i}
M104 S${a}
G28
M109 S${a}
G0 Z3
; Add your temperature tower pattern here`}}}];Xe.push({id:"calibration-cube",title:"Calibration Cube",name:"Calibration Cube",description:"Print a 20 mm calibration cube to verify dimensional accuracy and general print health",requiresSave:!1,category:"Quality",videoUrl:"https://www.youtube-nocookie.com/embed/2RPO4mDFN70",instructions:["Use this cube to validate X/Y/Z dimensions, first-layer adhesion, and general motion.","Measure each axis with calipers after printing and compare against 20 mm.","Adjust steps/mm or flow if dimensional errors are consistent."],visualAids:[],commonIssues:[{issue:"Elephant foot",solution:"Lower bed temp slightly or add chamfer; adjust first-layer Z-offset."},{issue:"Over/under extrusion",solution:"Tune flow rate and retraction settings."},{issue:"Ringing/ghosting",solution:"Reduce acceleration/jerk and speed."}],expectedOutcomes:"Cube measures close to 20.00 mm on X/Y/Z with clean walls and corners.",checklist:["Bed clean and leveled","Filament dry and consistent diameter","Temperatures appropriate for filament"],inputs:[{type:"number",label:"Cube Size (mm)",key:"cubeSize",defaultValue:20,min:10,max:40,step:1,required:!0},{type:"number",label:"Layer Height (mm)",key:"layerHeight",defaultValue:.2,min:.08,max:.36,step:.02,required:!0},{type:"number",label:"Perimeters",key:"perimeters",defaultValue:2,min:1,max:5,step:1,required:!0},{type:"number",label:"Top/Bottom Layers",key:"solidLayers",defaultValue:4,min:2,max:10,step:1,required:!0},{type:"number",label:"Infill (%)",key:"infill",defaultValue:15,min:0,max:40,step:5,required:!0},{type:"number",label:"Print Speed (mm/s)",key:"printSpeed",defaultValue:50,min:20,max:175,step:5,required:!0},{type:"number",label:"Hotend Temp (°C)",key:"hotendTemp",defaultValue:205,min:170,max:280,step:5,required:!0},{type:"number",label:"Bed Temp (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0}],gcode:t=>{const a=typeof window<"u"&&window.__PRINTER_BED__||{x:220,y:220},r=Math.max(10,Math.min(60,t.cubeSize||20)),s=Math.max(.08,Math.min(.4,t.layerHeight||.2)),i=Math.max(1,Math.min(5,t.perimeters||2)),n=Math.max(2,Math.min(10,t.solidLayers||4)),l=Math.max(0,Math.min(100,t.infill||15)),c=Math.max(10,Math.min(150,t.printSpeed||50)),o=Math.round(c*60),d=Math.max(0,t.hotendTemp||205),m=Math.max(0,t.bedTemp||60),x=20,h=Math.min(Math.max(x+r/2,a.x/2),a.x-x-r/2),f=Math.min(Math.max(x+r/2,a.y/2),a.y-x-r/2),y=(h-r/2).toFixed(3),g=(h+r/2).toFixed(3),p=(f-r/2).toFixed(3),b=(f+r/2).toFixed(3);let w="";w+=`; Calibration Cube ${r}mm
G90
M82
M106 S0
`,w+=`M140 S${m}
M190 S${m}
`,w+=`M104 S${d}
M109 S${d}
`,w+=`G28
G1 Z3 F1200
G92 E0
`;const _=Math.max(x,h-r).toFixed(2),A=Math.max(x,f-30).toFixed(2),C=Math.min(a.y-x,f+30).toFixed(2);w+=`G1 X${_} Y${A} F9000
G1 Z${s.toFixed(3)} F1200
G1 E2 F1500
G92 E0
`,w+=`G1 Y${C} E6 F${o}
G92 E0
`;const T=Math.max(1,Math.round(r/s)),G=.8;let E=s;for(let k=0;k<T;k++){w+=`; Layer ${k+1}/${T}
`,w+=`G1 Z${E.toFixed(3)} F1200
`;for(let R=0;R<i;R++){const I=R*.4,J=(parseFloat(y)+I).toFixed(3),ce=(parseFloat(g)-I).toFixed(3),q=(parseFloat(p)+I).toFixed(3),ne=(parseFloat(b)-I).toFixed(3);w+=`G92 E0
G1 X${J} Y${q} F9000
`,w+=`G1 X${ce} Y${q} E${G.toFixed(3)} F${o}
`,w+=`G1 X${ce} Y${ne} E${(G*2).toFixed(3)}
`,w+=`G1 X${J} Y${ne} E${(G*3).toFixed(3)}
`,w+=`G1 X${J} Y${q} E${(G*4).toFixed(3)}
`}if(!(k<n||k>=T-n)&&l>0){const R=Math.max(2,Math.floor(r/2));for(let I=0;I<R;I++){const J=I/(R-1),ce=(parseFloat(p)+.6+J*(r-1.2)).toFixed(3),q=I%2===0,ne=q?y:g,Q=q?g:y;w+=`G1 X${ne} Y${ce} F9000
G92 E0
`,w+=`G1 X${Q} Y${ce} E${(r*.04*(l/100)).toFixed(3)} F${o}
`}}E+=s}return w+=`M106 S0
M104 S0
M140 S0
G1 Z${(E+5).toFixed(2)} F1200
M84
`,w}},{id:"speed-calibration",title:"Speed Calibration",name:"Speed Calibration",description:"Print progressive speed lines to find the fastest reliable print speed without artifacts",requiresSave:!1,category:"Speed",videoUrl:"https://www.youtube-nocookie.com/embed/U9B6hVZ7S9U",instructions:["This test draws multiple line passes at increasing speeds across the bed.","Inspect for under-extrusion, ringing, or missed steps as speed increases.","Choose the highest speed with acceptable quality and no skipped steps."],visualAids:[],commonIssues:[{issue:"Ringing/ghosting",solution:"Lower acceleration/jerk and top speed, improve frame rigidity."},{issue:"Under-extrusion at high speed",solution:"Increase temperature slightly or reduce speed."},{issue:"Layer shifts",solution:"Reduce speed or acceleration; check belt tension and stepper current."}],expectedOutcomes:"Clear determination of maximum usable speed without major artifacts.",checklist:["Belts tensioned and pulleys tight","Nozzle and extruder in good condition","Filament dry and consistent"],inputs:[{type:"number",label:"Start Speed (mm/s)",key:"startSpeed",defaultValue:40,min:10,max:175,step:5,required:!0},{type:"number",label:"End Speed (mm/s)",key:"endSpeed",defaultValue:120,min:20,max:300,step:5,required:!0},{type:"number",label:"Speed Step (mm/s)",key:"stepSpeed",defaultValue:10,min:5,max:50,step:5,required:!0},{type:"number",label:"Line Length (mm)",key:"lineLength",defaultValue:160,min:60,max:220,step:10,required:!0},{type:"number",label:"Hotend Temp (°C)",key:"hotendTemp",defaultValue:210,min:170,max:280,step:5,required:!0},{type:"number",label:"Bed Temp (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0}],gcode:async t=>{const{startSpeed:a,endSpeed:r,stepSpeed:s,lineLength:i,hotendTemp:n,bedTemp:l}=t,c={bedTemp:l||50,hotendTemp:n||240,finalHotendTemp:n||240,layerHeight:.28,retractionDistance:6,retractionSpeed:2700,printSpeed:1500,travelSpeed:7500,enableABL:!1,restoreABL:!1};try{const o=await Mt("speed-calibration",c);let d=`; Speed Calibration
`;return d+=`; Speed range: ${a||40} to ${r||120} mm/s (step: ${s||10} mm/s)
`,d+=`; Line length: ${i||160} mm
`,d+=`; Hotend: ${n||240}°C, Bed: ${l||50}°C

`,d+=`; This test prints progressive speed lines to find maximum reliable speed
`,d+=`; Inspect for under-extrusion, ringing, or missed steps as speed increases
`,d+=`; Choose the highest speed with acceptable quality and no skipped steps

`,d+=o.gcode,d}catch(o){return console.error("Error generating parameterized G-code:",o),`; Speed Calibration
; Speed range: ${a||40} to ${r||120} mm/s
; Line length: ${i||160} mm
; Hotend: ${n||240}°C, Bed: ${l||50}°C
; Print speed test lines and inspect for quality issues`}}});const Jo=u.memo(({onBackToDashboard:t})=>{var g,p,b;const[a,r]=u.useState("config");za();const s=yr(),{status:i,sendCommand:n}=Ts(),l=s(),c=u.useMemo(()=>({serialStatus:i,sendCommand:n}),[i,n]),o=[{id:"monitor",name:"Print Monitor",icon:hi,description:"Monitor and control active prints",component:()=>window.location.href="#/control"},{id:"calibration-workflow",name:"Calibration Workflow",icon:ra,description:"Guided step-by-step calibration process",component:()=>window.location.href="#/calibration"},{id:"config",name:"Printer Configuration",icon:Se,description:"Basic printer settings and information",component:ha},{id:"profilesMaterials",name:"Profiles & Materials",icon:De,description:"Manage slicer profiles and materials together",component:Do,category:"Profiles"},{id:"firmwareConfig",name:"Firmware Configuration",icon:De,description:"Parse and analyze Marlin firmware files",component:Ml},{id:"control",name:"Control",icon:pi,description:"Manual control for movement, temperatures, extrusion, and more",component:qo,category:"Diagnostics"},{id:"serial",name:"Terminal",icon:gi,description:"USB serial connection and G-code terminal",component:zo,category:"Diagnostics"},{id:"issueTracker",name:"Issue Tracker",icon:Te,description:"Track and manage printer issues and diagnostics",component:no,category:"Diagnostics"},...Xe.map(w=>({id:w.id,name:w.title,icon:w.category==="Temperature"?$e:w.category==="Movement"?ra:w.category==="Quality"?Se:Ye,description:w.description,component:()=>e.jsx(Kl,{step:w,onComplete:d,...c}),category:w.category}))];if(!l)return e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-800 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ot,{className:"h-16 w-16 text-gray-300 dark:text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Printer Selected"}),e.jsx("button",{onClick:t,className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})]})});const d=w=>{console.log(`Calibration step ${w} completed`)},m=w=>{var A,C;if(w==="config")return"available";if(w==="firmwareConfig"){const M=(A=l.calibrationSteps)==null?void 0:A.firmwareConfig;return M?M.completed?"completed":"in-progress":"pending"}const _=(C=l.calibrationSteps)==null?void 0:C[w];return _?_.completed?"completed":"in-progress":"pending"},x=w=>{if(Xe.some(C=>C.id===w)){const C=m(w);return C==="completed"?Ee:C==="in-progress"?ls:ls}const A=o.find(C=>C.id===w);return(A==null?void 0:A.icon)||ls},h=w=>{if(Xe.some(A=>A.id===w)){const A=m(w);return A==="completed"?"text-green-500":A==="in-progress"?"text-yellow-500":"text-gray-400 dark:text-gray-500"}return"text-gray-600 dark:text-gray-300"},f=((g=o.find(w=>w.id===a))==null?void 0:g.component)||ha,y=o.reduce((w,_)=>{if(_.id==="config"||_.id==="firmwareConfig")w.Configuration||(w.Configuration=[]),w.Configuration.push(_);else{const A=_.category||"Other";w[A]||(w[A]=[]),w[A].push(_)}return w},{});return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-800 dark:bg-gray-900 flex",children:[e.jsxs("div",{className:"w-64 bg-white dark:bg-gray-800 shadow-lg border-r border-gray-200 dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:t,className:"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(pr,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vr,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:l.name})]}),e.jsx(Nr,{})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:l.model}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:l.firmware})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"space-y-4",children:Object.entries(y).map(([w,_])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:w}),e.jsx("div",{className:"space-y-2",children:_.map(A=>{const C=x(A.id),M=h(A.id),T=a===A.id;return e.jsxs("button",{onClick:()=>r(A.id),className:`w-full flex items-center space-x-3 p-3 rounded-lg text-left transition-colors ${T?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(C,{className:`h-5 w-5 ${M}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:A.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:A.description})]})]},A.id)})})]},w))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(fi,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"3D Printer Suite"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:l.calibrationSteps&&`${Object.values(l.calibrationSteps).filter(w=>w==null?void 0:w.completed).length}/${Object.keys(l.calibrationSteps).length} steps completed`})]})})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:(p=o.find(w=>w.id===a))==null?void 0:p.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:(b=o.find(w=>w.id===a))==null?void 0:b.description})]})}),e.jsx("div",{className:"p-6",children:e.jsx(f,{})})]})]})},(t,a)=>t.onBackToDashboard===a.onBackToDashboard&&t.selectedStep===a.selectedStep);/**
  * @reach/utils v0.18.0
  *
  * Copyright (c) 2018-2022, React Training LLC
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE.md file in the root directory of this source tree.
  *
  * @license MIT
  */function cn(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function ur(t,a){return r=>{if(t&&t(r),!r.defaultPrevented)return a(r)}}function ec(t){return typeof t=="boolean"}function us(t){return!!(t&&{}.toString.call(t)=="[object Function]")}function tc(t,a){if(t!=null)if(us(t))t(a);else try{t.current=a}catch{throw new Error(`Cannot assign value "${a}" to ref "${t}"`)}}function Cs(...t){return u.useCallback(a=>{for(let r of t)tc(r,a)},t)}function dn(t){return cn()?t?t.ownerDocument:document:null}function sc(t){let a=dn(t);return a?a.defaultView||window:null}function rc(t){let a=sc(t);return a?a.getComputedStyle(t,null):null}function ac(t,a){var r;return((r=rc(t))==null?void 0:r.getPropertyValue(a))||null}function nc(t,a){let r=u.createContext(a);function s(n){let{children:l,...c}=n,o=u.useMemo(()=>c,Object.values(c));return u.createElement(r.Provider,{value:o},l)}function i(n){let l=u.useContext(r);if(l)return l;if(a)return a;throw Error(`${n} must be rendered inside of a ${t} component.`)}return r.displayName=`${t}Context`,s.displayName=`${t}Provider`,[s,i]}function vs(...t){return t.filter(a=>a!=null).join("--")}function Ns(){}function ic({controlledValue:t,defaultValue:a,calledFrom:r="A component"}){let s=t!==void 0,i=u.useRef(s);!i.current&&s&&console.warn(`${r} is changing from controlled to uncontrolled. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),i.current&&!s&&console.warn(`${r} is changing from uncontrolled to controlled. Components should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`);let[n,l]=u.useState(i.current?t:a),c=u.useCallback(o=>{i.current||l(o)},[]);return[i.current?t:n,c]}function lc(){let[,t]=u.useState(Object.create(null));return u.useCallback(()=>{t(Object.create(null))},[])}var Sr=cn()?u.useLayoutEffect:u.useEffect;function mn(t,a){let[r,s]=u.useState(a),i=u.useCallback(n=>{t.current=n,s(n)},[]);return[r,i]}function un(t,a={}){const r=[];let s=u.createContext({descendants:r,registerDescendant:()=>Ns,...a});return s.displayName=t,s}function xn(t,a,r){let s=lc(),{registerDescendant:i,descendants:n}=u.useContext(a),l=r??n.findIndex(c=>c.element===t.element);return Sr(()=>(t.element||s(),i({...t,index:l})),[t,s,l,i,...Object.values(t)]),l}function hn(){return u.useState([])}function oc(t){return u.useContext(t).descendants}function pn({context:t,children:a,items:r,set:s}){let i=u.useCallback(({element:n,index:l,...c})=>n?(s(o=>{if(l!=null&&l!==-1)return wa(o,{element:n,index:l,...c},l);if(o.length===0)return[{...c,element:n,index:0}];if(o.find(x=>x.element===n))return console.warn(`[reach-ui]: \`useDescendant\` was called with an element that was already registered.

If you are using the \`@reach/descendants\` package directly, make sure to only register descendants once. Registering a descendant more than once will lead to bugs in your app.

If you are using another \`reach-ui\` package, this is probably our bug!

To report a bug, open a new issue:

  https://github.com/reach/reach-ui/issues/new?assignees=&labels=&template=Bug_report.md

IMPORTANT: this check will only run in the development build, so if you see this warning please be aware that your app may crash when deployed.`),mc(o);let d=dc(o,n),m;return d===-1?m=[...o,{...c,element:n,index:o.length}]:m=wa(o,{...c,element:n,index:d},d),m}),()=>{n&&s(o=>o.filter(d=>n!==d.element))}):Ns,[]);return u.createElement(t.Provider,{value:u.useMemo(()=>({descendants:r,registerDescendant:i}),[r,i])},a)}function cc(t,a){let{descendants:r}=u.useContext(t),{callback:s,currentIndex:i,filter:n,key:l="index",orientation:c="vertical",rotate:o=!0,rtl:d=!1}=a;return function(x){if(!["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(x.key))return;let h=i??-1,f=n?r.filter(n):r;if(!f.length)return;let y=f.findIndex(_=>_.index===i);function g(){return h===w().index?o?b():f[y]:f[(y+1)%f.length]}function p(){return h===b().index?o?w():f[y]:f[(y-1+f.length)%f.length]}function b(){return f[0]}function w(){return f[f.length-1]}switch(x.key){case"ArrowDown":if(c==="vertical"||c==="both"){x.preventDefault();let T=g();s(l==="option"?T:T[l])}break;case"ArrowUp":if(c==="vertical"||c==="both"){x.preventDefault();let T=p();s(l==="option"?T:T[l])}break;case"ArrowLeft":if(c==="horizontal"||c==="both"){x.preventDefault();let T=(d?g:p)();s(l==="option"?T:T[l])}break;case"ArrowRight":if(c==="horizontal"||c==="both"){x.preventDefault();let T=(d?p:g)();s(l==="option"?T:T[l])}break;case"PageUp":x.preventDefault();let _=(x.ctrlKey?p:b)();s(l==="option"?_:_[l]);break;case"Home":x.preventDefault();let A=b();s(l==="option"?A:A[l]);break;case"PageDown":x.preventDefault();let C=(x.ctrlKey?g:w)();s(l==="option"?C:C[l]);break;case"End":x.preventDefault();let M=w();s(l==="option"?M:M[l]);break}}}function gn(t,a){return!!(a.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING)}function dc(t,a){if(!a||!t.length)return-1;let r=t.length;for(;r--;){let s=t[r].element;if(s&&gn(s,a))return r+1}return-1}function wa(t,a,r){return r==null||!(r in t)?[...t,a]:[...t.slice(0,r),a,...t.slice(r)]}function mc(t){return t.sort((a,r)=>!a.element||!r.element?0:gn(a.element,r.element)?-1:1).map((a,r)=>({...a,index:r}))}var ir=!1,uc=0;function Ea(){return++uc}var Sa=bi["useId".toString()];function xc(t){if(Sa!==void 0){let i=Sa();return t??i}let a=t??(ir?Ea():null),[r,s]=u.useState(a);return Sr(()=>{r===null&&s(Ea())},[]),u.useEffect(()=>{ir===!1&&(ir=!0)},[]),t??r??void 0}var js=un("TabsDescendantsContext"),fn=un("TabPanelDescendantsContext"),[hc,_r]=nc("Tabs"),bn=u.forwardRef(({as:t="div",children:a,defaultIndex:r,orientation:s="horizontal",index:i=void 0,keyboardActivation:n="auto",onChange:l,readOnly:c=!1,...o},d)=>{let{current:m}=u.useRef(i!==void 0),x=xc(o.id||"tabs"),h=u.useRef(null),f=u.useRef(!1),[y,g]=ic({controlledValue:i,defaultValue:r??0,calledFrom:"Tabs"}),[p,b]=u.useState(-1),[w,_]=hn(),A=u.useCallback(()=>{h.current&&us(h.current.focus)&&h.current.focus()},[]),C=u.useCallback(T=>{l&&l(T),g(T)},[l,g]),M=u.useCallback(T=>{var k;let G=(k=w[T])==null?void 0:k.element,E=dn(G);n==="auto"&&(l&&l(T),g(T)),G&&G!==E.activeElement&&us(G.focus)&&G.focus()},[n,l,g,w]);return u.createElement(pn,{context:js,items:w,set:_},u.createElement(hc,{focusedIndex:p,id:x,isControlled:m,isRTL:f,keyboardActivation:n,onFocusPanel:A,onSelectTab:c?Ns:C,onSelectTabWithKeyboard:c?Ns:M,orientation:s,selectedIndex:y,selectedPanelRef:h,setFocusedIndex:b,setSelectedIndex:g},u.createElement(t,{...o,ref:d,"data-reach-tabs":"","data-orientation":s,id:o.id},us(a)?a({focusedIndex:p,id:x,selectedIndex:y}):a)))});bn.displayName="Tabs";var yn=u.forwardRef(({children:t,as:a="div",onKeyDown:r,...s},i)=>{let{focusedIndex:n,isControlled:l,isRTL:c,keyboardActivation:o,onSelectTabWithKeyboard:d,orientation:m,selectedIndex:x,setSelectedIndex:h}=_r("TabList"),f=oc(js),y=u.useRef(null),g=Cs(i,y);u.useEffect(()=>{y.current&&(y.current.ownerDocument&&y.current.ownerDocument.dir==="rtl"||ac(y.current,"direction")==="rtl")&&(c.current=!0)},[c]);let p=ur(r,cc(js,{currentIndex:o==="manual"?n:x,orientation:m,rotate:!0,callback:d,filter:b=>!b.disabled,rtl:c.current}));return Sr(()=>{var b;if(!l&&gc((b=f[x])==null?void 0:b.disabled)){let w=f.find(_=>!_.disabled);w&&h(w.index)}},[f,l,x,h]),u.createElement(a,{role:"tablist","aria-orientation":m,...s,"data-reach-tab-list":"",ref:g,onKeyDown:p},t)});yn.displayName="TabList";var vn=u.memo(yn);vn.displayName="TabList";var ot=u.forwardRef(({isSelected:t,children:a,as:r="button",index:s,disabled:i,onBlur:n,onFocus:l,...c},o)=>{let{id:d,onSelectTab:m,orientation:x,selectedIndex:h,setFocusedIndex:f}=_r("Tab"),y=u.useRef(null),[g,p]=mn(y,null),b=Cs(o,p),w=u.useMemo(()=>({element:g,disabled:!!i}),[i,g]),_=xn(w,js,s),A=r==="button"&&c.type==null?"button":c.type,C=_===h;function M(){m(_)}return u.createElement(r,{"aria-controls":vs(d,"panel",_),"aria-disabled":i,"aria-selected":C,role:"tab",tabIndex:C?0:-1,...c,ref:b,"data-reach-tab":"","data-orientation":x,"data-selected":C?"":void 0,disabled:i,id:vs(d,"tab",_),onClick:M,onFocus:ur(l,()=>{f(_)}),onBlur:ur(n,()=>{f(-1)}),type:A},a)});ot.displayName="Tab";var Nn=u.forwardRef(({children:t,as:a="div",...r},s)=>{let i=u.useRef(),n=Cs(i,s),[l,c]=hn();return u.createElement(pn,{context:fn,items:l,set:c},u.createElement(a,{...r,ref:n,"data-reach-tab-panels":""},t))});Nn.displayName="TabPanels";var pc=u.memo(Nn);pc.displayName="TabPanels";var ct=u.forwardRef(({children:t,"aria-label":a,as:r="div",index:s,...i},n)=>{let{selectedPanelRef:l,selectedIndex:c,id:o}=_r("TabPanel"),d=u.useRef(null),[m,x]=mn(d,null),h=u.useMemo(()=>({element:m}),[m]),f=xn(h,fn,s),y=vs(o,"panel",f),g=f===c,p=u.useRef(!1),b=p.current?!g:!1;u.useEffect(()=>{p.current=!0},[]);let w=Cs(n,x,g?l:null);return u.createElement(r,{"aria-labelledby":vs(o,"tab",f),hidden:b,role:"tabpanel",tabIndex:g?0:-1,...i,ref:w,"data-reach-tab-panel":"",id:y},t)});ct.displayName="TabPanel";function gc(t){return t==="true"?!0:ec(t)?t:!1}function fc(){const{sendCommand:t}=Ts(),{updatePrintProgress:a}=tt(),r=u.useRef({active:!1,paused:!1,linesSent:0,totalLines:0,buffer:[],waitingForResponse:!1,currentFileId:null}),s=u.useCallback(async()=>{const m=r.current;if(!(!m.active||m.paused||m.waitingForResponse))try{if(m.buffer.length===0){a(100),o();return}const x=m.buffer.shift();m.waitingForResponse=!0,await t(x),m.linesSent++;const h=m.linesSent/m.totalLines*100;a(h),setTimeout(()=>{m.waitingForResponse=!1,s()},50)}catch(x){throw console.error("Error streaming G-code:",x),o(),x}},[t,a]),i=u.useCallback(async(m,x)=>{if(r.current.active)throw new Error("Already streaming G-code");try{const h=x.split(`
`).map(f=>f.trim()).filter(f=>f&&!f.startsWith(";"));r.current={active:!0,paused:!1,linesSent:0,totalLines:h.length,buffer:h,waitingForResponse:!1,currentFileId:m},await s()}catch(h){throw o(),h}},[s]),n=u.useCallback(()=>{r.current.active&&(r.current.paused=!0)},[]),l=u.useCallback(()=>{r.current.active&&(r.current.paused=!1,s())},[s]),c=u.useCallback(()=>{r.current.active&&o()},[]),o=u.useCallback(()=>{r.current={active:!1,paused:!1,linesSent:0,totalLines:0,buffer:[],waitingForResponse:!1,currentFileId:null}},[]),d=u.useCallback(()=>{const{active:m,paused:x,linesSent:h,totalLines:f,currentFileId:y}=r.current;return{active:m,paused:x,progress:f?h/f*100:0,currentFileId:y}},[]);return{streamGcode:i,pauseStreaming:n,resumeStreaming:l,stopStreaming:c,getStreamingStatus:d}}const bc=()=>{var k;const{gcodeFiles:t,printQueue:a,activePrint:r,removeFromQueue:s,updateQueueOrder:i,startPrint:n,pausePrint:l,resumePrint:c,stopPrint:o,completePrint:d}=tt(),{status:m}=Ts(),{streamGcode:x,pauseStreaming:h,resumeStreaming:f,stopStreaming:y,getStreamingStatus:g}=fc(),p=u.useCallback(async N=>{if(m!=="connected"){alert("Please connect to the printer first");return}const R=t.find(I=>I.id===N);if(R)try{n(N),await x(N,R.content)}catch(I){console.error("Failed to start print:",I),o()}},[m,t,n,x,o]),b=u.useCallback(()=>{l(),h()},[l,h]),w=u.useCallback(()=>{c(),f()},[c,f]),_=u.useCallback(()=>{o(),y()},[o,y]);u.useEffect(()=>{const R=setInterval(()=>{const I=g();I.active&&r&&I.progress>=100&&d()},1e3);return()=>clearInterval(R)},[r,d,g]);const A=(N,R)=>{N.dataTransfer.setData("text/plain",R)},C=N=>{N.preventDefault()},M=u.useCallback((N,R)=>{N.preventDefault();const I=N.dataTransfer.getData("text/plain"),J=a.map(Q=>Q.fileId),ce=J.indexOf(I),q=J.indexOf(R);if(ce===-1||q===-1)return;const ne=[...J];ne.splice(ce,1),ne.splice(q,0,I),i(ne)},[a,i]),T=N=>N?new Date(N).toLocaleTimeString():"",G=N=>{if(!N)return"Unknown";const R=Math.floor(N/3600),I=Math.floor(N%3600/60);return`${R}h ${I}m`},E=N=>{switch(N){case"printing":return"text-green-500";case"paused":return"text-yellow-500";case"completed":return"text-blue-500";case"failed":return"text-red-500";default:return"text-gray-500"}};return e.jsxs("div",{className:"w-full space-y-4",children:[r&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Currently Printing"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:(k=t.find(N=>N.id===r.fileId))==null?void 0:k.name}),e.jsx("span",{className:E(r.status),children:r.status.charAt(0).toUpperCase()+r.status.slice(1)})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${r.progress}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:["Started: ",T(r.startTime)]}),e.jsxs("span",{children:["Est. completion: ",T(r.estimatedEndTime)]})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[r.status==="printing"?e.jsx("button",{onClick:b,className:"px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600",children:"Pause"}):e.jsx("button",{onClick:w,className:"px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600",children:"Resume"}),e.jsx("button",{onClick:_,className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"Stop"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Print Queue"})}),e.jsxs("div",{className:"divide-y",children:[a.map(N=>{const R=t.find(I=>I.id===N.fileId);return R?e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",draggable:!0,onDragStart:I=>A(I,N.fileId),onDragOver:C,onDrop:I=>M(I,N.fileId),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:R.name}),e.jsx("span",{className:`ml-2 text-sm ${E(N.status)}`,children:N.status})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("span",{children:["Size: ",(R.size/1024/1024).toFixed(2)," MB"]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:["Est. time: ",G(R.estimatedPrintTime)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N.status==="queued"&&!r&&e.jsx("button",{onClick:()=>p(N.fileId),disabled:m!=="connected",className:`p-2 ${m==="connected"?"text-green-500 hover:bg-green-50":"text-gray-400 cursor-not-allowed"} rounded`,children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("button",{onClick:()=>s(N.fileId),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},N.fileId):null}),a.length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No files in queue"})]})]})]})},yc=()=>{const t=Va(),a=Yi(),{addFolder:r,updateFolder:s,deleteFolder:i}=Zi(),[n,l]=u.useState(""),[c,o]=u.useState(new Set),[d,m]=u.useState(null),[x,h]=u.useState(!1),[f,y]=u.useState(""),[g,p]=u.useState("name"),[b,w]=u.useState("asc"),[_,A]=u.useState([]),C=u.useMemo(()=>{const N=new Set;return t.forEach(R=>{var I;(I=R.tags)==null||I.forEach(J=>N.add(J))}),Array.from(N)},[t]),M=u.useMemo(()=>t.filter(N=>d&&N.folder!==d||n&&!N.name.toLowerCase().includes(n.toLowerCase())?!1:_.length>0?_.every(R=>{var I;return(I=N.tags)==null?void 0:I.includes(R)}):!0).sort((N,R)=>{let I=0;switch(g){case"name":I=N.name.localeCompare(R.name);break;case"date":I=new Date(R.uploadDate)-new Date(N.uploadDate);break;case"size":I=N.size-R.size;break;default:I=0}return b==="asc"?I:-I}),[t,d,n,_,g,b]),T=u.useMemo(()=>{const N=[];let R=d;for(;R;){const I=a.find(J=>J.id===R);if(I)N.unshift(I),R=I.parentId;else break}return N},[d,a]),G=()=>{f.trim()&&(r(f.trim(),d),y(""),h(!1))},E=N=>{},k=N=>N<1024?`${N} B`:N<1024*1024?`${(N/1024).toFixed(1)} KB`:`${(N/(1024*1024)).toFixed(1)} MB`;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search files...",value:n,onChange:N=>l(N.target.value),className:"w-full p-2 border rounded"})}),e.jsx("div",{className:"relative",children:e.jsx("select",{multiple:!0,value:_,onChange:N=>{const R=Array.from(N.target.selectedOptions,I=>I.value);A(R)},className:"p-2 border rounded",children:C.map(N=>e.jsx("option",{value:N,children:N},N))})}),e.jsxs("select",{value:g,onChange:N=>p(N.target.value),className:"p-2 border rounded",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"size",children:"Size"})]}),e.jsx("button",{onClick:()=>w(N=>N==="asc"?"desc":"asc"),className:"p-2 text-gray-500 hover:text-gray-700",children:b==="asc"?"↑":"↓"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"New Folder"})})]})}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("button",{onClick:()=>m(null),className:"text-blue-500 hover:text-blue-600",children:"Root"}),T.map((N,R)=>e.jsxs(Ce.Fragment,{children:[e.jsx("span",{children:"/"}),e.jsx("button",{onClick:()=>m(N.id),className:"text-blue-500 hover:text-blue-600",children:N.name})]},N.id))]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:c.size===M.length,onChange:N=>{N.target.checked?o(new Set(M.map(R=>R.id))):o(new Set)},className:"rounded"}),e.jsxs("span",{className:"font-medium",children:[c.size," selected"]})]}),c.size>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>E(),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded",children:"Move"}),e.jsx("button",{onClick:()=>E(),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded",children:"Tag"}),e.jsx("button",{onClick:()=>E(),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded",children:"Add to Queue"}),e.jsx("button",{onClick:()=>E(),className:"px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded",children:"Delete"})]})]})}),e.jsxs("div",{className:"divide-y",children:[a.filter(N=>N.parentId===d).map(N=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),e.jsx("button",{onClick:()=>m(N.id),className:"font-medium hover:text-blue-500",children:N.name})]}),e.jsx("button",{onClick:()=>i(N.id),className:"text-red-500 hover:text-red-600",children:"Delete"})]},N.id)),M.map(N=>{var R;return e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:c.has(N.id),onChange:I=>{const J=new Set(c);I.target.checked?J.add(N.id):J.delete(N.id),o(J)},className:"rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:N.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[k(N.size)," • ",new Date(N.uploadDate).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(R=N.tags)==null?void 0:R.map(I=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:I},I))})]})},N.id)}),M.length===0&&a.filter(N=>N.parentId===d).length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No files or folders found"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New Folder"}),e.jsx("input",{type:"text",value:f,onChange:N=>y(N.target.value),placeholder:"Folder name",className:"w-full p-2 border rounded mb-4"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Create"})]})]})})]})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jn=Symbol("Comlink.proxy"),vc=Symbol("Comlink.endpoint"),Nc=Symbol("Comlink.releaseProxy"),lr=Symbol("Comlink.finalizer"),xs=Symbol("Comlink.thrown"),wn=t=>typeof t=="object"&&t!==null||typeof t=="function",jc={canHandle:t=>wn(t)&&t[jn],serialize(t){const{port1:a,port2:r}=new MessageChannel;return Sn(t,a),[r,[r]]},deserialize(t){return t.start(),Tn(t)}},wc={canHandle:t=>wn(t)&&xs in t,serialize({value:t}){let a;return t instanceof Error?a={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:a={isError:!1,value:t},[a,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},En=new Map([["proxy",jc],["throw",wc]]);function Ec(t,a){for(const r of t)if(a===r||r==="*"||r instanceof RegExp&&r.test(a))return!0;return!1}function Sn(t,a=globalThis,r=["*"]){a.addEventListener("message",function s(i){if(!i||!i.data)return;if(!Ec(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:n,type:l,path:c}=Object.assign({path:[]},i.data),o=(i.data.argumentList||[]).map(Qe);let d;try{const m=c.slice(0,-1).reduce((h,f)=>h[f],t),x=c.reduce((h,f)=>h[f],t);switch(l){case"GET":d=x;break;case"SET":m[c.slice(-1)[0]]=Qe(i.data.value),d=!0;break;case"APPLY":d=x.apply(m,o);break;case"CONSTRUCT":{const h=new x(...o);d=Rc(h)}break;case"ENDPOINT":{const{port1:h,port2:f}=new MessageChannel;Sn(t,f),d=Cc(h,[h])}break;case"RELEASE":d=void 0;break;default:return}}catch(m){d={value:m,[xs]:0}}Promise.resolve(d).catch(m=>({value:m,[xs]:0})).then(m=>{const[x,h]=Ss(m);a.postMessage(Object.assign(Object.assign({},x),{id:n}),h),l==="RELEASE"&&(a.removeEventListener("message",s),_n(a),lr in t&&typeof t[lr]=="function"&&t[lr]())}).catch(m=>{const[x,h]=Ss({value:new TypeError("Unserializable return value"),[xs]:0});a.postMessage(Object.assign(Object.assign({},x),{id:n}),h)})}),a.start&&a.start()}function Sc(t){return t.constructor.name==="MessagePort"}function _n(t){Sc(t)&&t.close()}function Tn(t,a){const r=new Map;return t.addEventListener("message",function(i){const{data:n}=i;if(!n||!n.id)return;const l=r.get(n.id);if(l)try{l(n)}finally{r.delete(n.id)}}),xr(t,r,[],a)}function rs(t){if(t)throw new Error("Proxy has been released and is not useable")}function Pn(t){return dt(t,new Map,{type:"RELEASE"}).then(()=>{_n(t)})}const ws=new WeakMap,Es="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const a=(ws.get(t)||0)-1;ws.set(t,a),a===0&&Pn(t)});function _c(t,a){const r=(ws.get(a)||0)+1;ws.set(a,r),Es&&Es.register(t,a,t)}function Tc(t){Es&&Es.unregister(t)}function xr(t,a,r=[],s=function(){}){let i=!1;const n=new Proxy(s,{get(l,c){if(rs(i),c===Nc)return()=>{Tc(n),Pn(t),a.clear(),i=!0};if(c==="then"){if(r.length===0)return{then:()=>n};const o=dt(t,a,{type:"GET",path:r.map(d=>d.toString())}).then(Qe);return o.then.bind(o)}return xr(t,a,[...r,c])},set(l,c,o){rs(i);const[d,m]=Ss(o);return dt(t,a,{type:"SET",path:[...r,c].map(x=>x.toString()),value:d},m).then(Qe)},apply(l,c,o){rs(i);const d=r[r.length-1];if(d===vc)return dt(t,a,{type:"ENDPOINT"}).then(Qe);if(d==="bind")return xr(t,a,r.slice(0,-1));const[m,x]=_a(o);return dt(t,a,{type:"APPLY",path:r.map(h=>h.toString()),argumentList:m},x).then(Qe)},construct(l,c){rs(i);const[o,d]=_a(c);return dt(t,a,{type:"CONSTRUCT",path:r.map(m=>m.toString()),argumentList:o},d).then(Qe)}});return _c(n,t),n}function Pc(t){return Array.prototype.concat.apply([],t)}function _a(t){const a=t.map(Ss);return[a.map(r=>r[0]),Pc(a.map(r=>r[1]))]}const Cn=new WeakMap;function Cc(t,a){return Cn.set(t,a),t}function Rc(t){return Object.assign(t,{[jn]:!0})}function Ss(t){for(const[a,r]of En)if(r.canHandle(t)){const[s,i]=r.serialize(t);return[{type:"HANDLER",name:a,value:s},i]}return[{type:"RAW",value:t},Cn.get(t)||[]]}function Qe(t){switch(t.type){case"HANDLER":return En.get(t.name).deserialize(t.value);case"RAW":return t.value}}function dt(t,a,r,s){return new Promise(i=>{const n=Mc();a.set(n,i),t.start&&t.start(),t.postMessage(Object.assign({id:n},r),s)})}function Mc(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class kc{constructor(a){this.originalData=a,this.lodLevels=new Map,this.generateLodLevels()}generateLodLevels(){const a=[{level:0,sampleRate:1},{level:1,sampleRate:2},{level:2,sampleRate:4},{level:3,sampleRate:8},{level:4,sampleRate:16}];for(const r of a)this.lodLevels.set(r.level,this.generateLodLevel(r.sampleRate))}generateLodLevel(a){return{layers:this.originalData.layers.map(s=>{const i=[],n=[],l=[];for(let c=0;c<s.points.length;c+=6*a){i.push(s.points[c],s.points[c+1],s.points[c+2]),c+3<s.points.length&&i.push(s.points[c+3],s.points[c+4],s.points[c+5]);const o=i.length/3-2;o>=0&&n.push(o,o+1),l.push(s.moveTypes[Math.floor(c/6)])}return{...s,points:i,lines:n,moveTypes:l}}),bounds:this.originalData.bounds,stats:{...this.originalData.stats,totalPoints:Math.ceil(this.originalData.stats.totalPoints/a)}}}getLodLevel(a,r){this.originalData.stats.totalPoints/r;const s=r/a;return s>2?0:s>1?1:s>.5?2:s>.25?3:4}getGeometryForDistance(a,r){const s=this.getLodLevel(a,r);return this.lodLevels.get(s)||this.originalData}}const Rn=new Worker(new URL("/assets/gcode.worker-eb76017b.js",self.location),{type:"module"}),Ac=Tn(Rn),Ic={travel:new ut(8421504),extrude:new ut(65280),retract:new ut(16711680)},Dc=({geometryData:t,visibleLayers:a,showTravelMoves:r})=>{const{camera:s,size:i}=Si(),[n,l]=u.useState(t),c=u.useRef(null);return u.useEffect(()=>{t&&(c.current=new kc(t),l(t))},[t]),_i(()=>{if(!c.current)return;const o=s.position.distanceTo(new qe),d=c.current.getGeometryForDistance(o,Math.min(i.width,i.height));d!==n&&l(d)}),u.useEffect(()=>{if(t!=null&&t.bounds){const{min:o,max:d}=t.bounds,m=new qe((o.x+d.x)/2,(o.y+d.y)/2,(o.z+d.z)/2),x=new qe(d.x-o.x,d.y-o.y,d.z-o.z),h=Math.max(x.x,x.y,x.z),f=s.fov*(Math.PI/180),y=Math.abs(h/Math.sin(f/2)/2);s.position.set(m.x,m.y+y,m.z+y),s.lookAt(m),s.updateProjectionMatrix()}},[t,s]),n?e.jsxs(e.Fragment,{children:[e.jsx(Ti,{args:[1e3,1e3],position:[0,0,0],rotation:[-Math.PI/2,0,0],cellSize:10,cellThickness:.5,cellColor:"#606060",sectionSize:50,sectionThickness:1,sectionColor:"#808080",fadeDistance:1e3,fadeStrength:1}),n.layers.map((o,d)=>a.has(d)?o.points.map((m,x)=>{if(x%6!==0)return null;const h=o.moveTypes[x/6];if(h==="travel"&&!r)return null;const f=[new qe(o.points[x],o.points[x+1],o.points[x+2]),new qe(o.points[x+3],o.points[x+4],o.points[x+5])];return e.jsx(Ba,{points:f,color:Ic[h],lineWidth:h==="travel"?.5:2},`${d}-${x}`)}):null)]}):null},Ke=({content:t,width:a=800,height:r=600})=>{const[s,i]=u.useState(null),[n,l]=u.useState(!1),[c,o]=u.useState(0),[d,m]=u.useState(!0),x=u.useRef(null);u.useEffect(()=>((async()=>{try{console.log("GcodeViewer3D: Initializing worker..."),x.current=await new Ac,console.log("GcodeViewer3D: Worker initialized successfully")}catch(y){console.error("GcodeViewer3D: Error initializing worker:",y)}})(),()=>{x.current&&(console.log("GcodeViewer3D: Terminating worker"),Rn.terminate())}),[]),u.useEffect(()=>{(async()=>{if(console.log("GcodeViewer3D: Processing G-code, content length:",t==null?void 0:t.length,"worker ready:",!!x.current),!t||!x.current){console.log("GcodeViewer3D: Missing content or worker, skipping processing");return}l(!0);try{console.log("GcodeViewer3D: Starting G-code processing...");const y=await x.current.convertToGeometry(t,{sampleRate:1,simplifyThreshold:.1,maxPoints:1e6});console.log("GcodeViewer3D: Processing complete, result:",y),i(y),o(y.layers.length-1)}catch(y){console.error("GcodeViewer3D: Error processing G-code:",y)}finally{l(!1)}})()},[t]);const h=u.useMemo(()=>s?new Set(Array.from({length:c+1},(f,y)=>y)):new Set,[c,s]);return n?e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:r},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processing G-code..."})]})}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-black rounded-lg shadow-lg",style:{width:a,height:r},children:[e.jsxs(fr,{children:[e.jsx(wi,{}),e.jsx(Ei,{makeDefault:!0,position:[0,200,200]}),e.jsx(br,{enableDamping:!0,dampingFactor:.05}),e.jsx("ambientLight",{intensity:.5}),e.jsx("directionalLight",{position:[1,1,1],intensity:.8}),e.jsx(Dc,{geometryData:s,visibleLayers:h,showTravelMoves:d})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-white/90 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Layer: ",c+1," / ",(s==null?void 0:s.layers.length)||0]}),e.jsx("input",{type:"range",min:0,max:((s==null?void 0:s.layers.length)||1)-1,value:c,onChange:f=>o(parseInt(f.target.value)),className:"w-full"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:f=>m(f.target.checked),className:"rounded text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Show Travel Moves"})]})})]})]}),s&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Layers:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.stats.totalLayers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Points:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.stats.totalPoints})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Build Volume:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(s.bounds.max.x-s.bounds.min.x),"x",Math.round(s.bounds.max.y-s.bounds.min.y),"x",Math.round(s.bounds.max.z-s.bounds.min.z),"mm"]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:r},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500 mb-2",children:"No G-code data to visualize"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Generate G-code first to see 3D preview"})]})})},Mn=Object.freeze(Object.defineProperty({__proto__:null,GcodeViewer3D:Ke},Symbol.toStringTag,{value:"Module"})),Ta=128,as=32,Lc=3,Oc=1e4;function Fc(){const{sendCommand:t,status:a,temperatures:r,log:s}=Ts(),{activePrint:i,updatePrintProgress:n,pausePrint:l,resumePrint:c,completePrint:o,stopPrint:d,getFile:m}=tt(),[x,h]=u.useState({position:{x:0,y:0,z:0,e:0},bufferSpace:Ta,isPrinting:!1,isPaused:!1,isEmergencyStopped:!1,currentLine:0,lastResponse:"",retryCount:0,lastError:null}),f=u.useRef([]),y=u.useRef(null),g=u.useRef(null),p=u.useCallback(E=>{const k=E.match(/X:(-?\d+\.?\d*) Y:(-?\d+\.?\d*) Z:(-?\d+\.?\d*) E:(-?\d+\.?\d*)/);return k?{x:parseFloat(k[1]),y:parseFloat(k[2]),z:parseFloat(k[3]),e:parseFloat(k[4])}:null},[]),b=u.useCallback(E=>{if(y.current&&(clearTimeout(y.current),y.current=null),E.includes("ok")?(h(k=>({...k,bufferSpace:k.bufferSpace+as,lastResponse:E,retryCount:0,lastError:null})),_()):E.includes("Error")&&w(E),E.includes("X:")){const k=p(E);k&&h(N=>({...N,position:k}))}},[p]),w=u.useCallback(E=>{h(k=>{const N=k.retryCount+1;return N>=Lc?(T(`Max retries exceeded: ${E}`),{...k,lastError:E,isPrinting:!1,retryCount:0}):{...k,lastError:E,retryCount:N,bufferSpace:k.bufferSpace+as}})},[]),_=u.useCallback(async()=>{if(!(!x.isPrinting||x.isPaused||x.isEmergencyStopped)){if(f.current.length===0){o(),h(E=>({...E,isPrinting:!1,currentLine:0}));return}if(!(x.bufferSpace<as))try{const E=f.current[0];if(await t(E),y.current=setTimeout(()=>{w("Command timeout")},Oc),h(k=>({...k,bufferSpace:k.bufferSpace-as,currentLine:k.currentLine+1})),f.current.shift(),i){const k=x.currentLine/f.current.length*100;n(k)}}catch(E){w(E.message)}}},[i,x.bufferSpace,x.currentLine,x.isEmergencyStopped,x.isPaused,x.isPrinting,t,n,o]),A=u.useCallback(async E=>{const k=m(E);if(k)try{await t("M110 N0"),await t("M155 S1"),await t("M114");const N=k.content.split(`
`).map(R=>R.trim()).filter(R=>R&&!R.startsWith(";"));f.current=N,h(R=>({...R,isPrinting:!0,isPaused:!1,isEmergencyStopped:!1,currentLine:0,bufferSpace:Ta,lastError:null,retryCount:0})),_()}catch(N){console.error("Error starting print:",N),h(R=>({...R,lastError:N.message}))}},[m,_,t]),C=u.useCallback(async()=>{try{const E=await t("M114"),k=p(E);k&&(g.current=k),await t("G91"),await t("G1 E-3 F1800"),await t("G90"),await t("G1 Z5 F300"),await t("G1 X0 Y0 F3000"),h(N=>({...N,isPaused:!0})),l()}catch(E){console.error("Error pausing print:",E)}},[l,p,t]),M=u.useCallback(async()=>{if(g.current)try{await t("G90"),await t(`G1 Z${g.current.z+5} F300`),await t(`G1 X${g.current.x} Y${g.current.y} F3000`),await t(`G1 Z${g.current.z} F300`),await t("G91"),await t("G1 E3 F1800"),await t("G90"),h(E=>({...E,isPaused:!1})),c(),_()}catch(E){console.error("Error resuming print:",E)}},[_,c,t]),T=u.useCallback(async(E="Emergency stop triggered")=>{try{await t("M410"),await t("M112"),await t("M108"),f.current=[],h(k=>({...k,isPrinting:!1,isPaused:!1,isEmergencyStopped:!0,lastError:E})),d()}catch(k){console.error("Error during emergency stop:",k)}},[d,t]),G=u.useCallback(async E=>{try{await t(`M290 Z${E}`),await t("M114")}catch(k){console.error("Error adjusting Z offset:",k)}},[t]);return u.useEffect(()=>{if(s&&s.length>0){const E=s[s.length-1];(E==null?void 0:E.type)==="rx"&&b(E.message)}},[s,b]),u.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),{printerState:x,startPrint:A,pausePrint:C,resumePrint:M,emergencyStop:T,adjustZOffset:G,temperatures:r}}const Uc=()=>{var p,b,w,_,A,C,M,T;const{printerState:t,temperatures:a,pausePrint:r,resumePrint:s,emergencyStop:i,adjustZOffset:n}=Fc(),l=Ui(),c=Bi(),o=Fi().sendCommand,[d,m]=u.useState(null),[x,h]=u.useState(null),f=()=>{window.location.hash="#/control"};u.useEffect(()=>{l&&!d?m(new Date):l||m(null)},[l,d]),u.useEffect(()=>{if(!l||!d){h(null);return}const G=c(l.fileId);if(!(G!=null&&G.estimatedPrintTime))return;const E=(new Date-d)/1e3,k=Math.max(0,G.estimatedPrintTime-E);h(k);const N=setInterval(()=>{const R=(new Date-d)/1e3,I=Math.max(0,G.estimatedPrintTime-R);h(I)},1e3);return()=>clearInterval(N)},[l,d,c]);const y=G=>{if(!G)return"--:--:--";const E=Math.floor(G/3600),k=Math.floor(G%3600/60),N=Math.floor(G%60);return`${E.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`};if(!l)return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Print Monitor"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Control Panel"})]}),e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx("p",{className:"text-lg mb-2",children:"No active print"}),e.jsx("p",{className:"text-sm",children:"Start a print from the control panel to monitor its progress here."})]})]});const g=c(l.fileId);return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Print Monitor"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Control Panel"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-black rounded-lg shadow-lg",children:e.jsx(Ke,{content:g==null?void 0:g.content,width:"100%",height:400,currentPosition:t.position,highlightedLayer:Math.floor(l.progress*(g==null?void 0:g.layerCount)||0)})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Print Controls"}),e.jsxs("div",{className:"flex space-x-2",children:[t.isPaused?e.jsx("button",{onClick:s,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Resume Print"}):e.jsx("button",{onClick:r,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600",children:"Pause Print"}),e.jsx("button",{onClick:()=>i(),className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Emergency Stop"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Z Offset Adjustment"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>n(-.1),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"-0.1mm"}),e.jsx("button",{onClick:()=>n(-.05),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"-0.05mm"}),e.jsx("button",{onClick:()=>n(.05),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"+0.05mm"}),e.jsx("button",{onClick:()=>n(.1),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"+0.1mm"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Print Progress"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 mb-1",children:[e.jsxs("span",{children:[Math.round(l.progress),"%"]}),e.jsxs("span",{children:["Layer ",Math.floor(l.progress*(g==null?void 0:g.layerCount)||0)," / ",g==null?void 0:g.layerCount]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${l.progress}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Elapsed Time"}),e.jsx("p",{className:"font-medium",children:d?y((new Date-d)/1e3):"--:--:--"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Remaining Time"}),e.jsx("p",{className:"font-medium",children:y(x)})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Temperatures"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hotend"}),e.jsxs("span",{className:"text-sm font-medium",children:[(p=a.hotend)==null?void 0:p.current,"°C / ",(b=a.hotend)==null?void 0:b.target,"°C"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 transition-all duration-300",style:{width:`${((w=a.hotend)==null?void 0:w.current)/Math.max((_=a.hotend)==null?void 0:_.target,250)*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bed"}),e.jsxs("span",{className:"text-sm font-medium",children:[(A=a.bed)==null?void 0:A.current,"°C / ",(C=a.bed)==null?void 0:C.target,"°C"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${((M=a.bed)==null?void 0:M.current)/Math.max((T=a.bed)==null?void 0:T.target,100)*100}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Position"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"X"}),e.jsxs("p",{className:"font-medium",children:[t.position.x.toFixed(2),"mm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Y"}),e.jsxs("p",{className:"font-medium",children:[t.position.y.toFixed(2),"mm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Z"}),e.jsxs("p",{className:"font-medium",children:[t.position.z.toFixed(2),"mm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"E"}),e.jsxs("p",{className:"font-medium",children:[t.position.e.toFixed(2),"mm"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Bed Leveling"}),e.jsx("button",{onClick:()=>o("M503"),className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Refresh"})]}),e.jsx(an,{})]}),t.lastError&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-600 font-semibold mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:t.lastError})]})]})]})]})},Bc=Ce.memo(function({series:a,width:r=600,height:s=120}){const i=u.useRef(null);return u.useEffect(()=>{const n=i.current;if(!n)return;const l=n.getContext("2d"),c=n.width,o=n.height;if(l.clearRect(0,0,c,o),a.length===0)return;const d=a.map(T=>T.hotend||0),m=a.map(T=>T.bed||0),x=a.map(T=>T.targetHotend||0),h=a.map(T=>T.targetBed||0),f=[...d,...m,...x,...h],y=Math.min(0,...f),g=Math.max(Math.ceil((Math.max(...f)+10)/10)*10,100),p={left:40,right:10,top:10,bottom:20},b=c-p.left-p.right,w=o-p.top-p.bottom,_=T=>p.left+T/Math.max(1,a.length-1)*b,A=T=>p.top+w-(T-y)/Math.max(1,g-y)*w;l.strokeStyle="#e5e7eb",l.lineWidth=1,l.setLineDash([]),l.textAlign="right",l.textBaseline="middle",l.font="10px sans-serif";const C=Math.ceil((g-y)/5/10)*10;for(let T=Math.ceil(y/C)*C;T<=g;T+=C){const G=A(T);l.beginPath(),l.moveTo(p.left,G),l.lineTo(c-p.right,G),l.stroke(),l.fillStyle="#6b7280",l.fillText(T.toString()+"°C",p.left-5,G)}const M=(T,G,E=!1)=>{l.strokeStyle=G,l.lineWidth=2,l.setLineDash(E?[5,5]:[]),l.beginPath(),T.forEach((k,N)=>{const R=_(N),I=A(k);N===0?l.moveTo(R,I):l.lineTo(R,I)}),l.stroke(),E||(l.fillStyle=G,T.forEach((k,N)=>{const R=_(N),I=A(k);l.beginPath(),l.arc(R,I,3,0,Math.PI*2),l.fill()}))};M(x,"#ef4444",!0),M(h,"#3b82f6",!0),M(d,"#ef4444"),M(m,"#3b82f6")},[a,r,s]),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("canvas",{ref:i,width:r,height:s,className:"w-full h-28"}),e.jsxs("div",{className:"text-xs text-gray-500 flex justify-between",children:[e.jsx("span",{children:"Hotend (red)"}),e.jsx("span",{children:"Bed (blue)"})]})]})},(t,a)=>{var s,i,n,l,c,o,d,m;if(t.series.length!==a.series.length||t.width!==a.width||t.height!==a.height)return!1;const r=t.series.length-1;return((s=t.series[r])==null?void 0:s.hotend)===((i=a.series[r])==null?void 0:i.hotend)&&((n=t.series[r])==null?void 0:n.bed)===((l=a.series[r])==null?void 0:l.bed)&&((c=t.series[r])==null?void 0:c.targetHotend)===((o=a.series[r])==null?void 0:o.targetHotend)&&((d=t.series[r])==null?void 0:d.targetBed)===((m=a.series[r])==null?void 0:m.targetBed)}),zc=()=>{const t=Xe.find(r=>r.id==="bed-leveling"),a=Xe.filter(r=>r.id!=="bed-leveling");return t?[t,...a]:Xe},We=zc(),Pa={hotendTemp:!0,bedTemp:!0,nozzleDiameter:!0,layerHeight:!0,printSpeed:!0,retractionDistance:!0,retractionSpeed:!0,primeSpeed:!0,flowRate:!0,wallThickness:!0,enableABL:!0,firstLayerSpeed:!0};Ce.lazy(()=>Ps(()=>Promise.resolve().then(()=>Mn),void 0).then(t=>({default:t.GcodeViewer3D})));const Gc=Ce.lazy(()=>Ps(()=>Promise.resolve().then(()=>kn),void 0).then(t=>({default:t.SimpleGcodeViewer3D}))),hr=()=>{var he,W,me,xe;const t=window.location.hash==="#/bed-leveling",[a,r]=u.useState(()=>{if(t){const K=We.findIndex(ae=>ae.id==="bed-leveling");return K>=0?K:0}const O=sessionStorage.getItem("calibration_currentStepIndex");return O?parseInt(O):0}),[s,i]=u.useState(()=>sessionStorage.getItem("calibration_workflowState")||"idle"),[n,l]=u.useState(()=>sessionStorage.getItem("calibration_stepState")||"config"),[c,o]=u.useState({}),[d,m]=u.useState(()=>sessionStorage.getItem("calibration_generatedGcode")||""),[x,h]=u.useState(()=>sessionStorage.getItem("calibration_gcodeViewMode")||"3d"),[f,y]=u.useState(()=>{const O=sessionStorage.getItem("calibration_executionProgress");return O?JSON.parse(O):{sent:0,total:0}}),[g,p]=u.useState(()=>{const O=sessionStorage.getItem("calibration_stepResults");return O?JSON.parse(O):{}}),[b,w]=u.useState(()=>{const O=sessionStorage.getItem("calibration_workflowResults");return O?JSON.parse(O):{}}),[_,A]=u.useState(!1),[C,M]=u.useState({}),T=u.useRef(null),G=te(O=>O.status),E=te(O=>O.sendGcodeProgram),k=te(O=>O.temperatures);te(O=>O.position);const N=te(O=>O.activeExecution),R=te(O=>O.activePrinter),I=We[a],J=a===We.length-1,ce=a===0;u.useEffect(()=>{sessionStorage.setItem("calibration_currentStepIndex",a.toString())},[a]),u.useEffect(()=>{sessionStorage.setItem("calibration_workflowState",s)},[s]),u.useEffect(()=>{sessionStorage.setItem("calibration_stepState",n)},[n]),u.useEffect(()=>{Object.keys(c).length>0&&sessionStorage.setItem("calibration_parameters",JSON.stringify(c))},[c]),u.useEffect(()=>{sessionStorage.setItem("calibration_generatedGcode",d)},[d]),u.useEffect(()=>{sessionStorage.setItem("calibration_executionProgress",JSON.stringify(f))},[f]),u.useEffect(()=>{sessionStorage.setItem("calibration_stepResults",JSON.stringify(g))},[g]),u.useEffect(()=>{sessionStorage.setItem("calibration_workflowResults",JSON.stringify(b))},[b]),u.useEffect(()=>{sessionStorage.setItem("calibration_gcodeViewMode",x)},[x]),u.useEffect(()=>{if(R!=null&&R.id){const O=Je(R.id);M(O),console.log("Loaded globalThis parameters for display:",O)}},[R==null?void 0:R.id]),u.useEffect(()=>{I&&T.current!==I.id&&(R!=null&&R.id)&&(console.log("Initializing parameters for step:",I.id,"printer:",R.id,"current parameters:",c),(async()=>{var K,ae;try{const Y=sessionStorage.getItem("calibration_parameters");let le={};if(Y)try{le=JSON.parse(Y)}catch(ie){console.warn("Failed to parse saved parameters:",ie)}const de=Je(R.id);console.log("Loaded globalThis parameters:",de);const se=await Al(I.id),ve={};(K=I.inputs)==null||K.forEach(ie=>{ve[ie.key]=le[ie.key]||de[ie.key]||se[ie.key]||ie.defaultValue||""}),I.inputs&&I.inputs.length>0&&(console.log("Setting initial parameters:",ve),o(ie=>Object.keys(ie).length===0||T.current!==I.id?ve:ie),T.current=I.id)}catch(Y){console.error("Error loading parameters:",Y);const le=Je(R.id),de={};(ae=I.inputs)==null||ae.forEach(se=>{de[se.key]=le[se.key]||se.defaultValue||""}),console.log("Setting fallback parameters:",de),o(de),T.current=I.id}})())},[a,R==null?void 0:R.id]),u.useEffect(()=>{I&&Object.keys(c).length>0&&q()},[c,a]);const q=async()=>{if(I)try{if(I.gcode){const O=await I.gcode(c);m(O)}}catch(O){console.error("Error generating G-code:",O),m("")}},ne=()=>{var P,H,ee,re,pe,ye;if(!d||!I)return;const{activePrinterId:O,printers:K}=je.getState(),ae=K.find(Ne=>Ne.id===O),Y=((P=ae==null?void 0:ae.name)==null?void 0:P.replace(/[^a-zA-Z0-9]/g,"_"))||"Unknown_Printer",le=((H=ae==null?void 0:ae.model)==null?void 0:H.replace(/[^a-zA-Z0-9]/g,"_"))||"Unknown_Model",de=((pe=(re=(ee=ae==null?void 0:ae.printerSettings)==null?void 0:ee.filament)==null?void 0:re.type)==null?void 0:pe.replace(/[^a-zA-Z0-9]/g,"_"))||"PLA",se=((ye=I.title)==null?void 0:ye.replace(/[^a-zA-Z0-9]/g,"_"))||"calibration",ve=new Date().toISOString().slice(0,19).replace(/:/g,"-"),ie=`${se}_${Y}_${le}_${de}_${ve}.gcode`,fe=new Blob([d],{type:"text/plain"}),B=URL.createObjectURL(fe),z=document.createElement("a");z.href=B,z.download=ie,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(B)},Q=(O,K)=>{console.log("Parameter change:",O,"from",c[O],"to",K,"step:",I==null?void 0:I.id);let ae=K;if(K==="")ae="";else if(I.inputs){const Y=I.inputs.find(le=>le.key===O);(Y==null?void 0:Y.type)==="number"&&(ae=parseFloat(K)||0)}console.log("Processed value:",ae,"for key:",O),o(Y=>{const le={...Y,[O]:ae};return console.log("Setting new parameters:",le,"previous:",Y),R!=null&&R.id&&Object.keys(Pa).includes(O)&&(console.log("Updating globalThis parameter:",O,"to",ae),dr(R.id,I.id,{[O]:ae}),M(de=>({...de,[O]:ae}))),le})},X=async()=>{if(!_){alert("Please connect to your printer first");return}l("running"),i("running"),y({sent:0,total:0});try{const O=await E(d,{delayMs:100,waitForReady:!0,executionData:{stepName:I.name,stepId:I.id,workflowId:`calibration-${Date.now()}`},onProgress:(K,ae)=>{y({sent:K,total:ae})}});l("review"),p(K=>({...K,[I.id]:{parameters:{...c},gcode:d,executionResult:O,timestamp:Date.now()}}))}catch(O){console.error("Error executing G-code:",O),alert("Error executing G-code: "+O.message),l("config"),i("idle"),y({sent:0,total:0})}},v=te(O=>O.abortExecution),j=async()=>{if(confirm("Are you sure you want to abort the current calibration execution? This will send an emergency stop to the printer."))try{await v(),l("config"),i("idle"),y({sent:0,total:0})}catch(O){console.error("Failed to abort execution:",O),alert("Failed to abort execution: "+O.message)}},S=async()=>{l("completed");const O={...g[I.id],completed:!0,timestamp:Date.now(),success:!0};if(w(K=>({...K,[I.id]:O})),Dl(I.id,c,O),R!=null&&R.id&&(dr(R.id,I.id,c),console.log("Updated globalThis parameters for printer:",R.id)),I.requiresSave)try{await Il(I.id,c),await L()}catch(K){console.error("Error saving parameters:",K),alert("Error saving parameters: "+K.message)}},L=async()=>{try{const O=te.getState().sendCommand;await O("M500"),alert("Printer settings saved successfully")}catch(O){console.error("Error saving settings:",O),alert("Error saving settings: "+O.message)}},V=()=>{l("config"),p(O=>{const K={...O};return delete K[I.id],K})},F=()=>{J?i("completed"):(r(O=>O+1),l("config"))},$=()=>{ce||(r(O=>O-1),l("config"))},U=()=>{r(0),i("idle"),l("config"),p({}),w({}),o({}),m(""),y({sent:0,total:0}),sessionStorage.removeItem("calibration_currentStepIndex"),sessionStorage.removeItem("calibration_workflowState"),sessionStorage.removeItem("calibration_stepState"),sessionStorage.removeItem("calibration_parameters"),sessionStorage.removeItem("calibration_generatedGcode"),sessionStorage.removeItem("calibration_executionProgress"),sessionStorage.removeItem("calibration_stepResults"),sessionStorage.removeItem("calibration_workflowResults")};u.useEffect(()=>{(()=>{if(s==="running"&&n==="running"){const K=sessionStorage.getItem("calibration_executionProgress");if(K){const ae=JSON.parse(K);ae.sent>0&&ae.sent<ae.total&&(confirm("Previous calibration execution was interrupted. Do you want to continue from where you left off?")?(l("running"),i("running")):(l("config"),i("idle"),y({sent:0,total:0})))}}})()},[]),u.useEffect(()=>{const O=K=>{if(s==="running"&&n==="running")return K.preventDefault(),K.returnValue="Calibration is currently running. Are you sure you want to leave?","Calibration is currently running. Are you sure you want to leave?"};return window.addEventListener("beforeunload",O),()=>window.removeEventListener("beforeunload",O)},[s,n]),u.useEffect(()=>{A(G==="connected")},[G]),u.useEffect(()=>{N&&N.status==="running"?n!=="running"&&(l("running"),i("running"),y(N.progress)):!N&&n==="running"&&(l("config"),i("idle"),y({sent:0,total:0}))},[N]);const D=O=>({"pid-tune":$e,"extruder-esteps":ns,"retraction-tuning":Ye,"first-layer":Se,"temperature-tower":$e,"flow-rate":ns,"calibration-cube":ns,"speed-calibration":Ye})[O]||Se,Z=O=>{var K;return(K=b[O])!=null&&K.completed?"completed":g[O]?"review":a>We.findIndex(ae=>ae.id===O)?"pending":"current"},oe=O=>({"pid-tune":["Check temperature stability - should be within ±1°C of target","Verify no temperature oscillations","Confirm heating time is reasonable"],"extruder-esteps":["Measure 100mm of filament with calipers","Check if measurement matches expected 100mm","Verify consistent extrusion throughout test"],"retraction-tuning":["Look for stringing between printed parts","Check for blobs or zits on print surface","Verify clean retraction without under-extrusion"],"first-layer":["Check bed adhesion - no warping or lifting","Verify first layer height is consistent","Look for proper squish without over-squish"],"temperature-tower":["Examine each temperature section for quality","Look for best balance of strength and appearance","Check for layer adhesion issues"],"flow-rate":["Measure wall thickness with calipers","Check for over/under-extrusion patterns","Verify consistent wall thickness"],"calibration-cube":["Measure cube dimensions with calipers","Check for dimensional accuracy (should be 20mm)","Look for layer consistency and surface quality"],"speed-calibration":["Check for ringing or ghosting at higher speeds","Look for missed steps or layer shifts","Verify print quality at different speeds"]})[O]||[];return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[s==="running"&&n==="running"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Calibration in Progress"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[I==null?void 0:I.name," - ",f.sent," / ",f.total," commands sent"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"⚠️ Do not navigate away or refresh the page during execution"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-mono text-blue-800",children:f.total>0?`${Math.round(f.sent/f.total*100)}%`:"0%"}),e.jsx("div",{className:"w-24 bg-blue-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${f.total>0?f.sent/f.total*100:0}%`}})}),e.jsx("button",{onClick:j,className:"mt-2 px-3 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200 text-xs",children:"Abort (Emergency Stop)"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"3D Printer Calibration Workflow"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${s==="idle"?"bg-gray-100 text-gray-800":s==="running"?"bg-blue-100 text-blue-800":s==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:[s==="idle"&&"Ready to Start",s==="running"&&"Running",s==="completed"&&"Completed",s==="paused"&&"Paused"]}),s==="running"&&n==="running"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(Ue,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Executing G-code..."})]}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Reset Workflow"})]})]}),e.jsx("div",{className:"flex items-center justify-between mb-6",children:We.map((O,K)=>{const ae=D(O.id),Y=Z(O.id),le=K===a;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${Y==="completed"?"bg-green-500 border-green-500 text-white":Y==="review"?"bg-yellow-500 border-yellow-500 text-white":le?"bg-blue-500 border-blue-500 text-white":"bg-gray-100 border-gray-300 text-gray-500"}`,children:Y==="completed"?e.jsx(Ee,{className:"w-5 h-5"}):e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium",children:O.name}),e.jsx("div",{className:"text-xs text-gray-500",children:Y==="completed"?"Completed":Y==="review"?"Review Results":le?"Current":"Pending"})]}),K<We.length-1&&e.jsx(or,{className:"w-4 h-4 text-gray-400 mx-4"})]},O.id)})})]}),I&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:I.name}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Step ",a+1," of ",We.length]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:I.description}),I.instructions&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Instructions:"}),e.jsx("ul",{className:"list-disc list-inside text-blue-800 space-y-1",children:I.instructions.map((O,K)=>e.jsx("li",{children:O},K))})]})]}),n==="config"&&e.jsxs("div",{className:"space-y-6",children:[I.inputs&&I.inputs.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:I.inputs.map(O=>{const K=Object.keys(Pa).includes(O.key),ae=Y=>{if(O.required&&(!Y||Y===""))return"This field is required";if(O.type==="number"&&Y!==""){const le=parseFloat(Y);if(isNaN(le))return"Must be a valid number";if(O.min!==void 0&&le<O.min)return`Must be at least ${O.min}`;if(O.max!==void 0&&le>O.max)return`Must be at most ${O.max}`}return!0};return e.jsx(wr,{type:O.type,label:O.label,placeholder:O.placeholder,min:O.min,max:O.max,step:O.step,required:O.required,disabled:n!=="config",validate:ae,syncWithStore:K,getStoreValue:()=>C[O.key],onChangeStore:Y=>{console.log("Store update for globalThis parameter:",O.key,"value:",Y),Q(O.key,Y)},initialValue:c[O.key]||O.defaultValue||"",className:K?"border-blue-300 bg-blue-50":"",errorClassName:"text-red-600"},O.key)})}),(R==null?void 0:R.id)&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Global Parameters for ",R.name||R.id]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:Object.entries(C).map(([O,K])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-blue-700 font-medium",children:[O,":"]}),e.jsx("span",{className:"text-blue-900 font-mono",children:K})]},O))}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"These parameters persist across all calibration steps and are saved per printer."})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-700",children:"Generated G-code:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>h("text"),className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${x==="text"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Text View"})]}),e.jsxs("button",{onClick:()=>{console.log("Switching to 3D view, current mode:",x),h("3d")},className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${x==="3d"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(La,{className:"w-4 h-4"}),e.jsx("span",{children:"3D View"})]}),e.jsxs("button",{onClick:ne,className:"px-3 py-1 rounded text-sm flex items-center space-x-1 bg-green-600 text-white hover:bg-green-700",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Download"})]})]})]}),x==="text"?e.jsx("div",{className:"bg-gray-900 text-green-400 p-4 rounded font-mono text-sm max-h-40 overflow-y-auto",children:e.jsx("pre",{children:d})}):e.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:[console.log("Rendering 3D view, gcodeViewMode:",x,"generatedGcode length:",d==null?void 0:d.length),e.jsx(Ce.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[600px] bg-gray-100 dark:bg-gray-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading 3D viewer..."})]})}),children:e.jsx(Gc,{content:d,width:"100%",height:600,buildPlateSize:(R==null?void 0:R.bedSize)||{x:220,y:220}})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[n==="running"&&e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Abort (Emergency Stop)"]}),e.jsxs("button",{onClick:X,disabled:!_||!d,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Da,{className:"w-4 h-4"}),"Start Calibration"]})]})]}),n==="running"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 animate-spin"}),"Executing G-code..."]}),e.jsxs("span",{className:"font-mono",children:[f.sent," / ",f.total," commands"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${f.total>0?f.sent/f.total*100:0}%`}})}),e.jsx("div",{className:"text-xs text-gray-600 text-center",children:f.total>0?`${Math.round(f.sent/f.total*100)}% complete`:"Preparing..."})]}),e.jsxs("div",{className:"bg-gray-50 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Temperature Monitoring"}),e.jsx(Bc,{series:[]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsxs("span",{children:["Hotend: ",((he=k==null?void 0:k.hotend)==null?void 0:he.current)||0,"°C / ",((W=k==null?void 0:k.hotend)==null?void 0:W.target)||0,"°C"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsxs("span",{children:["Bed: ",((me=k==null?void 0:k.bed)==null?void 0:me.current)||0,"°C / ",((xe=k==null?void 0:k.bed)==null?void 0:xe.target)||0,"°C"]})]})]})]}),n==="review"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-4",children:[e.jsxs("h3",{className:"font-medium text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Review Results"]}),e.jsx("p",{className:"text-yellow-800 mb-3",children:"Please check the following items after the calibration has completed:"}),e.jsx("ul",{className:"list-disc list-inside text-yellow-800 space-y-1",children:oe(I.id).map((O,K)=>e.jsx("li",{children:O},K))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:V,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 flex items-center gap-2",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Redo with New Parameters"]}),e.jsxs("button",{onClick:S,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Ia,{className:"w-4 h-4"}),"Complete Step"]})]})]}),n==="completed"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:[e.jsxs("h3",{className:"font-medium text-green-900 mb-2 flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Step Completed"]}),e.jsx("p",{className:"text-green-800",children:"This calibration step has been completed successfully. You can proceed to the next step."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:$,disabled:ce,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(pr,{className:"w-4 h-4"}),"Previous Step"]}),e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2",children:[J?"Finish Workflow":"Next Step",e.jsx(or,{className:"w-4 h-4"})]})]})]})]}),I&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Parameter History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{if(xt(I.id).length>0){const K=Ll(I.id);o(ae=>({...ae,...K}))}},className:"px-3 py-1 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 text-sm",children:"Load Best Parameters"}),e.jsx("button",{onClick:Fl,className:"px-3 py-1 bg-green-100 text-green-800 rounded hover:bg-green-200 text-sm",children:"Export History"}),e.jsx("button",{onClick:()=>{confirm("Clear parameter history for this step?")&&(Ol(I.id),o(fs(I.id)))},className:"px-3 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200 text-sm",children:"Clear History"})]})]}),e.jsx("div",{className:"space-y-2",children:xt(I.id).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No parameter history for this step yet."}):e.jsx("div",{className:"space-y-2",children:xt(I.id).slice(-5).reverse().map((O,K)=>{var ae,Y;return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(O.timestamp).toLocaleString()}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${(ae=O.result)!=null&&ae.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(Y=O.result)!=null&&Y.success?"Success":"Failed"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:Object.entries(O.parameters).map(([le,de])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[le,":"]}),e.jsx("span",{className:"font-mono",children:de})]},le))}),e.jsx("button",{onClick:()=>o(le=>({...le,...O.parameters})),className:"mt-2 px-2 py-1 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 text-xs",children:"Use These Parameters"})]},K)})})})]}),s==="completed"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Calibration Workflow Completed"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"All calibration steps have been completed. Your printer should now be properly calibrated."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(b).map(([O,K])=>{const ae=Xe.find(Y=>Y.id===O);return e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-green-900",children:ae==null?void 0:ae.name}),e.jsxs("p",{className:"text-sm text-green-800",children:["Completed at ",new Date(K.timestamp).toLocaleTimeString()]})]},O)})})]})]})]})},Vc=()=>{const t=$i(),{addTemplate:a,updateTemplate:r,deleteTemplate:s}=Xi();Hi();const i=Va(),[n,l]=u.useState(!1),[c,o]=u.useState(null),[d,m]=u.useState({name:"",description:"",parameters:[],defaultSettings:{},compatibleFiles:[]}),x=()=>{m(g=>({...g,parameters:[...g.parameters,{id:crypto.randomUUID(),name:"",type:"number",default:"",min:"",max:"",step:"1",unit:"",description:""}]}))},h=(g,p,b)=>{m(w=>({...w,parameters:w.parameters.map(_=>_.id===g?{..._,[p]:b}:_)}))},f=()=>{c?r(c.id,d):a(d),l(!1),o(null),m({name:"",description:"",parameters:[],defaultSettings:{},compatibleFiles:[]})},y=g=>{o(g)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Print Templates"}),e.jsx("button",{onClick:()=>l(!0),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"New Template"})]}),e.jsxs("div",{className:"divide-y",children:[t.map(g=>e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:g.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:g.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(g),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Use Template"}),e.jsx("button",{onClick:()=>{o(g),m({...g,parameters:[...g.parameters]}),l(!0)},className:"p-1 text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>s(g.id),className:"p-1 text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),g.parameters.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Parameters"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:g.parameters.map(p=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:p.name}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",p.type,p.unit&&` ${p.unit}`,p.min!==""&&`, min: ${p.min}`,p.max!==""&&`, max: ${p.max}`,")"]}),p.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:p.description})]},p.id))})]}),g.compatibleFiles.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Compatible Files"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.compatibleFiles.map(p=>{const b=i.find(w=>w.id===p);return b?e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded",children:b.name},p):null})})]})]},g.id)),t.length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No templates found"})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:c?"Edit Template":"New Template"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name"}),e.jsx("input",{type:"text",value:d.name,onChange:g=>m(p=>({...p,name:g.target.value})),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:g=>m(p=>({...p,description:g.target.value})),rows:3,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Parameters"}),e.jsx("button",{onClick:x,className:"text-blue-500 hover:text-blue-600",children:"+ Add Parameter"})]}),e.jsx("div",{className:"space-y-4",children:d.parameters.map(g=>e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 border rounded",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:g.name,onChange:p=>h(g.id,"name",p.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Type"}),e.jsxs("select",{value:g.type,onChange:p=>h(g.id,"type",p.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"boolean",children:"Boolean"}),e.jsx("option",{value:"select",children:"Select"})]})]}),g.type==="number"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Min"}),e.jsx("input",{type:"number",value:g.min,onChange:p=>h(g.id,"min",p.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Max"}),e.jsx("input",{type:"number",value:g.max,onChange:p=>h(g.id,"max",p.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Step"}),e.jsx("input",{type:"number",value:g.step,onChange:p=>h(g.id,"step",p.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Unit"}),e.jsx("input",{type:"text",value:g.unit,onChange:p=>h(g.id,"unit",p.target.value),className:"w-full p-2 border rounded"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:g.description,onChange:p=>h(g.id,"description",p.target.value),className:"w-full p-2 border rounded"})]})]},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compatible Files"}),e.jsx("select",{multiple:!0,value:d.compatibleFiles,onChange:g=>{const p=Array.from(g.target.selectedOptions,b=>b.value);m(b=>({...b,compatibleFiles:p}))},className:"w-full p-2 border rounded",size:5,children:i.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>{l(!1),o(null),m({name:"",description:"",parameters:[],defaultSettings:{},compatibleFiles:[]})},className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Save Template"})]})]})]})})]})},Hc=()=>{const[t,a]=u.useState(null);return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(vr,{className:"h-8 w-8 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"3D Printer Suite"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx(Nr,{})})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs(bn,{className:"space-y-6",children:[e.jsxs(vn,{className:"flex space-x-4 border-b border-gray-200",children:[e.jsx(ot,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Print Monitor"}),e.jsx(ot,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"File Management"}),e.jsx(ot,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Queue"}),e.jsx(ot,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Calibration"}),e.jsx(ot,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Templates"})]}),e.jsx(ct,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(Uc,{})}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"3D Preview"}),e.jsx(Ke,{content:t.content,width:"100%",height:400})]})})]})}),e.jsx(ct,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(yc,{onFileSelect:a})}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"File Preview"}),e.jsx(Ke,{content:t.content,width:"100%",height:400})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"File Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",t.name]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",(t.size/1024).toFixed(2)," KB"]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Uploaded:"})," ",new Date(t.uploadDate).toLocaleString()]})]})]})]})})]})}),e.jsx(ct,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(bc,{}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Queue Preview"}),e.jsx(Ke,{content:t.content,width:"100%",height:400})]})})]})}),e.jsx(ct,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(hr,{}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Calibration Preview"}),e.jsx(Ke,{content:t.content,width:"100%",height:400})]})})]})}),e.jsx(ct,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Vc,{}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Template Preview"}),e.jsx(Ke,{content:t.content,width:"100%",height:400})]})})]})})]})})]})},$c=()=>{const t=te(o=>o.activeExecution),a=te(o=>o.abortExecution);if(!t||t.status!=="running")return null;const{stepName:r,progress:s,startTime:i}=t,n=s.total>0?Math.round(s.sent/s.total*100):0,l=Math.round((Date.now()-i)/1e3),c=async()=>{if(confirm("Are you sure you want to abort the current calibration execution? This will send an emergency stop to the printer."))try{await a()}catch(o){console.error("Failed to abort execution:",o),alert("Failed to abort execution: "+o.message)}};return e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-blue-50 border border-blue-200 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsx("h3",{className:"font-medium text-blue-900",children:"Calibration Running"})]}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-red-100 rounded text-red-600 hover:text-red-700",title:"Abort execution (Emergency Stop)",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("div",{className:"font-medium",children:r}),e.jsxs("div",{className:"text-xs text-blue-600",children:[s.sent," / ",s.total," commands • ",l,"s elapsed"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})}),e.jsxs("div",{className:"text-xs text-blue-600 text-center",children:[n,"% complete"]})]}),e.jsx("div",{className:"mt-3 text-xs text-blue-600 bg-blue-100 rounded p-2",children:"💡 You can navigate to other tabs while this runs. Progress will be tracked globally."})]})},Xc=()=>{const[t,a]=u.useState(window.location.hash.slice(1)||"/");return u.useEffect(()=>{const s=()=>{a(window.location.hash.slice(1)||"/")};return window.addEventListener("hashchange",s),()=>window.removeEventListener("hashchange",s)},[]),{route:t,navigate:s=>{window.location.hash=s}}};function Yc(){const{route:t,navigate:a}=Xc();za();const r=Ga();u.useEffect(()=>{console.log("🚀 3D Printer Suite App initialized with globalThis store access")},[]);const s=d=>{r(d),a(`/printer/${d}`)},i=()=>{r(null),a("/")},[n,l,c]=t.split("/"),o=()=>{switch(l){case"printer":if(c)return e.jsx(Jo,{onBackToDashboard:i});break;case"control":return e.jsx(Hc,{});case"calibration":return e.jsx(hr,{});case"bed-leveling":return e.jsx(hr,{});default:return e.jsx(Ki,{onPrinterSelect:s})}};return e.jsxs(Qi,{children:[o(),e.jsx($c,{})]})}yi(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Yc,{})}));const Zc={travel:new ut(8421504),extrude:new ut(65280),retract:new ut(16711680)},Ca=(t,a=1e3)=>{const r=t.split(`
`),s=new Map;let i={x:0,y:0,z:0,e:0},n={x:0,y:0,z:0,e:0},l={min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}};const c=new Map,o=h=>{l.min.x=Math.min(l.min.x,h.x),l.min.y=Math.min(l.min.y,h.y),l.min.z=Math.min(l.min.z,h.z),l.max.x=Math.max(l.max.x,h.x),l.max.y=Math.max(l.max.y,h.y),l.max.z=Math.max(l.max.z,h.z)},d=h=>{const f={};for(const y of h){const g=y.charAt(0).toLowerCase();if("xyzef".includes(g)){const p=parseFloat(y.slice(1));!isNaN(p)&&isFinite(p)&&(f[g]=p)}}return f};for(const h of r){const f=h.trim();if(!f||f.startsWith(";"))continue;const y=f.split(" "),g=y[0];if(g==="G0"||g==="G1"){const p=d(y);if(Object.values(p).some(w=>isNaN(w)||!isFinite(w))&&console.warn("Invalid coordinates found in line:",f,"coords:",p),p.x!==void 0&&(i.x=p.x),p.y!==void 0&&(i.y=p.y),p.z!==void 0&&(i.z=p.z),p.e!==void 0&&(i.e=p.e),[i.x,i.y,i.z,n.x,n.y,n.z].every(w=>!isNaN(w)&&isFinite(w))){const _=i.e>n.e?"extrude":"travel",A=i.z;s.has(A)||(s.set(A,{points:[],moveTypes:[],pointCount:0}),c.set(A,0));const C=s.get(A),M=c.get(A);(M<a||M%Math.ceil(M/a)===0||_==="extrude")&&(C.points.push(n.x,n.y,n.z,i.x,i.y,i.z),C.moveTypes.push(_),C.pointCount++),c.set(A,M+1),o(i),n={...i}}else console.warn("Skipping invalid coordinates:",{lastPosition:n,currentPosition:i})}}const m=Array.from(s.entries()).sort(([h],[f])=>h-f).map(([h,f])=>({z:h,...f})),x={min:{x:isFinite(l.min.x)?l.min.x:0,y:isFinite(l.min.y)?l.min.y:0,z:isFinite(l.min.z)?l.min.z:0},max:{x:isFinite(l.max.x)?l.max.x:100,y:isFinite(l.max.y)?l.max.y:100,z:isFinite(l.max.z)?l.max.z:10}};return{layers:m,bounds:x,stats:{totalLayers:m.length,totalPoints:m.reduce((h,f)=>h+f.points.length/6,0)}}},Wc=({geometryData:t,visibleLayers:a,showTravelMoves:r,buildPlateSize:s})=>t?e.jsxs(e.Fragment,{children:[(()=>{const{min:i,max:n}=t.bounds,l=(i.x+n.x)/2,c=(i.y+n.y)/2,o=n.x-i.x,d=n.y-i.y,m=Math.max(o,s.x);return Math.max(d,s.y),e.jsxs(e.Fragment,{children:[e.jsx("gridHelper",{args:[m,Math.max(10,Math.floor(m/10)),"#cccccc","#cccccc"],position:[l,c,0],rotation:[-Math.PI/2,0,0]}),e.jsxs("mesh",{position:[l,c,.01],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[s.x,s.y]}),e.jsx("meshBasicMaterial",{color:"#f0f0f0",transparent:!0,opacity:.1})]}),e.jsx("group",{position:[l,c,.02],children:e.jsxs("lineSegments",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:8,array:new Float32Array([-s.x/2,-s.y/2,0,s.x/2,-s.y/2,0,s.x/2,-s.y/2,0,s.x/2,s.y/2,0,s.x/2,s.y/2,0,-s.x/2,s.y/2,0,-s.x/2,s.y/2,0,-s.x/2,-s.y/2,0]),itemSize:3})}),e.jsx("lineBasicMaterial",{color:"#666666"})]})})]})})(),e.jsxs("mesh",{position:[-4,4,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-2.5,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,2.5,0],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[Math.PI/2,0,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsxs("mesh",{position:[-4,4,.5],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsx(Ge,{position:[-2.2,4,0],fontSize:.25,color:"#ff0000",rotation:[-Math.PI/2,0,0],children:"X"}),e.jsx(Ge,{position:[-4,2.2,0],fontSize:.25,color:"#00ff00",rotation:[-Math.PI/2,0,0],children:"Y"}),e.jsx(Ge,{position:[-4,4,.7],fontSize:.25,color:"#0000ff",children:"Z"}),t.layers.map((i,n)=>a.has(n)?i.points.map((l,c)=>{if(c%6!==0)return null;const o=i.moveTypes[c/6];if(o==="travel"&&!r)return null;const d=i.points[c],m=i.points[c+1],x=i.points[c+2],h=i.points[c+3],f=i.points[c+4],y=i.points[c+5];if(![d,m,x,h,f,y].every(w=>!isNaN(w)&&isFinite(w)))return console.warn("Skipping invalid line segment:",{x1:d,y1:m,z1:x,x2:h,y2:f,z2:y}),null;const b=[new qe(d,m,x),new qe(h,f,y)];return e.jsx(Ba,{points:b,color:Zc[o],lineWidth:o==="travel"?.5:2},`${n}-${c}`)}):null)]}):e.jsxs(e.Fragment,{children:[e.jsx("gridHelper",{args:[s.x,Math.max(10,Math.floor(s.x/10)),"#cccccc","#cccccc"],position:[0,0,0],rotation:[-Math.PI/2,0,0]}),e.jsxs("mesh",{position:[0,0,.01],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[s.x,s.y]}),e.jsx("meshBasicMaterial",{color:"#f0f0f0",transparent:!0,opacity:.1})]}),e.jsx("group",{position:[0,0,.02],children:e.jsxs("lineSegments",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:8,array:new Float32Array([-s.x/2,-s.y/2,0,s.x/2,-s.y/2,0,s.x/2,-s.y/2,0,s.x/2,s.y/2,0,s.x/2,s.y/2,0,-s.x/2,s.y/2,0,-s.x/2,s.y/2,0,-s.x/2,-s.y/2,0]),itemSize:3})}),e.jsx("lineBasicMaterial",{color:"#666666"})]})}),e.jsxs("mesh",{position:[-4,4,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-2.5,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,2.5,0],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[Math.PI/2,0,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsxs("mesh",{position:[-4,4,.5],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsx(Ge,{position:[-2.2,4,0],fontSize:.25,color:"#ff0000",rotation:[-Math.PI/2,0,0],children:"X"}),e.jsx(Ge,{position:[-4,2.2,0],fontSize:.25,color:"#00ff00",rotation:[-Math.PI/2,0,0],children:"Y"}),e.jsx(Ge,{position:[-4,4,.7],fontSize:.25,color:"#0000ff",children:"Z"}),e.jsxs("mesh",{position:[0,0,1],children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:"#ef4444"})]})]}),qc=({content:t,width:a=800,height:r=700,buildPlateSize:s={x:220,y:220}})=>{const[i,n]=u.useState(null),[l,c]=u.useState(!1),[o,d]=u.useState(0),[m,x]=u.useState(!0),[h,f]=u.useState([0,0,50]),[y,g]=u.useState("medium"),[p,b]=u.useState(1e3);console.log("SimpleGcodeViewer3D rendered with content length:",t==null?void 0:t.length,"width:",a,"height:",r,"buildPlateSize:",s),u.useEffect(()=>{t&&t.length>5e4?(g("low"),b(500)):t&&t.length>2e4?(g("medium"),b(1e3)):(g("high"),b(2e3))},[t]),u.useEffect(()=>{(()=>{if(console.log("SimpleGcodeViewer3D: Processing G-code, content length:",t==null?void 0:t.length,"quality:",y,"maxPoints:",p),!t){console.log("SimpleGcodeViewer3D: No content, skipping processing");return}c(!0);try{console.log("SimpleGcodeViewer3D: Starting G-code processing...");const A=Ca(t,p);if(console.log("SimpleGcodeViewer3D: Processing complete, result:",A),n(A),d(A.layers.length-1),A.bounds){const{min:C,max:M}=A.bounds,T=(C.x+M.x)/2,G=(C.y+M.y)/2,E=(C.z+M.z)/2,k=M.x-C.x,N=M.y-C.y,R=M.z-C.z,I=Math.max(k,N,R),J=Math.max(s.x,s.y),ce=Math.max(I,J),q=Math.max(ce*1.2,30),ne=ce*.6,Q=[T+ne,G+ne,E+q*.6];console.log("Setting camera position:",Q,"for bounds:",A.bounds,"buildPlateSize:",s),f(Q)}}catch(A){console.error("SimpleGcodeViewer3D: Error processing G-code:",A)}finally{c(!1)}})()},[t]);const w=u.useMemo(()=>i?new Set(Array.from({length:o+1},(_,A)=>A)):new Set,[o,i]);return l?e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:r},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processing G-code..."})]})}):i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-300",style:{width:a,height:r},children:[e.jsxs(fr,{camera:{position:h,fov:45},children:[e.jsx(br,{enableDamping:!0,dampingFactor:.05,target:i?[(i.bounds.min.x+i.bounds.max.x)/2,(i.bounds.min.y+i.bounds.max.y)/2,(i.bounds.min.z+i.bounds.max.z)/2]:[0,0,0],minDistance:5,maxDistance:500,enableZoom:!0,enablePan:!0,enableRotate:!0}),e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[5,5,5],intensity:.8}),e.jsx(Wc,{geometryData:i,visibleLayers:w,showTravelMoves:m,buildPlateSize:s})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-white bg-opacity-90 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Layer: ",o+1," / ",(i==null?void 0:i.layers.length)||0]}),e.jsx("input",{type:"range",min:0,max:((i==null?void 0:i.layers.length)||1)-1,value:o,onChange:_=>d(parseInt(_.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:_=>x(_.target.checked),className:"rounded text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Show Travel Moves"})]}),e.jsx("button",{onClick:()=>{if(i!=null&&i.bounds){const{min:_,max:A}=i.bounds,C=(_.x+A.x)/2,M=(_.y+A.y)/2,T=(_.z+A.z)/2,G=A.x-_.x,E=A.y-_.y,k=A.z-_.z,N=Math.max(G,E,k),R=Math.max(s.x,s.y),I=Math.max(N,R),J=Math.max(I*1.2,30),ce=I*.6;f([C+ce,M+ce,T+J*.6])}},className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",children:"Reset View"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Quality:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:y,onChange:_=>{const A=_.target.value;g(A),b(A==="low"?500:A==="medium"?1e3:2e3)},className:"px-2 py-1 text-sm border border-gray-300 rounded",children:[e.jsx("option",{value:"low",children:"Low (Fast)"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High (Slow)"})]}),e.jsx("button",{onClick:()=>{if(t){c(!0);try{const _=Ca(t,p);n(_),d(_.layers.length-1)}catch(_){console.error("Error reprocessing G-code:",_)}finally{c(!1)}}},className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600",children:"Apply"})]})]})]})]})]}),i&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Layers:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.stats.totalLayers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Rendered Points:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.stats.totalPoints})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Quality Level:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:y})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Max Points/Layer:"}),e.jsx("span",{className:"ml-2 font-medium",children:p})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Build Volume:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(i.bounds.max.x-i.bounds.min.x),"x",Math.round(i.bounds.max.y-i.bounds.min.y),"x",Math.round(i.bounds.max.z-i.bounds.min.z),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Performance:"}),e.jsx("span",{className:"ml-2 font-medium",children:y==="low"?"Fast":y==="medium"?"Balanced":"Detailed"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:r},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500 mb-2",children:"No G-code data to visualize"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Generate G-code first to see 3D preview"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Content length: ",(t==null?void 0:t.length)||0]})]})})},kn=Object.freeze(Object.defineProperty({__proto__:null,SimpleGcodeViewer3D:qc},Symbol.toStringTag,{value:"Module"}));export{nl as F,ad as S,ma as _,id as a,nd as b,ul as d,Ci as g,td as s,rd as t,sd as u};
