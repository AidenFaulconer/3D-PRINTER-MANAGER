import{d as Ke,p as ct,s as Nr,_ as jr,j as e,C as Zt,T as Me,O as Yt,S as vr,P as wr,u as Sr,a as Er,G as _r,L as Es,c as Tr}from"./react-three-777be8c8.js";import{c as Je,r as d,R as _e,a as Cr}from"./state-management-690777ae.js";import{_ as Pr,F as kr,Z as ns,y as Ve,d as Le}from"./three-1b54b8e3.js";import"./react-vendor-2106b276.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(l){if(l.ep)return;l.ep=!0;const n=s(l);fetch(l.href,n)}})();const ue=Je(Ke(ct((t,a)=>({printers:[],activePrinterId:null,addPrinter:s=>{const r={id:crypto.randomUUID(),name:s.name||"New Printer",model:s.model||"Unknown Model",firmware:s.firmware||"Unknown Firmware",bedSize:s.bedSize||{x:220,y:220,z:250},calibrationSteps:s.calibrationSteps||{},firmwareConfiguration:s.firmwareConfiguration||{},printerSettings:s.printerSettings||{units:{linear:"mm",temperature:"C"},filament:{diameter:1.75,type:"PLA"},stepsPerUnit:{x:80,y:80,z:400,e:93},feedrates:{x:500,y:500,z:5,e:25},acceleration:{max:1e3,print:1e3,retract:1e3,travel:1e3,jerk:{x:0,y:0,z:0,e:0}},homeOffset:{x:0,y:0,z:0},bedLeveling:{enabled:!1,mesh:[],fadeHeight:10},materialHeating:{pla:{hotend:200,bed:60},abs:{hotend:240,bed:100},petg:{hotend:230,bed:80}},pid:{hotend:{p:21.73,i:1.54,d:73.76},bed:{p:301.25,i:24.2,d:73.76}},powerLossRecovery:!0,zProbeOffset:{x:0,y:0,z:0},linearAdvance:0,filamentLoadUnload:{loadLength:0,unloadLength:0},lastUpdated:null},slicerProfiles:s.slicerProfiles||{curaPath:"",profiles:[],materials:[]},macros:s.macros||[],calibrationHistory:s.calibrationHistory||[],...s};t(l=>({printers:[...l.printers,r],activePrinterId:r.id}))},addMacro:(s,r)=>{const l={id:crypto.randomUUID(),name:r.name||"New Macro",description:r.description||"",commands:r.commands||[],isFavorite:!!r.isFavorite,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t(n=>({printers:n.printers.map(i=>i.id===s?{...i,macros:[...i.macros||[],l]}:i)}))},updateMacro:(s,r,l)=>{t(n=>({printers:n.printers.map(i=>i.id===s?{...i,macros:(i.macros||[]).map(c=>c.id===r?{...c,...l,updatedAt:new Date().toISOString()}:c)}:i)}))},deleteMacro:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,macros:(n.macros||[]).filter(i=>i.id!==r)}:n)}))},updatePrinter:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,...r}:n)}))},updatePrinterSettings:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,printerSettings:{...n.printerSettings,...r,lastUpdated:new Date().toISOString()}}:n)}))},deletePrinter:s=>{t(r=>{const l=r.printers.filter(i=>i.id!==s);let n=r.activePrinterId;return r.activePrinterId===s&&(n=l.length>0?l[0].id:null),{printers:l,activePrinterId:n}})},setActivePrinter:s=>{t({activePrinterId:s})},updateCalibrationStep:(s,r,l)=>{t(n=>({printers:n.printers.map(i=>{var c;return i.id===s?{...i,calibrationSteps:{...i.calibrationSteps,[r]:{...i.calibrationSteps[r],...l,lastUpdated:new Date().toISOString(),activeTab:l.activeTab||((c=i.calibrationSteps[r])==null?void 0:c.activeTab)||"Instructions"}},calibrationHistory:[...i.calibrationHistory||[],{id:crypto.randomUUID(),stepId:r,timestamp:new Date().toISOString(),results:l.results||null,inputs:l.inputValues||null}]}:i})}))},addIssue:(s,r)=>{const l={id:`issue_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),status:"open",resolvedTimestamp:null,followUpActions:[],...r};return t(n=>({printers:n.printers.map(i=>i.id===s?{...i,issues:[...i.issues||[],l]}:i)})),l.id},updateIssue:(s,r,l)=>{t(n=>({printers:n.printers.map(i=>{var c;return i.id===s?{...i,issues:((c=i.issues)==null?void 0:c.map(o=>o.id===r?{...o,...l,...l.status==="resolved"&&o.status!=="resolved"?{resolvedTimestamp:new Date().toISOString()}:{},...l.status!=="resolved"&&o.status==="resolved"?{resolvedTimestamp:null}:{}}:o))||[]}:i})}))},deleteIssue:(s,r)=>{t(l=>({printers:l.printers.map(n=>{var i;return n.id===s?{...n,issues:((i=n.issues)==null?void 0:i.filter(c=>c.id!==r))||[]}:n})}))},addFollowUpAction:(s,r,l)=>{const n={id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,description:l,completed:!1,timestamp:new Date().toISOString()};t(i=>({printers:i.printers.map(c=>{var o;return c.id===s?{...c,issues:((o=c.issues)==null?void 0:o.map(m=>m.id===r?{...m,followUpActions:[...m.followUpActions,n]}:m))||[]}:c})}))},updateFollowUpAction:(s,r,l,n)=>{t(i=>({printers:i.printers.map(c=>{var o;return c.id===s?{...c,issues:((o=c.issues)==null?void 0:o.map(m=>m.id===r?{...m,followUpActions:m.followUpActions.map(u=>u.id===l?{...u,completed:n}:u)}:m))||[]}:c})}))},addProfile:(s,r)=>{const l={id:crypto.randomUUID(),name:r.name||"New Profile",type:r.type||"quality",settings:r.settings||{},isActive:r.isActive||!1,materialId:r.materialId||null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...r};t(n=>({printers:n.printers.map(i=>{if(i.id!==s)return i;const c=i.slicerProfiles||{curaPath:"",profiles:[],materials:[]};return{...i,slicerProfiles:{...c,profiles:[...c.profiles||[],l]}}})}))},updateProfile:(s,r,l)=>{t(n=>({printers:n.printers.map(i=>i.id===s?{...i,slicerProfiles:{...i.slicerProfiles,profiles:i.slicerProfiles.profiles.map(c=>{if(c.id===r){const o={...c,...l,updatedAt:new Date().toISOString()};if(l.settings){const m={id:crypto.randomUUID(),timestamp:new Date().toISOString(),changes:Object.keys(l.settings||{}),snapshot:{...o.settings},source:l.source||"manual"};o.history=[...(c.history||[]).slice(-9),m]}return o}return c})}}:i)}))},deleteProfile:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,slicerProfiles:{...n.slicerProfiles,profiles:n.slicerProfiles.profiles.filter(i=>i.id!==r)}}:n)}))},duplicateProfile:(s,r)=>{const n=a().printers.find(c=>c.id===s),i=n==null?void 0:n.slicerProfiles.profiles.find(c=>c.id===r);if(i){const c={...i,id:crypto.randomUUID(),name:`${i.name} (Copy)`,isActive:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};t(o=>({printers:o.printers.map(m=>m.id===s?{...m,slicerProfiles:{...m.slicerProfiles,profiles:[...m.slicerProfiles.profiles,c]}}:m)}))}},setActiveProfile:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,slicerProfiles:{...n.slicerProfiles,profiles:n.slicerProfiles.profiles.map(i=>({...i,isActive:i.id===r}))}}:n)}))},updateCuraPath:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,slicerProfiles:{...n.slicerProfiles,curaPath:r}}:n)}))},revertProfileToVersion:(s,r,l)=>{t(n=>({printers:n.printers.map(i=>i.id===s?{...i,slicerProfiles:{...i.slicerProfiles,profiles:i.slicerProfiles.profiles.map(c=>{var o;if(c.id===r){const m=(o=c.history)==null?void 0:o.find(u=>u.id===l);if(m){const u={...c,settings:{...m.snapshot},updatedAt:new Date().toISOString()},x={id:crypto.randomUUID(),timestamp:new Date().toISOString(),changes:["reverted"],snapshot:{...m.snapshot},source:"revert",revertedFrom:l};return u.history=[...(c.history||[]).slice(-9),x],u}}return c})}}:i)}))},addMaterial:(s,r)=>{const l={id:crypto.randomUUID(),name:r.name||"New Material",type:r.type||"PLA",properties:r.properties||{},recommendedSettings:r.recommendedSettings||{},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),...r};t(n=>({printers:n.printers.map(i=>i.id===s?{...i,slicerProfiles:{...i.slicerProfiles,materials:[...i.slicerProfiles.materials||[],l]}}:i)}))},updateMaterial:(s,r,l)=>{t(n=>({printers:n.printers.map(i=>i.id===s?{...i,slicerProfiles:{...i.slicerProfiles,materials:(i.slicerProfiles.materials||[]).map(c=>c.id===r?{...c,...l,updatedAt:new Date().toISOString()}:c)}}:i)}))},deleteMaterial:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,slicerProfiles:{...n.slicerProfiles,materials:(n.slicerProfiles.materials||[]).filter(i=>i.id!==r)}}:n)}))},setProfileMaterial:(s,r,l,n=!0)=>{t(i=>({printers:i.printers.map(c=>{if(c.id!==s)return c;const o=(c.slicerProfiles.materials||[]).find(m=>m.id===l);return{...c,slicerProfiles:{...c.slicerProfiles,profiles:c.slicerProfiles.profiles.map(m=>{if(m.id!==r)return m;const u=n&&(o!=null&&o.recommendedSettings)?{...m.settings,...o.recommendedSettings}:m.settings;return{...m,materialId:l,settings:u,updatedAt:new Date().toISOString()}})}}})}))},getActivePrinter:()=>{const s=a();return s.printers.find(r=>r.id===s.activePrinterId)},getPrinterById:s=>a().printers.find(l=>l.id===s),createConfigurationSnapshot:(s,r,l="")=>{const i=a().printers.find(o=>o.id===s);if(!i)throw new Error("Printer not found");const c={id:crypto.randomUUID(),name:r,description:l,timestamp:new Date().toISOString(),printerId:s,printerName:i.name,configuration:{printerSettings:i.printerSettings,firmwareConfiguration:i.firmwareConfiguration,bedSize:i.bedSize,model:i.model,firmware:i.firmware}};return t(o=>({printers:o.printers.map(m=>m.id===s?{...m,configurationSnapshots:[...m.configurationSnapshots||[],c]}:m)})),c},restoreConfigurationSnapshot:(s,r)=>{var c;const n=a().printers.find(o=>o.id===s);if(!n)throw new Error("Printer not found");const i=(c=n.configurationSnapshots)==null?void 0:c.find(o=>o.id===r);if(!i)throw new Error("Snapshot not found");return t(o=>({printers:o.printers.map(m=>m.id===s?{...m,printerSettings:{...i.configuration.printerSettings},firmwareConfiguration:{...i.configuration.firmwareConfiguration},bedSize:{...i.configuration.bedSize},model:i.configuration.model,firmware:i.configuration.firmware}:m)})),i},deleteConfigurationSnapshot:(s,r)=>{t(l=>({printers:l.printers.map(n=>n.id===s?{...n,configurationSnapshots:(n.configurationSnapshots||[]).filter(i=>i.id!==r)}:n)}))},exportConfiguration:s=>{const l=a().printers.find(i=>i.id===s);if(!l)throw new Error("Printer not found");return{version:"1.0",timestamp:new Date().toISOString(),printer:{name:l.name,model:l.model,firmware:l.firmware,bedSize:l.bedSize,printerSettings:l.printerSettings,firmwareConfiguration:l.firmwareConfiguration},snapshots:l.configurationSnapshots||[]}},importConfiguration:(s,r)=>{if(!r.version||!r.printer)throw new Error("Invalid configuration file format");t(l=>({printers:l.printers.map(n=>n.id===s?{...n,name:r.printer.name||n.name,model:r.printer.model||n.model,firmware:r.printer.firmware||n.firmware,bedSize:r.printer.bedSize||n.bedSize,printerSettings:r.printer.printerSettings||n.printerSettings,firmwareConfiguration:r.printer.firmwareConfiguration||n.firmwareConfiguration,configurationSnapshots:r.snapshots||[]}:n)}))},compareConfigurations:(s,r,l)=>{const i=a().printers.find(f=>f.id===s);if(!i)throw new Error("Printer not found");const c=i.configurationSnapshots||[],o=c.find(f=>f.id===r),m=c.find(f=>f.id===l);if(!o||!m)throw new Error("One or both snapshots not found");const u=[],x=(f,b,N="")=>{for(const p in f){const h=N?`${N}.${p}`:p;typeof f[p]=="object"&&f[p]!==null?typeof b[p]=="object"&&b[p]!==null?x(f[p],b[p],h):u.push({path:h,type:"modified",oldValue:f[p],newValue:b[p]}):f[p]!==b[p]&&u.push({path:h,type:"modified",oldValue:f[p],newValue:b[p]})}for(const p in b)p in f||u.push({path:N?`${N}.${p}`:p,type:"added",oldValue:void 0,newValue:b[p]})};return x(o.configuration.printerSettings,m.configuration.printerSettings),{snapshot1:{name:o.name,timestamp:o.timestamp},snapshot2:{name:m.name,timestamp:m.timestamp},differences:u}},resetStore:()=>{t({printers:[],activePrinterId:null})}}),{name:"3d-printer-suite-storage",partialize:t=>({printers:t.printers,activePrinterId:t.activePrinterId})}),{name:"PrintersStore",enabled:!1})),Mr=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),Rr=()=>ue(t=>t.printers),_s=()=>ue(t=>t.activePrinterId),Ar=()=>ue(t=>t.addPrinter),Ir=()=>ue(t=>t.deletePrinter),Ts=()=>ue(t=>t.setActivePrinter),Dr=()=>ue(t=>t.resetStore),Lr=()=>ue(t=>t.updateProfile),Or=()=>ue(t=>({addProfile:t.addProfile,updateProfile:t.updateProfile,deleteProfile:t.deleteProfile,duplicateProfile:t.duplicateProfile,setActiveProfile:t.setActiveProfile,revertProfileToVersion:t.revertProfileToVersion})),Fr=()=>ue(t=>({addMaterial:t.addMaterial,updateMaterial:t.updateMaterial,deleteMaterial:t.deleteMaterial,setProfileMaterial:t.setProfileMaterial})),qt=()=>ue(t=>t.getActivePrinter),Ur=[115200,25e4,57600,38400,9600],V=Je(Ke(Nr((t,a)=>{let s=null,r=null,l=null,n=new TextEncoder,i=!1,c=null;const o=(T,I="sys")=>{const A=new Date().toLocaleTimeString(),O=Date.now();t(X=>{const $=[...X.serialLogs,{timestamp:A,message:T,type:I,timestampMs:O}],se=1e3,J=60*60*1e3;let U=$;return $.length>se/2&&(U=$.filter(W=>O-(W.timestampMs||0)<J)),U.length>se&&(U=U.slice(-se)),{serialLogs:U}},!1,"appendSerialLog")},m=T=>{const I={units:{linear:"mm",temperature:"C"},filament:{diameter:1.75,type:"PLA"},stepsPerUnit:{x:80,y:80,z:400,e:93},feedrates:{x:500,y:500,z:5,e:25},acceleration:{max:1e3,print:1e3,retract:1e3,travel:1e3,jerk:{x:0,y:0,z:0,e:0}},homeOffset:{x:0,y:0,z:0},bedLeveling:{enabled:!1,mesh:[],fadeHeight:10},materialHeating:{pla:{hotend:200,bed:60},abs:{hotend:240,bed:100},petg:{hotend:230,bed:80}},pid:{hotend:{p:21.73,i:1.54,d:73.76},bed:{p:301.25,i:24.2,d:73.76}},powerLossRecovery:!0,zProbeOffset:{x:0,y:0,z:0},linearAdvance:0,filamentLoadUnload:{loadLength:0,unloadLength:0},lastUpdated:new Date().toISOString()},A=T.split(`
`).map(O=>O.trim()).filter(O=>O.length>0);for(const O of A)try{const X=O.match(/M92\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if(X){I.stepsPerUnit={x:parseFloat(X[1]),y:parseFloat(X[2]),z:parseFloat(X[3]),e:parseFloat(X[4])};continue}const $=O.match(/M203\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if($){I.feedrates={x:parseFloat($[1]),y:parseFloat($[2]),z:parseFloat($[3]),e:parseFloat($[4])};continue}const se=O.match(/M201\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if(se){I.acceleration.max=Math.max(parseFloat(se[1]),parseFloat(se[2]),parseFloat(se[3]),parseFloat(se[4]));continue}const J=O.match(/M204\s+P(\d+(?:\.\d+)?)\s+R(\d+(?:\.\d+)?)\s+T(\d+(?:\.\d+)?)/i);if(J){I.acceleration.print=parseFloat(J[1]),I.acceleration.retract=parseFloat(J[2]),I.acceleration.travel=parseFloat(J[3]);continue}const U=O.match(/M205\s+X(\d+(?:\.\d+)?)\s+Y(\d+(?:\.\d+)?)\s+Z(\d+(?:\.\d+)?)\s+E(\d+(?:\.\d+)?)/i);if(U){I.acceleration.jerk={x:parseFloat(U[1]),y:parseFloat(U[2]),z:parseFloat(U[3]),e:parseFloat(U[4])};continue}const W=O.match(/M206\s+X(-?\d+(?:\.\d+)?)\s+Y(-?\d+(?:\.\d+)?)\s+Z(-?\d+(?:\.\d+)?)/i);if(W){I.homeOffset={x:parseFloat(W[1]),y:parseFloat(W[2]),z:parseFloat(W[3])};continue}const ee=O.match(/M420\s+S(\d+)\s+Z(\d+(?:\.\d+)?)/i);if(ee){I.bedLeveling.enabled=parseInt(ee[1])===1,I.bedLeveling.fadeHeight=parseFloat(ee[2]);continue}const oe=O.match(/G29\s+W\s+(\d+)\s+(\d+)\s+(-?\d+(?:\.\d+)?)/i);if(oe){I.bedLeveling.mesh||(I.bedLeveling.mesh=[]),I.bedLeveling.mesh.push({i:parseInt(oe[1]),j:parseInt(oe[2]),z:parseFloat(oe[3])});continue}const ie=O.match(/M145\s+S(\d+)\s+B(\d+)\s+H(\d+)\s+F(\d+)/i);if(ie){const he=parseInt(ie[1])===0?"pla":parseInt(ie[1])===1?"abs":"petg";I.materialHeating[he]={hotend:parseInt(ie[2]),bed:parseInt(ie[3])};continue}const pe=O.match(/M301\s+P(\d+(?:\.\d+)?)\s+I(\d+(?:\.\d+)?)\s+D(\d+(?:\.\d+)?)/i);if(pe){I.pid.hotend={p:parseFloat(pe[1]),i:parseFloat(pe[2]),d:parseFloat(pe[3])};continue}const L=O.match(/M304\s+P(\d+(?:\.\d+)?)\s+I(\d+(?:\.\d+)?)\s+D(\d+(?:\.\d+)?)/i);if(L){I.pid.bed={p:parseFloat(L[1]),i:parseFloat(L[2]),d:parseFloat(L[3])};continue}const q=O.match(/M413\s+S(\d+)/i);if(q){I.powerLossRecovery=parseInt(q[1])===1;continue}const ae=O.match(/M851\s+X(-?\d+(?:\.\d+)?)\s+Y(-?\d+(?:\.\d+)?)\s+Z(-?\d+(?:\.\d+)?)/i);if(ae){I.zProbeOffset={x:parseFloat(ae[1]),y:parseFloat(ae[2]),z:parseFloat(ae[3])};continue}const xe=O.match(/M900\s+K(\d+(?:\.\d+)?)/i);if(xe){I.linearAdvance=parseFloat(xe[1]);continue}const ce=O.match(/M603\s+T(\d+(?:\.\d+)?)\s+L(\d+(?:\.\d+)?)\s+U(\d+(?:\.\d+)?)/i);if(ce){I.filamentLoadUnload={loadLength:parseFloat(ce[2]),unloadLength:parseFloat(ce[3])};continue}}catch(X){console.warn("Error parsing M503 line:",O,X)}return I},u=T=>{try{if((T.includes("echo:")||T.includes("Bed")||T.includes("Mesh")||T.includes("[")||T.includes("X:")||T.includes("Y:")||T.includes("Z:")||T.includes("eeprom:")||T.includes("ok")||T.includes("M503"))&&console.log("M503 Response:",T),T.trim()&&!T.includes("ok")&&!T.includes("echo:busy")&&console.log("Potential bed mesh data:",T),T.includes("Bed Leveling Grid:")||T.includes("Bilinear Leveling Grid:")||T.includes("Mesh Bed Leveling")||T.includes("Bilinear Leveling")){const A=T.match(/Size (\d+)x(\d+)/);if(A)return{type:"grid_size",gridSize:{x:parseInt(A[1]),y:parseInt(A[2])}}}if(T.includes("Bed Leveling:")||T.includes("Bilinear Leveling:")||T.includes("Mesh Bed Leveling:"))return{type:"bed_leveling_status",message:T};const I=T.match(/G29\s+W\s+I(\d+)\s+J(\d+)\s+Z(-?\d+(?:\.\d+)?)/i);if(I){const A=parseInt(I[1]),O=parseInt(I[2]),X=parseFloat(I[3]);return{type:"mesh_point",i:A,j:O,z:X}}if(T.includes("echo:")&&T.includes("0.000")){const A=T.replace("echo:","").trim().split(/\s+/).map(Number).filter(O=>!isNaN(O));if(A.length>0)return{type:"mesh_row",values:A}}if(T.includes("Bed leveling done")||T.includes("G29 finished")||T.includes("Bilinear Leveling Grid:"))return{type:"leveling_complete"};if(T.includes("No bed leveling data")||T.includes("Bed leveling not active")||T.includes("Bed leveling OFF"))return{type:"no_bed_data"};if(T.includes("eeprom:"))return{type:"eeprom_response",message:T};if(T.trim().match(/^[-+]?\d*\.?\d+(\s+[-+]?\d*\.?\d+)*$/)){const A=T.trim().split(/\s+/).map(Number).filter(O=>!isNaN(O));if(A.length>=3)return{type:"mesh_row",values:A}}if(T.trim().match(/^\s*[-+]?\d*\.?\d+/)&&T.includes(".")){const A=T.trim().split(/\s+/).map(Number).filter(O=>!isNaN(O));if(A.length>=3)return{type:"mesh_row",values:A}}if(T.trim().startsWith("[")&&T.includes(",")){const A=T.trim().replace(/[\[\]]/g,"").split(",").map(O=>parseFloat(O.trim())).filter(O=>!isNaN(O));if(A.length>=3)return{type:"mesh_point",x:A[0],y:A[1],z:A[2]}}if(T.trim().startsWith("[")&&!T.includes(",")){const A=T.trim().replace(/[\[\]]/g,"").split(/\s+/).filter(Boolean).map(Number).filter(O=>!isNaN(O));if(A.length>0)return{type:"mesh_row",values:A}}if(T.trim().match(/^\s*[-+]?\d*\.?\d+\s+[-+]?\d*\.?\d+\s+[-+]?\d*\.?\d+/)){const A=T.trim().split(/\s+/).map(Number).filter(O=>!isNaN(O));if(A.length>=3)return{type:"mesh_row",values:A}}if(T.includes("Bed X:")&&T.includes("Y:")&&T.includes("Z:")){const A=T.match(/X:\s*([-\d.]+)/),O=T.match(/Y:\s*([-\d.]+)/),X=T.match(/Z:\s*([-\d.]+)/);if(A&&O&&X)return{type:"mesh_point",x:parseFloat(A[1]),y:parseFloat(O[1]),z:parseFloat(X[1])}}return null}catch(I){return console.warn("Error parsing bed mesh data:",I),null}},x=T=>{if(!T||!T.data.length)return;const I=T.data.flat(),A=Math.min(...I),O=Math.max(...I),X=O-A;t($=>({bedMesh:{data:T.data,gridSize:T.gridSize,min:A,max:O,range:X,timestamp:Date.now(),rawData:$.bedMesh.rawData}}),!1,"updateBedMesh")},f=()=>{var J;const I=a().bedMesh.rawData||[];if(I.length===0)return;let A={x:0,y:0};const O=[],X=[];let $=!1,se=!1;console.log("Processing bed mesh data:",I);for(const U of I)U.type==="grid_size"?(A=U.gridSize,console.log("Found grid size:",A)):U.type==="mesh_row"?(O.push(U.values),console.log("Found mesh row:",U.values)):U.type==="mesh_point"?(X.push({i:U.i,j:U.j,z:U.z}),console.log("Found mesh point:",{i:U.i,j:U.j,z:U.z})):U.type==="leveling_complete"?($=!0,console.log("Found leveling complete signal")):U.type==="no_bed_data"?(se=!0,console.log("Found no bed data signal")):U.type==="bed_leveling_status"?console.log("Found bed leveling status:",U.message):U.type==="eeprom_response"&&console.log("Found eeprom response:",U.message);if(se){o("No bed leveling data found on printer. Run G29 to create bed leveling mesh.","sys"),t(U=>({bedMesh:{...U.bedMesh,rawData:[]}}),!1,"clearBedMeshRawData");return}if($||A.x>0&&A.y>0&&O.length>0||O.length>=3||X.length>0){if(X.length>0){if(A.x===0||A.y===0){const U=Math.max(...X.map(ee=>ee.i)),W=Math.max(...X.map(ee=>ee.j));A={x:U+1,y:W+1}}console.log("Processing G29 W mesh points with grid size:",A,"and",X.length,"points"),x({data:X,gridSize:A}),o(`Bed leveling data loaded: ${A.x}x${A.y} grid with ${X.length} points`,"sys")}else if(O.length>0){if(A.x===0||A.y===0){const U=O.length;if(U===9)A={x:3,y:3};else if(U===16)A={x:4,y:4};else if(U===25)A={x:5,y:5};else if(U===49)A={x:7,y:7};else{const W=((J=O[0])==null?void 0:J.length)||0;W>0&&(A={x:W,y:Math.ceil(U/W)})}}console.log("Processing mesh with grid size:",A,"and",O.length,"rows"),x({data:O,gridSize:A}),o(`Bed leveling data loaded: ${A.x}x${A.y} grid with ${O.length} points`,"sys")}t(U=>({bedMesh:{...U.bedMesh,rawData:[]}}),!1,"clearBedMeshRawData"),$&&o("Bed leveling procedure completed successfully","sys")}else I.length>0&&console.log("Insufficient bed mesh data to process:",{gridSize:A,meshRows:O.length,meshPoints:X.length,hasLevelingComplete:$})},b=async()=>{var I;const T=a();if(T.status==="connected"&&((I=T.port)!=null&&I.writable))try{o("Processing collected bed level data...","sys"),f()}catch(A){o(`Failed to process bed level data: ${A.message}`,"err")}},N=async()=>{var I;const T=a();if(T.status==="connected"&&((I=T.port)!=null&&I.writable))try{o("Starting automatic bed leveling procedure...","sys"),o("This will take several minutes. Do not interrupt the process.","sys"),t(A=>({bedMesh:{data:[],gridSize:{x:0,y:0},min:0,max:0,range:0,timestamp:null,rawData:[]}}),!1,"clearBedMesh"),await y("G29"),setTimeout(()=>{f()},3e4)}catch(A){o(`Failed to run bed leveling: ${A.message}`,"err")}},p=()=>{const T=Date.now(),I=60*60*1e3;t(A=>({serialLogs:A.serialLogs.filter(O=>T-(O.timestampMs||0)<I)}),!1,"cleanupOldLogs")},h=async()=>{var T;try{if(r&&(r.abort(),r=null),s){try{await s.cancel()}catch(I){if(!((T=I.message)!=null&&T.includes("locked")))throw I}try{await s.releaseLock()}catch{}}}catch(I){o(`Warning: Error closing reader: ${I.message}`,"sys")}finally{s=null}},g=async()=>{var T;try{await h()}catch{}try{l&&((T=l.readable)==null||T.cancel())}catch{}l=null},j=T=>{const I={};let A=T.match(/T:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);A&&(I.hotend={current:parseFloat(A[1]),target:parseFloat(A[2])}),I.hotend||(A=T.match(/T:(\d+\.?\d*)\/(\d+\.?\d*)/),A&&(I.hotend={current:parseFloat(A[1]),target:parseFloat(A[2])})),I.hotend||(A=T.match(/ok\s+T:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/),A&&(I.hotend={current:parseFloat(A[1]),target:parseFloat(A[2])}));let O=T.match(/B:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);return O&&(I.bed={current:parseFloat(O[1]),target:parseFloat(O[2])}),I.bed||(O=T.match(/B:(\d+\.?\d*)\/(\d+\.?\d*)/),O&&(I.bed={current:parseFloat(O[1]),target:parseFloat(O[2])})),I},S=async T=>{try{r&&(r.abort(),r=null),r=new AbortController,l=new TextDecoderStream;try{const I=T.readable.pipeTo(l.writable),A=l.readable.getReader();s=A;let O="",X=Date.now();for(;!(r!=null&&r.signal.aborted);)try{const{value:$,done:se}=await A.read();if(se){o("Read stream closed","sys");break}if($){O+=$;let J;for(;(J=O.indexOf(`
`))>=0;){const U=O.slice(0,J).replace(/\r$/,"");if(O=O.slice(J+1),U.trim().length>0){if(X=Date.now(),o(U,"rx"),U.includes("T:")||U.includes("B:")){const ee=j(U);(ee.hotend||ee.bed)&&t(oe=>({temperatures:{...oe.temperatures,...ee,timestamp:Date.now()}}),!1,"updateTemperatures")}const W=u(U);if(W&&t(ee=>({bedMesh:{...ee.bedMesh,rawData:[...ee.bedMesh.rawData||[],W]}}),!1,"addBedMeshRawData"),(U.includes("M92")||U.includes("M203")||U.includes("M201")||U.includes("M204")||U.includes("M205")||U.includes("M206")||U.includes("M420")||U.includes("G29 W")||U.includes("M145")||U.includes("M301")||U.includes("M304")||U.includes("M413")||U.includes("M851")||U.includes("M900")||U.includes("M603"))&&t(ee=>({m503Response:[...ee.m503Response||[],U]}),!1,"addM503Response"),U.toLowerCase().includes("error"))o(`Printer error: ${U}`,"err");else if(U.toLowerCase()==="ok")continue}}}Date.now()-X>1e4&&(o("Warning: No response from printer for 10 seconds","sys"),X=Date.now())}catch($){if(($==null?void 0:$.name)!=="AbortError")throw o(`Read error: ${$.message}`,"err"),$;break}await I.catch($=>{($==null?void 0:$.name)!=="AbortError"&&o(`Stream closed with error: ${$.message}`,"err")})}catch(I){if((I==null?void 0:I.name)!=="AbortError")throw o(`Read loop error: ${(I==null?void 0:I.message)||I}`,"err"),I}}catch(I){throw o(`Failed to start read loop: ${(I==null?void 0:I.message)||I}`,"err"),I}},M=async(T,I)=>{if(!T)throw new Error("No port provided");o(`Opening port @ ${I}…`,"sys");try{try{r&&(r.abort(),r=null),await g(),(T.readable||T.writable)&&await T.close(),await new Promise(X=>setTimeout(X,1e3))}catch(X){o(`Warning: Error while closing port: ${X.message}`,"sys"),await new Promise($=>setTimeout($,1e3))}const A={baudRate:I,dataBits:8,stopBits:1,parity:"none",bufferSize:255,flowControl:"none"};o(`Configuring port with baud ${I}`,"sys"),await T.open(A),o("Port opened successfully","sys"),t({port:T,status:"connected"},!1,"setPort"),await new Promise(X=>setTimeout(X,500)),setTimeout(async()=>{if(a().m503SentOnConnection)o("Printer configuration already fetched on connection","sys");else{try{await a().fetchAllPrinterSettings(),t({m503SentOnConnection:!0},!1,"markM503Sent"),await a().fetchBedLevel(),o("Printer configuration and bed level data fetched automatically","sys")}catch($){o(`Error fetching printer data: ${$.message}`,"err")}setTimeout(()=>{a().bedMesh.data.length===0&&o("No existing bed leveling data found. Consider running G29 for automatic bed leveling.","sys")},5e3)}},1e3);const O=setInterval(()=>{p()},10*60*1e3);if(t(X=>({...X,logCleanupInterval:O}),!1,"setLogCleanupInterval"),!T.readable||!T.writable)throw new Error("Port closed unexpectedly after opening");return await S(T),!0}catch(A){throw o(`Failed to open port @ ${I}: ${A.message}`,"err"),A}},_=async(T=!1)=>{const I=a();try{if(!T&&I.status==="disconnected")return;(I.status==="connected"||I.status==="connecting")&&o("Disconnecting...","sys");const A=I.port;t({port:null,status:"disconnected",m503SentOnConnection:!1},!1,"disconnect");try{r&&(r.abort(),r=null);const O=a();O.logCleanupInterval&&(clearInterval(O.logCleanupInterval),t({logCleanupInterval:null},!1,"clearLogCleanupInterval")),await g(),A&&(A.readable||A.writable)&&(await A.close(),o("Port closed","sys"))}catch(O){o(`Warning during cleanup: ${O.message}`,"sys")}}catch(A){o(`Error during disconnect: ${A.message}`,"err")}},P=async(T={})=>{var A,O,X,$,se,J;const I=a();try{if(t({error:null},!1,"connect/clearError"),!("serial"in navigator))throw new Error("Web Serial API not supported in this browser");if(I.status==="connected")return;if(I.status==="connecting")throw new Error("Connection already in progress");i=!0,await _(!0),t({port:null,status:"connecting"},!1,"connect/setConnecting"),await new Promise(U=>setTimeout(U,500));try{const U=await navigator.serial.getPorts();o(`Cleaning up ${U.length} existing ports...`,"sys");for(const W of U)try{const ee=W.getInfo();o(`Closing port VID: 0x${((A=ee.usbVendorId)==null?void 0:A.toString(16))||"none"}, PID: 0x${((O=ee.usbProductId)==null?void 0:O.toString(16))||"none"}`,"sys"),(W.readable||W.writable)&&await W.close()}catch(ee){o(`Warning: Error closing port: ${ee.message}`,"sys")}await new Promise(W=>setTimeout(W,1e3))}catch(U){o(`Warning: Error during port cleanup: ${U.message}`,"sys")}try{let U;try{const ie=await navigator.serial.getPorts();o(`Found ${ie.length} previously authorized ports`,"sys");for(const pe of ie){const L=pe.getInfo();if(o(`Port: VID: 0x${((X=L.usbVendorId)==null?void 0:X.toString(16))||"none"}, PID: 0x${(($=L.usbProductId)==null?void 0:$.toString(16))||"none"}`,"sys"),L.usbVendorId===6790){o("Found previously authorized CH340 device","sys"),U=pe;break}}U||(o("Requesting port selection...","sys"),U=await navigator.serial.requestPort({filters:[{usbVendorId:6790,usbProductId:29987},{usbVendorId:6790,usbProductId:21795},{usbVendorId:6790,usbProductId:29986},{usbVendorId:6790,usbProductId:21778},{usbVendorId:6790}]}),o("New CH340 device selected","sys")),o("CH340 USB-Serial adapter detected","sys")}catch{o("No CH340 device found, trying any available port...","sys"),U=await navigator.serial.requestPort({filters:[]})}if(!U)throw new Error("No port selected");let W=!1,ee=null;const oe=T.autoDetect??I.autoDetect?Ur:[T.baudRate||I.baudRate];for(const ie of oe)try{await M(U,ie),W=!0,ee=ie,t({baudRate:ie},!1,"connect/setBaud");break}catch(pe){o(`Failed @ ${ie}: ${(pe==null?void 0:pe.message)||pe}`,"err");try{(U.readable||U.writable)&&await U.close()}catch{}}if(!W)throw new Error("Unable to establish serial communication at common baud rates");if(!U||!U.readable||!U.writable)throw new Error("Port validation failed after opening");o(`Connected @ ${ee}`,"sys")}catch(U){throw o(`Communication check failed: ${U.message}`,"err"),await _(!0),new Error(`Failed to verify communication: ${U.message}`)}}catch(U){t({status:"disconnected"},!1,"connect/error");let W=(U==null?void 0:U.message)||String(U);W.includes("Could not establish connection")||W.includes("Receiving end does not exist")?W=`Browser connection error. Please try:
1. Refresh the page
2. Close and reopen browser
3. Disable browser extensions
4. Try a different browser (Chrome recommended)`:W.includes("Connection already in progress")?W="Already trying to connect. Please wait...":W.includes("Still verifying connection")?W="Please wait - verifying connection to printer...":W.includes("No response from printer")?W=`No response from printer. Please check:
1. Printer is powered on and not in a menu
2. Correct baud rate (115200 for Ender 3)
3. USB cable is firmly connected
4. Try unplugging and reconnecting USB cable`:W.includes("Port open timeout")?W=`Port open timed out. The port might be locked. Please try:
1. Close ALL applications that might use COM3:
   - Pronterface
   - Cura
   - PuTTY
   - Arduino IDE
2. Open Task Manager and end these processes if found:
   - Pronterface.exe
   - python.exe (if running Pronterface)
   - Cura.exe
3. Open Device Manager:
   - Find "USB-SERIAL CH340 (COM3)"
   - Right-click -> Disable
   - Wait 5 seconds
   - Right-click -> Enable`:W.includes("NetworkError")||W.includes('Failed to execute "open"')?W=`Could not open serial port. Please check:
1. In Device Manager, verify:
   - "USB-SERIAL CH340 (COM3)" is present
   - Driver provider is wch.cn
   - Driver version is 3.9.2024.9
2. Try these steps in order:
   a. Unplug USB cable
   b. Wait 10 seconds
   c. Open Device Manager
   d. Plug in USB cable
   e. Watch Device Manager - should show COM3
   f. If COM3 doesn't appear, uninstall driver and reinstall
3. If still failing:
   - Try a different USB port
   - Try a different USB cable
   - Check if printer powers on via USB`:W.includes("No valid Marlin response")&&(W=`No response from printer. Please check:
1. The correct baud rate is selected (usually 115200)
2. The printer is not in a boot/flash mode
3. The USB-Serial adapter is working properly`),t({error:W},!1,"connect/setError"),o(`Connection error: ${W}`,"err");try{await((J=(se=I.port)==null?void 0:se.close)==null?void 0:J.call(se))}catch{}t({port:null},!1,"connect/clearPort")}finally{i=!1}};let E=null,F=null;const v=async()=>{E&&await E,E=new Promise(T=>{F=T})},C=()=>{F&&(F(),E=null,F=null)},y=async T=>{const I=a();if(!I.port||!I.port.writable||I.status!=="connected"){o(`Cannot send command - not connected. Status: ${I.status}`,"err");return}if(!T||T.trim().length===0)return;await v();let A=null;try{try{A=I.port.writable.getWriter()}catch{C(),o("Writer was locked, retrying shortly…","sys"),await new Promise(ee=>setTimeout(ee,50)),await v(),A=I.port.writable.getWriter()}const O=T.trim().toUpperCase();o(O,"tx");const X=`${O}\r
`;n||(n=new TextEncoder);const $=n.encode(X);console.log("Sending command:",O,"Command text:",X,"Encoded data:",$);const se=new TextDecoder().decode($);if(se!==X)throw console.error("Data corruption detected! Original:",X,"Decoded:",se),new Error("Data corruption detected in command encoding");await A.write($);const U=a().isStreamingProgram?5:50;await new Promise(W=>setTimeout(W,U))}catch(O){throw o(`Send error: ${O.message}`,"err"),O}finally{if(A)try{A.releaseLock()}catch(O){o(`Warning: Error releasing writer: ${O.message}`,"err")}C()}},w=async(T,I=50)=>{for(const A of T)!A||/^\s*(;|#)/.test(A)||(await y(A),I&&await new Promise(O=>setTimeout(O,I)))},k=async(T,I={})=>{const{delayMs:A=100,waitForReady:O=!0}=I;for(const X of T)!X||/^\s*(;|#)/.test(X)||(await K(X,{waitForReady:O}),A&&await new Promise($=>setTimeout($,A)))},H=async(T=1e4)=>{const I=Date.now();for(;Date.now()-I<T;){if(!a().serialLogs.slice(-10).some($=>$.type==="rx"&&$.message.includes("echo:busy: processing")))return!0;await new Promise($=>setTimeout($,100))}return!1},K=async(T,I={})=>{const{waitForReady:A=!0,maxRetries:O=3,retryDelay:X=1e3}=I;if(!T||T.trim().length===0)return;const $=a();if(!$.port||!$.port.writable||$.status!=="connected"){o(`Cannot send command - not connected. Status: ${$.status}`,"err");return}if(A&&!await H()){o("Printer busy timeout - command skipped","warn");return}await y(T),await new Promise(se=>setTimeout(se,100))},z=async(T,I={})=>{const{delayMs:A=100,waitForReady:O=!0,onProgress:X,executionData:$={}}=I,se=a();if(!se.port||!se.port.writable||se.status!=="connected")throw o(`Cannot start program - not connected. Status: ${se.status}`,"err"),new Error("Not connected");const J=String(T).split(/\r?\n/).map(ee=>ee.trim()).filter(ee=>ee.length>0&&!ee.startsWith(";")&&!ee.startsWith("#"));let U=0;c=new AbortController,$.stepName&&a().startExecution({...$,totalCommands:J.length});const W=()=>new Promise((ee,oe)=>{if(!waitForOk)return ee();let ie=!1;const pe=Date.now(),L=V.subscribe(q=>q.serialLogs.length,()=>{const q=a().serialLogs.slice(-10),ae=q.some(he=>he.type==="rx"&&/^ok\b/i.test(String(he.message).trim())),xe=q.some(he=>he.type==="rx"&&/echo:busy: processing/i.test(String(he.message).trim())),ce=q.some(he=>he.type==="rx"&&/error|unknown|invalid/i.test(he.message));Date.now()-pe>1e3&&!ie&&(console.log("Awaiting OK - Recent logs:",q.map(he=>`${he.type}: ${he.message}`).slice(-3)),console.log("hasOk:",ae,"hasBusy:",xe,"hasErr:",ce)),(ae||xe)&&!ie?(ie=!0,L(),ee()):ce&&!ie?(ie=!0,L(),oe(new Error("Printer error reported"))):Date.now()-pe>okTimeoutMs&&!ie&&(ie=!0,L(),ee())})});t({isStreamingProgram:!0},!1,"startProgramStream");try{for(let oe=0;oe<J.length;oe++){if(c!=null&&c.signal.aborted)throw o("G-code execution aborted by user","warn"),new Error("Execution aborted by user");await K(J[oe],{waitForReady:O}),A&&await new Promise(ie=>setTimeout(ie,A));try{await W(),console.log(`G-code line ${oe+1}/${J.length} acknowledged: ${J[oe]}`)}catch(ie){console.warn(`G-code line ${oe+1}/${J.length} timeout/error: ${J[oe]}`,ie.message)}U=oe+1,$.stepName&&a().updateExecutionProgress({sent:U,total:J.length}),typeof X=="function"&&X(U,J.length)}const ee={sent:U,total:J.length};return $.stepName&&a().completeExecution(ee),ee}catch(ee){throw $.stepName&&a().cancelExecution(),ee}finally{t({isStreamingProgram:!1},!1,"endProgramStream"),c=null}},Z=async(T,I={})=>{const{delayMs:A=100,maxRetries:O=3,retryDelayMs:X=500,onProgress:$=null,onError:se=null}=I,J=[];let U=0,W=0;for(let ee=0;ee<T.length;ee++){const oe=T[ee];let ie=0,pe=!1;for(;ie<O&&!pe;)try{if(o(`Sending command ${ee+1}/${T.length}: ${oe}`,"sys"),await y(oe),await new Promise(ae=>setTimeout(ae,A)),a().serialLogs.slice(-5).some(ae=>ae.message.toLowerCase().includes("error")||ae.message.toLowerCase().includes("invalid")||ae.message.toLowerCase().includes("unknown")))throw new Error("Command failed - error response detected");pe=!0,U++,J.push({command:oe,success:!0,attempts:ie+1}),$&&$(ee+1,T.length,oe,!0)}catch(L){ie++,o(`Command failed (attempt ${ie}/${O}): ${oe} - ${L.message}`,"err"),ie<O?(o(`Retrying in ${X}ms...`,"sys"),await new Promise(q=>setTimeout(q,X))):(W++,J.push({command:oe,success:!1,attempts:ie,error:L.message}),se&&se(oe,L,ee+1,T.length))}ee<T.length-1&&await new Promise(L=>setTimeout(L,A))}return o(`Bulk configuration complete: ${U} successful, ${W} failed`,"sys"),{results:J,successCount:U,failureCount:W,total:T.length}},ne=(T,I)=>{const A=Array.isArray(I)?I:[I];for(const O of A){const X=O.message||O;if(X.toLowerCase().includes("ok"))return{success:!0,message:"Command acknowledged"};if(X.toLowerCase().includes("error")||X.toLowerCase().includes("invalid")||X.toLowerCase().includes("unknown"))return{success:!1,error:X};if(T.startsWith("M92")){const $=X.match(/echo:Steps per unit:\s*X:(\d+(?:\.\d+)?)\s*Y:(\d+(?:\.\d+)?)\s*Z:(\d+(?:\.\d+)?)\s*E:(\d+(?:\.\d+)?)/i);if($)return{success:!0,data:{x:parseFloat($[1]),y:parseFloat($[2]),z:parseFloat($[3]),e:parseFloat($[4])}}}if(T.startsWith("M203")){const $=X.match(/echo:Maximum feedrates:\s*X:(\d+(?:\.\d+)?)\s*Y:(\d+(?:\.\d+)?)\s*Z:(\d+(?:\.\d+)?)\s*E:(\d+(?:\.\d+)?)/i);if($)return{success:!0,data:{x:parseFloat($[1]),y:parseFloat($[2]),z:parseFloat($[3]),e:parseFloat($[4])}}}if(T.startsWith("M301")){const $=X.match(/echo:Hotend PID:\s*P:(\d+(?:\.\d+)?)\s*I:(\d+(?:\.\d+)?)\s*D:(\d+(?:\.\d+)?)/i);if($)return{success:!0,data:{p:parseFloat($[1]),i:parseFloat($[2]),d:parseFloat($[3])}}}if(T.startsWith("M304")){const $=X.match(/echo:Bed PID:\s*P:(\d+(?:\.\d+)?)\s*I:(\d+(?:\.\d+)?)\s*D:(\d+(?:\.\d+)?)/i);if($)return{success:!0,data:{p:parseFloat($[1]),i:parseFloat($[2]),d:parseFloat($[3])}}}}return{success:!0,message:"Command sent"}},je=async()=>{try{o("EMERGENCY STOP ACTIVATED","err");const T=["M112","M410","M84"];for(const I of T)try{await y(I),await new Promise(A=>setTimeout(A,100))}catch(A){o(`Emergency command ${I} failed: ${A.message}`,"err")}return o("Emergency stop sequence completed","sys"),!0}catch(T){return o(`Emergency stop failed: ${T.message}`,"err"),!1}};return{port:null,status:"disconnected",baudRate:115200,autoDetect:!0,isConnecting:!1,error:null,serialLogs:[],temperatures:{hotend:{current:0,target:0},bed:{current:0,target:0},timestamp:Date.now(),lastPoll:Date.now()},bedMesh:{data:[],gridSize:{x:0,y:0},min:0,max:0,range:0,timestamp:null,rawData:[]},m503Response:[],m503SentOnConnection:!1,writerLock:null,writerPromise:null,logCleanupInterval:null,isStreamingProgram:!1,activeExecution:null,executionHistory:[],setPort:T=>t({port:T},!1,"setPort"),setStatus:T=>t({status:T},!1,"setStatus"),setBaudRate:T=>t({baudRate:T},!1,"setBaudRate"),setAutoDetect:T=>t({autoDetect:T},!1,"setAutoDetect"),setIsConnecting:T=>t({isConnecting:T},!1,"setIsConnecting"),setError:T=>t({error:T},!1,"setError"),appendSerialLog:o,updateTemperatures:T=>t(I=>({temperatures:{...I.temperatures,...T,timestamp:Date.now()}}),!1,"updateTemperatures"),setWriterLock:T=>t({writerLock:T},!1,"setWriterLock"),setWriterPromise:T=>t({writerPromise:T},!1,"setWriterPromise"),clearLogs:()=>t({serialLogs:[]},!1,"clearLogs"),reset:()=>t({port:null,status:"disconnected",baudRate:115200,autoDetect:!0,isConnecting:!1,error:null,serialLogs:[],temperatures:{hotend:{current:0,target:0},bed:{current:0,target:0},timestamp:Date.now()},bedMesh:{data:[],gridSize:{x:0,y:0},min:0,max:0,range:0,timestamp:null,rawData:[]},writerLock:null,writerPromise:null,logCleanupInterval:null},!1,"reset"),connect:P,disconnect:_,sendCommand:y,sendCommands:w,sendCommandWithWait:K,sendCommandsWithWait:k,waitForPrinterReady:H,sendGcodeProgram:z,fetchBedLevel:b,runBedLeveling:N,processBedMeshData:f,updateBedMesh:x,cleanupOldLogs:p,processCollectedBedMeshData:()=>{const T=a();T.bedMesh.rawData&&T.bedMesh.rawData.length>0?(o("Manually processing collected bed mesh data...","sys"),f()):o("No bed mesh data collected to process. Try fetching bed level data first.","sys")},processM503Response:()=>{const I=a().m503Response||[];if(I.length===0)return o("No M503 response data to process","sys"),null;try{const A=I.join(`
`),O=m(A);return o(`Successfully parsed M503 response with ${I.length} lines`,"sys"),o(`Parsed settings: ${Object.keys(O).join(", ")}`,"sys"),t({m503Response:[]},!1,"clearM503Response"),O}catch(A){return o(`Error processing M503 response: ${A.message}`,"err"),null}},clearM503Response:()=>t({m503Response:[]},!1,"clearM503Response"),fetchAllPrinterSettings:async()=>{var I;const T=a();if(T.status==="connected"&&((I=T.port)!=null&&I.writable))try{o("Fetching all printer settings (M503)...","sys"),o("This will capture all current settings including bed leveling data","sys"),t(A=>({bedMesh:{...A.bedMesh,rawData:[]},m503Response:[]}),!1,"clearRawData"),await new Promise(A=>setTimeout(A,100)),await y("M503"),setTimeout(()=>{const A=a(),O=A.bedMesh.rawData||[],X=A.m503Response||[];if(o(`Captured ${O.length} bed mesh items and ${X.length} M503 lines`,"sys"),X.length>0){const $=m(X.join(`
`));o(`Parsed M503 settings: ${Object.keys($).join(", ")}`,"sys"),jr(()=>Promise.resolve().then(()=>Mr),void 0).then(se=>{const J=se.default,U=J.getState();let W=U.activePrinterId;if(console.log("SerialStore: Storing M503 settings"),console.log("SerialStore: activePrinterId:",W),console.log("SerialStore: parsedSettings:",$),console.log("SerialStore: printersState:",U),!W){const ee={name:"Connected Printer",model:"Unknown",firmware:"Unknown",bedSize:{x:220,y:220,z:250},firmwareConfiguration:{},calibrationSteps:[],lastUpdated:new Date().toISOString()};J.getState().addPrinter(ee),W=J.getState().activePrinterId,console.log("SerialStore: Created default printer with ID:",W),o(`Created default printer with ID: ${W}`,"sys")}W&&$?(J.getState().updatePrinterSettings(W,$),o(`Printer settings stored for printer ${W}`,"sys")):(console.log("SerialStore: Cannot store settings - activePrinterId:",W,"parsedSettings:",$),o(`Cannot store settings - activePrinterId: ${W}, parsedSettings: ${!!$}`,"err"))}).catch(se=>{console.log("SerialStore: Error storing printer settings:",se),o(`Error storing printer settings: ${se.message}`,"err")}),t({m503Response:[]},!1,"clearM503Response")}f()},5e3)}catch(A){o(`Failed to fetch printer settings: ${A.message}`,"err")}},sendBulkConfiguration:Z,parseConfigurationResponse:ne,emergencyStop:je,startExecution:T=>t({activeExecution:{id:Date.now().toString(),type:"calibration",stepName:T.stepName,progress:{sent:0,total:T.totalCommands},startTime:Date.now(),status:"running",...T}},!1,"startExecution"),updateExecutionProgress:T=>t(I=>({activeExecution:I.activeExecution?{...I.activeExecution,progress:{...I.activeExecution.progress,...T}}:null}),!1,"updateExecutionProgress"),completeExecution:T=>t(I=>{const A=I.activeExecution?{...I.activeExecution,status:"completed",endTime:Date.now(),result:T}:null;return{activeExecution:null,executionHistory:A?[...I.executionHistory,A].slice(-10):I.executionHistory}},!1,"completeExecution"),abortExecution:async()=>{c&&c.abort();try{await je()}catch(A){console.error("Failed to send emergency stop:",A)}const T=a(),I=T.activeExecution?{...T.activeExecution,status:"cancelled",endTime:Date.now()}:null;t({activeExecution:null,executionHistory:I?[...T.executionHistory,I].slice(-10):T.executionHistory},!1,"abortExecution")},cancelExecution:()=>t(T=>{const I=T.activeExecution?{...T.activeExecution,status:"cancelled",endTime:Date.now()}:null;return{activeExecution:null,executionHistory:I?[...T.executionHistory,I].slice(-10):T.executionHistory}},!1,"cancelExecution"),clearExecutionHistory:()=>t({executionHistory:[]},!1,"clearExecutionHistory")}}))),Br=()=>V(t=>({sendCommand:t.sendCommand,connect:t.connect,disconnect:t.disconnect,clearLogs:t.clearLogs})),Ue=Je(Ke(ct((t,a)=>({gcodeFiles:[],printQueue:[],activePrint:null,addFile:s=>{const r={id:crypto.randomUUID(),name:s.name,size:s.size,uploadDate:new Date().toISOString(),content:s.content,estimatedPrintTime:s.estimatedPrintTime||null};return t(l=>({gcodeFiles:[...l.gcodeFiles,r]})),r.id},removeFile:s=>{t(r=>({gcodeFiles:r.gcodeFiles.filter(l=>l.id!==s),printQueue:r.printQueue.filter(l=>l.fileId!==s)}))},addToQueue:s=>{if(!a().gcodeFiles.find(n=>n.id===s))return;const l={fileId:s,status:"queued",addedDate:new Date().toISOString(),startDate:null,endDate:null};t(n=>({printQueue:[...n.printQueue,l]}))},removeFromQueue:s=>{t(r=>({printQueue:r.printQueue.filter(l=>l.fileId!==s)}))},updateQueueOrder:s=>{t(r=>({printQueue:s.map(n=>r.printQueue.find(i=>i.fileId===n)).filter(Boolean)}))},startPrint:s=>{const r=a().gcodeFiles.find(l=>l.id===s);r&&t(l=>({printQueue:l.printQueue.map(n=>n.fileId===s?{...n,status:"printing",startDate:new Date().toISOString()}:n),activePrint:{fileId:s,progress:0,startTime:new Date().toISOString(),estimatedEndTime:r.estimatedPrintTime?new Date(Date.now()+r.estimatedPrintTime*1e3).toISOString():null,status:"printing"}}))},pausePrint:()=>{t(s=>s.activePrint?{printQueue:s.printQueue.map(r=>r.fileId===s.activePrint.fileId?{...r,status:"paused"}:r),activePrint:{...s.activePrint,status:"paused"}}:s)},resumePrint:()=>{t(s=>s.activePrint?{printQueue:s.printQueue.map(r=>r.fileId===s.activePrint.fileId?{...r,status:"printing"}:r),activePrint:{...s.activePrint,status:"printing"}}:s)},stopPrint:()=>{t(s=>s.activePrint?{printQueue:s.printQueue.map(r=>r.fileId===s.activePrint.fileId?{...r,status:"cancelled",endDate:new Date().toISOString()}:r),activePrint:null}:s)},completePrint:()=>{t(s=>s.activePrint?{printQueue:s.printQueue.map(r=>r.fileId===s.activePrint.fileId?{...r,status:"completed",endDate:new Date().toISOString()}:r),activePrint:null}:s)},updatePrintProgress:s=>{t(r=>r.activePrint?{activePrint:{...r.activePrint,progress:s}}:r)},getFile:s=>a().gcodeFiles.find(r=>r.id===s),getQueueItem:s=>a().printQueue.find(r=>r.fileId===s),resetStore:()=>{t({gcodeFiles:[],printQueue:[],activePrint:null})}}),{name:"gcode-files-storage",partialize:t=>({gcodeFiles:t.gcodeFiles.map(a=>({...a,content:void 0})),printQueue:t.printQueue,activePrint:null})}),{name:"GcodeFilesStore",enabled:!1})),Cs=()=>Ue(t=>t.gcodeFiles),zr=()=>Ue(t=>t.activePrint),$r=()=>Ue(t=>t.getFile),Gr=Je(Ke(ct((t,a)=>({calibrationFiles:[],calibrationResults:[],calibrationWorkflows:[],activeWorkflow:null,addCalibrationFile:s=>{const r={id:crypto.randomUUID(),...s,type:"calibration",createdAt:new Date().toISOString(),results:null,settings:s.settings||{},analysisData:null};return t(l=>({calibrationFiles:[...l.calibrationFiles,r]})),r.id},updateCalibrationFile:(s,r)=>{t(l=>({calibrationFiles:l.calibrationFiles.map(n=>n.id===s?{...n,...r}:n)}))},addCalibrationResult:(s,r)=>{const l={id:crypto.randomUUID(),fileId:s,timestamp:new Date().toISOString(),data:r,recommendations:[],appliedSettings:null};return t(n=>({calibrationResults:[...n.calibrationResults,l],calibrationFiles:n.calibrationFiles.map(i=>i.id===s?{...i,results:l.id}:i)})),l.id},updateCalibrationResult:(s,r)=>{t(l=>({calibrationResults:l.calibrationResults.map(n=>n.id===s?{...n,...r}:n)}))},addCalibrationWorkflow:s=>{const r={id:crypto.randomUUID(),...s,createdAt:new Date().toISOString(),status:"pending",currentStep:0,results:[],recommendations:[]};return t(l=>({calibrationWorkflows:[...l.calibrationWorkflows,r]})),r.id},startWorkflow:s=>{t(r=>({activeWorkflow:s,calibrationWorkflows:r.calibrationWorkflows.map(l=>l.id===s?{...l,status:"running",currentStep:0}:l)}))},updateWorkflowStep:(s,r,l,n=null)=>{t(i=>{const c=i.calibrationWorkflows.find(m=>m.id===s);if(!c)return i;const o={...c,currentStep:r+1,results:[...c.results]};return n&&(o.results[r]=n),r+1>=c.steps.length&&(o.status="completed",o.recommendations=Vr(o.results)),{calibrationWorkflows:i.calibrationWorkflows.map(m=>m.id===s?o:m),activeWorkflow:o.status==="completed"?null:i.activeWorkflow}})},analyzeFirstLayerAdhesion:s=>({score:.85,issues:["slight_warping_corners"],recommendations:[{setting:"bed_temperature",value:65,confidence:.8},{setting:"first_layer_height",value:.24,confidence:.7}]}),analyzeStringingTest:s=>({score:.75,stringCount:12,stringThickness:.1,recommendations:[{setting:"retraction_distance",value:6.5,confidence:.85},{setting:"retraction_speed",value:45,confidence:.75}]}),analyzeBedLevel:s=>({maxDeviation:.15,problemAreas:[{x:10,y:10,deviation:.15},{x:190,y:190,deviation:-.12}],recommendations:[{corner:"front_left",adjustment:"+0.1mm"},{corner:"back_right",adjustment:"-0.1mm"}]}),getCalibrationFile:s=>a().calibrationFiles.find(r=>r.id===s),getCalibrationResult:s=>a().calibrationResults.find(r=>r.id===s),getWorkflow:s=>a().calibrationWorkflows.find(r=>r.id===s),resetStore:()=>{t({calibrationFiles:[],calibrationResults:[],calibrationWorkflows:[],activeWorkflow:null})}}),{name:"calibration-storage"}),{name:"CalibrationStore",enabled:!1}));function Vr(t){const a=[];return t.forEach(s=>{s.recommendations&&s.recommendations.forEach(r=>{const l=a.find(n=>n.setting===r.setting);if(l){const n=l.confidence+r.confidence;l.value=(l.value*l.confidence+r.value*r.confidence)/n,l.confidence=Math.max(l.confidence,r.confidence)}else a.push({...r})})}),a}const Hr=Je(Ke(ct((t,a)=>({printHistory:[],statistics:{totalPrints:0,successfulPrints:0,failedPrints:0,totalPrintTime:0,averagePrintTime:0,filamentUsed:0},addPrintRecord:s=>{const r={id:crypto.randomUUID(),timestamp:new Date().toISOString(),...s};return t(l=>{const n=[...l.printHistory,r],i={totalPrints:l.statistics.totalPrints+1,successfulPrints:l.statistics.successfulPrints+(s.status==="completed"?1:0),failedPrints:l.statistics.failedPrints+(s.status==="failed"?1:0),totalPrintTime:l.statistics.totalPrintTime+(s.duration||0),filamentUsed:l.statistics.filamentUsed+(s.filamentUsed||0)};return i.averagePrintTime=i.totalPrintTime/i.totalPrints,{printHistory:n,statistics:i}}),r.id},updatePrintRecord:(s,r)=>{t(l=>{const n=l.printHistory.findIndex(u=>u.id===s);if(n===-1)return l;const i=l.printHistory[n],c={...i,...r},o=[...l.printHistory];o[n]=c;let m={...l.statistics};return r.status&&r.status!==i.status&&(i.status==="completed"&&m.successfulPrints--,i.status==="failed"&&m.failedPrints--,r.status==="completed"&&m.successfulPrints++,r.status==="failed"&&m.failedPrints++),(r.duration!==void 0||r.filamentUsed!==void 0)&&(m.totalPrintTime+=(r.duration||0)-(i.duration||0),m.filamentUsed+=(r.filamentUsed||0)-(i.filamentUsed||0),m.averagePrintTime=m.totalPrintTime/l.statistics.totalPrints),{printHistory:o,statistics:m}})},deletePrintRecord:s=>{t(r=>{const l=r.printHistory.find(c=>c.id===s);if(!l)return r;const n=r.printHistory.filter(c=>c.id!==s),i={totalPrints:r.statistics.totalPrints-1,successfulPrints:r.statistics.successfulPrints-(l.status==="completed"?1:0),failedPrints:r.statistics.failedPrints-(l.status==="failed"?1:0),totalPrintTime:r.statistics.totalPrintTime-(l.duration||0),filamentUsed:r.statistics.filamentUsed-(l.filamentUsed||0)};return i.averagePrintTime=i.totalPrints>0?i.totalPrintTime/i.totalPrints:0,{printHistory:n,statistics:i}})},addPrintNote:(s,r)=>{t(l=>({printHistory:l.printHistory.map(n=>n.id===s?{...n,notes:[...n.notes||[],{id:crypto.randomUUID(),text:r,timestamp:new Date().toISOString()}]}:n)}))},updatePrintRating:(s,r)=>{t(l=>({printHistory:l.printHistory.map(n=>n.id===s?{...n,rating:r}:n)}))},getPrintRecord:s=>a().printHistory.find(r=>r.id===s),getStatistics:()=>a().statistics,resetStore:()=>{t({printHistory:[],statistics:{totalPrints:0,successfulPrints:0,failedPrints:0,totalPrintTime:0,averagePrintTime:0,filamentUsed:0}})}}),{name:"print-history-storage"}),{name:"PrintHistoryStore",enabled:!1})),et=Je(Ke(ct((t,a)=>({queueItems:[],templates:[],folders:[],notifications:[],addToQueue:(s,r={})=>{const{priority:l=1,scheduledTime:n=null,dependencies:i=[],requiredMaterial:c=null,cooldownTime:o=0,templateId:m=null,parameterOverrides:u={},copies:x=1,folder:f=null,tags:b=[],notes:N="",requiredTemperature:p=null,conditionalExecution:h=null}=r,g={id:crypto.randomUUID(),fileId:s,addedAt:new Date().toISOString(),status:"pending",priority:l,scheduledTime:n,dependencies:i,requiredMaterial:c,cooldownTime:o,templateId:m,parameterOverrides:u,copies:x,folder:f,tags:b,notes:N,requiredTemperature:p,conditionalExecution:h,estimatedStartTime:null,estimatedEndTime:null};return t(j=>({queueItems:[...j.queueItems,g]})),a().recalculateQueueTimes(),g.id},updateQueueItem:(s,r)=>{t(l=>({queueItems:l.queueItems.map(n=>n.id===s?{...n,...r}:n)})),(r.scheduledTime||r.cooldownTime||r.copies)&&a().recalculateQueueTimes()},removeFromQueue:s=>{t(r=>({queueItems:r.queueItems.filter(l=>l.id!==s)})),a().recalculateQueueTimes()},reorderQueue:(s,r)=>{t(l=>{const n=[...l.queueItems],i=n.findIndex(o=>o.id===s);if(i===-1)return l;const[c]=n.splice(i,1);return n.splice(r,0,c),{queueItems:n}}),a().recalculateQueueTimes()},addTemplate:s=>{const r={id:crypto.randomUUID(),createdAt:new Date().toISOString(),...s};return t(l=>({templates:[...l.templates,r]})),r.id},updateTemplate:(s,r)=>{t(l=>({templates:l.templates.map(n=>n.id===s?{...n,...r}:n)}))},deleteTemplate:s=>{t(r=>({templates:r.templates.filter(l=>l.id!==s)}))},addFolder:(s,r=null)=>{const l={id:crypto.randomUUID(),name:s,parentId:r,createdAt:new Date().toISOString()};return t(n=>({folders:[...n.folders,l]})),l.id},updateFolder:(s,r)=>{t(l=>({folders:l.folders.map(n=>n.id===s?{...n,...r}:n)}))},deleteFolder:s=>{t(r=>({folders:r.folders.filter(l=>l.id!==s)}))},addNotification:s=>{const r={id:crypto.randomUUID(),timestamp:new Date().toISOString(),read:!1,...s};return t(l=>({notifications:[...l.notifications,r]})),r.id},markNotificationRead:s=>{t(r=>({notifications:r.notifications.map(l=>l.id===s?{...l,read:!0}:l)}))},clearNotifications:()=>{t({notifications:[]})},getNextPrintable:()=>{const s=a(),r=new Date;return s.queueItems.filter(l=>{if(l.status!=="pending"||l.scheduledTime&&new Date(l.scheduledTime)>r||l.dependencies.length>0&&l.dependencies.filter(i=>{const c=s.queueItems.find(o=>o.id===i);return!c||c.status!=="completed"}).length>0)return!1;if(l.conditionalExecution){const n=s.queueItems.find(i=>i.id===l.conditionalExecution.dependsOn);if(!n||n.status!==l.conditionalExecution.requiredStatus)return!1}return!0}).sort((l,n)=>{if(l.priority!==n.priority)return n.priority-l.priority;const i=l.scheduledTime||l.addedAt,c=n.scheduledTime||n.addedAt;return new Date(i)-new Date(c)})[0]},recalculateQueueTimes:()=>{const s=a();let r=new Date,l=null,n=null;const i=s.queueItems.map(c=>{c.requiredMaterial&&c.requiredMaterial!==l&&(r=new Date(r.getTime()+5*6e4),l=c.requiredMaterial),c.requiredTemperature&&c.requiredTemperature!==n&&(r=new Date(r.getTime()+3*6e4),n=c.requiredTemperature);const o=new Date(Math.max(r.getTime(),c.scheduledTime?new Date(c.scheduledTime).getTime():0)),m=(c.estimatedDuration||3600)*c.copies,u=new Date(o.getTime()+m*1e3);return r=new Date(u.getTime()+(c.cooldownTime||0)*1e3),{...c,estimatedStartTime:o.toISOString(),estimatedEndTime:u.toISOString()}});t({queueItems:i})},bulkAddToQueue:(s,r={})=>{s.forEach(l=>{a().addToQueue(l,r)})},bulkUpdateQueue:(s,r)=>{t(l=>({queueItems:l.queueItems.map(n=>s.includes(n.id)?{...n,...r}:n)})),a().recalculateQueueTimes()},bulkRemoveFromQueue:s=>{t(r=>({queueItems:r.queueItems.filter(l=>!s.includes(l.id))})),a().recalculateQueueTimes()},resetStore:()=>{t({queueItems:[],templates:[],folders:[],notifications:[]})}}),{name:"advanced-queue-storage"}),{name:"AdvancedQueueStore",enabled:!1})),Xr=()=>et(t=>({addToQueue:t.addToQueue,updateQueueItem:t.updateQueueItem,removeFromQueue:t.removeFromQueue,reorderQueue:t.reorderQueue,getNextPrintable:t.getNextPrintable,recalculateQueueTimes:t.recalculateQueueTimes})),Zr=()=>et(t=>t.templates),Yr=()=>et(t=>({addTemplate:t.addTemplate,updateTemplate:t.updateTemplate,deleteTemplate:t.deleteTemplate})),qr=()=>et(t=>t.folders),Wr=()=>et(t=>({addFolder:t.addFolder,updateFolder:t.updateFolder,deleteFolder:t.deleteFolder}));class Qr{constructor(){this.stores={printers:ue,serial:V,gcodeFiles:Ue,calibration:Gr,printHistory:Hr,advancedQueue:et},this.initializeGlobalExposure()}initializeGlobalExposure(){typeof window<"u"&&(window.__3D_PRINTER_SUITE_STORES__={stores:this.stores,getStoreState:a=>{const s=this.stores[a];if(!s)throw new Error(`Store '${a}' not found. Available stores: ${Object.keys(this.stores).join(", ")}`);return s.getState()},subscribeToStore:(a,s)=>{const r=this.stores[a];if(!r)throw new Error(`Store '${a}' not found. Available stores: ${Object.keys(this.stores).join(", ")}`);return r.subscribe(s)},getAllStates:()=>{const a={};return Object.keys(this.stores).forEach(s=>{a[s]=this.stores[s].getState()}),a},getStoreInfo:()=>Object.keys(this.stores).map(a=>({name:a,hasState:!!this.stores[a].getState,hasSubscribe:!!this.stores[a].subscribe,hasSetState:!!this.stores[a].setState})),storeNames:Object.keys(this.stores)},Object.keys(this.stores).forEach(a=>{window[`__${a.toUpperCase()}_STORE__`]=this.stores[a]}),console.log("🔧 3D Printer Suite stores exposed globally:",{main:"window.__3D_PRINTER_SUITE_STORES__",individual:Object.keys(this.stores).map(a=>`window.__${a.toUpperCase()}_STORE__`),availableStores:Object.keys(this.stores)}))}getStore(a){return this.stores[a]}getAllStores(){return this.stores}getStoreNames(){return Object.keys(this.stores)}subscribeToAllStores(a){const s=Object.keys(this.stores).map(r=>this.stores[r].subscribe(a));return()=>{s.forEach(r=>r())}}}new Qr;var Kr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Jr=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ea=(t,a)=>{const s=d.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:n=2,absoluteStrokeWidth:i,children:c,...o},m)=>d.createElement("svg",{ref:m,...Kr,width:l,height:l,stroke:r,strokeWidth:i?Number(n)*24/Number(l):n,className:`lucide lucide-${Jr(t)}`,...o},[...a.map(([u,x])=>d.createElement(u,x)),...(Array.isArray(c)?c:[c])||[]]));return s.displayName=`${t}`,s};var Q=ea;const ta=Q("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ne=Q("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),sa=Q("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]),Wt=Q("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),zt=Q("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),ra=Q("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),aa=Q("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),na=Q("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),ia=Q("Bot",[["rect",{width:"18",height:"10",x:"3",y:"11",rx:"2",key:"1ofdy3"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}],["path",{d:"M12 7v4",key:"xawao1"}],["line",{x1:"8",x2:"8",y1:"16",y2:"16",key:"h6x27f"}],["line",{x1:"16",x2:"16",y1:"16",y2:"16",key:"5lty7f"}]]),Ps=Q("Box",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),la=Q("Cable",[["path",{d:"M4 9a2 2 0 0 1-2-2V5h6v2a2 2 0 0 1-2 2Z",key:"1s6oa5"}],["path",{d:"M3 5V3",key:"1k5hjh"}],["path",{d:"M7 5V3",key:"1t1388"}],["path",{d:"M19 15V6.5a3.5 3.5 0 0 0-7 0v11a3.5 3.5 0 0 1-7 0V9",key:"1ytv72"}],["path",{d:"M17 21v-2",key:"ds4u3f"}],["path",{d:"M21 21v-2",key:"eo0ou"}],["path",{d:"M22 19h-6v-2a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2Z",key:"sdz6o8"}]]),ks=Q("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),fe=Q("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Ms=Q("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Rs=Q("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),oa=Q("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Nt=Q("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ut=Q("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ke=Q("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ca=Q("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),da=Q("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ye=Q("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),xt=Q("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),He=Q("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Te=Q("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),As=Q("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ma=Q("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]),ua=Q("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),xa=Q("FolderUp",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]]),ha=Q("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),Is=Q("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),jt=Q("Grid",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}]]),pa=Q("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ga=Q("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),qe=Q("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),rt=Q("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),fa=Q("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),ba=Q("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),is=Q("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ya=Q("MonitorPlay",[["path",{d:"m10 7 5 3-5 3Z",key:"29ljg6"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]),Na=Q("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),ja=Q("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),Ds=Q("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),va=Q("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),We=Q("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Ls=Q("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Qe=Q("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),it=Q("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),wa=Q("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),lt=Q("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),ht=Q("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Fe=Q("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),ot=Q("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Sa=Q("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),ye=Q("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ea=Q("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),_a=Q("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Qt=Q("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ta=Q("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),Os=Q("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Ca=Q("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Pa=Q("TerminalSquare",[["path",{d:"m7 11 2-2-2-2",key:"1lz0vl"}],["path",{d:"M11 13h4",key:"1p7l4v"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}]]),Re=Q("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),Rt=Q("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ka=Q("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),vt=Q("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ls=Q("Usb",[["circle",{cx:"10",cy:"7",r:"1",key:"dypaad"}],["circle",{cx:"4",cy:"20",r:"1",key:"22iqad"}],["path",{d:"M4.7 19.3 19 5",key:"1enqfc"}],["path",{d:"m21 3-3 1 2 2Z",key:"d3ov82"}],["path",{d:"M9.26 7.68 5 12l2 5",key:"1esawj"}],["path",{d:"m10 14 5 2 3.5-3.5",key:"v8oal5"}],["path",{d:"m18 12 1-1 1 1-1 1Z",key:"1bh22v"}]]),Fs=Q("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ma=Q("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),os=Q("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),Ra=Q("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Ce=Q("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ie=Q("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Aa=[{name:"Ender 3 Pro",model:"Ender 3 Pro",firmware:"Marlin 2.1.2",bedSize:{x:235,y:235,z:250},calibrationSteps:{pidAutotune:{completed:!1,lastUpdated:null},extruderEsteps:{completed:!1,lastUpdated:null},retractionTuning:{completed:!1,lastUpdated:null},firstLayer:{completed:!1,lastUpdated:null},flowRate:{completed:!1,lastUpdated:null},temperatureTower:{completed:!1,lastUpdated:null},firmwareConfig:{completed:!1,lastUpdated:null}},firmwareConfiguration:{maxTemp:250,maxBedTemp:100,stepsPerMm:{x:80,y:80,z:400,e:93}},issues:[{id:"issue_1704110400000_abc123",timestamp:"2024-01-01T12:00:00Z",category:"mechanical",title:"Under-extrusion on first layer",description:"The printer is not extruding enough material during the first layer, causing poor bed adhesion and gaps between lines. This seems to happen mostly in the center of the bed.",status:"open",resolvedTimestamp:null,followUpActions:[{id:"action_1704110460000_def456",description:"Check extruder tension and ensure proper grip on filament",completed:!0,timestamp:"2024-01-01T12:01:00Z"},{id:"action_1704110520000_ghi789",description:"Calibrate E-Steps to ensure accurate extrusion amounts",completed:!1,timestamp:"2024-01-01T12:02:00Z"}]},{id:"issue_1704196800000_jkl012",timestamp:"2024-01-02T12:00:00Z",category:"electrical",title:"Temperature fluctuations during printing",description:"The hotend temperature keeps fluctuating ±3°C during prints, causing inconsistent extrusion and layer quality.",status:"resolved",resolvedTimestamp:"2024-01-03T15:30:00Z",followUpActions:[{id:"action_1704196860000_mno345",description:"Run PID autotune for hotend and bed",completed:!0,timestamp:"2024-01-02T12:01:00Z"},{id:"action_1704196920000_pqr678",description:"Check thermistor connections",completed:!0,timestamp:"2024-01-02T12:02:00Z"}]},{id:"issue_1704283200000_stu901",timestamp:"2024-01-03T12:00:00Z",category:"firmware",title:"Stringing between towers",description:"Getting significant stringing when printing multiple objects or tower tests. Retraction settings may need adjustment.",status:"in-progress",resolvedTimestamp:null,followUpActions:[{id:"action_1704283260000_vwx234",description:"Increase retraction distance (try 0.5-1mm more)",completed:!0,timestamp:"2024-01-03T12:01:00Z"},{id:"action_1704283320000_yza567",description:"Lower nozzle temperature by 5-10°C",completed:!1,timestamp:"2024-01-03T12:02:00Z"}]}]},{name:"Prusa i3 MK3S+",model:"Prusa i3 MK3S+",firmware:"Prusa Firmware 3.12.1",bedSize:{x:250,y:210,z:200},calibrationSteps:{pidAutotune:{completed:!0,lastUpdated:"2024-01-15T10:30:00Z"},extruderEsteps:{completed:!0,lastUpdated:"2024-01-15T10:35:00Z"},retractionTuning:{completed:!1,lastUpdated:null},firstLayer:{completed:!0,lastUpdated:"2024-01-15T10:40:00Z"},flowRate:{completed:!1,lastUpdated:null},temperatureTower:{completed:!1,lastUpdated:null},firmwareConfig:{completed:!1,lastUpdated:null}},firmwareConfiguration:{maxTemp:300,maxBedTemp:120,stepsPerMm:{x:100,y:100,z:400,e:280}},issues:[]}],Us=d.createContext(),Bs=()=>{const t=d.useContext(Us);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t},Ia=({children:t})=>{const[a,s]=d.useState(()=>{const n=localStorage.getItem("theme");return n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});d.useEffect(()=>{const n=window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(a),localStorage.setItem("theme",a)},[a]);const l={theme:a,toggleTheme:()=>{s(n=>n==="light"?"dark":"light")},isDark:a==="dark"};return e.jsx(Us.Provider,{value:l,children:t})},Kt=({className:t="h-8 w-8"})=>{const{isDark:a}=Bs(),s=a?"#000064":"#D4DDF6",r=a?"#D4DDF6":"#000064";return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"54",height:"61",fill:"none",viewBox:"0 0 56 61",className:t,children:[e.jsx("defs",{}),e.jsx("path",{fill:s,stroke:r,strokeWidth:".769",d:"M18.662 50.518l-9.626 2.588V25.924l9.626-1.737v26.331z"}),e.jsx("path",{fill:r,d:"M16.627.808c8.771 0 11.163 3.2 11.163 3.2V15.21l-14.352-6.4L.744 13.726C.744.925 16.627.808 16.627.808z"}),e.jsx("path",{fill:r,d:"M38.905.808c-8.771 0-11.163 3.2-11.163 3.2V15.21l14.352-6.4 12.694 4.917C54.788.925 38.905.808 38.905.808z"}),e.jsx("path",{fill:r,d:"M36.67 17.893l10.191 1.042 1.23-.417V7.892H36.67v10.001zM36.671 34.77l9.968 2.5 1.66-1.042v-6.875l-11.42.208-.208 5.209zM8.652 53.608L.538 50.769v-36c0-12.801 12.898-12.362 12.898-12.362 14.353.8 14.353 9.6 14.353 14.4v44.001l-9.569-3.536V36.227c0-4.8-9.568-7.867-9.568-2.864v20.245zM36.462 23.102l15.576 2.5-15.576 3.334v-5.834z"}),e.jsx("path",{fill:s,stroke:`#${s}064`,strokeWidth:".769",d:"M8.651 15.208c0-4.8 9.569-3.2 9.569 1.6v11.2l-9.569-2.4v-10.4z"}),e.jsx("path",{fill:s,stroke:s,strokeWidth:".769",d:"M18.278 28.046L8.65 25.608v-10.4c0-4.685 9.627-3.645 9.627 1.214v11.624z"}),e.jsx("path",{fill:s,stroke:r,strokeWidth:".769",d:"M8.359 25.433l-.022.751 10.175 2.5.477.117v-5.327l-.455.083L8.36 25.433zM36.972 27.477v.437l.434-.055 14.247-1.82v9.478l-4.63 1.25v-3.872a1.83 1.83 0 00-.504-1.291c-.315-.333-.747-.556-1.227-.691-.957-.269-2.192-.212-3.398.127-2.397.672-4.922 2.542-4.922 5.605V57.33l-8.799 2.943V40.607v-23.8c0-2.413.008-5.704 1.737-8.498 1.707-2.76 5.154-5.121 12.24-5.519h.023l.104.003c.093.003.23.008.404.018.35.021.852.063 1.454.145 1.208.166 2.81.495 4.402 1.146 1.594.652 3.162 1.618 4.325 3.05 1.157 1.424 1.93 3.33 1.906 5.9h0v3.901l-7.538 1.512v-3.489c0-1.17-.71-2.037-1.683-2.566-.969-.525-2.233-.743-3.478-.636-1.248.106-2.516.54-3.48 1.367-.974.834-1.617 2.052-1.617 3.666v10.67z"}),e.jsx("path",{fill:s,stroke:r,strokeWidth:".769",d:"M36.972 27.477h14.247v3.2H36.972v-3.2z"})]})},Jt=()=>{const{theme:t,toggleTheme:a}=Bs();return e.jsx("button",{onClick:a,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx(Na,{className:"h-5 w-5"}):e.jsx(Ta,{className:"h-5 w-5"})})},Da=({onPrinterSelect:t})=>{const[a,s]=d.useState(!1),[r,l]=d.useState({name:"",model:"",firmware:"",bedSize:{x:220,y:220,z:250}}),n=Rr(),i=Ar(),c=Ir(),o=Ts(),m=Dr(),u=["Ender 3","Ender 3 Pro","Ender 3 V2","Ender 3 S1","Ender 3 S1 Pro","Ender 5","Ender 5 Plus","Prusa i3 MK3S+","Prusa i3 MK4","Prusa Mini+","Voron 2.4","Voron Trident","RatRig V-Core 3","Custom"],x=["Marlin 2.0.x","Marlin 2.1.x","Marlin 2.2.x","Prusa Firmware","Klipper","RepRapFirmware","Custom"],f=()=>{r.name&&r.model&&(i(r),l({name:"",model:"",firmware:"",bedSize:{x:220,y:220,z:250}}),s(!1))},b=g=>{o(g),t(g)},N=()=>{Aa.forEach(g=>i(g))},p=g=>g.calibrationSteps?Object.values(g.calibrationSteps).filter(j=>j==null?void 0:j.completed).length:0,h=g=>g.calibrationSteps?Object.keys(g.calibrationSteps).length:0;return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-800 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Kt,{className:"h-8 w-8 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"3D Printer Suite"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Jt,{}),e.jsxs("button",{onClick:N,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(da,{className:"h-4 w-4"}),e.jsx("span",{children:"Load Sample Data"})]}),e.jsx("button",{onClick:()=>m(),className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors flex items-center space-x-2",children:e.jsx("span",{children:"Reset Store"})}),e.jsxs("button",{onClick:()=>s(!a),className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Add New Printer"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Printer"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Printer Name *"}),e.jsx("input",{type:"text",placeholder:"e.g., My Ender 3",value:r.name,onChange:g=>l({...r,name:g.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Model *"}),e.jsxs("select",{value:r.model,onChange:g=>l({...r,model:g.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Model"}),u.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Firmware"}),e.jsxs("select",{value:r.firmware,onChange:g=>l({...r,firmware:g.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Firmware"}),x.map(g=>e.jsx("option",{value:g,children:g},g))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bed Size (mm)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"number",placeholder:"X",value:r.bedSize.x,onChange:g=>l({...r,bedSize:{...r.bedSize,x:parseInt(g.target.value)||0}}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("input",{type:"number",placeholder:"Y",value:r.bedSize.y,onChange:g=>l({...r,bedSize:{...r.bedSize,y:parseInt(g.target.value)||0}}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("input",{type:"number",placeholder:"Z",value:r.bedSize.z,onChange:g=>l({...r,bedSize:{...r.bedSize,z:parseInt(g.target.value)||0}}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>s(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:!r.name||!r.model,className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Printer"})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(it,{className:"h-16 w-16 text-gray-300 dark:text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Printers Added"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Get started by adding your first 3D printer"}),e.jsxs("button",{onClick:()=>s(!0),className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white px-6 py-3 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2 mx-auto",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Your First Printer"})]})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-6",children:"Your Printers"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(g=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>b(g.id),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(it,{className:"h-6 w-6 text-gray-600 dark:text-gray-300 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:g.name})]}),e.jsx("button",{onClick:j=>{j.stopPropagation(),c(g.id)},className:"text-gray-400 dark:text-gray-500 dark:text-gray-400 hover:text-red-500 transition-colors p-1",children:e.jsx(Rt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",g.model]}),g.firmware&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Firmware:"})," ",g.firmware]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Bed Size:"})," ",g.bedSize.x," × ",g.bedSize.y," × ",g.bedSize.z," mm"]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Calibration Progress"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[p(g),"/",h(g)]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 h-2 rounded-full transition-all duration-300",style:{width:`${h(g)>0?p(g)/h(g)*100:0}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[e.jsxs("button",{onClick:j=>{j.stopPropagation(),b(g.id)},className:"text-gray-600 dark:text-gray-300 hover:text-blue-600 text-sm font-medium flex items-center",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Configure"]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[p(g)>0&&e.jsx(fe,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:p(g)>0?"Ready":"Setup Required"})]})]})]})},g.id))})]})]})]})};function At(){const t=V(f=>f.status),a=V(f=>f.baudRate),s=V(f=>f.autoDetect),r=V(f=>f.error),l=V(f=>f.port),n=V(f=>f.connect),i=V(f=>f.disconnect),c=V(f=>f.sendCommand),o=V(f=>f.sendCommands),m=V(f=>f.clearLogs),u=V(f=>f.setBaudRate),x=V(f=>f.setAutoDetect);return{status:t,baudRate:a,setBaudRate:u,autoDetect:s,setAutoDetect:x,port:l,error:r,connect:n,disconnect:i,sendCommand:c,sendCommands:o,clearLogs:m}}const La=({meshData:t,colorScheme:a,showValues:s,showGrid:r})=>{const l=d.useRef(null),[n,i]=d.useState({width:600,height:400}),c=d.useMemo(()=>{if(!t||!t.mesh||t.mesh.length===0)return null;const m=t.mesh,u=Math.max(...m.map(g=>g.i)),x=Math.max(...m.map(g=>g.j)),f=Array(u+1).fill().map(()=>Array(x+1).fill(null));m.forEach(g=>{f[g.i][g.j]=g.z});const b=m.map(g=>g.z),N=Math.min(...b),p=Math.max(...b),h=p-N;return{matrix:f,minZ:N,maxZ:p,range:h,gridSize:{x:u+1,y:x+1}}},[t]),o=d.useCallback((m,u,x,f)=>{if(f===0)return"#808080";const b=(m-u)/f;switch(a){case"heatmap":if(b<.5){const h=b*2;return`rgb(${Math.round(255*h)}, ${Math.round(255*h)}, 255)`}else{const h=(b-.5)*2;return`rgb(255, ${Math.round(255*(1-h))}, ${Math.round(255*(1-h))})`}case"grayscale":const N=Math.round(255*b);return`rgb(${N}, ${N}, ${N})`;case"rainbow":return`hsl(${(1-b)*240}, 100%, 50%)`;default:return"#808080"}},[a]);return d.useEffect(()=>{const m=l.current;if(!m||!c)return;const u=m.getContext("2d"),{width:x,height:f}=n,{matrix:b,minZ:N,maxZ:p,range:h,gridSize:g}=c;u.clearRect(0,0,x,f);const j=x/g.x,S=f/g.y;b.forEach((M,_)=>{M.forEach((P,E)=>{if(P!==null){const F=E*j,v=_*S;u.fillStyle=o(P,N,p,h),u.fillRect(F,v,j,S),r&&(u.strokeStyle="#333",u.lineWidth=1,u.strokeRect(F,v,j,S)),s&&(u.fillStyle=P>(N+p)/2?"#000":"#fff",u.font="10px monospace",u.textAlign="center",u.textBaseline="middle",u.fillText(P.toFixed(3),F+j/2,v+S/2))}})}),u.strokeStyle="#000",u.lineWidth=2,u.strokeRect(0,0,x,f)},[c,n,a,s,r,o]),c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:"2D Heatmap"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Range: ",c.minZ.toFixed(3),"mm to ",c.maxZ.toFixed(3),"mm"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("canvas",{ref:l,width:n.width,height:n.height,className:"border border-gray-300 rounded"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Scale:"}),e.jsx("div",{className:"flex-1 h-4 bg-gradient-to-r from-blue-500 via-white to-red-500 rounded border"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c.minZ.toFixed(2),"mm"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[c.maxZ.toFixed(2),"mm"]})]})]}):e.jsx("div",{className:"w-full h-[400px] bg-gray-100 rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(jt,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No bed mesh data available"})]})})},Oa=({meshData:t,showWireframe:a,showPoints:s})=>{const r=d.useRef(),{geometry:l,points:n,zMin:i,zMax:c}=d.useMemo(()=>{if(!t||!t.mesh||t.mesh.length===0)return{geometry:null,points:[],zMin:0,zMax:0};const N=t.mesh,p=Math.max(...N.map(E=>E.i)),h=Math.max(...N.map(E=>E.j)),g=Math.min(...N.map(E=>E.z)),j=Math.max(...N.map(E=>E.z)),S=Array(p+1).fill().map(()=>Array(h+1).fill(0));N.forEach(E=>{S[E.i][E.j]=E.z});const M=new Pr(h,p,h,p),_=M.attributes.position.array,P=new Float32Array((p+1)*(h+1)*3);for(let E=0;E<=p;E++)for(let F=0;F<=h;F++){const v=E*(h+1)+F;if(v<_.length/3){_[v*3+2]=S[E][F]*10;const C=(S[E][F]-g)/Math.max(1e-6,j-g),y=C,w=.2+.6*(1-Math.abs(C-.5)*2),k=1-C;P[v*3+0]=y,P[v*3+1]=w,P[v*3+2]=k}}return M.attributes.position.needsUpdate=!0,M.setAttribute("color",new kr(P,3)),M.computeVertexNormals(),{geometry:M,points:N,zMin:g,zMax:j}},[t]);if(!l)return e.jsx("div",{className:"w-full h-[500px] bg-gray-100 rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(jt,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"No bed mesh data available"})]})});const o=Math.max(...n.map(N=>N.i)),m=Math.max(...n.map(N=>N.j)),u=i,x=c,f=x-u,b=10;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:"3D Surface"}),e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded",children:[e.jsxs("div",{children:["Grid: ",o+1,"×",m+1," points"]}),e.jsxs("div",{children:["Z Range: ",u.toFixed(3)," to ",x.toFixed(3)," mm"]}),e.jsxs("div",{children:["Scale: 1 unit = 1mm (Z ×",b," for visibility)"]})]})]}),e.jsxs("div",{className:"h-[500px] border border-gray-300 rounded relative",children:[e.jsxs(Zt,{camera:{position:[6,6,10],fov:50},children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[5,5,5],intensity:.8}),e.jsx("gridHelper",{args:[10,20,"#cccccc","#cccccc"]}),e.jsxs("mesh",{position:[4,4,0],children:[e.jsx("boxGeometry",{args:[.1,.1,.1]}),e.jsx("meshStandardMaterial",{color:"#666666",transparent:!0,opacity:.7})]}),e.jsx(Me,{position:[4.2,4,0],fontSize:.15,color:"#666666",rotation:[-Math.PI/2,0,0],children:"1mm"}),e.jsxs("mesh",{position:[-4,4,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-2.5,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,2.5,0],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[Math.PI/2,0,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsxs("mesh",{position:[-4,4,.5],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsx("mesh",{ref:r,geometry:l,rotation:[-Math.PI/2,0,0],position:[0,-.3,0],children:e.jsx("meshStandardMaterial",{vertexColors:!0,wireframe:a,transparent:!0,opacity:.95,side:ns})}),s&&n.map((N,p)=>e.jsxs("mesh",{position:[N.j-2.5,N.i-2.5,N.z*10],rotation:[-Math.PI/2,0,0],children:[e.jsx("sphereGeometry",{args:[.05]}),e.jsx("meshStandardMaterial",{color:"#ef4444"})]},p)),!a&&e.jsx("mesh",{geometry:l,rotation:[-Math.PI/2,0,0],position:[0,-.3,0],children:e.jsx("meshBasicMaterial",{color:"#000000",wireframe:!0,transparent:!0,opacity:.3,side:ns})}),e.jsx(Yt,{enablePan:!0,enableZoom:!0,enableRotate:!0,minPolarAngle:Math.PI/6,maxPolarAngle:5*Math.PI/12,target:[0,-.3,0]}),e.jsx(Me,{position:[-2.2,4,0],fontSize:.25,color:"#ff0000",rotation:[-Math.PI/2,0,0],children:"X"}),e.jsx(Me,{position:[-4,2.2,0],fontSize:.25,color:"#00ff00",rotation:[-Math.PI/2,0,0],children:"Y"}),e.jsx(Me,{position:[-4,4,.7],fontSize:.25,color:"#0000ff",children:"Z"})]}),e.jsxs("div",{className:"absolute left-2 top-2 bottom-2 w-16 bg-white bg-opacity-90 rounded p-2 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Z Scale"}),e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[x.toFixed(2),"mm"]}),e.jsx("div",{className:"w-1 h-16 bg-gradient-to-b from-red-500 via-yellow-500 to-green-500 rounded"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[u.toFixed(2),"mm"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Range: ",f.toFixed(2),"mm"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-red-500"}),e.jsx("span",{className:"text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-green-500"}),e.jsx("span",{className:"text-xs",children:"Y"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-blue-500"}),e.jsx("span",{className:"text-xs",children:"Z"})]})]})]}),e.jsx("div",{className:"absolute right-2 top-2 bottom-2 w-12 bg-white bg-opacity-90 rounded p-2 flex flex-col justify-between",children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Height"}),e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:x.toFixed(2)}),e.jsx("div",{className:"w-1 h-20 bg-gradient-to-b from-blue-400 via-blue-500 to-blue-600 rounded"}),e.jsx("div",{className:"text-xs text-gray-600",children:u.toFixed(2)})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"mm"})]})})]})]})},zs=({showStatus:t=!0,showActions:a=!0})=>{var C;const[s,r]=d.useState("3d"),[l,n]=d.useState("heatmap"),[i,c]=d.useState(!0),[o,m]=d.useState(!0),[u,x]=d.useState(!1),[f,b]=d.useState(!1),N=V(y=>y.status),p=V(y=>y.bedMesh),h=V(y=>y.fetchBedLevel),g=V(y=>y.runBedLeveling),j=V(y=>y.processCollectedBedMeshData);ue(y=>y.activePrinterId);const S=ue(y=>{const w=y.printers.find(k=>k.id===y.activePrinterId);return w==null?void 0:w.printerSettings}),M=d.useCallback(async()=>{if(N!=="connected"){alert("Please connect to printer first");return}await h()},[N,h]),_=d.useCallback(async()=>{if(N!=="connected"){alert("Please connect to printer first");return}confirm("This will run automatic bed leveling (G29). This process takes several minutes. Continue?")&&await g()},[N,g]),P=d.useCallback(()=>{j()},[j]),E=(p==null?void 0:p.data)&&p.data.length>0,F=((C=S==null?void 0:S.bedLeveling)==null?void 0:C.mesh)&&S.bedLeveling.mesh.length>0,v=E?{mesh:p.data,gridSize:p.gridSize,min:p.min,max:p.max,range:p.range}:F?{mesh:S.bedLeveling.mesh,gridSize:{x:Math.max(...S.bedLeveling.mesh.map(y=>y.i))+1,y:Math.max(...S.bedLeveling.mesh.map(y=>y.j))+1},min:Math.min(...S.bedLeveling.mesh.map(y=>y.z)),max:Math.max(...S.bedLeveling.mesh.map(y=>y.z)),range:Math.max(...S.bedLeveling.mesh.map(y=>y.z))-Math.min(...S.bedLeveling.mesh.map(y=>y.z))}:null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Bed Mesh Visualization"}),e.jsx("div",{className:"text-sm text-gray-600",children:v?e.jsxs(e.Fragment,{children:[v.gridSize.x,"×",v.gridSize.y," grid • Range: ",v.min.toFixed(3),"mm to ",v.max.toFixed(3),"mm •",E?e.jsxs(e.Fragment,{children:["Last updated: ",p.timestamp?new Date(p.timestamp).toLocaleTimeString():"Unknown"]}):e.jsx(e.Fragment,{children:"Data from printer settings"})]}):"No mesh data available"})]}),a&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:M,disabled:N!=="connected",className:"px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(wa,{className:"w-4 h-4 mr-2"}),"Process Data"]}),!E&&e.jsxs("button",{onClick:_,disabled:N!=="connected",className:"px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Run G29"]}),e.jsxs("button",{onClick:P,className:"px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Process Data"]})]})]}),t&&(S==null?void 0:S.bedLeveling)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Bed Leveling Status"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[S.bedLeveling.enabled?"Enabled":"Disabled"," • Fade Height: ",S.bedLeveling.fadeHeight,"mm"]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${S.bedLeveling.enabled?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:S.bedLeveling.enabled?"Active":"Inactive"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>r("2d"),className:`px-3 py-1 rounded text-sm font-medium ${s==="2d"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(He,{className:"w-4 h-4 mr-1 inline"}),"2D View"]}),e.jsxs("button",{onClick:()=>r("3d"),className:`px-3 py-1 rounded text-sm font-medium ${s==="3d"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(lt,{className:"w-4 h-4 mr-1 inline"}),"3D View"]})]}),e.jsx("div",{className:"flex items-center space-x-6",children:s==="2d"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Color:"}),e.jsxs("select",{value:l,onChange:y=>n(y.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"heatmap",children:"Heatmap"}),e.jsx("option",{value:"grayscale",children:"Grayscale"}),e.jsx("option",{value:"rainbow",children:"Rainbow"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showValues",checked:i,onChange:y=>c(y.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showValues",className:"text-sm text-gray-700",children:"Show Values"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showGrid",checked:o,onChange:y=>m(y.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showGrid",className:"text-sm text-gray-700",children:"Show Grid"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showWireframe",checked:u,onChange:y=>x(y.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showWireframe",className:"text-sm text-gray-700",children:"Show Wireframe"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"showPoints",checked:f,onChange:y=>b(y.target.checked),className:"rounded"}),e.jsx("label",{htmlFor:"showPoints",className:"text-sm text-gray-700",children:"Show Points"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:s==="2d"?e.jsx(La,{meshData:v,colorScheme:l,showValues:i,showGrid:o}):e.jsx(Oa,{meshData:v,showWireframe:u,showPoints:f})}),v&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Min Height:"}),e.jsxs("div",{className:"font-mono text-sm",children:[v.min.toFixed(3),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Max Height:"}),e.jsxs("div",{className:"font-mono text-sm",children:[v.max.toFixed(3),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Range:"}),e.jsxs("div",{className:"font-mono text-sm",children:[v.range.toFixed(3),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 text-xs",children:"Points:"}),e.jsx("div",{className:"font-mono text-sm",children:v.mesh.length})]})]})})]})},Fa={stepsPerUnit:{min:1,max:1e3,warning:"Values outside normal range may cause dimensional inaccuracy",critical:"Extreme values can damage the printer"},feedrates:{min:1,max:1e4,warning:"High feedrates may cause skipped steps",critical:"Excessive feedrates can damage motors"},acceleration:{min:1,max:1e4,warning:"High acceleration may cause print quality issues",critical:"Excessive acceleration can damage the printer"},pid:{min:0,max:100,warning:"Incorrect PID values can cause temperature instability",critical:"Extreme PID values can cause thermal runaway"},zProbeOffset:{min:-10,max:10,warning:"Incorrect Z probe offset affects first layer height",critical:"Extreme Z probe offset can cause nozzle crashes"},linearAdvance:{min:0,max:10,warning:"High linear advance values may cause extrusion issues",critical:"Extreme linear advance can damage the extruder"}},Ua=({settingKey:t,value:a,settingType:s})=>{const r=d.useMemo(()=>{if(a==null||a==="")return{level:"info",message:"No value set"};const i=parseFloat(a);if(isNaN(i))return{level:"error",message:"Invalid numeric value"};let c=null;for(const[u,x]of Object.entries(Fa))if(t.includes(u)){c=x;break}if(!c)return{level:"info",message:"No safety validation available"};if(i<c.min*.1||i>c.max*10)return{level:"critical",message:c.critical};if(i<c.min||i>c.max)return{level:"warning",message:c.warning};const o=c.max-c.min,m=(i-c.min)/o;return m<.1||m>.9?{level:"caution",message:"Value is at extreme end of safe range"}:{level:"safe",message:"Value is within safe range"}},[t,a,s]),l=()=>{switch(r.level){case"critical":return e.jsx(Ne,{className:"w-4 h-4 text-red-600"});case"warning":return e.jsx(Ne,{className:"w-4 h-4 text-yellow-600"});case"caution":return e.jsx(qe,{className:"w-4 h-4 text-blue-600"});case"safe":return e.jsx(fe,{className:"w-4 h-4 text-green-600"});default:return e.jsx(qe,{className:"w-4 h-4 text-gray-600"})}},n=()=>{switch(r.level){case"critical":return"text-red-800 bg-red-50 border-red-200";case"warning":return"text-yellow-800 bg-yellow-50 border-yellow-200";case"caution":return"text-blue-800 bg-blue-50 border-blue-200";case"safe":return"text-green-800 bg-green-50 border-green-200";default:return"text-gray-800 bg-gray-50 border-gray-200"}};return r.level==="info"?null:e.jsx("div",{className:`mt-2 p-2 rounded border text-xs ${n()}`,children:e.jsxs("div",{className:"flex items-center",children:[l(),e.jsx("span",{className:"ml-1 font-medium",children:r.message})]})})},Ba=["pid.hotend.p","pid.hotend.i","pid.hotend.d","pid.bed.p","pid.bed.i","pid.bed.d","stepsPerUnit.x","stepsPerUnit.y","stepsPerUnit.z","stepsPerUnit.e","zProbeOffset.z","homeOffset.z"],za=({setting:t,value:a,onChange:s,onSend:r,hasChanges:l,isDangerous:n=!1,documentation:i=null})=>{const[c,o]=d.useState(!1),[m,u]=d.useState(!0),[x,f]=d.useState(""),b=d.useCallback(g=>{if(!t.validation)return u(!0),f(""),!0;const{min:j,max:S,pattern:M,required:_}=t.validation;return _&&(g===""||g===null||g===void 0)?(u(!1),f("This field is required"),!1):j!==void 0&&parseFloat(g)<j?(u(!1),f(`Value must be at least ${j}`),!1):S!==void 0&&parseFloat(g)>S?(u(!1),f(`Value must be at most ${S}`),!1):M&&!M.test(String(g))?(u(!1),f("Invalid format"),!1):(u(!0),f(""),!0)},[t.validation]),N=d.useCallback(g=>{b(g),s(g)},[s,b]),p=d.useCallback(()=>{if(m&&l){if(Ba.includes(t.key)&&!confirm(`Warning: ${t.label} is a potentially dangerous setting. Are you sure you want to send this command?`))return;r()}},[m,l,r,t.key,t.label]),h=()=>{var j,S,M;const g={value:a||"",onChange:_=>N(_.target.value),className:`w-full px-3 py-2 border rounded text-sm ${m?l?"border-yellow-300 bg-yellow-50":"border-gray-300":"border-red-300 bg-red-50"}`,placeholder:t.placeholder||""};switch(t.type){case"number":return e.jsx("input",{...g,type:"number",step:t.step||"any",min:(j=t.validation)==null?void 0:j.min,max:(S=t.validation)==null?void 0:S.max});case"boolean":return e.jsxs("select",{...g,value:a?"1":"0",onChange:_=>N(_.target.value==="1"),children:[e.jsx("option",{value:"0",children:"Disabled"}),e.jsx("option",{value:"1",children:"Enabled"})]});case"select":return e.jsx("select",{...g,children:(M=t.options)==null?void 0:M.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))});case"text":default:return e.jsx("input",{...g,type:"text"})}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:t.label}),n&&e.jsx(Ne,{className:"w-4 h-4 text-red-500",title:"Dangerous setting"}),i&&e.jsx("button",{onClick:()=>o(!c),className:"text-gray-400 hover:text-gray-600",children:e.jsx(qe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[l&&e.jsx("span",{className:"text-xs text-yellow-600 bg-yellow-100 px-2 py-1 rounded",children:"Changed"}),e.jsxs("button",{onClick:p,disabled:!m||!l,className:"px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Sa,{className:"w-3 h-3 mr-1"}),"Send"]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[h(),e.jsx("span",{className:"text-xs text-gray-500 self-center",children:t.unit||""})]}),!m&&x&&e.jsx("div",{className:"text-xs text-red-600",children:x}),c&&i&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-sm",children:[e.jsx("div",{className:"font-medium text-blue-900 mb-1",children:"Documentation"}),e.jsx("div",{className:"text-blue-800",children:i.description}),i.marlinRef&&e.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:["Marlin Reference: ",i.marlinRef]}),i.warning&&e.jsxs("div",{className:"mt-2 text-xs text-red-600 font-medium",children:["⚠️ ",i.warning]})]}),e.jsx(Ua,{settingKey:t.key,value:a,settingType:t.type})]})},$a=({category:t,settings:a,values:s,onChange:r,onSend:l,changedSettings:n,isExpanded:i,onToggle:c})=>{const o=Object.keys(n).filter(m=>a.some(u=>u.key===m&&n[m])).length;return e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("button",{onClick:c,className:"w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-t-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i?e.jsx(Rs,{className:"w-5 h-5"}):e.jsx(Nt,{className:"w-5 h-5"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",a.length," settings)"]}),o>0&&e.jsxs("span",{className:"bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded",children:[o," changed"]})]}),e.jsx(t.icon,{className:"w-5 h-5 text-gray-400"})]}),i&&e.jsx("div",{className:"p-4 space-y-4",children:a.map(m=>e.jsx(za,{setting:m,value:s[m.key],onChange:u=>r(m.key,u),onSend:()=>l(m),hasChanges:n[m.key],isDangerous:m.dangerous,documentation:m.documentation},m.key))})]})},Ga=()=>{const[t,a]=d.useState(""),[s,r]=d.useState("all"),[l,n]=d.useState({}),[i,c]=d.useState({}),[o,m]=d.useState({}),u=V(v=>v.status),x=V(v=>v.sendCommand),f=V(v=>v.sendBulkConfiguration);V(v=>v.processM503Response),V(v=>v.fetchAllPrinterSettings);const b=ue(v=>v.activePrinterId),N=ue(v=>{const C=v.printers.find(y=>y.id===v.activePrinterId);return C==null?void 0:C.printerSettings}),p=ue(v=>v.updatePrinterSettings),h=d.useMemo(()=>[{category:"motion",name:"Motion Settings",icon:ye,settings:[{key:"stepsPerUnit.x",label:"X Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for X-axis movement",marlinRef:"M92 X<value>",warning:"Incorrect values can cause dimensional inaccuracy"}},{key:"stepsPerUnit.y",label:"Y Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for Y-axis movement",marlinRef:"M92 Y<value>"}},{key:"stepsPerUnit.z",label:"Z Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for Z-axis movement",marlinRef:"M92 Z<value>"}},{key:"stepsPerUnit.e",label:"E Steps per Unit",type:"number",unit:"steps/mm",validation:{min:1,max:1e3},documentation:{description:"Number of steps per millimeter for extruder",marlinRef:"M92 E<value>"}},{key:"feedrates.x",label:"X Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e4},documentation:{description:"Maximum feedrate for X-axis movement",marlinRef:"M203 X<value>"}},{key:"feedrates.y",label:"Y Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e4},documentation:{description:"Maximum feedrate for Y-axis movement",marlinRef:"M203 Y<value>"}},{key:"feedrates.z",label:"Z Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e3},documentation:{description:"Maximum feedrate for Z-axis movement",marlinRef:"M203 Z<value>"}},{key:"feedrates.e",label:"E Max Feedrate",type:"number",unit:"mm/min",validation:{min:1,max:1e4},documentation:{description:"Maximum feedrate for extruder",marlinRef:"M203 E<value>"}}]},{category:"acceleration",name:"Acceleration Settings",icon:ye,settings:[{key:"acceleration.max",label:"Max Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Maximum acceleration for all axes",marlinRef:"M201",warning:"Too high values can cause skipped steps"}},{key:"acceleration.print",label:"Print Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Acceleration used during printing",marlinRef:"M204 P<value>"}},{key:"acceleration.retract",label:"Retract Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Acceleration used for retraction moves",marlinRef:"M204 R<value>"}},{key:"acceleration.travel",label:"Travel Acceleration",type:"number",unit:"mm/s²",validation:{min:1,max:1e4},documentation:{description:"Acceleration used for travel moves",marlinRef:"M204 T<value>"}},{key:"acceleration.jerk.x",label:"X Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for X-axis",marlinRef:"M205 X<value>"}},{key:"acceleration.jerk.y",label:"Y Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for Y-axis",marlinRef:"M205 Y<value>"}},{key:"acceleration.jerk.z",label:"Z Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for Z-axis",marlinRef:"M205 Z<value>"}},{key:"acceleration.jerk.e",label:"E Jerk",type:"number",unit:"mm/s",validation:{min:0,max:100},documentation:{description:"Maximum instantaneous speed change for extruder",marlinRef:"M205 E<value>"}}]},{category:"temperature",name:"Temperature Settings",icon:ye,settings:[{key:"pid.hotend.p",label:"Hotend PID P",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Proportional gain for hotend PID controller",marlinRef:"M301 P<value>",warning:"Incorrect PID values can cause temperature instability"},dangerous:!0},{key:"pid.hotend.i",label:"Hotend PID I",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Integral gain for hotend PID controller",marlinRef:"M301 I<value>"},dangerous:!0},{key:"pid.hotend.d",label:"Hotend PID D",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Derivative gain for hotend PID controller",marlinRef:"M301 D<value>"},dangerous:!0},{key:"pid.bed.p",label:"Bed PID P",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Proportional gain for bed PID controller",marlinRef:"M304 P<value>"},dangerous:!0},{key:"pid.bed.i",label:"Bed PID I",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Integral gain for bed PID controller",marlinRef:"M304 I<value>"},dangerous:!0},{key:"pid.bed.d",label:"Bed PID D",type:"number",unit:"",validation:{min:0,max:100},documentation:{description:"Derivative gain for bed PID controller",marlinRef:"M304 D<value>"},dangerous:!0}]},{category:"bedLeveling",name:"Bed Leveling Settings",icon:ye,settings:[{key:"bedLeveling.enabled",label:"Bed Leveling Enabled",type:"boolean",documentation:{description:"Enable or disable automatic bed leveling compensation",marlinRef:"M420 S<0|1>"}},{key:"bedLeveling.fadeHeight",label:"Fade Height",type:"number",unit:"mm",validation:{min:0,max:100},documentation:{description:"Height at which bed leveling compensation fades out",marlinRef:"M420 Z<value>"}},{key:"zProbeOffset.x",label:"Z Probe X Offset",type:"number",unit:"mm",validation:{min:-100,max:100},documentation:{description:"X offset of the Z probe relative to the nozzle",marlinRef:"M851 X<value>"}},{key:"zProbeOffset.y",label:"Z Probe Y Offset",type:"number",unit:"mm",validation:{min:-100,max:100},documentation:{description:"Y offset of the Z probe relative to the nozzle",marlinRef:"M851 Y<value>"}},{key:"zProbeOffset.z",label:"Z Probe Z Offset",type:"number",unit:"mm",validation:{min:-10,max:10},documentation:{description:"Z offset of the Z probe relative to the nozzle",marlinRef:"M851 Z<value>",warning:"Critical for first layer height"}}]},{category:"advanced",name:"Advanced Settings",icon:ye,settings:[{key:"homeOffset.x",label:"Home X Offset",type:"number",unit:"mm",validation:{min:-1e3,max:1e3},documentation:{description:"X offset from home position",marlinRef:"M206 X<value>"}},{key:"homeOffset.y",label:"Home Y Offset",type:"number",unit:"mm",validation:{min:-1e3,max:1e3},documentation:{description:"Y offset from home position",marlinRef:"M206 Y<value>"}},{key:"homeOffset.z",label:"Home Z Offset",type:"number",unit:"mm",validation:{min:-1e3,max:1e3},documentation:{description:"Z offset from home position",marlinRef:"M206 Z<value>"}},{key:"linearAdvance",label:"Linear Advance",type:"number",unit:"",validation:{min:0,max:10},documentation:{description:"Linear advance K-factor for pressure advance",marlinRef:"M900 K<value>"}},{key:"powerLossRecovery",label:"Power Loss Recovery",type:"boolean",documentation:{description:"Enable power loss recovery feature",marlinRef:"M413 S<0|1>"}}]}],[]);_e.useEffect(()=>{if(N){const v={};h.forEach(C=>{C.settings.forEach(y=>{const w=y.key.split(".");let k=N;for(const H of w)k=k==null?void 0:k[H];v[y.key]=k})}),m(v)}},[N,h]);const g=d.useCallback((v,C)=>{m(y=>({...y,[v]:C})),c(y=>({...y,[v]:!0}))},[]),j=d.useCallback(async v=>{if(u!=="connected"){alert("Please connect to printer first");return}try{const C=o[v.key];let y="";switch(v.key){case"stepsPerUnit.x":y=`M92 X${C}`;break;case"stepsPerUnit.y":y=`M92 Y${C}`;break;case"stepsPerUnit.z":y=`M92 Z${C}`;break;case"stepsPerUnit.e":y=`M92 E${C}`;break;case"feedrates.x":y=`M203 X${C}`;break;case"feedrates.y":y=`M203 Y${C}`;break;case"feedrates.z":y=`M203 Z${C}`;break;case"feedrates.e":y=`M203 E${C}`;break;case"acceleration.max":y=`M201 X${C} Y${C} Z${C} E${C}`;break;case"acceleration.print":y=`M204 P${C}`;break;case"acceleration.retract":y=`M204 R${C}`;break;case"acceleration.travel":y=`M204 T${C}`;break;case"acceleration.jerk.x":y=`M205 X${C}`;break;case"acceleration.jerk.y":y=`M205 Y${C}`;break;case"acceleration.jerk.z":y=`M205 Z${C}`;break;case"acceleration.jerk.e":y=`M205 E${C}`;break;case"pid.hotend.p":case"pid.hotend.i":case"pid.hotend.d":const w=o["pid.hotend.p"]||0,k=o["pid.hotend.i"]||0,H=o["pid.hotend.d"]||0;y=`M301 P${w} I${k} D${H}`;break;case"pid.bed.p":case"pid.bed.i":case"pid.bed.d":const K=o["pid.bed.p"]||0,z=o["pid.bed.i"]||0,Z=o["pid.bed.d"]||0;y=`M304 P${K} I${z} D${Z}`;break;case"bedLeveling.enabled":y=`M420 S${C?1:0}`;break;case"bedLeveling.fadeHeight":y=`M420 Z${C}`;break;case"zProbeOffset.x":case"zProbeOffset.y":case"zProbeOffset.z":const ne=o["zProbeOffset.x"]||0,je=o["zProbeOffset.y"]||0,T=o["zProbeOffset.z"]||0;y=`M851 X${ne} Y${je} Z${T}`;break;case"homeOffset.x":case"homeOffset.y":case"homeOffset.z":const I=o["homeOffset.x"]||0,A=o["homeOffset.y"]||0,O=o["homeOffset.z"]||0;y=`M206 X${I} Y${A} Z${O}`;break;case"linearAdvance":y=`M900 K${C}`;break;case"powerLossRecovery":y=`M413 S${C?1:0}`;break;default:console.warn("Unknown setting:",v.key);return}await x(y),c(w=>({...w,[v.key]:!1}))}catch(C){console.error("Error sending setting:",C),alert(`Error sending setting: ${C.message}`)}},[u,x,o]),S=d.useCallback(async()=>{if(u!=="connected"){alert("Please connect to printer first");return}if(confirm("Are you sure you want to save all changed settings to the printer? This will overwrite current printer configuration."))try{const v=Object.keys(i).filter(H=>i[H]),C=[],y={};for(const H of v){const K=h.flatMap(z=>z.settings).find(z=>z.key===H);if(K){const z=o[K.key];let Z="";switch(K.key){case"stepsPerUnit.x":case"stepsPerUnit.y":case"stepsPerUnit.z":case"stepsPerUnit.e":const ne=o["stepsPerUnit.x"]||0,je=o["stepsPerUnit.y"]||0,T=o["stepsPerUnit.z"]||0,I=o["stepsPerUnit.e"]||0;Z=`M92 X${ne} Y${je} Z${T} E${I}`,y.M92=Z;break;case"feedrates.x":case"feedrates.y":case"feedrates.z":case"feedrates.e":const A=o["feedrates.x"]||0,O=o["feedrates.y"]||0,X=o["feedrates.z"]||0,$=o["feedrates.e"]||0;Z=`M203 X${A} Y${O} Z${X} E${$}`,y.M203=Z;break;case"acceleration.max":const se=o["acceleration.max"]||0;Z=`M201 X${se} Y${se} Z${se} E${se}`,y.M201=Z;break;case"acceleration.print":case"acceleration.retract":case"acceleration.travel":const J=o["acceleration.print"]||0,U=o["acceleration.retract"]||0,W=o["acceleration.travel"]||0;Z=`M204 P${J} R${U} T${W}`,y.M204=Z;break;case"acceleration.jerk.x":case"acceleration.jerk.y":case"acceleration.jerk.z":case"acceleration.jerk.e":const ee=o["acceleration.jerk.x"]||0,oe=o["acceleration.jerk.y"]||0,ie=o["acceleration.jerk.z"]||0,pe=o["acceleration.jerk.e"]||0;Z=`M205 X${ee} Y${oe} Z${ie} E${pe}`,y.M205=Z;break;case"pid.hotend.p":case"pid.hotend.i":case"pid.hotend.d":const L=o["pid.hotend.p"]||0,q=o["pid.hotend.i"]||0,ae=o["pid.hotend.d"]||0;Z=`M301 P${L} I${q} D${ae}`,y.M301=Z;break;case"pid.bed.p":case"pid.bed.i":case"pid.bed.d":const xe=o["pid.bed.p"]||0,ce=o["pid.bed.i"]||0,he=o["pid.bed.d"]||0;Z=`M304 P${xe} I${ce} D${he}`,y.M304=Z;break;case"bedLeveling.enabled":case"bedLeveling.fadeHeight":const Ee=o["bedLeveling.enabled"]?1:0,Pe=o["bedLeveling.fadeHeight"]||0;Z=`M420 S${Ee} Z${Pe}`,y.M420=Z;break;case"zProbeOffset.x":case"zProbeOffset.y":case"zProbeOffset.z":const we=o["zProbeOffset.x"]||0,B=o["zProbeOffset.y"]||0,Y=o["zProbeOffset.z"]||0;Z=`M851 X${we} Y${B} Z${Y}`,y.M851=Z;break;case"homeOffset.x":case"homeOffset.y":case"homeOffset.z":const D=o["homeOffset.x"]||0,R=o["homeOffset.y"]||0,G=o["homeOffset.z"]||0;Z=`M206 X${D} Y${R} Z${G}`,y.M206=Z;break;case"linearAdvance":Z=`M900 K${z}`,y.M900=Z;break;case"powerLossRecovery":Z=`M413 S${z?1:0}`,y.M413=Z;break}}}const w=Object.values(y);if(w.length===0){alert("No settings to save");return}w.push("M500");const k=await f(w,{delayMs:150,maxRetries:2,onProgress:(H,K,z)=>{console.log(`Sending ${H}/${K}: ${z}`)}});if(k.failureCount>0?alert(`Settings saved with ${k.failureCount} failures. Check serial log for details.`):alert("All settings saved successfully!"),b){const H={...N};v.forEach(K=>{const z=K.split(".");let Z=H;for(let ne=0;ne<z.length-1;ne++)Z[z[ne]]||(Z[z[ne]]={}),Z=Z[z[ne]];Z[z[z.length-1]]=o[K]}),p(b,H)}c({})}catch(v){console.error("Error saving settings:",v),alert(`Error saving settings: ${v.message}`)}},[u,f,i,h,o,b,N,p]),M=d.useCallback(async()=>{},[]),_=d.useCallback(()=>{if(c({}),N){const v={};h.forEach(C=>{C.settings.forEach(y=>{const w=y.key.split(".");let k=N;for(const H of w)k=k==null?void 0:k[H];v[y.key]=k})}),m(v)}},[N,h]),P=d.useCallback(v=>{n(C=>({...C,[v]:!C[v]}))},[]),E=d.useMemo(()=>h.filter(v=>s==="all"||v.category===s).map(v=>({...v,settings:v.settings.filter(C=>t===""||C.label.toLowerCase().includes(t.toLowerCase())||C.key.toLowerCase().includes(t.toLowerCase()))})).filter(v=>v.settings.length>0),[h,t,s]),F=Object.values(i).filter(Boolean).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Printer Settings Editor"}),e.jsx("p",{className:"text-gray-600",children:"Configure and manage all printer settings"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:M,disabled:u!=="connected",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Fetch Settings"]}),F>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 flex items-center",children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Reset Changes"]}),e.jsxs("button",{onClick:S,disabled:u!=="connected",className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Save All (",F,")"]})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search settings...",value:t,onChange:v=>a(v.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"min-w-48",children:e.jsxs("select",{value:s,onChange:v=>r(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Categories"}),h.map(v=>e.jsx("option",{value:v.category,children:v.name},v.category))]})})]})}),e.jsx("div",{className:"space-y-4",children:E.map(v=>e.jsx($a,{category:v,settings:v.settings,values:o,onChange:g,onSend:j,changedSettings:i,isExpanded:l[v.category]||!1,onToggle:()=>P(v.category)},v.category))}),F>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-600 mr-2"}),e.jsxs("span",{className:"text-yellow-800 font-medium",children:[F," setting",F!==1?"s":""," have been modified"]})]}),e.jsxs("button",{onClick:S,disabled:u!=="connected",className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Save All"]})]})})]})},Va=()=>{var o,m,u,x,f,b,N,p,h,g,j,S,M,_,P,E;const[t,a]=d.useState("editor");V(F=>F.status),ue(F=>F.activePrinterId);const s=ue(F=>{const v=F.printers.find(C=>C.id===F.activePrinterId);return v==null?void 0:v.printerSettings}),r=()=>{var v,C,y,w,k,H,K,z,Z,ne;return s?{motion:{stepsPerUnit:s.stepsPerUnit,feedrates:s.feedrates},acceleration:{max:(v=s.acceleration)==null?void 0:v.max,print:(C=s.acceleration)==null?void 0:C.print,retract:(y=s.acceleration)==null?void 0:y.retract,travel:(w=s.acceleration)==null?void 0:w.travel},temperature:{pidHotend:(k=s.pid)==null?void 0:k.hotend,pidBed:(H=s.pid)==null?void 0:H.bed},bedLeveling:{enabled:(K=s.bedLeveling)==null?void 0:K.enabled,fadeHeight:(z=s.bedLeveling)==null?void 0:z.fadeHeight,meshPoints:((ne=(Z=s.bedLeveling)==null?void 0:Z.mesh)==null?void 0:ne.length)||0},advanced:{homeOffset:s.homeOffset,zProbeOffset:s.zProbeOffset,linearAdvance:s.linearAdvance,powerLossRecovery:s.powerLossRecovery}}:null},l=()=>{if(!s)return{status:"no-data",message:"No configuration data available",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",icon:Ne};const F=s.lastUpdated;return F&&Date.now()-new Date(F).getTime()<24*60*60*1e3?{status:"current",message:"Configuration is up to date",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",icon:fe}:{status:"outdated",message:"Configuration may be outdated",color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",icon:Ne}},n=r(),i=l(),c=i.icon;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuration Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and configure all printer settings"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Settings Auto-Fetched on Connection"]})})]}),e.jsx("div",{className:`rounded-lg border-2 ${i.borderColor} ${i.bgColor} p-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:`w-6 h-6 mr-3 ${i.color}`}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold ${i.color}`,children:"Configuration Status"}),e.jsx("p",{className:`text-sm ${i.color}`,children:i.message})]})]}),(s==null?void 0:s.lastUpdated)&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm ${i.color}`,children:new Date(s.lastUpdated).toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-500",children:"Last Updated"})]})]})}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>a("editor"),className:`flex-1 px-4 py-2 rounded text-sm font-medium ${t==="editor"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ye,{className:"w-4 h-4 mr-2 inline"}),"Settings Editor"]}),e.jsxs("button",{onClick:()=>a("summary"),className:`flex-1 px-4 py-2 rounded text-sm font-medium ${t==="summary"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Te,{className:"w-4 h-4 mr-2 inline"}),"Summary"]}),e.jsxs("button",{onClick:()=>a("documentation"),className:`flex-1 px-4 py-2 rounded text-sm font-medium ${t==="documentation"?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(na,{className:"w-4 h-4 mr-2 inline"}),"Documentation"]})]}),t==="editor"&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsx(Ga,{})}),t==="summary"&&e.jsx("div",{className:"space-y-6",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Motion Settings"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"X Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((o=n.motion.stepsPerUnit)==null?void 0:o.x)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Y Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((m=n.motion.stepsPerUnit)==null?void 0:m.y)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Z Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((u=n.motion.stepsPerUnit)==null?void 0:u.z)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"E Steps/mm"}),e.jsx("div",{className:"text-xl font-bold",children:((x=n.motion.stepsPerUnit)==null?void 0:x.e)||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Acceleration Settings"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Max Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((f=n.acceleration)==null?void 0:f.max)||"N/A"," mm/s²"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Print Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((b=n.acceleration)==null?void 0:b.print)||"N/A"," mm/s²"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Retract Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((N=n.acceleration)==null?void 0:N.retract)||"N/A"," mm/s²"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Travel Acceleration"}),e.jsxs("div",{className:"text-xl font-bold",children:[((p=n.acceleration)==null?void 0:p.travel)||"N/A"," mm/s²"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Temperature Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Hotend PID"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"P:"}),e.jsx("span",{className:"font-mono",children:((h=n.temperature.pidHotend)==null?void 0:h.p)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"I:"}),e.jsx("span",{className:"font-mono",children:((g=n.temperature.pidHotend)==null?void 0:g.i)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"D:"}),e.jsx("span",{className:"font-mono",children:((j=n.temperature.pidHotend)==null?void 0:j.d)||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Bed PID"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"P:"}),e.jsx("span",{className:"font-mono",children:((S=n.temperature.pidBed)==null?void 0:S.p)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"I:"}),e.jsx("span",{className:"font-mono",children:((M=n.temperature.pidBed)==null?void 0:M.i)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"D:"}),e.jsx("span",{className:"font-mono",children:((_=n.temperature.pidBed)==null?void 0:_.d)||"N/A"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Bed Leveling"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("div",{className:`text-lg font-semibold ${n.bedLeveling.enabled?"text-green-600":"text-red-600"}`,children:n.bedLeveling.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Fade Height"}),e.jsxs("div",{className:"text-xl font-bold",children:[n.bedLeveling.fadeHeight||"N/A"," mm"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Mesh Points"}),e.jsx("div",{className:"text-xl font-bold",children:n.bedLeveling.meshPoints})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Advanced Settings"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Linear Advance"}),e.jsx("div",{className:"text-xl font-bold",children:n.advanced.linearAdvance||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Power Loss Recovery"}),e.jsx("div",{className:`text-lg font-semibold ${n.advanced.powerLossRecovery?"text-green-600":"text-red-600"}`,children:n.advanced.powerLossRecovery?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Z Probe Z Offset"}),e.jsxs("div",{className:"text-xl font-bold",children:[((P=n.advanced.zProbeOffset)==null?void 0:P.z)||"N/A"," mm"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Home Z Offset"}),e.jsxs("div",{className:"text-xl font-bold",children:[((E=n.advanced.homeOffset)==null?void 0:E.z)||"N/A"," mm"]})]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(ye,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Configuration Data"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Connect to printer to automatically fetch configuration"}),e.jsxs("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded flex items-center justify-center mx-auto max-w-xs",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Auto-Fetch on Connection"]})]})}),t==="documentation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Marlin G-code Reference"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Motion Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M92"})," - Set steps per unit"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M203"})," - Set maximum feedrate"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M201"})," - Set maximum acceleration"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M204"})," - Set acceleration"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M205"})," - Set advanced settings"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Temperature Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M301"})," - Set hotend PID"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M304"})," - Set bed PID"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M145"})," - Set material presets"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Bed Leveling Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M420"})," - Enable/disable bed leveling"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"G29"})," - Auto bed leveling"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M851"})," - Set Z probe offset"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Advanced Commands"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M206"})," - Set home offset"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M900"})," - Set linear advance"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M413"})," - Power loss recovery"]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"M500"})," - Save to EEPROM"]})]})]})]})})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Safety Information"]}),e.jsxs("div",{className:"space-y-3 text-sm text-yellow-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"PID Settings:"})," Incorrect PID values can cause temperature instability and potential damage to your printer."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Steps per Unit:"})," Wrong values will cause dimensional inaccuracy in your prints."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Acceleration/Jerk:"})," Too high values can cause skipped steps and print failures."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Z Probe Offset:"})," Critical for first layer height and print quality."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Always test changes:"})," Make small adjustments and test thoroughly before making major changes."]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2 text-blue-600"}),"Best Practices"]}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Backup First:"})," Always fetch and save your current configuration before making changes."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"One at a Time:"})," Make one setting change at a time and test the results."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Document Changes:"})," Keep track of what you've changed and why."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Save to EEPROM:"}),` Always use "Save All" to permanently save changes to the printer's memory.`]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Test Prints:"})," Run test prints after making significant changes to verify everything works correctly."]})]})]})]})]})},cs=()=>{var P,E,F,v,C,y;const[t,a]=d.useState(!1),[s,r]=d.useState({}),[l,n]=d.useState("basic"),{updatePrinter:i}=ue(),c=ue(w=>w.activePrinterId),o=ue(w=>{const k=w.printers.find(H=>H.id===c);return k||null}),m=V(w=>w.status),u=V(w=>w.bedMesh),x=V(w=>w.fetchBedLevel),f=V(w=>w.runBedLeveling),b=V(w=>w.processCollectedBedMeshData),N=ue(w=>{const k=w.printers.find(H=>H.id===c);return k==null?void 0:k.printerSettings}),p=(u==null?void 0:u.data)&&u.data.length>0,h=(P=N==null?void 0:N.bedLeveling)==null?void 0:P.enabled;if(d.useCallback(async()=>{if(m!=="connected"){alert("Please connect to printer first");return}await x()},[m,x]),d.useCallback(async()=>{if(m!=="connected"){alert("Please connect to printer first");return}confirm("This will run automatic bed leveling (G29). This process takes several minutes. Continue?")&&await f()},[m,f]),d.useCallback(async()=>{await b()},[b]),!o)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(it,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Printer Selected"}),e.jsx("p",{className:"text-gray-500",children:"Please select a printer to view configuration"})]});const g=()=>{r({name:o.name,model:o.model,firmware:o.firmware||"",bedSize:{...o.bedSize}}),a(!0)},j=()=>{i(o.id,s),a(!1),r({})},S=()=>{a(!1),r({})},M=(w,k)=>{r(w==="bedSize"?H=>({...H,bedSize:{...H.bedSize,...k}}):H=>({...H,[w]:k}))},_=(w,k,H,K="text")=>t&&s[H]!==void 0?H==="bedSize"?e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{type:"number",placeholder:"X",value:s.bedSize.x,onChange:z=>M("bedSize",{x:parseInt(z.target.value)||0}),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"number",placeholder:"Y",value:s.bedSize.y,onChange:z=>M("bedSize",{y:parseInt(z.target.value)||0}),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"number",placeholder:"Z",value:s.bedSize.z,onChange:z=>M("bedSize",{z:parseInt(z.target.value)||0}),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}):e.jsx("input",{type:K,value:s[H],onChange:z=>M(H,z.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):H==="bedSize"?e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("span",{className:"text-gray-900 font-medium",children:[k.x," × ",k.y," × ",k.z," mm"]})}):e.jsx("span",{className:"text-gray-900",children:k||"Not specified"});return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Printer Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your printer's basic settings and bed leveling"})]}),e.jsx("div",{className:"flex space-x-3",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Changes"})]}),e.jsxs("button",{onClick:S,className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Configuration"})]})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>n("basic"),className:`py-2 px-1 border-b-2 font-medium text-sm ${l==="basic"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ye,{className:"h-4 w-4 inline mr-2"}),"Basic Configuration"]}),e.jsxs("button",{onClick:()=>n("bedLevel"),className:`py-2 px-1 border-b-2 font-medium text-sm ${l==="bedLevel"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(jt,{className:"h-4 w-4 inline mr-2"}),"Bed Leveling"]}),e.jsxs("button",{onClick:()=>n("config"),className:`py-2 px-1 border-b-2 font-medium text-sm ${l==="config"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(We,{className:"h-4 w-4 inline mr-2"}),"Configuration Management"]})]})}),l==="basic"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(it,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Printer Name"}),_("Printer Name",o.name,"name")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),_("Model",o.model,"model")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Firmware"}),_("Firmware",o.firmware,"firmware")]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bed Size (X × Y × Z)"}),_("Bed Size",o.bedSize,"bedSize")]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Firmware Configuration"})]}),e.jsxs("div",{className:"space-y-3",children:[((E=o.firmwareConfiguration)==null?void 0:E.maxHotendTemp)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Hotend Temperature"}),e.jsxs("span",{className:"text-gray-900",children:[o.firmwareConfiguration.maxHotendTemp,"°C"]})]}),((F=o.firmwareConfiguration)==null?void 0:F.maxBedTemp)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Bed Temperature"}),e.jsxs("span",{className:"text-gray-900",children:[o.firmwareConfiguration.maxBedTemp,"°C"]})]}),((v=o.firmwareConfiguration)==null?void 0:v.stepsPerMm)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Steps per mm"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"X:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.x})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Y:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.y})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Z:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.z})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"E:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:o.firmwareConfiguration.stepsPerMm.e})]})]})]}),!o.firmwareConfiguration||Object.keys(o.firmwareConfiguration).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No firmware configuration data available"}):null]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Re,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Calibration Status"})]}),e.jsxs("div",{className:"space-y-3",children:[o.calibrationSteps&&Object.entries(o.calibrationSteps).map(([w,k])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 capitalize",children:w.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"flex items-center space-x-2",children:k!=null&&k.completed?e.jsx("span",{className:"text-green-600 text-sm font-medium",children:"Completed"}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Pending"})})]},w)),!o.calibrationSteps||Object.keys(o.calibrationSteps).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No calibration steps configured"}):null]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Re,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Additional Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Printer ID"}),e.jsx("p",{className:"text-sm text-gray-600 font-mono bg-gray-100 p-2 rounded",children:o.id})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Last Updated"}),e.jsx("p",{className:"text-sm text-gray-600",children:o.lastUpdated?new Date(o.lastUpdated).toLocaleDateString():"Never"})]})]})]})]}),l==="bedLevel"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(jt,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bed Leveling Status"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:h?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Enabled"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Disabled"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u!=null&&u.gridSize?`${u.gridSize.x}×${u.gridSize.y}`:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Grid Size"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:p?u.data.length:0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Mesh Points"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u!=null&&u.variance?`${u.variance.toFixed(3)}`:"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Variance (mm)"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ht,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bed Mesh Visualization"})]}),e.jsx(zs,{})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(qe,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Bed Leveling Information"})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fade Height:"})," ",((C=N==null?void 0:N.bedLeveling)==null?void 0:C.fadeHeight)||"Not set"," mm"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mesh Type:"})," ",((y=N==null?void 0:N.bedLeveling)==null?void 0:y.type)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Updated:"})," ",u!=null&&u.lastUpdated?new Date(u.lastUpdated).toLocaleString():"Never"]})]})]})]}),l==="config"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Va,{})})]})};function Ha(t,a=!1){if(!t||typeof t!="string")return[];const s=t.split(`
`),r=[];for(let i=0;i<s.length;i++){const c=s[i].trim();if(!c||c.startsWith("//")&&!c.includes("#define")||c.startsWith("/*"))continue;let o=c.match(/^(\s*\/\/\s*)?#define\s+([A-Za-z0-9_]+)\s*(.*)/);if(o){const[,m,u,x]=o,f=!!m;let b="",N="";if(x){const p=x.split(/(?:\/\/|\/\*)/),h=p[0].trim();f&&!h?b=!1:h&&(h==="true"||h==="false"?b=h==="true":h==="1"||h==="0"?b=h==="1":!isNaN(h)&&h!==""?h.includes(".")||h.startsWith("-")?b=parseFloat(h):b=parseInt(h,10):h.startsWith('"')&&h.endsWith('"')||h.startsWith("'")&&h.endsWith("'")?b=h.slice(1,-1):b=h),p.length>1&&(N=p[1].trim())}if(!N&&i+1<s.length){const p=s[i+1].trim();p.startsWith("//")&&!p.includes("#define")&&(N=p.substring(2).trim())}if(!N&&i>0){const p=s[i-1].trim();p.startsWith("//")&&!p.includes("#define")&&(N=p.substring(2).trim())}f&&console.log(`Found commented define: ${u} (line ${i+1})`),r.push({name:u,value:b,enabled:!f,description:N,lineNumber:i+1,fileType:a?"advanced":"basic"})}}const l=r.filter(i=>i.enabled).length,n=r.filter(i=>!i.enabled).length;return console.log(`Parsed ${r.length} defines: ${l} enabled, ${n} disabled`),r}function Xa(t,a="name",s="asc"){return[...t].sort((r,l)=>{let n=r[a],i=l[a];if(typeof n=="boolean"&&(n=n?1:0),typeof i=="boolean"&&(i=i?1:0),typeof n=="number"&&typeof i=="number")return s==="asc"?n-i:i-n;if(typeof n=="string"&&typeof i=="string"){const o=n.localeCompare(i);return s==="asc"?o:-o}const c=String(n).localeCompare(String(i));return s==="asc"?c:-c})}const Dt={"Machine Configuration":{subcategories:{"Basic Info":["MACHINE_NAME","MACHINE_UUID","STRING_CONFIG_H_AUTHOR"],"Board & Serial":["MOTHERBOARD","SERIAL_PORT","BAUDRATE","SERIAL_PORT_2"],"Printer Type":["DELTA","SCARA","COREXY","COREXZ","COREYZ","MARKFORGED_XY"]}},"Geometry & Kinematics":{subcategories:{"Build Volume":["X_BED_SIZE","Y_BED_SIZE","X_MIN_POS","X_MAX_POS","Y_MIN_POS","Y_MAX_POS","Z_MIN_POS","Z_MAX_POS"],"Bed Configuration":["BED_CENTER_AT_0_0","MANUAL_X_HOME_POS","MANUAL_Y_HOME_POS","MANUAL_Z_HOME_POS","BED_TRAMMING_INSET_LFRONT","BED_TRAMMING_INSET_RFRONT","BED_TRAMMING_INSET_LBACK","BED_TRAMMING_INSET_RBACK","BED_TRAMMING_HEIGHT","BED_TRAMMING_Z_HOP","BED_TRAMMING_USE_PROBE","BED_TRAMMING_INCLUDE_CENTER","BED_TRAMMING_VERIFY_RAISED","BED_TRAMMING_AUTO_LEVEL","BED_TRAMMING_REPORT_AVERAGE","BED_TRAMMING_ACCEPTABLE_TOLERANCE"],"Extruder Count":["EXTRUDERS","TEMP_SENSOR_1","TEMP_SENSOR_2","TEMP_SENSOR_3"],"Bed Leveling":["BED_LEVELING_COMMANDS","BED_LEVELING_REPEATABLE","BED_LEVELING_GRID","BED_LEVELING_GRID_POINTS","BED_LEVELING_GRID_SIZE","BED_LEVELING_GRID_OFFSET","BED_LEVELING_GRID_OFFSET_X","BED_LEVELING_GRID_OFFSET_Y","BED_LEVELING_GRID_OFFSET_Z","BED_LEVELING_GRID_OFFSET_RIGHT","BED_LEVELING_GRID_OFFSET_FRONT","BED_LEVELING_GRID_OFFSET_LEFT","BED_LEVELING_GRID_OFFSET_BACK"]}},"Motion & Mechanics":{subcategories:{"Steps & Direction":["DEFAULT_AXIS_STEPS_PER_UNIT","INVERT_X_DIR","INVERT_Y_DIR","INVERT_Z_DIR","INVERT_E0_DIR","INVERT_E1_DIR","INVERT_E2_DIR","INVERT_E3_DIR","INVERT_E4_DIR","INVERT_E5_DIR","INVERT_E6_DIR","INVERT_E7_DIR","X_DRIVER_TYPE","Y_DRIVER_TYPE","Z_DRIVER_TYPE","E0_DRIVER_TYPE","E1_DRIVER_TYPE","E2_DRIVER_TYPE","E3_DRIVER_TYPE","E4_DRIVER_TYPE","E5_DRIVER_TYPE","E6_DRIVER_TYPE","E7_DRIVER_TYPE"],"Speed & Acceleration":["DEFAULT_MAX_FEEDRATE","DEFAULT_MAX_ACCELERATION","DEFAULT_ACCELERATION","DEFAULT_RETRACT_ACCELERATION"],"Jerk Control":["CLASSIC_JERK","DEFAULT_XJERK","DEFAULT_YJERK","DEFAULT_ZJERK","DEFAULT_EJERK"],"Junction Deviation":["JUNCTION_DEVIATION","JD_HANDLE_SMALL_SEGMENTS"],"Stepper Driver Configuration":["X_DRIVER_TYPE","Y_DRIVER_TYPE","Z_DRIVER_TYPE","E0_DRIVER_TYPE","E1_DRIVER_TYPE","E2_DRIVER_TYPE","E3_DRIVER_TYPE","E4_DRIVER_TYPE","E5_DRIVER_TYPE","E6_DRIVER_TYPE","E7_DRIVER_TYPE","X_RSENSE","Y_RSENSE","Z_RSENSE","E0_RSENSE","E1_RSENSE","E2_RSENSE","E3_RSENSE","E4_RSENSE","E5_RSENSE","E6_RSENSE","E7_RSENSE","X_CHOPPER_TIMING","Y_CHOPPER_TIMING","Z_CHOPPER_TIMING","E0_CHOPPER_TIMING","E1_CHOPPER_TIMING","E2_CHOPPER_TIMING","E3_CHOPPER_TIMING","E4_CHOPPER_TIMING","E5_CHOPPER_TIMING","E6_CHOPPER_TIMING","E7_CHOPPER_TIMING"]}},"Endstops & Homing":{subcategories:{"Endstop Configuration":["USE_XMIN_PLUG","USE_YMIN_PLUG","USE_ZMIN_PLUG","USE_XMAX_PLUG","USE_YMAX_PLUG","USE_ZMAX_PLUG","X_MIN_ENDSTOP_INVERTING","Y_MIN_ENDSTOP_INVERTING","Z_MIN_ENDSTOP_INVERTING","X_MAX_ENDSTOP_INVERTING","Y_MAX_ENDSTOP_INVERTING","Z_MAX_ENDSTOP_INVERTING","X_MIN_ENDSTOP_PULLUP","Y_MIN_ENDSTOP_PULLUP","Z_MIN_ENDSTOP_PULLUP","X_MAX_ENDSTOP_PULLUP","Y_MAX_ENDSTOP_PULLUP","Z_MAX_ENDSTOP_PULLUP","ENDSTOPPULLUPS","ENDSTOPPULLUP_XMIN","ENDSTOPPULLUP_YMIN","ENDSTOPPULLUP_ZMIN","ENDSTOPPULLUP_XMAX","ENDSTOPPULLUP_YMAX","ENDSTOPPULLUP_ZMAX","ENDSTOP_INTERRUPTS_FEATURE","ENDSTOP_NOISE_FILTER","ENDSTOP_NOISE_THRESHOLD"],"Endstop Logic":["X_MIN_ENDSTOP_INVERTING","Y_MIN_ENDSTOP_INVERTING","Z_MIN_ENDSTOP_INVERTING"],Homing:["HOMING_FEEDRATE_XY","HOMING_FEEDRATE_Z","HOMING_BUMP_FEEDRATE","X_HOME_BUMP_MM","Y_HOME_BUMP_MM","Z_HOME_BUMP_MM"]}},"Temperature Control":{subcategories:{Sensors:["TEMP_SENSOR_0","TEMP_SENSOR_BED","TEMP_SENSOR_CHAMBER","TEMP_SENSOR_PROBE","TEMP_SENSOR_1","TEMP_SENSOR_2","TEMP_SENSOR_3","TEMP_SENSOR_4","TEMP_SENSOR_5","TEMP_SENSOR_6","TEMP_SENSOR_7","TEMP_SENSOR_COOLER","TEMP_SENSOR_REDUNDANT","TEMP_SENSOR_REDUNDANT_SOURCE","TEMP_SENSOR_REDUNDANT_TARGET","TEMP_SENSOR_REDUNDANT_MAX_DIFF"],"Safety Limits":["HEATER_0_MAXTEMP","HEATER_0_MINTEMP","BED_MAXTEMP","BED_MINTEMP"],"PID Settings":["PIDTEMP","DEFAULT_Kp","DEFAULT_Ki","DEFAULT_Kd","PIDTEMPBED"],"Thermal Protection":["THERMAL_PROTECTION_HOTENDS","THERMAL_PROTECTION_BED","THERMAL_PROTECTION_CHAMBER"],"Temperature Control Features":["BABYSTEPPING","BABYSTEP_XY","BABYSTEP_INVERT_Z","BABYSTEP_MULTIPLICATOR_Z","BABYSTEP_MULTIPLICATOR_XY","BABYSTEP_ZPROBE_OFFSET","BABYSTEP_HOTEND_Z_OFFSET","BABYSTEP_ZPROBE_GFX_OVERLAY","BABYSTEP_ZPROBE_GFX_REVERSE","BABYSTEP_ZPROBE_GFX_START_LEFT","BABYSTEP_ZPROBE_GFX_START_TOP","BABYSTEP_ZPROBE_GFX_START_RIGHT","BABYSTEP_ZPROBE_GFX_START_BOTTOM","BABYSTEP_ZPROBE_GFX_START_CENTER","BABYSTEP_ZPROBE_GFX_START_CENTER_LEFT","BABYSTEP_ZPROBE_GFX_START_CENTER_RIGHT","BABYSTEP_ZPROBE_GFX_START_CENTER_TOP","BABYSTEP_ZPROBE_GFX_START_CENTER_BOTTOM"]}},"Bed Leveling":{subcategories:{"Auto Bed Leveling":["AUTO_BED_LEVELING_3POINT","AUTO_BED_LEVELING_LINEAR","AUTO_BED_LEVELING_BILINEAR","AUTO_BED_LEVELING_UBL"],"Manual Leveling":["MESH_BED_LEVELING","MANUAL_MESH_BED_LEVELING"],"Probe Configuration":["BLTOUCH","FIX_MOUNTED_PROBE","NOZZLE_AS_PROBE","Z_PROBE_OFFSET_FROM_EXTRUDER"],"Grid Settings":["GRID_MAX_POINTS_X","GRID_MAX_POINTS_Y","LEFT_PROBE_BED_POSITION","RIGHT_PROBE_BED_POSITION"],Babystepping:["BABYSTEPPING","BABYSTEP_XY","BABYSTEP_INVERT_Z","BABYSTEP_MULTIPLICATOR_Z","BABYSTEP_MULTIPLICATOR_XY","BABYSTEP_ZPROBE_OFFSET","BABYSTEP_HOTEND_Z_OFFSET","BABYSTEP_ZPROBE_GFX_OVERLAY","BABYSTEP_ZPROBE_GFX_REVERSE"]}},"Extruder & Filament":{subcategories:{"Extruder Mechanics":["PREVENT_COLD_EXTRUSION","EXTRUDE_MINTEMP","PREVENT_LENGTHY_EXTRUDE","EXTRUDE_MAXLENGTH"],"Linear Advance":["LIN_ADVANCE","LIN_ADVANCE_K"],"Filament Handling":["FILAMENT_RUNOUT_SENSOR","FILAMENT_RUNOUT_SCRIPT","ADVANCED_PAUSE_FEATURE"],"Pressure Control":["FWRETRACT","RETRACT_LENGTH","RETRACT_FEEDRATE","RETRACT_ZRAISE"]}},"Display & Interface":{subcategories:{"LCD Type":["REPRAP_DISCOUNT_SMART_CONTROLLER","REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER","CR10_STOCKDISPLAY"],"Interface Features":["ULTIPANEL","NEWPANEL","LCD_BED_LEVELING","LCD_UBL_MESH_EDITING"],"SD Card":["SDSUPPORT","SD_CHECK_AND_RETRY","SDCARD_SORT_ALPHA"]}},"Advanced Features":{subcategories:{"Motion Features":["S_CURVE_ACCELERATION","BEZIER_JERK_CONTROL","EXPERIMENTAL_SCURVE"],"Stepper Drivers":["TMC2130","TMC2208","TMC2209","TMC5130","TMC5160"],Networking:["WIFI_CUSTOM_COMMAND","ESP3D_WIFISUPPORT"],Experimental:["EXPERIMENTAL_I2CBUS","EMERGENCY_PARSER","REALTIME_REPORTING_COMMANDS"],"Advanced Motion":["ADVANCED_PAUSE_FEATURE","ADVANCED_PAUSE_CONTINUOUS_PURGE","ADVANCED_PAUSE_PURGE_LENGTH","ADVANCED_PAUSE_PURGE_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT","ADVANCED_PAUSE_PURGE_RETRACT_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_SPEED","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_SPEED"],"Advanced Features":["ADVANCED_PAUSE_FEATURE","ADVANCED_PAUSE_CONTINUOUS_PURGE","ADVANCED_PAUSE_PURGE_LENGTH","ADVANCED_PAUSE_PURGE_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT","ADVANCED_PAUSE_PURGE_RETRACT_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_SPEED","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_FEEDRATE","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_LENGTH","ADVANCED_PAUSE_PURGE_RETRACT_UNLOAD_SPEED"]}},"Custom Menus & UI":{subcategories:{"Menu Items":["CUSTOM_MENU_MAIN","CUSTOM_MENU_CONFIGURATION","CUSTOM_MENU_MOVE","CUSTOM_MENU_TEMPERATURE","CUSTOM_MENU_CONTROL","CUSTOM_MENU_UTILITY","CUSTOM_MENU_MAINTENANCE","CUSTOM_MENU_INFO","CUSTOM_MENU_DEBUG","CUSTOM_MENU_CALIBRATION"],"Menu Actions":["CUSTOM_MENU_ACTION_1","CUSTOM_MENU_ACTION_2","CUSTOM_MENU_ACTION_3","CUSTOM_MENU_ACTION_4","CUSTOM_MENU_ACTION_5","CUSTOM_MENU_ACTION_6","CUSTOM_MENU_ACTION_7","CUSTOM_MENU_ACTION_8","CUSTOM_MENU_ACTION_9","CUSTOM_MENU_ACTION_10"],"Menu Labels":["CUSTOM_MENU_LABEL_1","CUSTOM_MENU_LABEL_2","CUSTOM_MENU_LABEL_3","CUSTOM_MENU_LABEL_4","CUSTOM_MENU_LABEL_5","CUSTOM_MENU_LABEL_6","CUSTOM_MENU_LABEL_7","CUSTOM_MENU_LABEL_8","CUSTOM_MENU_LABEL_9","CUSTOM_MENU_LABEL_10"]}},"Printer-Specific Features":{subcategories:{"Delta Printer":["DELTA_PRINTER","DELTA_ENDSTOP_ADJ","DELTA_DIAGONAL_ROD","DELTA_HEIGHT","DELTA_RADIUS","DELTA_SEGMENTS_PER_SECOND","DELTA_PRINTABLE_RADIUS","DELTA_PROBEABLE_RADIUS","DELTA_TOWER_ANGLE_TRIM","DELTA_ENDSTOP_OFFSET","DELTA_CARRIAGE_OFFSET","DELTA_DIAGONAL_ROD_TRIM_TOWER_1","DELTA_DIAGONAL_ROD_TRIM_TOWER_2","DELTA_DIAGONAL_ROD_TRIM_TOWER_3"],"SCARA Printer":["SCARA_PRINTER","SCARA_LINKAGE_1","SCARA_LINKAGE_2","SCARA_OFFSET_X","SCARA_OFFSET_Y","SCARA_THETA_OFFSET","SCARA_PSI_OFFSET"],"CoreXY Printer":["COREXY_PRINTER","COREXY_BELT_DRIVE","COREXY_BELT_DRIVE_XY","COREXY_BELT_DRIVE_XZ","COREXY_BELT_DRIVE_YZ"],"Dual X Carriage":["DUAL_X_CARRIAGE","X_DUAL_STEPPER_DRIVERS","X2_DRIVER_TYPE","X2_HOME_DIR","X2_HOME_POS","X2_MAX_ENDSTOP_INVERTING","X2_MIN_ENDSTOP_INVERTING","X2_USE_ENDSTOP","X2_STEP_PIN","X2_DIR_PIN","X2_ENABLE_PIN","X2_MS1_PIN","X2_MS2_PIN","X2_RESET_PIN","X2_SLEEP_PIN","X2_STEPPER_DRIVER","X2_STEPPER_DRIVER_TYPE","X2_STEPPER_DRIVER_ADDRESS","X2_STEPPER_DRIVER_RSENSE","X2_STEPPER_DRIVER_RSENSE_OHMS","X2_STEPPER_DRIVER_RSENSE_OHMS_DEFAULT","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_DEFAULT","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR","X2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR_DEFAULT"],"Dual Y Carriage":["DUAL_Y_CARRIAGE","Y_DUAL_STEPPER_DRIVERS","Y2_DRIVER_TYPE","Y2_HOME_DIR","Y2_HOME_POS","Y2_MAX_ENDSTOP_INVERTING","Y2_MIN_ENDSTOP_INVERTING","Y2_USE_ENDSTOP","Y2_STEP_PIN","Y2_DIR_PIN","Y2_ENABLE_PIN","Y2_MS1_PIN","Y2_MS2_PIN","Y2_RESET_PIN","Y2_SLEEP_PIN","Y2_STEPPER_DRIVER","Y2_STEPPER_DRIVER_TYPE","Y2_STEPPER_DRIVER_ADDRESS","Y2_STEPPER_DRIVER_RSENSE","Y2_STEPPER_DRIVER_RSENSE_OHMS","Y2_STEPPER_DRIVER_RSENSE_OHMS_DEFAULT","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_DEFAULT","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR","Y2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR_DEFAULT"],"Dual Z Carriage":["DUAL_Z_CARRIAGE","Z_DUAL_STEPPER_DRIVERS","Z2_DRIVER_TYPE","Z2_HOME_DIR","Z2_HOME_POS","Z2_MAX_ENDSTOP_INVERTING","Z2_MIN_ENDSTOP_INVERTING","Z2_USE_ENDSTOP","Z2_STEP_PIN","Z2_DIR_PIN","Z2_ENABLE_PIN","Z2_MS1_PIN","Z2_MS2_PIN","Z2_RESET_PIN","Z2_SLEEP_PIN","Z2_STEPPER_DRIVER","Z2_STEPPER_DRIVER_TYPE","Z2_STEPPER_DRIVER_ADDRESS","Z2_STEPPER_DRIVER_RSENSE","Z2_STEPPER_DRIVER_RSENSE_OHMS","Z2_STEPPER_DRIVER_RSENSE_OHMS_DEFAULT","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_DEFAULT","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR","Z2_STEPPER_DRIVER_RSENSE_OHMS_SENSE_RESISTOR_SENSE_RESISTOR_DEFAULT"]}},"Safety & Protection":{subcategories:{"Thermal Protection":["THERMAL_PROTECTION_HOTENDS","THERMAL_PROTECTION_BED","THERMAL_PROTECTION_CHAMBER","THERMAL_PROTECTION_COOLER","THERMAL_PROTECTION_COOLER_PERIOD","THERMAL_PROTECTION_COOLER_HYSTERESIS","THERMAL_PROTECTION_COOLER_FAN_SPEED","THERMAL_PROTECTION_COOLER_FAN_SPEED_MIN","THERMAL_PROTECTION_COOLER_FAN_SPEED_MAX"],"Emergency Features":["EMERGENCY_PARSER","HOST_ACTION_COMMANDS","HOST_PROMPT_SUPPORT","HOST_KEEPALIVE_FEATURE","HOST_KEEPALIVE_TIMEOUT","HOST_KEEPALIVE_INTERVAL","HOST_KEEPALIVE_TIMEOUT_SECONDS","HOST_KEEPALIVE_INTERVAL_SECONDS"],"Filament Safety":["FILAMENT_RUNOUT_SENSOR","FILAMENT_RUNOUT_SCRIPT","FILAMENT_RUNOUT_DISTANCE_MM","FILAMENT_RUNOUT_SECONDS","FILAMENT_RUNOUT_PULLUP","FILAMENT_RUNOUT_ON_STATE","FILAMENT_RUNOUT_SENSOR_STATE","FILAMENT_RUNOUT_SENSOR_STATE_HIGH","FILAMENT_RUNOUT_SENSOR_STATE_LOW"]}},"Communication & Host":{subcategories:{"Serial Communication":["SERIAL_PORT","SERIAL_PORT_2","BAUDRATE","SERIAL_BAUDRATE","SERIAL_BAUDRATE_2","SERIAL_BAUDRATE_3","SERIAL_BAUDRATE_4","SERIAL_BAUDRATE_5","SERIAL_BAUDRATE_6","SERIAL_BAUDRATE_7","SERIAL_BAUDRATE_8","SERIAL_BAUDRATE_9","SERIAL_BAUDRATE_10"],"Host Interface":["HOST_ACTION_COMMANDS","HOST_PROMPT_SUPPORT","HOST_KEEPALIVE_FEATURE","HOST_KEEPALIVE_TIMEOUT","HOST_KEEPALIVE_INTERVAL","HOST_KEEPALIVE_TIMEOUT_SECONDS","HOST_KEEPALIVE_INTERVAL_SECONDS"],"Network Features":["WIFI_CUSTOM_COMMAND","ESP3D_WIFISUPPORT","ESP3D_WIFISUPPORT_SSID","ESP3D_WIFISUPPORT_PASSWORD","ESP3D_WIFISUPPORT_IP","ESP3D_WIFISUPPORT_GATEWAY","ESP3D_WIFISUPPORT_SUBNET","ESP3D_WIFISUPPORT_AP_SSID","ESP3D_WIFISUPPORT_AP_PASSWORD","ESP3D_WIFISUPPORT_AP_IP","ESP3D_WIFISUPPORT_AP_GATEWAY","ESP3D_WIFISUPPORT_AP_SUBNET"]}},"Fans & Cooling":{subcategories:{"Fan Configuration":["FANMUX0","FANMUX1","FANMUX2","FANMUX3","FANMUX4","FANMUX5","FANMUX6","FANMUX7","FANMUX8","FANMUX9","FANMUX10","FANMUX11","FANMUX12","FANMUX13","FANMUX14","FANMUX15","FANMUX16","FANMUX17","FANMUX18","FANMUX19","FANMUX20","FANMUX21","FANMUX22","FANMUX23","FANMUX24","FANMUX25","FANMUX26","FANMUX27","FANMUX28","FANMUX29","FANMUX30","FANMUX31"],"Cooling Fans":["USE_CONTROLLER_FAN","CONTROLLER_FAN_PIN","CONTROLLER_FAN_EDITABLE","CONTROLLER_FAN_EDITABLE_SPEED","CONTROLLER_FAN_EDITABLE_TEMP","CONTROLLER_FAN_EDITABLE_TEMP_MIN","CONTROLLER_FAN_EDITABLE_TEMP_MAX","CONTROLLER_FAN_EDITABLE_TEMP_STEP","CONTROLLER_FAN_EDITABLE_TEMP_DEFAULT","CONTROLLER_FAN_EDITABLE_SPEED_MIN","CONTROLLER_FAN_EDITABLE_SPEED_MAX","CONTROLLER_FAN_EDITABLE_SPEED_STEP","CONTROLLER_FAN_EDITABLE_SPEED_DEFAULT"],"Part Cooling":["EXTRUDER_AUTO_FAN_TEMPERATURE","EXTRUDER_AUTO_FAN_SPEED","EXTRUDER_AUTO_FAN_DURATION","EXTRUDER_AUTO_FAN_SPEED_MIN","EXTRUDER_AUTO_FAN_SPEED_MAX","EXTRUDER_AUTO_FAN_SPEED_STEP","EXTRUDER_AUTO_FAN_SPEED_DEFAULT","EXTRUDER_AUTO_FAN_TEMP_MIN","EXTRUDER_AUTO_FAN_TEMP_MAX","EXTRUDER_AUTO_FAN_TEMP_STEP","EXTRUDER_AUTO_FAN_TEMP_DEFAULT"]}},"Hardware & Pins":{subcategories:{"Pin Assignments":["X_STEP_PIN","X_DIR_PIN","X_ENABLE_PIN","X_MS1_PIN","X_MS2_PIN","X_RESET_PIN","X_SLEEP_PIN","Y_STEP_PIN","Y_DIR_PIN","Y_ENABLE_PIN","Y_MS1_PIN","Y_MS2_PIN","Y_RESET_PIN","Y_SLEEP_PIN","Z_STEP_PIN","Z_DIR_PIN","Z_ENABLE_PIN","Z_MS1_PIN","Z_MS2_PIN","Z_RESET_PIN","Z_SLEEP_PIN","E0_STEP_PIN","E0_DIR_PIN","E0_ENABLE_PIN","E0_MS1_PIN","E0_MS2_PIN","E0_RESET_PIN","E0_SLEEP_PIN"],"Heater Pins":["HEATER_0_PIN","HEATER_1_PIN","HEATER_2_PIN","HEATER_3_PIN","HEATER_4_PIN","HEATER_5_PIN","HEATER_6_PIN","HEATER_7_PIN","HEATER_BED_PIN","HEATER_CHAMBER_PIN","HEATER_COOLER_PIN"],"Fan Pins":["FAN_PIN","FAN1_PIN","FAN2_PIN","FAN3_PIN","FAN4_PIN","FAN5_PIN","FAN6_PIN","FAN7_PIN","CONTROLLER_FAN_PIN","EXTRUDER_AUTO_FAN_PIN"],"Sensor Pins":["TEMP_0_PIN","TEMP_1_PIN","TEMP_2_PIN","TEMP_3_PIN","TEMP_4_PIN","TEMP_5_PIN","TEMP_6_PIN","TEMP_7_PIN","TEMP_BED_PIN","TEMP_CHAMBER_PIN","TEMP_COOLER_PIN","TEMP_PROBE_PIN"],"Endstop Pins":["X_MIN_PIN","X_MAX_PIN","Y_MIN_PIN","Y_MAX_PIN","Z_MIN_PIN","Z_MAX_PIN","X_STOP_PIN","Y_STOP_PIN","Z_STOP_PIN"],"Probe Pins":["Z_MIN_PROBE_PIN","Z_MIN_PROBE_PIN_INVERTING","Z_MIN_PROBE_PIN_PULLUP","Z_MIN_PROBE_PIN_PULLDOWN","Z_MIN_PROBE_PIN_PULLUP_INVERTING","Z_MIN_PROBE_PIN_PULLDOWN_INVERTING"]}}},$s={BAUDRATE:{type:"enum",values:[9600,19200,38400,57600,115200,230400,25e4,5e5,1e6],default:115200,description:"Serial communication baud rate. 115200 is standard for most printers."},EXTRUDERS:{type:"number",min:1,max:8,default:1,description:"Number of extruders. Most printers have 1, multi-color printers may have 2-4."},X_BED_SIZE:{type:"number",min:50,max:1e3,default:220,description:"Build volume width in mm. Should match your printer's physical bed size."},Y_BED_SIZE:{type:"number",min:50,max:1e3,default:220,description:"Build volume depth in mm. Should match your printer's physical bed size."},DEFAULT_AXIS_STEPS_PER_UNIT:{type:"array",elementType:"number",length:4,description:"Steps per mm for X, Y, Z, E axes. Critical for dimensional accuracy.",validation:t=>!Array.isArray(t)||t.length!==4?"Must be array of 4 numbers":t.some(a=>a<10||a>2e3)?"Values should be between 10-2000":null},DEFAULT_MAX_FEEDRATE:{type:"array",elementType:"number",length:4,description:"Maximum feedrates in mm/s for X, Y, Z, E axes.",validation:t=>!Array.isArray(t)||t.length!==4?"Must be array of 4 numbers":t[0]<10||t[0]>1e3?"X feedrate should be 10-1000 mm/s":t[1]<10||t[1]>1e3?"Y feedrate should be 10-1000 mm/s":t[2]<1||t[2]>100?"Z feedrate should be 1-100 mm/s":t[3]<1||t[3]>200?"E feedrate should be 1-200 mm/s":null},HEATER_0_MAXTEMP:{type:"number",min:200,max:500,default:275,description:"Maximum hotend temperature in °C. Set based on your hotend capabilities."},BED_MAXTEMP:{type:"number",min:60,max:200,default:130,description:"Maximum bed temperature in °C. Set based on your heated bed capabilities."},LIN_ADVANCE_K:{type:"number",min:0,max:10,default:0,description:"Linear Advance K factor. 0 disables, typical values 0.05-0.5 for direct drive, 0.3-1.5 for Bowden."},DEFAULT_MAX_ACCELERATION:{type:"array",elementType:"number",length:4,description:"Maximum acceleration in mm/s² for X, Y, Z, E axes.",validation:t=>!Array.isArray(t)||t.length!==4?"Must be array of 4 numbers":t[0]<100||t[0]>1e4?"X acceleration should be 100-10000 mm/s²":t[1]<100||t[1]>1e4?"Y acceleration should be 100-10000 mm/s²":t[2]<10||t[2]>1e3?"Z acceleration should be 10-1000 mm/s²":t[3]<100||t[3]>5e4?"E acceleration should be 100-50000 mm/s²":null},DEFAULT_ACCELERATION:{type:"number",min:100,max:1e4,default:3e3,description:"Default acceleration in mm/s² for print moves."},DEFAULT_RETRACT_ACCELERATION:{type:"number",min:100,max:5e4,default:3e3,description:"Default acceleration in mm/s² for retraction moves."},CLASSIC_JERK:{type:"boolean",default:!1,description:"Enable classic jerk control instead of junction deviation."},DEFAULT_XJERK:{type:"number",min:0,max:100,default:10,description:"Default X-axis jerk in mm/s."},DEFAULT_YJERK:{type:"number",min:0,max:100,default:10,description:"Default Y-axis jerk in mm/s."},DEFAULT_ZJERK:{type:"number",min:0,max:20,default:.3,description:"Default Z-axis jerk in mm/s."},DEFAULT_EJERK:{type:"number",min:0,max:100,default:5,description:"Default E-axis jerk in mm/s."},JUNCTION_DEVIATION:{type:"number",min:.01,max:1,default:.013,description:"Junction deviation for smooth motion planning."},RETRACT_LENGTH:{type:"number",min:0,max:50,default:6.5,description:"Retraction length in mm. 1-2mm for direct drive, 4-8mm for Bowden."},RETRACT_FEEDRATE:{type:"number",min:10,max:200,default:45,description:"Retraction feedrate in mm/s."},RETRACT_ZRAISE:{type:"number",min:0,max:10,default:0,description:"Z-axis raise during retraction in mm."},HOMING_FEEDRATE_XY:{type:"number",min:100,max:1e4,default:3e3,description:"Homing feedrate for X and Y axes in mm/s."},HOMING_FEEDRATE_Z:{type:"number",min:100,max:2e3,default:1500,description:"Homing feedrate for Z axis in mm/s."},GRID_MAX_POINTS_X:{type:"number",min:2,max:15,default:5,description:"Number of probe points in X direction for bed leveling."},GRID_MAX_POINTS_Y:{type:"number",min:2,max:15,default:5,description:"Number of probe points in Y direction for bed leveling."}},pt={"Direct Drive Conversion":{description:"Optimized settings for direct drive extruder conversion",settings:{LIN_ADVANCE:!0,LIN_ADVANCE_K:.2,RETRACT_LENGTH:1,RETRACT_FEEDRATE:60,DEFAULT_AXIS_STEPS_PER_UNIT:[80,80,400,140],DEFAULT_MAX_ACCELERATION:[500,500,100,1e4]}},"High Speed Printing":{description:"Settings optimized for high-speed printing",settings:{CLASSIC_JERK:!1,JUNCTION_DEVIATION:.05,S_CURVE_ACCELERATION:!0,DEFAULT_MAX_FEEDRATE:[500,500,15,120],DEFAULT_MAX_ACCELERATION:[3e3,3e3,100,1e4],LIN_ADVANCE:!0,LIN_ADVANCE_K:.4}},"Silent Operation":{description:"Reduced noise settings for quiet operation",settings:{TMC2208:!0,STEALTHCHOP:!0,HYBRID_THRESHOLD:!0,DEFAULT_MAX_FEEDRATE:[200,200,8,50],DEFAULT_MAX_ACCELERATION:[800,800,50,5e3],DEFAULT_XJERK:8,DEFAULT_YJERK:8,DEFAULT_ZJERK:.3}},"Auto Bed Leveling":{description:"Complete auto bed leveling setup",settings:{AUTO_BED_LEVELING_BILINEAR:!0,GRID_MAX_POINTS_X:5,GRID_MAX_POINTS_Y:5,LCD_BED_LEVELING:!0,RESTORE_LEVELING_AFTER_G28:!0,ENABLE_LEVELING_FADE_HEIGHT:!0,DEFAULT_LEVELING_FADE_HEIGHT:10}},"Safety Enhanced":{description:"Enhanced safety features and thermal protection",settings:{THERMAL_PROTECTION_HOTENDS:!0,THERMAL_PROTECTION_BED:!0,THERMAL_PROTECTION_CHAMBER:!0,PREVENT_COLD_EXTRUSION:!0,PREVENT_LENGTHY_EXTRUDE:!0,EMERGENCY_PARSER:!0,HOST_ACTION_COMMANDS:!0,HOST_PROMPT_SUPPORT:!0}}};function Za(t){const a={},s=[];return Object.keys(Dt).forEach(r=>{a[r]={},Object.keys(Dt[r].subcategories).forEach(l=>{a[r][l]=[]})}),t.forEach(r=>{let l=!1;for(const[n,i]of Object.entries(Dt)){for(const[c,o]of Object.entries(i.subcategories))if(o.includes(r.name)){a[n][c].push(r),l=!0;break}if(l)break}l||s.push(r)}),s.length>0&&(a.Other||(a.Other={Uncategorized:[]}),a.Other.Uncategorized=s),a}function ds(t,a){const s=$s[t];if(!s)return a==null||a===""?{isValid:!1,error:"Value cannot be empty"}:{isValid:!0,error:null};if(s.validation){const r=s.validation(a);return{isValid:!r,error:r}}switch(s.type){case"number":const r=parseFloat(a);if(isNaN(r))return{isValid:!1,error:"Must be a number"};if(s.min!==void 0&&r<s.min)return{isValid:!1,error:`Must be at least ${s.min}`};if(s.max!==void 0&&r>s.max)return{isValid:!1,error:`Must be at most ${s.max}`};break;case"enum":const l=typeof s.values[0]=="number"?parseFloat(a):a;if(!s.values.includes(l))return{isValid:!1,error:`Must be one of: ${s.values.join(", ")}`};break;case"boolean":if(typeof a!="boolean"&&a!=="true"&&a!=="false")return{isValid:!1,error:"Must be true or false"};break;case"array":if(!Array.isArray(a))return{isValid:!1,error:"Must be an array"};if(s.length&&a.length!==s.length)return{isValid:!1,error:`Must have exactly ${s.length} elements`};break}return{isValid:!0,error:null}}function gt(t){const a=$s[t];return{description:(a==null?void 0:a.description)||"No description available",type:(a==null?void 0:a.type)||"unknown",default:a==null?void 0:a.default,constraints:{min:a==null?void 0:a.min,max:a==null?void 0:a.max,values:a==null?void 0:a.values}}}function Ya(t,a){const s=pt[a];if(!s)return t;const r=[...t];return Object.entries(s.settings).forEach(([l,n])=>{const i=r.findIndex(c=>c.name===l);i!==-1?r[i]={...r[i],value:n,enabled:!0}:r.push({name:l,value:n,enabled:!0,description:gt(l).description,fileType:"basic"})}),r}function ms(t,a="cartesian"){const s={delta:["DELTA_PRINTER","DELTA_ENDSTOP_ADJ","DELTA_DIAGONAL_ROD","DELTA_HEIGHT","DELTA_RADIUS","DELTA_SEGMENTS_PER_SECOND","DELTA_PRINTABLE_RADIUS","DELTA_PROBEABLE_RADIUS","DELTA_TOWER_ANGLE_TRIM","DELTA_ENDSTOP_OFFSET","DELTA_CARRIAGE_OFFSET","DELTA_DIAGONAL_ROD_TRIM_TOWER_1","DELTA_DIAGONAL_ROD_TRIM_TOWER_2","DELTA_DIAGONAL_ROD_TRIM_TOWER_3"],scara:["SCARA_PRINTER","SCARA_LINKAGE_1","SCARA_LINKAGE_2","SCARA_OFFSET_X","SCARA_OFFSET_Y","SCARA_THETA_OFFSET","SCARA_PSI_OFFSET"],corexy:["COREXY_PRINTER","COREXY_BELT_DRIVE","COREXY_BELT_DRIVE_XY","COREXY_BELT_DRIVE_XZ","COREXY_BELT_DRIVE_YZ"],dual_x:["DUAL_X_CARRIAGE","X_DUAL_STEPPER_DRIVERS","X2_DRIVER_TYPE","X2_HOME_DIR","X2_HOME_POS","X2_MAX_ENDSTOP_INVERTING","X2_MIN_ENDSTOP_INVERTING","X2_USE_ENDSTOP"],dual_y:["DUAL_Y_CARRIAGE","Y_DUAL_STEPPER_DRIVERS","Y2_DRIVER_TYPE","Y2_HOME_DIR","Y2_HOME_POS","Y2_MAX_ENDSTOP_INVERTING","Y2_MIN_ENDSTOP_INVERTING","Y2_USE_ENDSTOP"],dual_z:["DUAL_Z_CARRIAGE","Z_DUAL_STEPPER_DRIVERS","Z2_DRIVER_TYPE","Z2_HOME_DIR","Z2_HOME_POS","Z2_MAX_ENDSTOP_INVERTING","Z2_MIN_ENDSTOP_INVERTING","Z2_USE_ENDSTOP"]};for(const[r,l]of Object.entries(s))if(l.includes(t))return r===a||a==="cartesian";return!0}function qa(t,a){if(!a)return t;const s=a.toLowerCase();return t.filter(r=>r.name.toLowerCase().includes(s)||r.description.toLowerCase().includes(s)||String(r.value).toLowerCase().includes(s))}const Wa=()=>{const[t,a]=d.useState(null),[s,r]=d.useState(null),[l,n]=d.useState([]),[i,c]=d.useState([]),[o,m]=d.useState(""),[u,x]=d.useState("name"),[f,b]=d.useState("asc"),[N,p]=d.useState(!0),[h,g]=d.useState(!0),[j,S]=d.useState(!1),[M,_]=d.useState(new Set),[P,E]=d.useState({}),[F,v]=d.useState({}),[C,y]=d.useState(new Set),[w,k]=d.useState(!1),[H,K]=d.useState("");d.useState([]);const[z,Z]=d.useState({}),[ne,je]=d.useState(!1),[T,I]=d.useState(!0),[A,O]=d.useState(!0),X=d.useRef(null),{getActivePrinter:$,updatePrinter:se}=ue(),J=$();if(d.useEffect(()=>{var D,R;if(J&&J.firmwareConfiguration){const G=J.firmwareConfiguration;G.basic&&G.basic.length>0&&(n(G.basic),(D=G.summary)!=null&&D.basicFile&&a({name:G.summary.basicFile})),G.advanced&&G.advanced.length>0&&(c(G.advanced),(R=G.summary)!=null&&R.advancedFile&&r({name:G.summary.advancedFile}))}},[J]),!J)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Printer Selected"}),e.jsx("p",{className:"text-gray-500",children:"Please select a printer to configure firmware"})]});const U=async(D,R)=>{if(D)try{S(!0);const G=await D.text(),te=Ha(G,R);R?(c(te),r(D)):(n(te),a(D)),await W(te,R,D)}catch(G){console.error("Error reading file:",G),alert("Error reading file. Please make sure it's a valid text file.")}finally{S(!1)}},W=async(D,R,G)=>{var te,re;try{const de=J.firmwareConfiguration||{basic:[],advanced:[]},le=R?de.basic||[]:D,ge=R?D:de.advanced||[],be={basic:le,advanced:ge,lastUpdated:new Date().toISOString(),summary:{totalDefines:le.length+ge.length,enabledDefines:le.filter(me=>me.enabled).length+ge.filter(me=>me.enabled).length,basicFile:R?((te=de.summary)==null?void 0:te.basicFile)||null:G.name,advancedFile:R?G.name:((re=de.summary)==null?void 0:re.advancedFile)||null}};se(J.id,{firmwareConfiguration:be}),se(J.id,{calibrationSteps:{...J.calibrationSteps,firmwareConfig:{completed:!0,lastUpdated:new Date().toISOString(),configCount:be.summary.totalDefines}}}),console.log(`Configuration ${R?"advanced":"basic"} saved automatically`),je(!0),setTimeout(()=>je(!1),3e3)}catch(de){console.error("Error auto-saving configuration:",de),alert("Error saving configuration automatically. Please try saving manually.")}},ee=()=>{if(l.length===0&&i.length===0){alert("Please upload at least one configuration file first.");return}S(!0);try{const D={basic:l,advanced:i,lastUpdated:new Date().toISOString(),summary:{totalDefines:l.length+i.length,enabledDefines:l.filter(R=>R.enabled).length+i.filter(R=>R.enabled).length,basicFile:(t==null?void 0:t.name)||null,advancedFile:(s==null?void 0:s.name)||null}};se(J.id,{firmwareConfiguration:D}),se(J.id,{calibrationSteps:{...J.calibrationSteps,firmwareConfig:{completed:!0,lastUpdated:new Date().toISOString(),configCount:D.summary.totalDefines}}}),alert("Firmware configuration saved successfully!")}catch(D){console.error("Error saving configuration:",D),alert("Error saving configuration. Please try again.")}finally{S(!1)}},oe=()=>{const R=["Feature Name,Enabled,Value,Description,File Type,Line Number",...[...l,...i].map(de=>`"${de.name}",${de.enabled?"Yes":"No"},"${de.value}","${de.description}","${de.fileType}",${de.lineNumber}`)].join(`
`),G=new Blob([R],{type:"text/csv"}),te=window.URL.createObjectURL(G),re=document.createElement("a");re.href=te,re.download=`${J.name}_firmware_config.csv`,re.click(),window.URL.revokeObjectURL(te)},ie=()=>{let D=[...l];N&&(D=[...D,...i]);let R=qa(D,o);if(T||(R=R.filter(G=>G.enabled)),A&&J){const G=pe(J);R=R.filter(te=>ms(te.name,G))}return Xa(R,u,f)},pe=D=>{var te,re;const R=((te=D.model)==null?void 0:te.toLowerCase())||"",G=((re=D.firmware)==null?void 0:re.toLowerCase())||"";return R.includes("delta")||G.includes("delta")?"delta":R.includes("scara")||G.includes("scara")?"scara":R.includes("corexy")||R.includes("corexz")||R.includes("coreyz")||G.includes("corexy")||G.includes("corexz")||G.includes("coreyz")?"corexy":R.includes("dual")&&R.includes("x")?"dual_x":R.includes("dual")&&R.includes("y")?"dual_y":R.includes("dual")&&R.includes("z")?"dual_z":"cartesian"},L=D=>{const R=[...l,...i].find(G=>G.name===D);R&&(_(G=>new Set([...G,D])),E(G=>({...G,[D]:R.value})))},q=D=>{_(R=>{const G=new Set(R);return G.delete(D),G}),E(R=>{const G={...R};return delete G[D],G}),v(R=>{const G={...R};return delete G[D],G})},ae=D=>{const R=P[D],G=gt(D);let te=R;if(G.type==="number"){if(te=parseFloat(R),isNaN(te)){v(le=>({...le,[D]:"Must be a valid number"}));return}}else G.type==="boolean"?te=R==="true":G.constraints.values&&typeof G.constraints.values[0]=="number"&&(te=parseFloat(R));const re=ds(D,te);if(!re.isValid){v(le=>({...le,[D]:re.error}));return}const de=le=>le.map(ge=>ge.name===D?{...ge,value:te}:ge);l.find(le=>le.name===D)?n(de):i.find(le=>le.name===D)&&c(de),q(D)},xe=D=>{var de,le,ge,be;const R=me=>me.map(ve=>ve.name===D?{...ve,enabled:!ve.enabled}:ve);l.find(me=>me.name===D)?n(R):i.find(me=>me.name===D)&&c(R);const G=l.find(me=>me.name===D)?R(l):l,te=i.find(me=>me.name===D)?R(i):i,re={basic:G,advanced:te,lastUpdated:new Date().toISOString(),summary:{totalDefines:G.length+te.length,enabledDefines:G.filter(me=>me.enabled).length+te.filter(me=>me.enabled).length,basicFile:((le=(de=J.firmwareConfiguration)==null?void 0:de.summary)==null?void 0:le.basicFile)||null,advancedFile:((be=(ge=J.firmwareConfiguration)==null?void 0:ge.summary)==null?void 0:be.advancedFile)||null}};se(J.id,{firmwareConfiguration:re})},ce=()=>{if(!H)return;const D=[...l,...i],R=Ya(D,H),G=R.filter(re=>re.fileType==="basic"),te=R.filter(re=>re.fileType==="advanced");n(G),c(te),K("")},he=D=>{y(R=>{const G=new Set(R);return G.has(D)?G.delete(D):G.add(D),G})},Ee=D=>{Z(R=>({...R,[D]:!R[D]}))},Pe=D=>{const R=M.has(D.name),G=P[D.name],te=F[D.name],re=gt(D.name),de=z[D.name],le=J?pe(J):"cartesian",ge=ms(D.name,le);return e.jsxs("div",{className:`bg-white border rounded-lg p-3 hover:shadow-md transition-shadow ${D.enabled?ge?"border-gray-200":"border-yellow-300 bg-yellow-50":"border-gray-300 bg-gray-50"}`,children:[!ge&&e.jsxs("div",{className:"mb-2 p-1 bg-yellow-100 border border-yellow-200 rounded text-xs text-yellow-800",children:["⚠️ May not be relevant for ",le," printers"]}),e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono truncate",children:D.name}),e.jsx("button",{onClick:()=>Ee(D.name),className:"text-gray-400 hover:text-blue-600 transition-colors flex-shrink-0",children:e.jsx(qe,{className:"h-3 w-3"})})]})}),e.jsx("button",{onClick:()=>xe(D.name),className:`ml-2 p-1 rounded transition-colors ${D.enabled?"text-green-600 hover:text-green-700 hover:bg-green-50":"text-red-600 hover:text-red-700 hover:bg-red-50"}`,title:D.enabled?"Disable setting":"Enable setting",children:D.enabled?e.jsx(fe,{className:"h-4 w-4"}):e.jsx(Ra,{className:"h-4 w-4"})})]}),de&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 rounded text-xs text-blue-800",children:[e.jsx("p",{children:re.description}),re.constraints.min!==void 0&&e.jsxs("p",{className:"mt-1",children:["Min: ",re.constraints.min]}),re.constraints.max!==void 0&&e.jsxs("p",{children:["Max: ",re.constraints.max]}),re.constraints.values&&e.jsxs("p",{children:["Valid values: ",re.constraints.values.join(", ")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:R?e.jsxs("div",{className:"space-y-1",children:[re.constraints.values?e.jsxs("select",{value:G||"",onChange:be=>{const me=be.target.value;E(ve=>({...ve,[D.name]:me})),me&&v(ve=>{const Se={...ve};return delete Se[D.name],Se})},className:`w-full px-2 py-1 text-xs border rounded ${te?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a value..."}),re.constraints.values.map(be=>e.jsx("option",{value:be,children:be},be))]}):re.type==="boolean"?e.jsxs("select",{value:G||"",onChange:be=>{const me=be.target.value;E(ve=>({...ve,[D.name]:me})),me&&v(ve=>{const Se={...ve};return delete Se[D.name],Se})},className:`w-full px-2 py-1 text-xs border rounded ${te?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}):e.jsx("input",{type:re.type==="number"?"number":"text",value:G||"",onChange:be=>{const me=be.target.value;if(E(ve=>({...ve,[D.name]:me})),me){const ve=gt(D.name);let Se=me;if(ve.type==="number"){if(Se=parseFloat(me),isNaN(Se)){v(tt=>({...tt,[D.name]:"Must be a valid number"}));return}}else ve.type==="boolean"?Se=me==="true":ve.constraints.values&&typeof ve.constraints.values[0]=="number"&&(Se=parseFloat(me));const rs=ds(D.name,Se);rs.isValid?v(tt=>{const as={...tt};return delete as[D.name],as}):v(tt=>({...tt,[D.name]:rs.error}))}else v(ve=>{const Se={...ve};return delete Se[D.name],Se})},className:`w-full px-2 py-1 text-xs border rounded ${te?"border-red-300 bg-red-50":"border-gray-300"}`,min:re.constraints.min,max:re.constraints.max,step:re.type==="number"?"any":void 0}),te&&e.jsxs("p",{className:"text-xs text-red-600 flex items-center",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),te]})]}):e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:String(D.value)})}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${D.fileType==="basic"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:D.fileType}),R?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ae(D.name),className:"text-green-600 hover:text-green-800 p-1",title:"Save",children:e.jsx(Ms,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>q(D.name),className:"text-red-600 hover:text-red-800 p-1",title:"Cancel",children:e.jsx(Ce,{className:"h-3 w-3"})})]}):e.jsx("button",{onClick:()=>L(D.name),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit value",children:e.jsx(We,{className:"h-3 w-3"})})]})]}),D.description&&!de&&e.jsx("p",{className:"text-xs text-gray-600 mt-2 truncate",title:D.description,children:D.description})]},D.name)},we=D=>{const R=Za(D);return e.jsx("div",{className:"space-y-6",children:Object.entries(R).map(([G,te])=>{const re=C.has(G),de=Object.values(te).flat().length;return de===0?null:e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsx("button",{onClick:()=>he(G),className:"w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 flex items-center justify-between text-left transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[re?e.jsx(Rs,{className:"h-4 w-4 text-gray-500"}):e.jsx(Nt,{className:"h-4 w-4 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:G}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",de," settings)"]})]})}),re&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:Object.entries(te).map(([le,ge])=>ge.length===0?null:e.jsxs("div",{className:"mb-6 last:mb-0",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 border-b border-gray-100 pb-1",children:[le," (",ge.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:ge.map(Pe)})]},le))})]},G)})})},B=l.length+i.length,Y=l.filter(D=>D.enabled).length+i.filter(D=>D.enabled).length;return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Firmware Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Upload and analyze your Marlin firmware configuration files to understand your printer's capabilities"})]}),ne&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-800",children:"Configuration saved automatically! Your changes are now persistent."})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Configuration Files"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Configuration.h"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors",children:t?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{className:"h-8 w-8 text-green-500 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[l.length," defines found"]}),e.jsx("button",{onClick:()=>a(null),className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(vt,{className:"h-8 w-8 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),e.jsx("input",{type:"file",accept:".h,.txt,.conf",onChange:D=>U(D.target.files[0],!1),className:"hidden",ref:X}),e.jsx("button",{onClick:()=>{var D;return(D=X.current)==null?void 0:D.click()},className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm",children:"Choose File"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Configuration_adv.h (Optional)"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 transition-colors",children:s?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Te,{className:"h-8 w-8 text-purple-500 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.length," defines found"]}),e.jsx("button",{onClick:()=>r(null),className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(vt,{className:"h-8 w-8 text-gray-400 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click to upload or drag and drop"}),e.jsx("input",{type:"file",accept:".h,.txt,.conf",onChange:D=>U(D.target.files[0],!0),className:"hidden"}),e.jsx("button",{onClick:()=>{var D;return(D=document.querySelector('input[type="file"]:last-of-type'))==null?void 0:D.click()},className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors text-sm",children:"Choose File"})]})})]})]}),B>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-600",children:[e.jsxs("span",{children:["Total: ",e.jsx("strong",{className:"text-gray-900",children:B})]}),e.jsxs("span",{children:["Enabled: ",e.jsx("strong",{className:"text-green-600",children:Y})]}),e.jsxs("span",{children:["Disabled: ",e.jsx("strong",{className:"text-red-600",children:B-Y})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ds,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:H,onChange:D=>K(D.target.value),className:"border border-gray-300 rounded-md px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:"Select Preset..."}),Object.keys(pt).map(D=>e.jsx("option",{value:D,children:D},D))]}),e.jsx("button",{onClick:ce,disabled:!H,className:"bg-purple-600 text-white px-3 py-1 rounded-md hover:bg-purple-700 transition-colors text-sm disabled:opacity-50",children:"Apply"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>k(!w),className:"bg-orange-600 text-white px-3 py-2 rounded-md hover:bg-orange-700 transition-colors flex items-center space-x-2 text-sm",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx("span",{children:"Diff"})]}),e.jsxs("button",{onClick:oe,className:"bg-gray-600 text-white px-3 py-2 rounded-md hover:bg-gray-700 transition-colors flex items-center space-x-2 text-sm",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{onClick:ee,disabled:j,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2 disabled:opacity-50",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{children:j?"Saving...":"Save"})]})]})]}),H&&pt[H]&&e.jsx("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-purple-800",children:[e.jsxs("strong",{children:[H,":"]})," ",pt[H].description]})})]})]}),B>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configuration Analysis"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search configurations...",value:o,onChange:D=>m(D.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("button",{onClick:()=>p(!N),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${N?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:[N?e.jsx(He,{className:"h-4 w-4"}):e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Advanced"})]}),e.jsxs("button",{onClick:()=>g(!h),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${h?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Group"})]}),e.jsxs("button",{onClick:()=>I(!T),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${T?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"}`,children:[T?e.jsx(He,{className:"h-4 w-4"}):e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Disabled"})]}),e.jsxs("button",{onClick:()=>O(!A),className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${A?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,title:A?"Show only relevant settings for this printer":"Show all settings including irrelevant ones",children:[A?e.jsx(He,{className:"h-4 w-4"}):e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Relevant"})]}),e.jsx("button",{onClick:()=>b(f==="asc"?"desc":"asc"),className:"px-3 py-2 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors",children:f==="asc"?e.jsx(ra,{className:"h-4 w-4"}):e.jsx(sa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"overflow-hidden",children:we(ie())})]}),B===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Getting Started"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"To analyze your printer's firmware configuration:"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-800 space-y-2",children:[e.jsxs("li",{children:["Upload your ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"Configuration.h"})," file"]}),e.jsxs("li",{children:["Optionally upload your ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"Configuration_adv.h"})," file"]}),e.jsx("li",{children:"Review the parsed configuration items"}),e.jsx("li",{children:"Save the configuration to your printer profile"})]}),e.jsxs("p",{className:"text-blue-800 mt-4 text-sm",children:[e.jsx("strong",{children:"Note:"})," These files are typically located in your Marlin source code folder."]})]})]})},Qa=_e.memo(function({className:a=""}){const s=V(o=>o.status),r=V(o=>o.connect),l=V(o=>o.disconnect),n=s==="connected",i=s==="connecting",c=()=>{n?l():i||r()};return e.jsx("button",{onClick:c,disabled:i,className:`inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-md transition-colors
        ${n?"bg-green-100 text-green-700 hover:bg-green-200":i?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"} ${a}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(ls,{size:16}),"Connected"]}):i?e.jsxs(e.Fragment,{children:[e.jsx(ls,{size:16,className:"animate-pulse"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(la,{size:16}),"Connect"]})})}),at={hotendTemp:200,bedTemp:60,nozzleDiameter:.4,layerHeight:.2,printSpeed:50,retractionDistance:5,retractionSpeed:45,primeSpeed:45,flowRate:100,wallThickness:.4,enableABL:!0,firstLayerSpeed:20},Gs={"pid-autotune":{hotendTemp:200,bedTemp:60,cycles:8,target:"hotend"},"extruder-esteps":{hotendTemp:200,bedTemp:60,extrudeLength:100,currentEsteps:93},"retraction-tuning":{hotendTemp:200,bedTemp:60,retractionDistance:5,retractionSpeed:45,primeSpeed:45},"first-layer":{hotendTemp:200,bedTemp:60,layerHeight:.2,firstLayerSpeed:20,enableABL:!0},"flow-rate":{hotendTemp:200,bedTemp:60,flowRate:100,wallThickness:.4},"temperature-tower":{hotendTemp:200,bedTemp:60,startTemp:180,endTemp:220,tempStep:5},"calibration-cube":{hotendTemp:200,bedTemp:60,cubeSize:20,layerHeight:.2,printSpeed:50},"speed-calibration":{hotendTemp:200,bedTemp:60,startSpeed:40,endSpeed:120,stepSpeed:10,lineLength:160}},Vs={"pid-autotune":{hotendTemp:"M301",bedTemp:"M304"},"extruder-esteps":{currentEsteps:"M92"},"retraction-tuning":{retractionDistance:"M207",retractionSpeed:"M207"},"flow-rate":{flowRate:"M221"}},wt=t=>Gs[t]||{},Ka=async t=>{try{const a=V.getState().sendCommand,s={...wt(t)},r=Vs[t];if(r)for(const[l,n]of Object.entries(r))try{await a(n)}catch(i){console.warn(`Failed to load ${n}:`,i)}return s}catch(a){return console.error("Error loading parameters from settings:",a),wt(t)}},Ja=async(t,a)=>{try{const s=V.getState().sendCommand,r=Vs[t];if(r){for(const[l,n]of Object.entries(r)){const i=a[l];if(i!==void 0)try{n==="M92"&&l==="currentEsteps"?await s(`M92 E${i}`):n==="M207"&&l==="retractionDistance"?await s(`M207 S${i}`):n==="M207"&&l==="retractionSpeed"?await s(`M207 F${i*60}`):n==="M221"&&l==="flowRate"&&await s(`M221 S${i}`)}catch(c){console.warn(`Failed to save ${n} with value ${i}:`,c)}}await s("M500")}}catch(s){throw console.error("Error saving parameters to settings:",s),s}},Xe=t=>{try{const a=localStorage.getItem(`calibration_parameters_${t}`);return a?JSON.parse(a):[]}catch(a){return console.error("Error loading parameter history:",a),[]}},en=(t,a,s)=>{try{const r=Xe(t),l={parameters:{...a},result:s,timestamp:Date.now()};r.push(l),r.length>10&&r.splice(0,r.length-10),localStorage.setItem(`calibration_parameters_${t}`,JSON.stringify(r))}catch(r){console.error("Error saving parameter history:",r)}},tn=t=>{const a=Xe(t);if(a.length===0)return wt(t);const s=a.filter(r=>{var l;return(l=r.result)==null?void 0:l.success});return s.length>0?s[s.length-1].parameters:a[a.length-1].parameters},sn=t=>{try{localStorage.removeItem(`calibration_parameters_${t}`)}catch(a){console.error("Error clearing parameter history:",a)}},rn=()=>{try{const t={};Object.keys(Gs).forEach(n=>{t[n]=Xe(n)});const a=JSON.stringify(t,null,2),s=new Blob([a],{type:"application/json"}),r=URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download=`calibration_parameters_${new Date().toISOString().split("T")[0]}.json`,l.click(),URL.revokeObjectURL(r)}catch(t){console.error("Error exporting parameter history:",t)}},Hs=t=>`printer_${t}_global_parameters`,Ze=t=>{try{const a=localStorage.getItem(Hs(t));if(a){const s=JSON.parse(a);return{...at,...s}}return{...at}}catch(a){return console.error("Error loading globalThis parameters:",a),{...at}}},an=(t,a)=>{try{const s={};Object.keys(at).forEach(r=>{a[r]!==void 0&&(s[r]=a[r])}),localStorage.setItem(Hs(t),JSON.stringify(s)),console.log("Saved globalThis parameters for printer",t,":",s)}catch(s){console.error("Error saving globalThis parameters:",s)}},$t=(t,a,s)=>{const l={...Ze(t)};return Object.keys(at).forEach(n=>{s[n]!==void 0&&(l[n]=s[n])}),an(t,l),l},nn=({isOpen:t,onClose:a,step:s,stepData:r,printer:l})=>{if(!t)return null;const n=d.useMemo(()=>{const c=[];return c.push(`# Calibration Report: ${s.title}`),c.push(`Printer: ${(l==null?void 0:l.name)||""}`),c.push(`Date: ${new Date((r==null?void 0:r.lastUpdated)||Date.now()).toLocaleString()}`),c.push(""),c.push("Inputs:"),Object.entries((r==null?void 0:r.inputValues)||{}).forEach(([o,m])=>c.push(`- ${o}: ${m}`)),c.push(""),r!=null&&r.results&&(c.push("Results:"),Object.entries(r.results.measurements||{}).forEach(([o,m])=>c.push(`- ${o}: ${m}`)),r.results.notes&&c.push(`Notes: ${r.results.notes}`)),c.push(""),c.push("Recommendations:"),c.push(s.expectedOutcomes||"See notes above."),c.join(`
`)},[s,r,l]),i=()=>{const c=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(c),m=document.createElement("a");m.href=o,m.download=`${s.id}-calibration-report.txt`,m.click(),URL.revokeObjectURL(o)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[e.jsx("div",{className:"font-semibold",children:"Calibration Report"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:"Close"})]}),e.jsx("div",{className:"p-4",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap bg-gray-50 border border-gray-200 rounded p-3",children:n})}),e.jsx("div",{className:"px-4 py-2 border-t flex justify-end",children:e.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-blue-600 text-white rounded",children:"Export TXT"})})]})})},ln=()=>{const t=V(N=>N.status);V(N=>N.sendCommand);const a=V(N=>{var p;return((p=N.serialLogs)==null?void 0:p.length)||0}),[s,r]=d.useState([]),[l,n]=d.useState([]),[i,c]=d.useState([]);d.useEffect(()=>{const N=V.getState().serialLogs||[],p=N.filter(j=>j.type==="rx"&&/\bX:\s*[-\d.]+/.test(j.message)&&/\bY:\s*[-\d.]+/.test(j.message)&&/\bZ:\s*[-\d.]+/.test(j.message)),h=N.filter(j=>j.type==="rx"&&/\bok\b/i.test(j.message)),g=N.filter(j=>j.type==="rx"&&/error[:\s]/i.test(j.message));r(p),n(h),c(g)},[a]);const[o,m]=d.useState({x:0,y:0,z:0}),[u,x]=d.useState(0),[f,b]=d.useState(0);return d.useEffect(()=>{if(s.length===0)return;const p=s[s.length-1].message,h={x:parseFloat((p.match(/X:\s*([-\d.]+)/)||[])[1]||0),y:parseFloat((p.match(/Y:\s*([-\d.]+)/)||[])[1]||0),z:parseFloat((p.match(/Z:\s*([-\d.]+)/)||[])[1]||0)};m(g=>g.x!==h.x||g.y!==h.y||g.z!==h.z?h:g)},[s]),d.useEffect(()=>{x(l.length)},[l]),d.useEffect(()=>{b(i.length)},[i]),{position:o,okCount:u,errCount:f,status:t}},on=_e.memo(({position:t,okCount:a,errCount:s})=>{var r,l,n,i,c,o;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:["Pos: ",e.jsxs("span",{className:"font-mono",children:["X",((l=(r=t.x).toFixed)==null?void 0:l.call(r,2))??t.x," Y",((i=(n=t.y).toFixed)==null?void 0:i.call(n,2))??t.y," Z",((o=(c=t.z).toFixed)==null?void 0:o.call(c,2))??t.z]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-green-700",children:["ok: ",a]}),e.jsxs("span",{className:"text-red-700",children:["err: ",s]})]})]})}),cn=_e.memo(()=>{const{position:t,okCount:a,errCount:s}=ln();return e.jsx("div",{className:"bg-white border border-gray-200 rounded p-3 space-y-3",children:e.jsx(on,{position:t,okCount:a,errCount:s})})}),us={PLA:{hotend:205,bed:60},PETG:{hotend:235,bed:80},ABS:{hotend:245,bed:100}};function dn(t,a){const[s,r]=d.useState({hotendCurrent:0,hotendTarget:0,bedCurrent:0,bedTarget:0}),l=d.useRef({hotendCurrent:0,hotendTarget:0,bedCurrent:0,bedTarget:0}),n=d.useRef(0),i=d.useRef(0),c=d.useRef(null);return d.useEffect(()=>{if(!t){r({hotendCurrent:0,hotendTarget:0,bedCurrent:0,bedTarget:0}),i.current=0;return}const o=b=>{const N={};let p=b.match(/T:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);p||(p=b.match(/T:(\d+\.?\d*)\/(\d+\.?\d*)/)),p||(p=b.match(/T:(\d+\.?\d*)\s*B:/)),p||(p=b.match(/T:(\d+\.?\d*)/)),p||(p=b.match(/T(\d+\.?\d*)/)),p&&(N.hotend={current:parseFloat(p[1]),target:p[2]?parseFloat(p[2]):0});let h=b.match(/B:(\d+\.?\d*)\s*\/\s*(\d+\.?\d*)/);return h||(h=b.match(/B:(\d+\.?\d*)\/(\d+\.?\d*)/)),h||(h=b.match(/B:(\d+\.?\d*)/)),h||(h=b.match(/B(\d+\.?\d*)/)),h&&(N.bed={current:parseFloat(h[1]),target:h[2]?parseFloat(h[2]):0}),N},m=()=>{var g,j,S,M;const N=V.getState().serialLogs||[];let p=Math.max(0,i.current),h=null;for(;p<N.length;p++){const _=N[p];if((_==null?void 0:_.type)==="rx"&&typeof _.message=="string"&&(_.message.includes("T:")||_.message.includes("B:"))){const P=o(_.message);(P.hotend||P.bed)&&(h={hotendCurrent:((g=P.hotend)==null?void 0:g.current)??l.current.hotendCurrent,hotendTarget:((j=P.hotend)==null?void 0:j.target)??l.current.hotendTarget,bedCurrent:((S=P.bed)==null?void 0:S.current)??l.current.bedCurrent,bedTarget:((M=P.bed)==null?void 0:M.target)??l.current.bedTarget})}}i.current=N.length,h&&(l.current=h,n.current=Date.now(),r(h))},u=V.subscribe(b=>b.temperatures,b=>{var p,h,g,j;const N={hotendCurrent:((p=b==null?void 0:b.hotend)==null?void 0:p.current)??l.current.hotendCurrent,hotendTarget:((h=b==null?void 0:b.hotend)==null?void 0:h.target)??l.current.hotendTarget,bedCurrent:((g=b==null?void 0:b.bed)==null?void 0:g.current)??l.current.bedCurrent,bedTarget:((j=b==null?void 0:b.bed)==null?void 0:j.target)??l.current.bedTarget};l.current=N,n.current=Date.now(),r(N)}),x=V.subscribe(b=>b.serialLogs?b.serialLogs.length:0,(b,N)=>{t&&b>N&&m()});c.current=setInterval(async()=>{var N;const b=V.getState();if(!(b.status!=="connected"||!((N=b.port)!=null&&N.writable)))try{const p=b.port.writable.getWriter(),h=new TextEncoder,g=`M105\r
`,j=h.encode(g);await p.write(j),p.releaseLock(),V.getState().appendSerialLog("M105","tx")}catch{}},2e3);const f=setInterval(m,750);return()=>{clearInterval(f),c.current&&(clearInterval(c.current),c.current=null),u(),x()}},[t,a]),s}const Xs=_e.memo(function({send:a,isConnected:s=!1}){const{hotendCurrent:r,hotendTarget:l,bedCurrent:n,bedTarget:i}=dn(s,a),c=V(S=>S.serialLogs?S.serialLogs.length:0),[o,m]=d.useState({hotend:"",bed:""}),u=d.useRef(null),[x,f]=d.useState([]),[b,N]=d.useState(0);d.useEffect(()=>{},[c]),d.useEffect(()=>{if(!s)return;const S=setInterval(()=>{N(M=>M+1)},1e3);return()=>{clearInterval(S)}},[s]),d.useEffect(()=>{if(!s){f([]);return}f(S=>{const M={hotend:r,bed:n,targetHotend:l,targetBed:i,timestamp:Date.now()},_=[...S,M];return _.length>60?_.slice(-60):_}),N(S=>S+1)},[s,r,l,n,i]),d.useEffect(()=>{const S=u.current;if(!S)return;const M=S.getContext("2d"),_=S.width,P=S.height;if(M.clearRect(0,0,_,P),x.length===0){M.fillStyle="#666",M.font="16px sans-serif",M.textAlign="center",M.fillText("No temperature data",_/2,P/2),M.fillText("Connect to printer to see live temperatures",_/2,P/2+20);return}const E=x.map(A=>A.hotend||0),F=x.map(A=>A.bed||0),v=x.map(A=>A.targetHotend||0),C=x.map(A=>A.targetBed||0),y=[...E,...F,...v,...C],w=Math.max(0,...y),k=0,H=Math.max(w+20,100),K={left:40,right:10,top:10,bottom:20},z=_-K.left-K.right,Z=P-K.top-K.bottom,ne=A=>K.left+A/Math.max(1,x.length-1)*z,je=A=>K.top+Z-(A-k)/Math.max(1,H-k)*Z;M.strokeStyle="#e5e7eb",M.lineWidth=1,M.setLineDash([]),M.textAlign="right",M.textBaseline="middle",M.font="10px sans-serif";const T=Math.ceil((H-k)/5/10)*10;for(let A=Math.ceil(k/T)*T;A<=H;A+=T){const O=je(A);M.beginPath(),M.moveTo(K.left,O),M.lineTo(_-K.right,O),M.stroke(),M.fillStyle="#6b7280",M.fillText(A.toString()+"°C",K.left-5,O)}const I=(A,O,X=!1)=>{M.strokeStyle=O,M.lineWidth=2,M.setLineDash(X?[5,5]:[]),M.beginPath(),A.forEach(($,se)=>{const J=ne(se),U=je($);se===0?M.moveTo(J,U):M.lineTo(J,U)}),M.stroke(),X||(M.fillStyle=O,A.forEach(($,se)=>{const J=ne(se),U=je($);M.beginPath(),M.arc(J,U,3,0,Math.PI*2),M.fill()}))};I(v,"#ef4444",!0),I(C,"#3b82f6",!0),I(E,"#ef4444"),I(F,"#3b82f6")},[x,b]);const p=()=>{if(!s)return;const S=parseInt(o.hotend,10);isNaN(S)||a(`M104 S${S}`)},h=()=>{if(!s)return;const S=parseInt(o.bed,10);isNaN(S)||a(`M140 S${S}`)},g=S=>{if(!s)return;const M=us[S];M&&(M.hotend&&a(`M104 S${M.hotend}`),M.bed&&a(`M140 S${M.bed}`))},j=()=>{s&&(a("M104 S0"),a("M140 S0"),a("M106 S0"))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Temperature"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Object.keys(us).map(S=>e.jsx("button",{disabled:!s,className:`px-2 py-1 text-xs rounded ${s?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 text-gray-400 cursor-not-allowed"}`,onClick:()=>g(S),children:S},S)),e.jsx("button",{disabled:!s,className:`px-2 py-1 text-xs rounded ${s?"bg-red-600 text-white hover:bg-red-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:j,children:"Cool Down"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["H: ",r,"°C / ",l,"°C"]}),e.jsxs("span",{className:"ml-4",children:["B: ",n,"°C / ",i,"°C"]}),e.jsxs("span",{className:"ml-4",children:["Points: ",x.length]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Hotend: ",e.jsxs("span",{className:"font-medium text-gray-900",children:[r,"°C"]}),l>0&&e.jsxs("span",{className:"text-gray-500",children:[" → ",l,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{placeholder:"Target °C",disabled:!s,className:`w-32 border rounded px-2 py-1 ${s?"border-gray-300":"border-gray-200 bg-gray-50 text-gray-400"}`,value:o.hotend,onChange:S=>m({...o,hotend:S.target.value})}),e.jsx("button",{disabled:!s,className:`px-3 py-2 rounded ${s?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:p,children:"Set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Bed: ",e.jsxs("span",{className:"font-medium text-gray-900",children:[n,"°C"]}),i>0&&e.jsxs("span",{className:"text-gray-500",children:[" → ",i,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{placeholder:"Target °C",disabled:!s,className:`w-32 border rounded px-2 py-1 ${s?"border-gray-300":"border-gray-200 bg-gray-50 text-gray-400"}`,value:o.bed,onChange:S=>m({...o,bed:S.target.value})}),e.jsx("button",{disabled:!s,className:`px-3 py-2 rounded ${s?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,onClick:h,children:"Set"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("canvas",{ref:u,width:600,height:160,className:"w-full h-40"}),e.jsxs("div",{className:"text-xs text-gray-500 flex justify-between",children:[e.jsx("span",{children:"Hotend (red, dashed = target)"}),e.jsx("span",{children:"Bed (blue, dashed = target)"})]})]})]})}),Zs=_e.memo(()=>{const t=V(u=>u.bedMesh),a=V(u=>u.fetchBedLevel),s=V(u=>u.runBedLeveling),r=V(u=>u.processCollectedBedMeshData),l=V(u=>u.fetchAllPrinterSettings),n=V(u=>u.status),i=d.useMemo(()=>{if(t.data&&t.data.length>0){let u=t.data;if(Array.isArray(u)&&u.length>0&&!Array.isArray(u[0])){const x=t.gridSize||{x:5,y:5},f=[];for(let b=0;b<x.y;b++){const N=[];for(let p=0;p<x.x;p++){const h=b*x.x+p;N.push(u[h]||0)}f.push(N)}u=f}if(Array.isArray(u)&&u.length>0&&Array.isArray(u[0]))return{mesh:u,gridSize:t.gridSize||{x:u[0].length,y:u.length},min:t.min||Math.min(...u.flat()),max:t.max||Math.max(...u.flat()),range:t.range||Math.max(...u.flat())-Math.min(...u.flat())}}return{mesh:[[.1,.05,0,-.05,-.1],[.08,.03,-.02,-.07,-.12],[.05,0,-.05,-.1,-.15],[.02,-.03,-.08,-.13,-.18],[-.01,-.06,-.11,-.16,-.21]],gridSize:{x:5,y:5},min:-.21,max:.1,range:.31}},[t]),c=i.mesh&&Array.isArray(i.mesh)?Math.max(...i.mesh.flat().map(Math.abs)):0,o=i.mesh&&Array.isArray(i.mesh)?Math.min(...i.mesh.flat()):0,m=u=>{if(c===o)return"bg-gray-500";const x=(u-o)/(c-o);return x<.33?"bg-green-500":x<.66?"bg-yellow-500":"bg-red-500"};return e.jsx("div",{className:"space-y-4",children:t.data.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"No bed leveling data available"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:s,disabled:n!=="connected",className:"px-4 py-2 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Run Auto Bed Leveling (G29)"}),e.jsx("div",{className:"text-xs text-gray-400",children:"or"}),e.jsx("button",{onClick:a,disabled:n!=="connected",className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Fetch Existing Data (M503)"}),e.jsx("div",{className:"text-xs text-gray-400",children:"or"}),e.jsx("button",{onClick:r,className:"px-3 py-1 text-sm bg-purple-500 text-white rounded hover:bg-purple-600",children:"Process Collected Data"}),e.jsx("div",{className:"text-xs text-gray-400",children:"or"}),e.jsx("button",{onClick:l,disabled:n!=="connected",className:"px-3 py-1 text-sm bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Fetch All Settings (M503)"})]}),n!=="connected"&&e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Connect to printer first"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:s,disabled:n!=="connected",className:"px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Run New Leveling"}),e.jsx("button",{onClick:a,disabled:n!=="connected",className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Refresh"})]}),e.jsx("div",{className:"grid gap-1 max-w-xs mx-auto",style:{gridTemplateColumns:`repeat(${i.gridSize.x}, minmax(0, 1fr))`,gridTemplateRows:`repeat(${i.gridSize.y}, minmax(0, 1fr))`},children:i.mesh&&Array.isArray(i.mesh)&&i.mesh.map((u,x)=>Array.isArray(u)&&u.map((f,b)=>e.jsx("div",{className:`h-8 w-8 rounded border flex items-center justify-center text-xs text-white font-mono ${m(f)}`,title:`X${b} Y${x}: ${f.toFixed(3)}mm`,children:f.toFixed(2)},`${x}-${b}`)))}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"Good"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:"Warning"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Critical"})]})]}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Max deviation: ",i.max.toFixed(3),"mm"]}),e.jsxs("p",{children:["Min deviation: ",i.min.toFixed(3),"mm"]}),e.jsxs("p",{children:["Range: ",i.range.toFixed(3),"mm"]}),e.jsxs("p",{children:["Grid: ",i.gridSize.x,"x",i.gridSize.y]}),t.timestamp&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Last updated: ",new Date(t.timestamp).toLocaleTimeString()]})]})]})})});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ys=Symbol("Comlink.proxy"),mn=Symbol("Comlink.endpoint"),un=Symbol("Comlink.releaseProxy"),Lt=Symbol("Comlink.finalizer"),ft=Symbol("Comlink.thrown"),qs=t=>typeof t=="object"&&t!==null||typeof t=="function",xn={canHandle:t=>qs(t)&&t[Ys],serialize(t){const{port1:a,port2:s}=new MessageChannel;return Qs(t,a),[s,[s]]},deserialize(t){return t.start(),Js(t)}},hn={canHandle:t=>qs(t)&&ft in t,serialize({value:t}){let a;return t instanceof Error?a={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:a={isError:!1,value:t},[a,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Ws=new Map([["proxy",xn],["throw",hn]]);function pn(t,a){for(const s of t)if(a===s||s==="*"||s instanceof RegExp&&s.test(a))return!0;return!1}function Qs(t,a=globalThis,s=["*"]){a.addEventListener("message",function r(l){if(!l||!l.data)return;if(!pn(s,l.origin)){console.warn(`Invalid origin '${l.origin}' for comlink proxy`);return}const{id:n,type:i,path:c}=Object.assign({path:[]},l.data),o=(l.data.argumentList||[]).map(Oe);let m;try{const u=c.slice(0,-1).reduce((f,b)=>f[b],t),x=c.reduce((f,b)=>f[b],t);switch(i){case"GET":m=x;break;case"SET":u[c.slice(-1)[0]]=Oe(l.data.value),m=!0;break;case"APPLY":m=x.apply(u,o);break;case"CONSTRUCT":{const f=new x(...o);m=jn(f)}break;case"ENDPOINT":{const{port1:f,port2:b}=new MessageChannel;Qs(t,b),m=Nn(f,[f])}break;case"RELEASE":m=void 0;break;default:return}}catch(u){m={value:u,[ft]:0}}Promise.resolve(m).catch(u=>({value:u,[ft]:0})).then(u=>{const[x,f]=_t(u);a.postMessage(Object.assign(Object.assign({},x),{id:n}),f),i==="RELEASE"&&(a.removeEventListener("message",r),Ks(a),Lt in t&&typeof t[Lt]=="function"&&t[Lt]())}).catch(u=>{const[x,f]=_t({value:new TypeError("Unserializable return value"),[ft]:0});a.postMessage(Object.assign(Object.assign({},x),{id:n}),f)})}),a.start&&a.start()}function gn(t){return t.constructor.name==="MessagePort"}function Ks(t){gn(t)&&t.close()}function Js(t,a){const s=new Map;return t.addEventListener("message",function(l){const{data:n}=l;if(!n||!n.id)return;const i=s.get(n.id);if(i)try{i(n)}finally{s.delete(n.id)}}),Gt(t,s,[],a)}function dt(t){if(t)throw new Error("Proxy has been released and is not useable")}function er(t){return Be(t,new Map,{type:"RELEASE"}).then(()=>{Ks(t)})}const St=new WeakMap,Et="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const a=(St.get(t)||0)-1;St.set(t,a),a===0&&er(t)});function fn(t,a){const s=(St.get(a)||0)+1;St.set(a,s),Et&&Et.register(t,a,t)}function bn(t){Et&&Et.unregister(t)}function Gt(t,a,s=[],r=function(){}){let l=!1;const n=new Proxy(r,{get(i,c){if(dt(l),c===un)return()=>{bn(n),er(t),a.clear(),l=!0};if(c==="then"){if(s.length===0)return{then:()=>n};const o=Be(t,a,{type:"GET",path:s.map(m=>m.toString())}).then(Oe);return o.then.bind(o)}return Gt(t,a,[...s,c])},set(i,c,o){dt(l);const[m,u]=_t(o);return Be(t,a,{type:"SET",path:[...s,c].map(x=>x.toString()),value:m},u).then(Oe)},apply(i,c,o){dt(l);const m=s[s.length-1];if(m===mn)return Be(t,a,{type:"ENDPOINT"}).then(Oe);if(m==="bind")return Gt(t,a,s.slice(0,-1));const[u,x]=xs(o);return Be(t,a,{type:"APPLY",path:s.map(f=>f.toString()),argumentList:u},x).then(Oe)},construct(i,c){dt(l);const[o,m]=xs(c);return Be(t,a,{type:"CONSTRUCT",path:s.map(u=>u.toString()),argumentList:o},m).then(Oe)}});return fn(n,t),n}function yn(t){return Array.prototype.concat.apply([],t)}function xs(t){const a=t.map(_t);return[a.map(s=>s[0]),yn(a.map(s=>s[1]))]}const tr=new WeakMap;function Nn(t,a){return tr.set(t,a),t}function jn(t){return Object.assign(t,{[Ys]:!0})}function _t(t){for(const[a,s]of Ws)if(s.canHandle(t)){const[r,l]=s.serialize(t);return[{type:"HANDLER",name:a,value:r},l]}return[{type:"RAW",value:t},tr.get(t)||[]]}function Oe(t){switch(t.type){case"HANDLER":return Ws.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Be(t,a,s,r){return new Promise(l=>{const n=vn();a.set(n,l),t.start&&t.start(),t.postMessage(Object.assign({id:n},s),r)})}function vn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class wn{constructor(a){this.originalData=a,this.lodLevels=new Map,this.generateLodLevels()}generateLodLevels(){const a=[{level:0,sampleRate:1},{level:1,sampleRate:2},{level:2,sampleRate:4},{level:3,sampleRate:8},{level:4,sampleRate:16}];for(const s of a)this.lodLevels.set(s.level,this.generateLodLevel(s.sampleRate))}generateLodLevel(a){return{layers:this.originalData.layers.map(r=>{const l=[],n=[],i=[];for(let c=0;c<r.points.length;c+=6*a){l.push(r.points[c],r.points[c+1],r.points[c+2]),c+3<r.points.length&&l.push(r.points[c+3],r.points[c+4],r.points[c+5]);const o=l.length/3-2;o>=0&&n.push(o,o+1),i.push(r.moveTypes[Math.floor(c/6)])}return{...r,points:l,lines:n,moveTypes:i}}),bounds:this.originalData.bounds,stats:{...this.originalData.stats,totalPoints:Math.ceil(this.originalData.stats.totalPoints/a)}}}getLodLevel(a,s){this.originalData.stats.totalPoints/s;const r=s/a;return r>2?0:r>1?1:r>.5?2:r>.25?3:4}getGeometryForDistance(a,s){const r=this.getLodLevel(a,s);return this.lodLevels.get(r)||this.originalData}}const sr=new Worker(new URL("/3D-PRINTER-MANAGER/3d-printer-suite/assets/gcode.worker-eb76017b.js",self.location),{type:"module"}),Sn=Js(sr),En={travel:new Ve(8421504),extrude:new Ve(65280),retract:new Ve(16711680)},_n=({geometryData:t,visibleLayers:a,showTravelMoves:s})=>{const{camera:r,size:l}=Sr(),[n,i]=d.useState(t),c=d.useRef(null);return d.useEffect(()=>{t&&(c.current=new wn(t),i(t))},[t]),Er(()=>{if(!c.current)return;const o=r.position.distanceTo(new Le),m=c.current.getGeometryForDistance(o,Math.min(l.width,l.height));m!==n&&i(m)}),d.useEffect(()=>{if(t!=null&&t.bounds){const{min:o,max:m}=t.bounds,u=new Le((o.x+m.x)/2,(o.y+m.y)/2,(o.z+m.z)/2),x=new Le(m.x-o.x,m.y-o.y,m.z-o.z),f=Math.max(x.x,x.y,x.z),b=r.fov*(Math.PI/180),N=Math.abs(f/Math.sin(b/2)/2);r.position.set(u.x,u.y+N,u.z+N),r.lookAt(u),r.updateProjectionMatrix()}},[t,r]),n?e.jsxs(e.Fragment,{children:[e.jsx(_r,{args:[1e3,1e3],position:[0,0,0],rotation:[-Math.PI/2,0,0],cellSize:10,cellThickness:.5,cellColor:"#606060",sectionSize:50,sectionThickness:1,sectionColor:"#808080",fadeDistance:1e3,fadeStrength:1}),n.layers.map((o,m)=>a.has(m)?o.points.map((u,x)=>{if(x%6!==0)return null;const f=o.moveTypes[x/6];if(f==="travel"&&!s)return null;const b=[new Le(o.points[x],o.points[x+1],o.points[x+2]),new Le(o.points[x+3],o.points[x+4],o.points[x+5])];return e.jsx(Es,{points:b,color:En[f],lineWidth:f==="travel"?.5:2},`${m}-${x}`)}):null)]}):null},ze=({content:t,width:a=800,height:s=600})=>{const[r,l]=d.useState(null),[n,i]=d.useState(!1),[c,o]=d.useState(0),[m,u]=d.useState(!0),x=d.useRef(null);d.useEffect(()=>((async()=>{try{console.log("GcodeViewer3D: Initializing worker..."),x.current=await new Sn,console.log("GcodeViewer3D: Worker initialized successfully")}catch(N){console.error("GcodeViewer3D: Error initializing worker:",N)}})(),()=>{x.current&&(console.log("GcodeViewer3D: Terminating worker"),sr.terminate())}),[]),d.useEffect(()=>{(async()=>{if(console.log("GcodeViewer3D: Processing G-code, content length:",t==null?void 0:t.length,"worker ready:",!!x.current),!t||!x.current){console.log("GcodeViewer3D: Missing content or worker, skipping processing");return}i(!0);try{console.log("GcodeViewer3D: Starting G-code processing...");const N=await x.current.convertToGeometry(t,{sampleRate:1,simplifyThreshold:.1,maxPoints:1e6});console.log("GcodeViewer3D: Processing complete, result:",N),l(N),o(N.layers.length-1)}catch(N){console.error("GcodeViewer3D: Error processing G-code:",N)}finally{i(!1)}})()},[t]);const f=d.useMemo(()=>r?new Set(Array.from({length:c+1},(b,N)=>N)):new Set,[c,r]);return n?e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:s},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processing G-code..."})]})}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-black rounded-lg shadow-lg",style:{width:a,height:s},children:[e.jsxs(Zt,{children:[e.jsx(vr,{}),e.jsx(wr,{makeDefault:!0,position:[0,200,200]}),e.jsx(Yt,{enableDamping:!0,dampingFactor:.05}),e.jsx("ambientLight",{intensity:.5}),e.jsx("directionalLight",{position:[1,1,1],intensity:.8}),e.jsx(_n,{geometryData:r,visibleLayers:f,showTravelMoves:m})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-white/90 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Layer: ",c+1," / ",(r==null?void 0:r.layers.length)||0]}),e.jsx("input",{type:"range",min:0,max:((r==null?void 0:r.layers.length)||1)-1,value:c,onChange:b=>o(parseInt(b.target.value)),className:"w-full"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:b=>u(b.target.checked),className:"rounded text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Show Travel Moves"})]})})]})]}),r&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Layers:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.stats.totalLayers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Points:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.stats.totalPoints})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Build Volume:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(r.bounds.max.x-r.bounds.min.x),"x",Math.round(r.bounds.max.y-r.bounds.min.y),"x",Math.round(r.bounds.max.z-r.bounds.min.z),"mm"]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:s},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500 mb-2",children:"No G-code data to visualize"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Generate G-code first to see 3D preview"})]})})},Tn={travel:new Ve(8421504),extrude:new Ve(65280),retract:new Ve(16711680)},hs=(t,a=1e3)=>{const s=t.split(`
`),r=new Map;let l={x:0,y:0,z:0,e:0},n={x:0,y:0,z:0,e:0},i={min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}};const c=new Map,o=f=>{i.min.x=Math.min(i.min.x,f.x),i.min.y=Math.min(i.min.y,f.y),i.min.z=Math.min(i.min.z,f.z),i.max.x=Math.max(i.max.x,f.x),i.max.y=Math.max(i.max.y,f.y),i.max.z=Math.max(i.max.z,f.z)},m=f=>{const b={};for(const N of f){const p=N.charAt(0).toLowerCase();if("xyzef".includes(p)){const h=parseFloat(N.slice(1));!isNaN(h)&&isFinite(h)&&(b[p]=h)}}return b};for(const f of s){const b=f.trim();if(!b||b.startsWith(";"))continue;const N=b.split(" "),p=N[0];if(p==="G0"||p==="G1"){const h=m(N);if(Object.values(h).some(j=>isNaN(j)||!isFinite(j))&&console.warn("Invalid coordinates found in line:",b,"coords:",h),h.x!==void 0&&(l.x=h.x),h.y!==void 0&&(l.y=h.y),h.z!==void 0&&(l.z=h.z),h.e!==void 0&&(l.e=h.e),[l.x,l.y,l.z,n.x,n.y,n.z].every(j=>!isNaN(j)&&isFinite(j))){const S=l.e>n.e?"extrude":"travel",M=l.z;r.has(M)||(r.set(M,{points:[],moveTypes:[],pointCount:0}),c.set(M,0));const _=r.get(M),P=c.get(M);(P<a||P%Math.ceil(P/a)===0||S==="extrude")&&(_.points.push(n.x,n.y,n.z,l.x,l.y,l.z),_.moveTypes.push(S),_.pointCount++),c.set(M,P+1),o(l),n={...l}}else console.warn("Skipping invalid coordinates:",{lastPosition:n,currentPosition:l})}}const u=Array.from(r.entries()).sort(([f],[b])=>f-b).map(([f,b])=>({z:f,...b})),x={min:{x:isFinite(i.min.x)?i.min.x:0,y:isFinite(i.min.y)?i.min.y:0,z:isFinite(i.min.z)?i.min.z:0},max:{x:isFinite(i.max.x)?i.max.x:100,y:isFinite(i.max.y)?i.max.y:100,z:isFinite(i.max.z)?i.max.z:10}};return{layers:u,bounds:x,stats:{totalLayers:u.length,totalPoints:u.reduce((f,b)=>f+b.points.length/6,0)}}},Cn=({geometryData:t,visibleLayers:a,showTravelMoves:s,buildPlateSize:r})=>t?e.jsxs(e.Fragment,{children:[(()=>{const{min:l,max:n}=t.bounds,i=(l.x+n.x)/2,c=(l.y+n.y)/2,o=n.x-l.x,m=n.y-l.y,u=Math.max(o,r.x);return Math.max(m,r.y),e.jsxs(e.Fragment,{children:[e.jsx("gridHelper",{args:[u,Math.max(10,Math.floor(u/10)),"#cccccc","#cccccc"],position:[i,c,0],rotation:[-Math.PI/2,0,0]}),e.jsxs("mesh",{position:[i,c,.01],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[r.x,r.y]}),e.jsx("meshBasicMaterial",{color:"#f0f0f0",transparent:!0,opacity:.1})]}),e.jsx("group",{position:[i,c,.02],children:e.jsxs("lineSegments",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:8,array:new Float32Array([-r.x/2,-r.y/2,0,r.x/2,-r.y/2,0,r.x/2,-r.y/2,0,r.x/2,r.y/2,0,r.x/2,r.y/2,0,-r.x/2,r.y/2,0,-r.x/2,r.y/2,0,-r.x/2,-r.y/2,0]),itemSize:3})}),e.jsx("lineBasicMaterial",{color:"#666666"})]})})]})})(),e.jsxs("mesh",{position:[-4,4,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-2.5,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,2.5,0],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[Math.PI/2,0,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsxs("mesh",{position:[-4,4,.5],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsx(Me,{position:[-2.2,4,0],fontSize:.25,color:"#ff0000",rotation:[-Math.PI/2,0,0],children:"X"}),e.jsx(Me,{position:[-4,2.2,0],fontSize:.25,color:"#00ff00",rotation:[-Math.PI/2,0,0],children:"Y"}),e.jsx(Me,{position:[-4,4,.7],fontSize:.25,color:"#0000ff",children:"Z"}),t.layers.map((l,n)=>a.has(n)?l.points.map((i,c)=>{if(c%6!==0)return null;const o=l.moveTypes[c/6];if(o==="travel"&&!s)return null;const m=l.points[c],u=l.points[c+1],x=l.points[c+2],f=l.points[c+3],b=l.points[c+4],N=l.points[c+5];if(![m,u,x,f,b,N].every(j=>!isNaN(j)&&isFinite(j)))return console.warn("Skipping invalid line segment:",{x1:m,y1:u,z1:x,x2:f,y2:b,z2:N}),null;const g=[new Le(m,u,x),new Le(f,b,N)];return e.jsx(Es,{points:g,color:Tn[o],lineWidth:o==="travel"?.5:2},`${n}-${c}`)}):null)]}):e.jsxs(e.Fragment,{children:[e.jsx("gridHelper",{args:[r.x,Math.max(10,Math.floor(r.x/10)),"#cccccc","#cccccc"],position:[0,0,0],rotation:[-Math.PI/2,0,0]}),e.jsxs("mesh",{position:[0,0,.01],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[r.x,r.y]}),e.jsx("meshBasicMaterial",{color:"#f0f0f0",transparent:!0,opacity:.1})]}),e.jsx("group",{position:[0,0,.02],children:e.jsxs("lineSegments",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:8,array:new Float32Array([-r.x/2,-r.y/2,0,r.x/2,-r.y/2,0,r.x/2,-r.y/2,0,r.x/2,r.y/2,0,r.x/2,r.y/2,0,-r.x/2,r.y/2,0,-r.x/2,r.y/2,0,-r.x/2,-r.y/2,0]),itemSize:3})}),e.jsx("lineBasicMaterial",{color:"#666666"})]})}),e.jsxs("mesh",{position:[-4,4,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-2.5,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#ff0000"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[0,0,Math.PI/2],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1.5,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,2.5,0],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#00ff00"})]}),e.jsxs("mesh",{position:[-4,4,0],rotation:[Math.PI/2,0,0],children:[e.jsx("cylinderGeometry",{args:[.02,.02,1,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsxs("mesh",{position:[-4,4,.5],rotation:[0,0,0],children:[e.jsx("coneGeometry",{args:[.08,.15,8]}),e.jsx("meshStandardMaterial",{color:"#0000ff"})]}),e.jsx(Me,{position:[-2.2,4,0],fontSize:.25,color:"#ff0000",rotation:[-Math.PI/2,0,0],children:"X"}),e.jsx(Me,{position:[-4,2.2,0],fontSize:.25,color:"#00ff00",rotation:[-Math.PI/2,0,0],children:"Y"}),e.jsx(Me,{position:[-4,4,.7],fontSize:.25,color:"#0000ff",children:"Z"}),e.jsxs("mesh",{position:[0,0,1],children:[e.jsx("boxGeometry",{args:[2,2,2]}),e.jsx("meshStandardMaterial",{color:"#ef4444"})]})]}),rr=({content:t,width:a=800,height:s=700,buildPlateSize:r={x:220,y:220}})=>{const[l,n]=d.useState(null),[i,c]=d.useState(!1),[o,m]=d.useState(0),[u,x]=d.useState(!0),[f,b]=d.useState([0,0,50]),[N,p]=d.useState("medium"),[h,g]=d.useState(1e3);console.log("SimpleGcodeViewer3D rendered with content length:",t==null?void 0:t.length,"width:",a,"height:",s,"buildPlateSize:",r),d.useEffect(()=>{t&&t.length>5e4?(p("low"),g(500)):t&&t.length>2e4?(p("medium"),g(1e3)):(p("high"),g(2e3))},[t]),d.useEffect(()=>{(()=>{if(console.log("SimpleGcodeViewer3D: Processing G-code, content length:",t==null?void 0:t.length,"quality:",N,"maxPoints:",h),!t){console.log("SimpleGcodeViewer3D: No content, skipping processing");return}c(!0);try{console.log("SimpleGcodeViewer3D: Starting G-code processing...");const M=hs(t,h);if(console.log("SimpleGcodeViewer3D: Processing complete, result:",M),n(M),m(M.layers.length-1),M.bounds){const{min:_,max:P}=M.bounds,E=(_.x+P.x)/2,F=(_.y+P.y)/2,v=(_.z+P.z)/2,C=P.x-_.x,y=P.y-_.y,w=P.z-_.z,k=Math.max(C,y,w),H=Math.max(r.x,r.y),K=Math.max(k,H),z=Math.max(K*1.2,30),Z=K*.6,ne=[E+Z,F+Z,v+z*.6];console.log("Setting camera position:",ne,"for bounds:",M.bounds,"buildPlateSize:",r),b(ne)}}catch(M){console.error("SimpleGcodeViewer3D: Error processing G-code:",M)}finally{c(!1)}})()},[t]);const j=d.useMemo(()=>l?new Set(Array.from({length:o+1},(S,M)=>M)):new Set,[o,l]);return i?e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:s},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Processing G-code..."})]})}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-300",style:{width:a,height:s},children:[e.jsxs(Zt,{camera:{position:f,fov:45},children:[e.jsx(Yt,{enableDamping:!0,dampingFactor:.05,target:l?[(l.bounds.min.x+l.bounds.max.x)/2,(l.bounds.min.y+l.bounds.max.y)/2,(l.bounds.min.z+l.bounds.max.z)/2]:[0,0,0],minDistance:5,maxDistance:500,enableZoom:!0,enablePan:!0,enableRotate:!0}),e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[5,5,5],intensity:.8}),e.jsx(Cn,{geometryData:l,visibleLayers:j,showTravelMoves:u,buildPlateSize:r})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-white bg-opacity-90 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Layer: ",o+1," / ",(l==null?void 0:l.layers.length)||0]}),e.jsx("input",{type:"range",min:0,max:((l==null?void 0:l.layers.length)||1)-1,value:o,onChange:S=>m(parseInt(S.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:S=>x(S.target.checked),className:"rounded text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Show Travel Moves"})]}),e.jsx("button",{onClick:()=>{if(l!=null&&l.bounds){const{min:S,max:M}=l.bounds,_=(S.x+M.x)/2,P=(S.y+M.y)/2,E=(S.z+M.z)/2,F=M.x-S.x,v=M.y-S.y,C=M.z-S.z,y=Math.max(F,v,C),w=Math.max(r.x,r.y),k=Math.max(y,w),H=Math.max(k*1.2,30),K=k*.6;b([_+K,P+K,E+H*.6])}},className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",children:"Reset View"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Quality:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:N,onChange:S=>{const M=S.target.value;p(M),g(M==="low"?500:M==="medium"?1e3:2e3)},className:"px-2 py-1 text-sm border border-gray-300 rounded",children:[e.jsx("option",{value:"low",children:"Low (Fast)"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High (Slow)"})]}),e.jsx("button",{onClick:()=>{if(t){c(!0);try{const S=hs(t,h);n(S),m(S.layers.length-1)}catch(S){console.error("Error reprocessing G-code:",S)}finally{c(!1)}}},className:"px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600",children:"Apply"})]})]})]})]})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Layers:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.stats.totalLayers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Rendered Points:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.stats.totalPoints})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Quality Level:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:N})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Max Points/Layer:"}),e.jsx("span",{className:"ml-2 font-medium",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Build Volume:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[Math.round(l.bounds.max.x-l.bounds.min.x),"x",Math.round(l.bounds.max.y-l.bounds.min.y),"x",Math.round(l.bounds.max.z-l.bounds.min.z),"mm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Performance:"}),e.jsx("span",{className:"ml-2 font-medium",children:N==="low"?"Fast":N==="medium"?"Balanced":"Detailed"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center",style:{width:a,height:s},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500 mb-2",children:"No G-code data to visualize"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Generate G-code first to see 3D preview"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Content length: ",(t==null?void 0:t.length)||0]})]})})},Pn=["Instructions","Visuals","Configuration","Results"],ps={hotendTemp:!0,bedTemp:!0,nozzleDiameter:!0,layerHeight:!0,printSpeed:!0,retractionDistance:!0,retractionSpeed:!0,primeSpeed:!0,flowRate:!0,wallThickness:!0,enableABL:!0,firstLayerSpeed:!0},kn=d.memo(()=>{const t=V(s=>s.status),a=V(s=>s.sendCommand);return e.jsx("div",{className:"mb-4",children:e.jsx(Xs,{send:a,isConnected:t==="connected"})})}),Mn=d.memo(({step:t,canProceed:a,execState:s,generateGcode:r,sendToPrinter:l,renderInput:n,pauseExec:i,resumeExec:c,abortExec:o,showGcode:m,setShowGcode:u,generatedGcode:x,copyGcode:f,activePrinterId:b,gcodeViewMode:N,setGcodeViewMode:p})=>{const h=V(j=>j.status),g=ue(j=>j.printers.find(S=>S.id===b));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Configuration Parameters"}),e.jsx(Qa,{className:"w-auto"})]}),b&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-3 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Global Parameters for Printer ",b]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:Object.entries(Ze(b)).map(([j,S])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:[j,":"]}),e.jsx("span",{className:"text-blue-900 dark:text-blue-100 font-mono",children:S})]},j))}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:"These parameters persist across all calibration steps and are saved per printer."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(t.inputs||[]).map(n)}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-2 items-center",children:[e.jsxs("button",{onClick:r,className:"bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors flex items-center space-x-2 shadow-sm",children:[e.jsx(Ls,{className:"h-4 w-4"}),e.jsx("span",{children:"Generate G-code"})]}),e.jsx("button",{onClick:l,disabled:h!=="connected"||!x||s.running,className:`px-4 py-2 rounded-md transition-colors shadow-sm ${h==="connected"&&x&&!s.running?"bg-green-600 hover:bg-green-700 dark:bg-green-600 dark:hover:bg-green-700 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:"Send to Printer"}),s.running&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-40 bg-gray-300 dark:bg-gray-600 rounded h-2 overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 dark:bg-blue-600",style:{width:`${s.total?Math.round(s.progress/s.total*100):0}%`}})}),e.jsxs("span",{children:[s.progress,"/",s.total]}),s.paused?e.jsx("button",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",onClick:c,children:"Resume"}):e.jsx("button",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",onClick:i,children:"Pause"}),e.jsx("button",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded",onClick:o,children:"Abort"})]})]}),x&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Generated G-code"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:f,className:"px-2 py-1 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded text-sm",children:"Copy"}),e.jsx("button",{onClick:()=>{const j=!m;u(j);try{t!=null&&t.id&&sessionStorage.setItem(`gcode_show_${t.id}`,j?"1":"0")}catch{}},className:"px-2 py-1 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded text-sm",children:m?"Hide":"Show"})]})]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Preview Mode:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>p("text"),className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${N==="text"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"Text"})]}),e.jsxs("button",{onClick:()=>p("3d"),className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${N==="3d"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:[e.jsx(Ps,{className:"w-4 h-4"}),e.jsx("span",{children:"3D"})]})]})]}),N==="text"?e.jsx("div",{className:"bg-gray-900 text-gray-400 dark:text-gray-500 p-4 rounded-md overflow-x-auto",children:e.jsx("pre",{className:"text-sm font-mono whitespace-pre-wrap",children:x})}):e.jsx("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",children:e.jsx(rr,{content:x,width:"100%",height:600,buildPlateSize:(g==null?void 0:g.bedSize)||{x:220,y:220}})})]})]})]})},(t,a)=>t.canProceed===a.canProceed&&t.execState.running===a.execState.running&&t.execState.progress===a.execState.progress&&t.showGcode===a.showGcode&&t.generatedGcode===a.generatedGcode),Rn=d.memo(({step:t,canProceed:a,execState:s,generateGcode:r,sendToPrinter:l,renderInput:n,pauseExec:i,resumeExec:c,abortExec:o,showGcode:m,setShowGcode:u,generatedGcode:x,copyGcode:f,activePrinterId:b,gcodeViewMode:N,setGcodeViewMode:p})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6 space-y-4",children:[e.jsx(kn,{}),e.jsx("div",{className:"h-px bg-gray-300 dark:bg-gray-600"}),t.category==="Movement"&&t.id.includes("level")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Bed Level Visualization"}),e.jsx(Zs,{})]}),e.jsx("div",{className:"h-px bg-gray-300 dark:bg-gray-600"})]}),e.jsx(Mn,{step:t,canProceed:a,execState:s,generateGcode:r,sendToPrinter:l,renderInput:n,pauseExec:i,resumeExec:c,abortExec:o,showGcode:m,setShowGcode:u,generatedGcode:x,copyGcode:f,activePrinterId:b,gcodeViewMode:N,setGcodeViewMode:p})]}),(t,a)=>t.canProceed===a.canProceed&&t.execState.running===a.execState.running&&t.execState.progress===a.execState.progress&&t.showGcode===a.showGcode&&t.generatedGcode===a.generatedGcode),An=d.memo(({step:t={},onComplete:a})=>{const s=V(B=>B.status),r=V(B=>B.sendCommand),l=V(B=>B.connect),n=V(B=>B.disconnect);d.useMemo(()=>({status:s,send:r,connect:l,disconnect:n}),[s,r,l,n]);const i=ue(B=>B.activePrinterId);ue(B=>B.printers.find(Y=>Y.id===B.activePrinterId));const c=ue(B=>!!B.printers.find(Y=>Y.id===B.activePrinterId)),o=ue(B=>{var D;const Y=B.printers.find(R=>R.id===B.activePrinterId);return(D=Y==null?void 0:Y.calibrationSteps)==null?void 0:D[t.id]}),m=ue(B=>B.updateCalibrationStep),u=(o==null?void 0:o.activeTab)||"Instructions",[x,f]=d.useState(u),b=d.useCallback(B=>{f(B),i&&(t!=null&&t.id)&&m(i,t.id,{activeTab:B})},[i,t==null?void 0:t.id,m]);d.useEffect(()=>{u!==x&&f(u)},[u]);const N=d.useRef(!1),p=d.useRef(!1),h=d.useRef(!1),g=d.useRef(!1),j=d.useRef({}),[S,M]=d.useState({}),[_,P]=d.useState(""),[E,F]=d.useState(!1),[v,C]=d.useState(!1),[y,w]=d.useState("3d"),[k,H]=d.useState({}),[K,z]=d.useState({measurements:{},notes:"",photos:[]}),Z=d.useRef(null),[ne,je]=d.useState(!1),T=V(B=>B.activeExecution),I=d.useMemo(()=>{var B,Y;return T?{running:T.status==="running",paused:!1,progress:((B=T.progress)==null?void 0:B.sent)||0,total:((Y=T.progress)==null?void 0:Y.total)||0}:{running:!1,paused:!1,progress:0,total:0}},[T]);if(d.useEffect(()=>{if(!(t!=null&&t.id)||N.current===t.id)return;N.current=t.id;const B=o;if(!g.current){if(B!=null&&B.inputValues)console.log("Loading input values from store:",B.inputValues),M(B.inputValues),j.current=B.inputValues;else if(t.inputs){const Y=i?Ze(i):{};console.log("Loaded globalThis parameters:",Y);const D={};t.inputs.forEach(R=>{D[R.key]=Y[R.key]||R.defaultValue}),console.log("Initializing input values with globalThis + defaults:",D),M(D),j.current=D}g.current=!0}if(!Object.keys(k).length){if(B!=null&&B.checklist)H(B.checklist);else if(t.checklist){const Y={};t.checklist.forEach((D,R)=>{Y[R]=!1}),H(Y)}}B!=null&&B.completed&&!E&&F(!0)},[t==null?void 0:t.id]),d.useEffect(()=>{console.log("Active tab changed to:",x)},[x]),d.useEffect(()=>{p.current=!1,h.current=!1,g.current=!1},[t.id]),d.useEffect(()=>{if(o){const B=o;B.generatedGcode&&!p.current&&(P(B.generatedGcode),p.current=!0),B.results&&!h.current&&(z(B.results),h.current=!0)}},[c,t.id]),d.useEffect(()=>{if(!(t!=null&&t.id))return;if(t.id==="first-layer")try{sessionStorage.removeItem(`gcode_${t.id}`),sessionStorage.removeItem(`gcode_show_${t.id}`)}catch{}const B=sessionStorage.getItem(`gcode_${t.id}`),Y=sessionStorage.getItem(`gcode_show_${t.id}`);B&&!p.current&&(P(B),p.current=!0),Y!=null&&C(Y==="1")},[t==null?void 0:t.id]),!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ta,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Calibration Step Selected"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"Please select a calibration step from the sidebar"})]});const A=d.useCallback((B,Y)=>{M(D=>{const R={...D,[B]:Y};return j.current=R,i&&ps[B]&&($t(i,t.id,R),console.log("Updated globalThis parameter:",B,"=",Y)),R})},[i,t.id]),O=d.useCallback(async()=>{var B;if(console.log("Generating G-code for step:",t==null?void 0:t.id),console.log("Step gcode function:",t==null?void 0:t.gcode),console.log("Input values:",j.current),!(t!=null&&t.gcode)){console.error("No gcode generator found for step:",t==null?void 0:t.id);return}try{let Y;if(typeof t.gcode=="function"){const D=(B=t.inputs)==null?void 0:B.filter(R=>R.required&&(j.current[R.key]===void 0||j.current[R.key]===""));if((D==null?void 0:D.length)>0){console.error("Missing required inputs:",D.map(R=>R.key)),alert(`Missing required inputs: ${D.map(R=>R.label||R.key).join(", ")}`);return}console.log("Calling gcode function with inputs:",j.current),Y=await t.gcode(j.current),console.log("Generated gcode:",Y)}else typeof t.gcode=="string"&&(Y=t.gcode,console.log("Using static gcode:",Y));if(Y){console.log("Setting generated gcode and showing preview"),P(Y),C(!0),p.current=!0;try{t!=null&&t.id&&t.id!=="first-layer"&&(sessionStorage.setItem(`gcode_${t.id}`,Y),sessionStorage.setItem(`gcode_show_${t.id}`,"1"))}catch{}}else console.error("No gcode generated"),alert("Failed to generate G-code. Please check the console for details.")}catch(Y){console.error("Error generating gcode:",Y),alert(`Error generating G-code: ${Y.message}`)}},[t==null?void 0:t.gcode,t==null?void 0:t.id,t==null?void 0:t.inputs]),X=d.useCallback(async()=>{if(s!=="connected"){console.log("Cannot send to printer - not connected. Current status:",s);return}if(!_&&(await O(),await new Promise(te=>setTimeout(te,0)),!_))return;const B=_.toUpperCase();if((/\bE[+\-]?\d/.test(B)||/M109\s+S\d+/.test(B))&&!confirm("This routine may involve extrusion or heating. Ensure target temperatures are set and safe to proceed. Continue?"))return;await r("M105");const R=_.split(/\r?\n/).map(te=>te.trim()).filter(te=>te&&!te.startsWith(";")),G={running:!0,paused:!1,progress:0,total:R.length};setExecState(G);try{const te=V.getState().sendGcodeProgram;if(typeof te=="function")await te(R.join(`
`),{delayMs:60,waitForOk:!0,okTimeoutMs:5e3,onProgress:(re,de)=>setExecState(le=>({...le||G,progress:re,total:de}))});else for(let re=0;re<R.length;re++){const de=I||G;if(de.paused){re--,await new Promise(le=>setTimeout(le,200));continue}if(!de.running)break;await r(R[re]),setExecState(le=>({...le||G,progress:re+1})),await new Promise(le=>setTimeout(le,60))}}finally{setExecState(te=>({...te||G,running:!1}))}},[s,r,_,I,O]),$=d.useCallback(()=>setExecState(B=>({...B,paused:!0})),[]),se=d.useCallback(()=>setExecState(B=>({...B,paused:!1})),[]),J=d.useCallback(()=>setExecState({running:!1,paused:!1,progress:0,total:0}),[]),U=Object.values(k).every(Boolean)||(t.checklist||[]).length===0,W=()=>{if(!c)return;const B={completed:!0,lastUpdated:new Date().toISOString(),inputValues:{...j.current},generatedGcode:_,category:t.category,checklist:{...k},results:{...K}};m(i,t.id,B),F(!0),a&&a(t.id)},ee=()=>{navigator.clipboard.writeText(_).catch(()=>{})},ie=(B=>{switch(B){case"Temperature":return Re;case"Movement":return ja;case"Quality":return ye;default:return Ie}})(t.category),pe=d.useCallback(()=>b("Instructions"),[b]),L=d.useCallback(()=>b("Visuals"),[b]),q=d.useCallback(()=>b("Configuration"),[b]),ae=d.useCallback(()=>b("Results"),[b]),xe=d.useMemo(()=>({Instructions:pe,Visuals:L,Configuration:q,Results:ae}),[pe,L,q,ae]),ce=d.useMemo(()=>({"first-layer":{good:{urls:["https://reprap.org/mediawiki/images/d/d8/First_layer_good_example.jpg","https://upload.wikimedia.org/wikipedia/commons/1/1b/3D_print_first_layer_good_example.jpg"],caption:"GOOD: Smooth lines, slight squish, even surface"},bad:{urls:["https://reprap.org/mediawiki/images/3/3b/First_layer_bad_example.jpg","https://upload.wikimedia.org/wikipedia/commons/5/57/3D_print_first_layer_bad_example.jpg"],caption:"BAD: Under-extruded/too high Z — lines separated and rough"}},"extruder-esteps":{good:{urls:["https://reprap.org/mediawiki/images/0/0e/Extrusion_good_example.jpg","https://upload.wikimedia.org/wikipedia/commons/7/7e/3D_print_good_extrusion_example.jpg"],caption:"GOOD: Accurate measured extrusion length"},bad:{urls:["https://reprap.org/mediawiki/images/4/4e/Extrusion_bad_example.jpg","https://upload.wikimedia.org/wikipedia/commons/4/4d/3D_print_under_over_extrusion_example.jpg"],caption:"BAD: Over/under extrusion — inaccurate length vs requested"}}}),[]),he=({urls:B=[],alt:Y="",caption:D="",fallbackQuery:R=""})=>{const[G,te]=d.useState(0),re=B[G];return e.jsxs("div",{children:[re?e.jsx("img",{src:re,alt:Y,className:"w-full h-56 object-cover rounded",onError:()=>te(de=>de+1)}):e.jsxs("div",{className:"w-full h-56 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded flex items-center justify-center text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500",children:["Image unavailable. ",R&&e.jsx("a",{className:"underline ml-1",href:`https://www.google.com/search?q=${encodeURIComponent(R)}`,target:"_blank",rel:"noreferrer",children:"Search examples"})]}),D&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-2",children:D})]})},Ee=d.useCallback(B=>{if(!B)return null;try{const Y=B.match(/[?&]v=([^&]+)|youtu\.be\/([^?&/]+)/),D=Y?Y[1]||Y[2]:null;return D?`https://www.youtube-nocookie.com/embed/${D}?rel=0&modestbranding=1&iv_load_policy=3&playsinline=1`:B.replace("watch?v=","embed/").replace("www.youtube.com","www.youtube-nocookie.com")+(B.includes("?")?"&":"?")+"rel=0&modestbranding=1"}catch{return B}},[]);d.useMemo(()=>e.jsx(cn,{}),[]);const Pe=d.useCallback(B=>{const{type:Y,label:D,key:R,defaultValue:G,min:te,max:re,step:de,required:le}=B,ge=S[R]??G,be=ps[R];switch(Y){case"checkbox":return e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:R,checked:ge,onChange:me=>A(R,me.target.checked),className:"h-4 w-4 text-blue-50 dark:text-blue-9000 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),e.jsxs("label",{htmlFor:R,className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:[D,be&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Global"})]})]},R);case"number":return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:R,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[D,le&&e.jsx("span",{className:"text-gray-700 dark:text-gray-300 ml-1",children:"*"}),be&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Global"})]}),e.jsx("input",{type:"number",id:R,value:ge,onChange:me=>A(R,parseFloat(me.target.value)||0),min:te,max:re,step:de,required:le,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]},R);case"text":return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:R,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[D,le&&e.jsx("span",{className:"text-gray-700 dark:text-gray-300 ml-1",children:"*"}),be&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Global"})]}),e.jsx("input",{type:"text",id:R,value:ge,onChange:me=>A(R,me.target.value),required:le,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]},R);default:return null}},[S,A]),we=B=>{const D=Array.from(B.target.files||[]).map(R=>new Promise(G=>{const te=new FileReader;te.onload=()=>G({name:R.name,dataUrl:te.result}),te.readAsDataURL(R)}));Promise.all(D).then(R=>{z(G=>({...G,photos:[...G.photos,...R]}))})};return e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(ie,{className:"h-6 w-6 text-blue-50 dark:text-blue-9000"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.title}),E&&e.jsx(fe,{className:"h-6 w-6 text-gray-500 dark:text-gray-400"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:t.description}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.category==="Temperature"||t.category==="Movement"?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":t.category==="Quality"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:t.category})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:e.jsx("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:Pn.map(B=>e.jsx("button",{onClick:xe[B],className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${x===B?"border-deep-900 text-blue-50 dark:text-blue-9000":"border-transparent text-gray-500 dark:text-gray-400 dark:text-gray-500 hover:text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:border-gray-600"}`,children:B},B))})}),x==="Configuration"&&!U&&e.jsx("div",{className:"mb-4 p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded text-sm text-light-800",children:"Complete the pre-calibration checklist in the Instructions tab before proceeding."}),x==="Instructions"&&e.jsxs("div",{className:"space-y-6",children:[t.checklist&&t.checklist.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Pre-Calibration Checklist"}),e.jsx(ba,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 dark:text-gray-500"})]}),e.jsx("div",{className:"space-y-2",children:t.checklist.map((B,Y)=>e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!k[Y],onChange:D=>H(R=>({...R,[Y]:D.target.checked}))}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:B})]},Y))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Step-by-step Guide"}),t.instructions&&t.instructions.length>0?e.jsx("ol",{className:"list-decimal list-inside space-y-2 text-sm text-gray-700 dark:text-gray-300",children:t.instructions.map((B,Y)=>e.jsx("li",{children:B},Y))}):e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"No detailed instructions available."}),t.commonIssues&&t.commonIssues.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Common Issues & Solutions"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300",children:t.commonIssues.map((B,Y)=>e.jsxs("li",{children:[e.jsxs("span",{className:"font-medium",children:[B.issue,":"]})," ",B.solution]},Y))})]}),t.expectedOutcomes&&e.jsxs("div",{className:"mt-4 p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded text-sm text-light-800",children:[e.jsx("span",{className:"font-medium",children:"Expected Outcome:"})," ",t.expectedOutcomes]})]})]}),x==="Visuals"&&e.jsxs("div",{className:"space-y-4",children:[t.videoUrl&&e.jsx("div",{className:"aspect-video bg-black rounded overflow-hidden",children:e.jsx("iframe",{className:"w-full h-full",src:Ee(t.videoUrl),title:"Calibration Tutorial",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})}),t.visualAids&&t.visualAids.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.visualAids.map((B,Y)=>e.jsxs("figure",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-2",children:[e.jsx("img",{src:B.imageUrl,alt:B.caption,className:"w-full h-48 object-cover rounded"}),e.jsx("figcaption",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:B.caption})]},Y))}),ce[t.id]&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-light-700 mb-2",children:"GOOD RESULT"}),e.jsx(he,{urls:ce[t.id].good.urls,alt:"Good result",caption:ce[t.id].good.caption,fallbackQuery:`${t.title} good result 3D print`})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"BAD RESULT"}),e.jsx(he,{urls:ce[t.id].bad.urls,alt:"Bad result",caption:ce[t.id].bad.caption,fallbackQuery:`${t.title} bad result 3D print`})]})]}),!t.videoUrl&&(!t.visualAids||t.visualAids.length===0)&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"No visual references available."})]}),x==="Configuration"&&e.jsx(Rn,{step:t,canProceed:U,execState:I,generateGcode:O,sendToPrinter:X,renderInput:Pe,pauseExec:$,resumeExec:se,abortExec:J,showGcode:v,setShowGcode:C,generatedGcode:_,copyGcode:ee,activePrinterId:i,gcodeViewMode:y,setGcodeViewMode:w}),x==="Results"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Record Measurements"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Primary Measurement"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-2 py-1",value:K.measurements.primary||"",onChange:B=>z(Y=>({...Y,measurements:{...Y.measurements,primary:B.target.value}}))})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Secondary"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-2 py-1",value:K.measurements.secondary||"",onChange:B=>z(Y=>({...Y,measurements:{...Y.measurements,secondary:B.target.value}}))})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Observation"}),e.jsx("input",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-2 py-1",value:K.measurements.observation||"",onChange:B=>z(Y=>({...Y,measurements:{...Y.measurements,observation:B.target.value}}))})]})]}),t.id==="extruder-esteps"&&e.jsxs("div",{className:"mt-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Helper:"})," ",(()=>{const B=Number(j.current.currentEsteps||0),Y=Number(j.current.extrudeDistance||0),D=Number(K.measurements.primary||0);if(B>0&&Y>0&&D>0){const R=B*Y/D;return e.jsxs(e.Fragment,{children:["Suggested E-steps: ",e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:R.toFixed(2)}),e.jsx("button",{className:"ml-2 px-2 py-1 bg-accent-medium text-white rounded",onClick:()=>P(`M92 E${R.toFixed(2)}
M500`),children:"Generate Update G-code"})]})}return e.jsx("span",{children:"Enter actual extruded mm as Primary Measurement to calculate new E-steps."})})()]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Notes"}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 h-28",value:K.notes,onChange:B=>z(Y=>({...Y,notes:B.target.value}))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Photos"}),e.jsxs("button",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded",onClick:()=>{var B;return(B=Z.current)==null?void 0:B.click()},children:[e.jsx(xa,{className:"h-4 w-4 inline mr-1"}),"Upload"]}),e.jsx("input",{ref:Z,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:we})]}),K.photos.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:K.photos.map((B,Y)=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("img",{src:B.dataUrl,alt:B.name,className:"w-full h-24 object-cover"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300 px-2 py-1 truncate",children:B.name})]},Y))}):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500",children:"No photos uploaded."})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-3 text-sm text-light-800",children:"Suggestions will appear here based on recorded measurements."})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsxs("button",{onClick:W,disabled:!U,className:`px-4 py-2 rounded-md transition-colors flex items-center space-x-2 ${U?"bg-gray-600 dark:bg-gray-300 text-white hover:bg-gray-700 dark:bg-gray-200":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 dark:text-gray-500 cursor-not-allowed"}`,children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{children:E?"Update Results":"Save & Mark Complete"})]}),E&&e.jsx("button",{className:"ml-2 px-4 py-2 bg-gray-50 dark:bg-gray-8000 dark:bg-gray-700 rounded",onClick:()=>je(!0),children:"Generate Report"})]}),ne&&e.jsx(nn,{isOpen:ne,onClose:()=>je(!1),step:t,stepData:{inputValues:j.current,results:K,generatedGcode:_,lastUpdated:new Date().toISOString()},printer:c?{id:i}:null})]})},(t,a)=>t.serialProps.status===a.serialProps.status&&t.canProceed===a.canProceed&&t.activeTab===a.activeTab&&t.isCompleted===a.isCompleted),Tt={mechanical:{label:"Mechanical",description:"Physical printer components, movement, and structural issues",color:"blue"},electrical:{label:"Electrical",description:"Wiring, sensors, heating elements, and power-related issues",color:"yellow"},firmware:{label:"Firmware",description:"Configuration, settings, and software-related issues",color:"purple"}},In={open:{label:"Open",description:"Issue reported and needs attention",color:"red"},"in-progress":{label:"In Progress",description:"Currently working on this issue",color:"yellow"},resolved:{label:"Resolved",description:"Issue has been fixed",color:"green"}},Dn={"under-extrusion":["Check extruder tension and ensure proper grip on filament","Calibrate E-Steps to ensure accurate extrusion amounts","Increase nozzle temperature by 5-10°C","Check for partial nozzle clogs","Verify filament diameter settings in slicer","Check for worn extruder gear"],"under extrusion":["Check extruder tension and ensure proper grip on filament","Calibrate E-Steps to ensure accurate extrusion amounts","Increase nozzle temperature by 5-10°C","Check for partial nozzle clogs","Verify filament diameter settings in slicer"],"over-extrusion":["Reduce flow rate in slicer by 5-10%","Lower nozzle temperature by 5-10°C","Recalibrate E-Steps (may be too high)","Check linear advance settings","Verify filament diameter is correct"],"over extrusion":["Reduce flow rate in slicer by 5-10%","Lower nozzle temperature by 5-10°C","Recalibrate E-Steps (may be too high)","Check linear advance settings"],stringing:["Increase retraction distance (try 0.5-1mm more)","Increase retraction speed","Lower nozzle temperature by 5-10°C",'Enable "Wipe Nozzle" in slicer settings',"Reduce print speed for travel moves","Check for worn PTFE tube in Bowden setups"],oozing:["Increase retraction distance","Lower nozzle temperature","Enable retraction at layer change","Check nozzle for damage or wear"],"layer adhesion":["Increase nozzle temperature by 5-10°C","Reduce cooling fan speed for first few layers","Increase print speed slightly to improve heat transfer","Check for drafts affecting the print area","Clean the nozzle and check for partial clogs"],delamination:["Increase bed and nozzle temperatures","Reduce cooling fan speed","Check for environmental temperature fluctuations","Increase infill percentage for structural parts"],"bed adhesion":["Level the bed more precisely","Clean bed surface with isopropyl alcohol","Adjust first layer height (try 0.1-0.3mm)","Increase bed temperature by 5-10°C","Use adhesion aids (hairspray, glue stick, or specialized bed adhesives)","Check first layer extrusion width settings"],warping:["Increase bed temperature","Use a heated enclosure or reduce drafts","Apply adhesion aids to bed surface","Add brim or raft to print","Check bed level and first layer height"],"layer shifting":["Check belt tension (should be tight but not over-tensioned)","Verify stepper motor connections","Reduce print speed and acceleration","Check for mechanical obstructions in axis movement","Verify stepper driver current settings","Check for loose pulleys or set screws"],ghosting:["Reduce print speed and acceleration","Tighten frame connections and check for mechanical looseness","Add dampers to stepper motors","Check belt tension","Enable S-curve acceleration if supported"],ringing:["Reduce print speed, especially for outer perimeters","Lower acceleration and jerk settings","Check frame rigidity and tighten loose components","Enable pressure advance/linear advance","Consider adding anti-vibration feet to printer"],"temperature fluctuation":["Run PID autotune for hotend and bed","Check thermistor connections","Verify heater cartridge is properly secured","Check for loose wiring","Ensure adequate power supply capacity"],"thermal runaway":["Check thermistor and heater connections immediately","Verify thermistor is properly secured to hotend","Check for damaged wiring","Test heater cartridge resistance","Ensure thermal protection is enabled in firmware"],grinding:["Check extruder tension (may be too tight)","Verify filament path is clear","Check for nozzle clogs","Increase nozzle temperature","Check extruder gear for wear or damage"],clicking:["Check for nozzle clogs","Reduce extruder tension slightly","Increase nozzle temperature","Check filament diameter and quality","Verify correct steps/mm calibration"],jamming:["Check for nozzle clogs and perform cold pull","Verify PTFE tube is properly seated (Bowden setups)","Check for heat creep in hotend","Ensure proper filament storage (dry conditions)","Check extruder alignment and filament path"],overheating:["Check part cooling fan operation","Verify hotend cooling fan is working","Reduce print speed for small features","Add minimum layer time settings","Check for adequate ventilation around printer"],curling:["Increase part cooling fan speed","Reduce nozzle temperature","Add supports for overhanging features","Reduce print speed for overhangs","Check cooling fan duct alignment"]};function Ln(t,a){const s=`${t} ${a}`.toLowerCase(),r=new Set;Object.entries(Dn).forEach(([n,i])=>{s.includes(n)&&i.forEach(c=>r.add(c))});const l=Array.from(r);return l.length===0?["Check basic printer maintenance (bed level, belt tension, cleanliness)","Verify slicer settings match printer specifications","Ensure filament quality and proper storage","Check for loose connections and mechanical issues","Review recent changes to printer or settings"]:l.slice(0,8)}function nt(t){return Tt[t]||{label:"Unknown",description:"Unknown category",color:"gray"}}function Ct(t){return In[t]||{label:"Unknown",description:"Unknown status",color:"gray"}}function bt(t){const a=new Date(t),r=new Date-a,l=Math.floor(r/6e4),n=Math.floor(r/36e5),i=Math.floor(r/864e5);return l<1?"Just now":l<60?`${l} minute${l!==1?"s":""} ago`:n<24?`${n} hour${n!==1?"s":""} ago`:i<7?`${i} day${i!==1?"s":""} ago`:a.toLocaleDateString()}function On(t){if(!t||t.length===0)return{total:0,open:0,inProgress:0,resolved:0,byCategory:{mechanical:0,electrical:0,firmware:0}};const a={total:t.length,open:0,inProgress:0,resolved:0,byCategory:{mechanical:0,electrical:0,firmware:0}};return t.forEach(s=>{s.status==="open"?a.open++:s.status==="in-progress"?a.inProgress++:s.status==="resolved"&&a.resolved++,a.byCategory.hasOwnProperty(s.category)&&a.byCategory[s.category]++}),a}const Fn=({onIssueSelect:t})=>{const[a,s]=d.useState(!1),[r,l]=d.useState(""),[n,i]=d.useState(""),[c,o]=d.useState(""),[m,u]=d.useState({category:"",title:"",description:""}),{getActivePrinter:x,addIssue:f}=ue(),b=x();if(!b)return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No active printer selected"})]});const N=b.issues||[],p=On(N),g=N.filter(P=>{const E=!r||P.title.toLowerCase().includes(r.toLowerCase())||P.description.toLowerCase().includes(r.toLowerCase()),F=!n||P.category===n,v=!c||P.status===c;return E&&F&&v}).sort((P,E)=>new Date(E.timestamp)-new Date(P.timestamp)),j=()=>{if(!m.category||!m.title.trim()){alert("Please fill in all required fields");return}f(b.id,{category:m.category,title:m.title.trim(),description:m.description.trim()}),u({category:"",title:"",description:""}),s(!1)},S=P=>{switch(P){case"open":return e.jsx(Ne,{className:"h-4 w-4"});case"in-progress":return e.jsx(ke,{className:"h-4 w-4"});case"resolved":return e.jsx(fe,{className:"h-4 w-4"});default:return e.jsx(Ne,{className:"h-4 w-4"})}},M=P=>{const E=Ct(P),F="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";switch(E.color){case"red":return`${F} bg-red-100 text-red-800`;case"yellow":return`${F} bg-yellow-100 text-yellow-800`;case"green":return`${F} bg-green-100 text-green-800`;default:return`${F} bg-gray-100 text-gray-800`}},_=P=>{const E=nt(P),F="inline-flex items-center px-2 py-1 rounded text-xs font-medium";switch(E.color){case"blue":return`${F} bg-blue-100 text-blue-800`;case"yellow":return`${F} bg-yellow-100 text-yellow-800`;case"purple":return`${F} bg-purple-100 text-purple-800`;default:return`${F} bg-gray-100 text-gray-800`}};return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Issue Log"}),e.jsxs("p",{className:"text-gray-600",children:["Track and manage printer issues for ",b.name]})]}),e.jsxs("button",{onClick:()=>s(!0),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Log New Issue"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(aa,{className:"h-8 w-8 text-gray-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Issues"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:p.total})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Open"}),e.jsx("p",{className:"text-2xl font-semibold text-red-600",children:p.open})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ke,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-semibold text-yellow-600",children:p.inProgress})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Resolved"}),e.jsx("p",{className:"text-2xl font-semibold text-green-600",children:p.resolved})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search issues...",value:r,onChange:P=>l(P.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{className:"h-4 w-4 text-gray-500"}),e.jsxs("select",{value:n,onChange:P=>i(P.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Categories"}),Object.entries(Tt).map(([P,E])=>e.jsx("option",{value:P,children:E.label},P))]})]}),e.jsx("div",{children:e.jsxs("select",{value:c,onChange:P=>o(P.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:g.length===0?e.jsx("div",{className:"text-center py-12",children:N.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No issues logged yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start tracking printer issues to improve your printing experience"}),e.jsx("button",{onClick:()=>s(!0),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Log Your First Issue"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No issues match your filters"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria"})]})}):e.jsx("div",{className:"divide-y divide-gray-200",children:g.map(P=>e.jsx("div",{onClick:()=>t&&t(P),className:"p-6 hover:bg-gray-50 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("span",{className:_(P.category),children:[e.jsx(Os,{className:"h-3 w-3 mr-1"}),nt(P.category).label]}),e.jsxs("span",{className:M(P.status),children:[S(P.status),e.jsx("span",{className:"ml-1",children:Ct(P.status).label})]})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:P.title}),P.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:P.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ks,{className:"h-4 w-4 mr-1"}),bt(P.timestamp)]}),P.followUpActions&&P.followUpActions.length>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),P.followUpActions.filter(E=>E.completed).length,"/",P.followUpActions.length," actions completed"]})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(ka,{className:"h-5 w-5 text-gray-400"})})]})},P.id))})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Log New Issue"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:m.category,onChange:P=>u(E=>({...E,category:P.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),Object.entries(Tt).map(([P,E])=>e.jsx("option",{value:P,children:E.label},P))]}),m.category&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:nt(m.category).description})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:m.title,onChange:P=>u(E=>({...E,title:P.target.value})),placeholder:"Brief description of the issue",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:m.description,onChange:P=>u(E=>({...E,description:P.target.value})),placeholder:"Detailed description of the issue, what you were printing, settings used, etc.",rows:4,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>s(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:j,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",children:"Log Issue"})]})]})})]})},Un=({issue:t,onBack:a})=>{var H,K;const[s,r]=d.useState(!1),[l,n]=d.useState({title:t.title,description:t.description,category:t.category,status:t.status}),[i,c]=d.useState(""),[o,m]=d.useState(!1),[u,x]=d.useState([]),{getActivePrinter:f,updateIssue:b,deleteIssue:N,addFollowUpAction:p,updateFollowUpAction:h}=ue(),g=f();if(d.useEffect(()=>{n({title:t.title,description:t.description,category:t.category,status:t.status})},[t]),!g)return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No active printer selected"})]});const j=()=>{b(g.id,t.id,l),r(!1)},S=()=>{n({title:t.title,description:t.description,category:t.category,status:t.status}),r(!1)},M=()=>{i.trim()&&(p(g.id,t.id,i.trim()),c(""))},_=(z,Z)=>{h(g.id,t.id,z,Z)},P=()=>{const z=Ln(t.title,t.description);x(z),m(!0)},E=z=>{p(g.id,t.id,z)},F=()=>{window.confirm("Are you sure you want to delete this issue? This action cannot be undone.")&&(N(g.id,t.id),a())},v=z=>{switch(z){case"open":return e.jsx(Ne,{className:"h-5 w-5"});case"in-progress":return e.jsx(ke,{className:"h-5 w-5"});case"resolved":return e.jsx(fe,{className:"h-5 w-5"});default:return e.jsx(Ne,{className:"h-5 w-5"})}},C=z=>{const Z=Ct(z),ne="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(Z.color){case"red":return`${ne} bg-red-100 text-red-800`;case"yellow":return`${ne} bg-yellow-100 text-yellow-800`;case"green":return`${ne} bg-green-100 text-green-800`;default:return`${ne} bg-gray-100 text-gray-800`}},y=z=>{const Z=nt(z),ne="inline-flex items-center px-3 py-1 rounded text-sm font-medium";switch(Z.color){case"blue":return`${ne} bg-blue-100 text-blue-800`;case"yellow":return`${ne} bg-yellow-100 text-yellow-800`;case"purple":return`${ne} bg-purple-100 text-purple-800`;default:return`${ne} bg-gray-100 text-gray-800`}},w=((H=t.followUpActions)==null?void 0:H.filter(z=>z.completed).length)||0,k=((K=t.followUpActions)==null?void 0:K.length)||0;return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:a,className:"flex items-center text-gray-600 hover:text-gray-900 mb-4 transition-colors",children:[e.jsx(Wt,{className:"h-4 w-4 mr-2"}),"Back to Issue Log"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs("span",{className:y(t.category),children:[e.jsx(Os,{className:"h-4 w-4 mr-1"}),nt(t.category).label]}),e.jsxs("span",{className:C(t.status),children:[v(t.status),e.jsx("span",{className:"ml-2",children:Ct(t.status).label})]})]}),s?e.jsx("input",{type:"text",value:l.title,onChange:z=>n(Z=>({...Z,title:z.target.value})),className:"text-2xl font-bold text-gray-900 border-b-2 border-blue-500 bg-transparent w-full focus:outline-none"}):e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.title})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:P,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{children:"Analyze Issue"})]}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center space-x-2",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:F,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[e.jsx(Rt,{className:"h-4 w-4"}),e.jsx("span",{children:"Delete"})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Save"})]}),e.jsxs("button",{onClick:S,className:"bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition-colors flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Cancel"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Issue Details"}),s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{value:l.category,onChange:z=>n(Z=>({...Z,category:z.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:Object.entries(Tt).map(([z,Z])=>e.jsx("option",{value:z,children:Z.label},z))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:l.status,onChange:z=>n(Z=>({...Z,status:z.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:l.description,onChange:z=>n(Z=>({...Z,description:z.target.value})),rows:6,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.description?e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:t.description}):e.jsx("p",{className:"text-gray-500 italic",children:"No description provided"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Follow-up Actions"}),k>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[w,"/",k," completed"]})]}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[e.jsx("input",{type:"text",value:i,onChange:z=>c(z.target.value),placeholder:"Add a follow-up action...",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:z=>z.key==="Enter"&&M()}),e.jsx("button",{onClick:M,disabled:!i.trim(),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:e.jsx(Qe,{className:"h-4 w-4"})})]}),t.followUpActions&&t.followUpActions.length>0?e.jsx("div",{className:"space-y-2",children:t.followUpActions.map(z=>e.jsxs("div",{className:`flex items-start space-x-3 p-3 rounded-lg border ${z.completed?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:[e.jsx("button",{onClick:()=>_(z.id,!z.completed),className:`mt-0.5 ${z.completed?"text-green-600 hover:text-green-700":"text-gray-400 hover:text-gray-600"}`,children:z.completed?e.jsx(fe,{className:"h-5 w-5"}):e.jsx("div",{className:"h-5 w-5 border-2 border-gray-300 rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm ${z.completed?"line-through text-gray-500":"text-gray-900"}`,children:z.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Added ",bt(z.timestamp)]})]})]},z.id))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Ca,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No follow-up actions yet"}),e.jsx("p",{className:"text-sm",children:"Add actions to track your progress on this issue"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Issue Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ks,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:bt(t.timestamp)})]}),t.resolvedTimestamp&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(fe,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Resolved:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:bt(t.resolvedTimestamp)})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Fs,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Printer:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:g.name})]})]})]}),k>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Progress"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Actions Completed"}),e.jsxs("span",{className:"text-gray-900",children:[w,"/",k]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${k>0?w/k*100:0}%`}})}),e.jsx("p",{className:"text-xs text-gray-500",children:w===k&&k>0?"All actions completed!":`${k-w} actions remaining`})]})]})]})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(rt,{className:"h-5 w-5 mr-2 text-yellow-500"}),"Issue Analysis Results"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Based on your issue description, here are some suggested solutions:"}),e.jsx("div",{className:"space-y-2",children:u.map((z,Z)=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-900 flex-1",children:z}),e.jsx("button",{onClick:()=>E(z),className:"ml-3 text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Add as Action"})]},Z))}),u.length===0&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(rt,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No specific suggestions found for this issue type"}),e.jsx("p",{className:"text-sm",children:"Try adding more details to the description for better analysis"})]})]})]})})]})},Bn=()=>{const[t,a]=d.useState(null),s=l=>{a(l)},r=()=>{a(null)};return t?e.jsx(Un,{issue:t,onBack:r}):e.jsx(Fn,{onIssueSelect:s})};function gs(t,a=""){if(!t||typeof t!="string")return{name:a||"Unknown",type:"quality",settings:{},metadata:{},raw:{}};const{sections:s,raw:r}=zn(t),l=s.general||{},n=s.metadata||{},i=s.values||s||{},c=n.name||l.name||Gn(a)||"Imported Profile",o=Hn(n.type||l.type||Vn(a)||"quality"),m={...i};return{name:c,type:o,settings:m,metadata:{...l,...n},raw:r}}function zn(t){const a={},s={lines:[]};let r=null;const l=t.split(/\r?\n/);for(let n=0;n<l.length;n+=1){let i=l[n];s.lines.push(i);const c=i.trim();if(!c||c.startsWith(";")||c.startsWith("#"))continue;const o=c.match(/^\[([^\]]+)\]$/);if(o){r=o[1].toLowerCase(),a[r]||(a[r]={});continue}const m=c.match(/^(.*?)=(.*)$/);if(m){const u=m[1].trim(),x=m[2].trim(),f=$n(x);r?a[r][u]=f:(a.values||(a.values={}),a.values[u]=f)}}return{sections:a,raw:s}}function $n(t){const a=t.replace(/^"|"$/g,"").replace(/^'|'$/g,"");if(/^(true|false)$/i.test(a))return/^true$/i.test(a);if(/^[+-]?\d+(\.\d+)?$/.test(a))return Number(a);if(a.includes(",")&&!a.includes(" ")){const s=a.split(",").map(r=>r.trim()).filter(Boolean);return s.every(r=>/^[+-]?\d+(\.\d+)?$/.test(r))?s.map(Number):s.every(r=>/^(true|false)$/i.test(r))?s.map(r=>/^true$/i.test(r)):s}return a}function Gn(t){return t?(t.split(/[\\/]/).pop()||"").replace(/\.(cfg|curaprofile)$/i,"").replace(/[_-]+/g," "):""}function Vn(t){const a=(t||"").toLowerCase();return a.includes("material")?"material":a.includes("print")?"print":(a.includes("quality"),"quality")}function Hn(t){const a=String(t).toLowerCase();return["quality","material","print"].includes(a)?a:"quality"}const Xn=t=>/\.(cfg|curaprofile)$/i.test(t),Zn=({isOpen:t,onClose:a,onImported:s})=>{const{getActivePrinter:r,addProfile:l}=ue(),n=r(),[i,c]=d.useState([]),[o,m]=d.useState({}),[u,x]=d.useState(null),[f,b]=d.useState(!1),[N,p]=d.useState(!1),[h,g]=d.useState(null),[j,S]=d.useState("");d.useEffect(()=>{t||(c([]),m({}),x(null),b(!1),p(!1),g(null),S(""))},[t]);const M=d.useMemo(()=>i.filter(C=>Xn(C.name)),[i]),_=d.useMemo(()=>M.filter(C=>!!o[C.name]),[M,o]),P=C=>{const y=Array.from(C.target.files||[]);c(y)},E=C=>{m(y=>({...y,[C.name]:!y[C.name]}))},F=async C=>{try{b(!0);const y=await C.text(),w=gs(y,C.name);x({file:C,parsed:w})}catch{S("Failed to load preview")}finally{b(!1)}},v=async()=>{var y;if(!n)return;if(_.length===0){S("Select at least one profile to import");return}S(""),p(!0);const C={total:_.length,success:0,failed:0,details:[]};for(const w of _)try{const k=await w.text(),H=gs(k,w.name),K={name:H.name,type:H.type,settings:H.settings,isActive:!1},z=((y=n.slicerProfiles)==null?void 0:y.profiles)||[];let Z=K.name,ne=1;for(;z.some(je=>je.name.toLowerCase()===Z.toLowerCase());)Z=`${K.name} (${ne})`,ne+=1;await l(n.id,{...K,name:Z}),C.success+=1,C.details.push({file:w.name,status:"ok"})}catch(k){C.failed+=1,C.details.push({file:w.name,status:"error",message:String((k==null?void 0:k.message)||k)})}g(C),p(!1),s&&s(C)};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Cura Profiles"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:e.jsx(Ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Cura profiles folder"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"file",webkitdirectory:"true",directory:"true",multiple:!0,onChange:P,className:"hidden",id:"cura-folder-input",accept:".cfg,.curaprofile"}),e.jsxs("label",{htmlFor:"cura-folder-input",className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer",children:[e.jsx(ua,{className:"h-4 w-4 mr-2"})," Browse Folder"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Tip: AppData/Roaming/cura/",e.jsx("i",{children:"version"}),"/quality"]})]})]}),e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:["Found Files (",M.length,")"]}),e.jsx("div",{className:"max-h-64 overflow-auto divide-y",children:M.length===0?e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No .cfg or .curaprofile files found"}):M.map(C=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:!!o[C.name],onChange:()=>E(C)}),e.jsx(Te,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-800",children:C.name})]}),e.jsx("button",{onClick:()=>F(C),className:"text-blue-600 hover:text-blue-700 text-sm",children:"Preview"})]},C.name))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Selected: ",_.length]}),e.jsx("button",{onClick:v,disabled:N||_.length===0,className:`px-4 py-2 rounded-md text-white ${N?"bg-gray-400":"bg-green-600 hover:bg-green-700"}`,children:N?e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(is,{className:"h-4 w-4 mr-2 animate-spin"})," Importing..."]}):"Import Selected"})]}),h&&e.jsxs("div",{className:"mt-3 p-3 border rounded-md bg-gray-50 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(fe,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:["Imported ",h.success," of ",h.total," (",h.failed," failed)"]})]}),e.jsx("div",{className:"max-h-32 overflow-auto divide-y",children:h.details.map((C,y)=>e.jsxs("div",{className:"py-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-800",children:C.file}),e.jsx("span",{className:`text-xs ${C.status==="ok"?"text-green-700":"text-red-700"}`,children:C.status==="ok"?"OK":`Error: ${C.message||"Malformed"}`})]},y))})]}),j&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 text-red-700 text-sm rounded border border-red-200 flex items-center",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"})," ",j]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b flex items-center justify-between",children:[e.jsx("span",{children:"Preview"}),f&&e.jsx(is,{className:"h-4 w-4 animate-spin text-gray-500"})]}),e.jsx("div",{className:"max-h-96 overflow-auto p-3 text-xs",children:u?e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 mb-2",children:[u.parsed.name," ",e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:u.parsed.type})]}),e.jsx("div",{className:"text-gray-600 mb-2",children:u.file.name}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(u.parsed.settings).slice(0,50).map(([C,y])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700 mr-2 truncate",children:C}),e.jsx("span",{className:"text-gray-500 max-w-[60%] truncate",children:String(Array.isArray(y)?y.join(","):y)})]},C)),Object.keys(u.parsed.settings).length>50&&e.jsx("div",{className:"text-gray-400",children:"…and more"})]})]}):e.jsx("div",{className:"text-gray-500",children:"Select a profile and click Preview."})})]})})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex items-center justify-end",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"Close"})})]})}):null},Ot={Quality:{layer_height:{type:"number",label:"Layer Height (mm)",step:.02,min:.04,max:1,description:"Height of each printed layer.",recommend:{default:.2}},line_width:{type:"number",label:"Line Width (mm)",step:.01,min:.1,max:1.2,description:"Width of extruded lines.",recommend:{default:.4}},wall_line_count:{type:"number",label:"Wall Line Count",step:1,min:0,max:10,description:"Number of perimeters.",recommend:{strong_parts:4,default:2}}},Speed:{print_speed:{type:"number",label:"Print Speed (mm/s)",step:1,min:5,max:300,description:"Default print speed.",recommend:{default:60,high_speed:150}},travel_speed:{type:"number",label:"Travel Speed (mm/s)",step:1,min:10,max:500,description:"Speed for non-printing moves.",recommend:{default:150}},infill_speed:{type:"number",label:"Infill Speed (mm/s)",step:1,min:5,max:300,description:"Speed for infill.",recommend:{default:80}}},Material:{material_print_temperature:{type:"number",label:"Printing Temperature (°C)",step:1,min:150,max:300,description:"Nozzle temperature.",recommend:{PLA:200,PETG:240}},material_bed_temperature:{type:"number",label:"Bed Temperature (°C)",step:1,min:0,max:120,description:"Bed temperature.",recommend:{PLA:60,PETG:80}},retraction_enable:{type:"boolean",label:"Enable Retraction",description:"Retract filament to reduce stringing."},retraction_distance:{type:"number",label:"Retraction Distance (mm)",step:.1,min:0,max:20,description:"Amount of filament to retract.",recommend:{direct:1.5,bowden:6}},retraction_speed:{type:"number",label:"Retraction Speed (mm/s)",step:1,min:1,max:100,description:"Retraction speed."}},Cooling:{cool_fan_enabled:{type:"boolean",label:"Enable Cooling Fan",description:"Use part cooling fan."},cool_fan_speed:{type:"number",label:"Fan Speed (%)",step:5,min:0,max:100,description:"Default fan speed."}},Support:{support_enable:{type:"boolean",label:"Enable Support",description:"Generate support structures."},support_overhang_angle:{type:"number",label:"Support Overhang Angle (°)",step:1,min:0,max:90,description:"Max overhang angle without support."},support_pattern:{type:"enum",label:"Support Pattern",options:["lines","grid","zigzag","gyroid"],description:"Support infill pattern."}},Adhesion:{adhesion_type:{type:"enum",label:"Build Plate Adhesion",options:["none","brim","raft","skirt"],description:"Adhesion helper."},brim_width:{type:"number",label:"Brim Width (mm)",step:1,min:0,max:50,description:"Brim width around model."}}};function Yn(t){const a={},s=(n,i,c)=>{const o=t[n];if(!(o==null||o==="")){if(typeof o!="number"||Number.isNaN(o)){a[n]="Must be a number";return}i!==void 0&&o<i&&(a[n]=`Must be ≥ ${i}`),!a[n]&&c!==void 0&&o>c&&(a[n]=`Must be ≤ ${c}`)}},r=n=>{const i=t[n];i!==void 0&&typeof i!="boolean"&&(a[n]="Must be true/false")},l=(n,i)=>{const c=t[n];c===void 0||c===""||i.includes(c)||(a[n]=`Must be one of: ${i.join(", ")}`)};return s("layer_height",.04,1),s("line_width",.1,1.2),s("wall_line_count",0,20),s("print_speed",5,300),s("travel_speed",10,500),s("infill_speed",5,300),s("material_print_temperature",150,300),s("material_bed_temperature",0,120),r("retraction_enable"),s("retraction_distance",0,20),s("retraction_speed",1,100),r("cool_fan_enabled"),s("cool_fan_speed",0,100),r("support_enable"),s("support_overhang_angle",0,90),l("support_pattern",["lines","grid","zigzag","gyroid"]),l("adhesion_type",["none","brim","raft","skirt"]),s("brim_width",0,50),a}function qn(t,a={}){const s=[],r=(i,c,o)=>s.push({key:i,message:c,suggestion:o,level:"warning"});t.iron_enable&&(t.infill_sparse_density??20)<10&&r("iron_enable","Ironing with very low infill can waste time with minimal benefit.","Increase infill density or disable ironing for speed.");const l=a.maxPrintSpeed??150;typeof t.print_speed=="number"&&t.print_speed>l&&r("print_speed",`Print speed ${t.print_speed} exceeds printer max ${l}.`,`Reduce print_speed ≤ ${l}.`);const n=a.maxBedTemp??110;return typeof t.material_bed_temperature=="number"&&t.material_bed_temperature>n&&r("material_bed_temperature",`Bed temp exceeds capability (${n}°C).`,`Use ≤ ${n}°C or upgrade bed insulation.`),s}function Wn(t){const a=[],s=(n,i,c)=>a.push({key:n,message:i,suggestion:c,level:"strength"});(t.wall_line_count??2)<2&&s("wall_line_count","Low wall count reduces part strength.","Use ≥ 3 walls for stronger parts.");const r=t.infill_pattern||"grid",l=t.infill_sparse_density??20;return l<15&&s("infill_sparse_density","Low infill density weakens parts.","Use ≥ 25% for functional parts."),["lines","zigzag"].includes(r)&&l<30&&s("infill_pattern","Selected infill pattern provides low shear strength at low density.","Use gyroid/cubic or increase density."),a}function Qn(t){const a=[],s=(c,o,m)=>a.push({key:c,message:o,suggestion:m,level:"speed"}),r=t.print_speed??60,l=t.layer_height??.2,n=t.wall_line_count??2,i=(n*.4+1)*(.2/l)*(60/r);return r<30&&s("print_speed","Very low print speed increases print time.","Increase to 50-70 mm/s if quality allows."),l<.12&&s("layer_height","Very low layer height increases print time significantly.","Use 0.16-0.24 mm for general prints."),n>4&&s("wall_line_count","High wall count increases time and material.","Use 2-3 walls unless strength is critical."),{estimates:{estTimeFactor:i},hints:a}}function Kn(t,a){const s=Yn(t),r=qn(t,a),l=Wn(t),n=Qn(t);return{errors:s,conflicts:r,strength:l,speed:n}}const Jn=({checked:t,onChange:a})=>e.jsx("button",{type:"button",onClick:()=>a(!t),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${t?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-4":"translate-x-1"}`})}),ei=({isOpen:t,onClose:a,profile:s,onSave:r})=>{var P;const l=qt(),n=Lr(),i=l(),[c,o]=d.useState((s==null?void 0:s.settings)||{}),[m,u]=d.useState(""),[x,f]=d.useState("all"),[b,N]=d.useState("all"),[p,h]=d.useState({errors:{},conflicts:[],strength:[],speed:{estimates:{},hints:[]}});d.useEffect(()=>{o((s==null?void 0:s.settings)||{})},[s]),d.useEffect(()=>{const E=(i==null?void 0:i.printerCapabilities)||{};h(Kn(c,E))},[c,i]),d.useMemo(()=>Object.keys(Ot),[]);const g=d.useMemo(()=>{const E=m.toLowerCase(),F=(y,w)=>E?y.toLowerCase().includes(E)||(w.label||"").toLowerCase().includes(E)||(w.description||"").toLowerCase().includes(E):!0,v=y=>x==="all"||y.type===x,C={};for(const[y,w]of Object.entries(Ot)){if(b!=="all"&&b!==y)continue;const k=Object.entries(w).filter(([H,K])=>F(H,K)&&v(K));k.length&&(C[y]=k)}return C},[m,x,b]);if(!t)return null;const j=(E,F,v)=>{o(C=>({...C,[E]:v}))},S=(E,F)=>{const v=c[E],C=p.errors[E];switch(F.type){case"boolean":return e.jsx(Jn,{checked:!!v,onChange:y=>j(E,F,y)});case"enum":return e.jsxs("select",{value:v??"",onChange:y=>j(E,F,y.target.value),className:`w-full px-2 py-1 border rounded text-sm ${C?"border-red-300 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select…"}),(F.options||[]).map(y=>e.jsx("option",{value:y,children:y},y))]});case"number":return e.jsxs("div",{children:[e.jsx("input",{type:"number",step:F.step??"any",min:F.min,max:F.max,value:v??"",onChange:y=>j(E,F,y.target.value===""?"":Number(y.target.value)),className:`w-full px-2 py-1 border rounded text-sm ${C?"border-red-300 bg-red-50":"border-gray-300"}`}),C&&e.jsxs("div",{className:"mt-1 text-[11px] text-red-600 flex items-center",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"})," ",C]})]});default:return e.jsx("input",{type:"text",value:v??"",onChange:y=>j(E,F,y.target.value),className:`w-full px-2 py-1 border rounded text-sm ${C?"border-red-300 bg-red-50":"border-gray-300"}`})}},M=Object.keys(p.errors).length>0,_=()=>{if(!s||M)return;const E={settings:c};n(i.id,s.id,E),r&&r(E),a()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex",children:e.jsxs("div",{className:"bg-white w-full h-full md:rounded-none overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Edit Profile: ",s==null?void 0:s.name]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"h-4 w-4 text-gray-400 absolute left-2 top-2"}),e.jsx("input",{className:"pl-7 pr-2 py-1 border rounded text-sm w-64",placeholder:"Search settings…",value:m,onChange:E=>u(E.target.value)})]}),e.jsxs("select",{value:b,onChange:E=>N(E.target.value),className:"border rounded text-sm px-2 py-1",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.keys(Ot).map(E=>e.jsx("option",{value:E,children:E},E))]}),e.jsxs("select",{value:x,onChange:E=>f(E.target.value),className:"border rounded text-sm px-2 py-1",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"boolean",children:"Boolean"}),e.jsx("option",{value:"enum",children:"Enum"}),e.jsx("option",{value:"string",children:"String"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"hidden md:flex items-center text-xs text-gray-600",children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Est factor: ",((P=p.speed.estimates.estTimeFactor)==null?void 0:P.toFixed(2))??"-"]}),e.jsx("button",{onClick:a,className:"px-3 py-1.5 bg-gray-100 rounded text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:M,className:`px-3 py-1.5 rounded ${M?"bg-gray-300 text-gray-600":"bg-blue-600 text-white"}`,children:"Save"})]})]}),e.jsxs("div",{className:"px-4 pt-3 grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Conflicts"}),p.conflicts.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"No conflicts detected."}):e.jsx("ul",{className:"space-y-1 text-xs",children:p.conflicts.map((E,F)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Ne,{className:"h-3 w-3 text-yellow-600 mr-1 mt-0.5"})," ",e.jsxs("span",{children:[e.jsx("strong",{children:E.key}),": ",E.message," ",E.suggestion&&e.jsxs("em",{className:"text-gray-600",children:["(",E.suggestion,")"]})]})]},F))})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Strength Checks"}),p.strength.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"No strength issues."}):e.jsx("ul",{className:"space-y-1 text-xs",children:p.strength.map((E,F)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Ne,{className:"h-3 w-3 text-orange-600 mr-1 mt-0.5"})," ",e.jsxs("span",{children:[e.jsx("strong",{children:E.key}),": ",E.message," ",e.jsxs("em",{className:"text-gray-600",children:["(",E.suggestion,")"]})]})]},F))})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Speed Hints"}),p.speed.hints.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"No speed hints."}):e.jsx("ul",{className:"space-y-1 text-xs",children:p.speed.hints.map((E,F)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(Ne,{className:"h-3 w-3 text-blue-600 mr-1 mt-0.5"})," ",e.jsxs("span",{children:[e.jsx("strong",{children:E.key}),": ",E.message," ",e.jsxs("em",{className:"text-gray-600",children:["(",E.suggestion,")"]})]})]},F))})]})]}),e.jsx("div",{className:"p-4 h-[calc(100%-200px)] overflow-auto",children:Object.entries(g).length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No settings match your filters."}):Object.entries(g).map(([E,F])=>e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:E}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:F.map(([v,C])=>e.jsxs("div",{className:`border rounded p-3 hover:shadow-sm transition ${p.errors[v]?"border-red-300":"border-gray-200"}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"mr-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:C.label||v}),C.description&&e.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:C.description}),C.recommend&&e.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:Object.entries(C.recommend).map(([y,w])=>e.jsxs("span",{className:"mr-2",children:[y,": ",e.jsx("span",{className:"text-gray-800",children:String(w)})]},y))})]})}),e.jsx("div",{className:"mt-2",children:S(v,C)})]},v))})]},E))})]})})};function ti(t,a){var l,n;const s=Array.from(new Set([...Object.keys(t.settings||{}),...Object.keys(a.settings||{})])),r=[];for(const i of s){const c=(l=t.settings)==null?void 0:l[i],o=(n=a.settings)==null?void 0:n[i];JSON.stringify(c)!==JSON.stringify(o)&&r.push({key:i,from:c,to:o})}return r}const fs=({isOpen:t,onClose:a,leftProfile:s,rightProfile:r,onMerge:l})=>{const n=d.useMemo(()=>ti(s,r),[s,r]),[i,c]=d.useState({});if(!t)return null;const o=u=>c(x=>({...x,[u]:!x[u]})),m=()=>{const u={};n.forEach(x=>{i[x.key]&&(u[x.key]=x.to)}),l(u)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded w-full max-w-3xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[e.jsx("div",{className:"font-semibold",children:"Compare Profiles"}),e.jsx("button",{onClick:a,children:e.jsx(Ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-12 text-sm font-medium text-gray-700 mb-2",children:[e.jsx("div",{className:"col-span-5",children:s==null?void 0:s.name}),e.jsx("div",{className:"col-span-2 text-center"}),e.jsx("div",{className:"col-span-5 text-right",children:r==null?void 0:r.name})]}),e.jsxs("div",{className:"max-h-80 overflow-auto divide-y",children:[n.map(u=>e.jsxs("label",{className:"grid grid-cols-12 items-center py-2 gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!i[u.key],onChange:()=>o(u.key)}),e.jsx("div",{className:"col-span-4 truncate",title:u.key,children:u.key}),e.jsx("div",{className:"col-span-3 truncate text-gray-600",title:String(u.from),children:String(u.from)}),e.jsx("div",{className:"col-span-1 flex justify-center",children:e.jsx(zt,{className:"h-4 w-4"})}),e.jsx("div",{className:"col-span-3 truncate text-gray-800",title:String(u.to),children:String(u.to)})]},u.key)),n.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No differences"})]})]}),e.jsxs("div",{className:"px-4 py-2 border-t flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1.5 bg-gray-100 rounded",children:"Close"}),e.jsx("button",{onClick:m,className:"px-3 py-1.5 bg-blue-600 text-white rounded",disabled:Object.keys(i).length===0,children:"Merge selected →"})]})]})})},es={quality:{id:"high-quality",name:"High Quality",description:"Best visual quality with fine details",category:"Quality",icon:"🎯",settings:{layer_height:.15,infill_sparse_density:20,speed_print:50,speed_infill:80,speed_wall_0:25,speed_wall_x:40,wall_thickness:1.2,top_thickness:.8,bottom_thickness:.8,support_enable:!0,support_angle:45,retraction_enable:!0,retraction_amount:5,retraction_speed:45,adhesion_type:"brim",brim_width:3}},draft:{id:"draft-fast",name:"Draft/Fast",description:"Quick prints with acceptable quality",category:"Speed",icon:"⚡",settings:{layer_height:.3,infill_sparse_density:10,speed_print:80,speed_infill:120,speed_wall_0:40,speed_wall_x:60,wall_thickness:.8,top_thickness:.6,bottom_thickness:.6,support_enable:!1,retraction_enable:!0,retraction_amount:4,retraction_speed:60,adhesion_type:"skirt"}},strong:{id:"strong-durable",name:"Strong & Durable",description:"Maximum strength for functional parts",category:"Strength",icon:"💪",settings:{layer_height:.2,infill_sparse_density:40,infill_pattern:"grid",speed_print:40,speed_infill:60,speed_wall_0:20,speed_wall_x:30,wall_thickness:1.6,wall_line_count:4,top_thickness:1.2,bottom_thickness:1.2,top_layers:6,bottom_layers:6,support_enable:!0,support_angle:60,retraction_enable:!0,retraction_amount:5.5,retraction_speed:40,adhesion_type:"brim",brim_width:5}},flexible:{id:"flexible-tpu",name:"Flexible Materials",description:"Optimized for TPU and flexible filaments",category:"Material",icon:"🤸",settings:{layer_height:.2,infill_sparse_density:25,infill_pattern:"gyroid",speed_print:20,speed_infill:15,speed_wall_0:10,speed_wall_x:15,wall_thickness:1,top_thickness:.8,bottom_thickness:.8,support_enable:!1,retraction_enable:!1,retraction_amount:.8,retraction_speed:25,adhesion_type:"raft",material_print_temperature:230,material_bed_temperature:50}},miniatures:{id:"miniatures-detail",name:"Miniatures & Details",description:"Ultra-fine details for small models",category:"Specialty",icon:"🎭",settings:{layer_height:.1,infill_sparse_density:15,speed_print:30,speed_infill:40,speed_wall_0:15,speed_wall_x:25,wall_thickness:.8,top_thickness:.6,bottom_thickness:.6,support_enable:!0,support_angle:30,support_density:15,retraction_enable:!0,retraction_amount:6,retraction_speed:35,adhesion_type:"raft"}},vase:{id:"vase-mode",name:"Vase Mode",description:"Single wall continuous print",category:"Specialty",icon:"🏺",settings:{layer_height:.2,wall_thickness:.4,wall_line_count:1,infill_sparse_density:0,top_thickness:0,support_enable:!1,retraction_enable:!1,magic_spiralize:!0,speed_print:60,speed_wall_0:30,adhesion_type:"brim",brim_width:2}}},Vt={stronger:{name:"Stronger",description:"Increase infill and wall thickness for more durability",icon:"🔧",changes:{infill_sparse_density:"+15",wall_thickness:"+0.4",top_thickness:"+0.2",bottom_thickness:"+0.2"}},faster:{name:"Faster",description:"Increase speeds and reduce quality for quicker prints",icon:"🚀",changes:{speed_print:"+20",speed_infill:"+30",layer_height:"+0.05",infill_sparse_density:"-5"}},smoother:{name:"Smoother",description:"Reduce layer height and speeds for better surface quality",icon:"✨",changes:{layer_height:"-0.05",speed_print:"-15",speed_wall_0:"-10",wall_thickness:"+0.2"}},detailed:{name:"More Detail",description:"Optimize for fine details and overhangs",icon:"🔍",changes:{layer_height:"-0.05",support_angle:"-15",retraction_amount:"+1",speed_wall_0:"-10"}},economical:{name:"Save Material",description:"Reduce material usage while maintaining strength",icon:"💰",changes:{infill_sparse_density:"-10",wall_thickness:"-0.2",top_thickness:"-0.2",infill_pattern:"gyroid"}}},si={strength:{id:"optimize-strength",name:"Optimize for Strength",description:"Step-by-step guide to maximize part strength",icon:"💪",steps:[{title:"Layer Adhesion",description:"Lower layer height improves layer bonding",setting:"layer_height",recommendation:.2,explanation:"Thinner layers create more interfaces between layers, improving strength"},{title:"Infill Density",description:"Higher infill provides more internal structure",setting:"infill_sparse_density",recommendation:40,explanation:"40% infill provides good strength without excessive material use"},{title:"Infill Pattern",description:"Grid pattern offers excellent strength in all directions",setting:"infill_pattern",recommendation:"grid",explanation:"Grid pattern distributes stress evenly throughout the part"},{title:"Wall Thickness",description:"Thicker walls resist bending and impact",setting:"wall_thickness",recommendation:1.6,explanation:"Multiple perimeters create a strong shell around the part"},{title:"Print Temperature",description:"Optimal temperature ensures proper layer bonding",setting:"material_print_temperature",recommendation:"+5°C",explanation:"Slightly higher temperature improves layer adhesion"}]},speed:{id:"optimize-speed",name:"Minimize Print Time",description:"Reduce print time while maintaining acceptable quality",icon:"⚡",steps:[{title:"Layer Height",description:"Thicker layers mean fewer total layers",setting:"layer_height",recommendation:.3,explanation:"Doubling layer height can halve print time"},{title:"Infill Reduction",description:"Lower infill prints faster with less material",setting:"infill_sparse_density",recommendation:10,explanation:"Minimal infill for non-structural parts saves significant time"},{title:"Print Speeds",description:"Increase movement speeds where quality allows",setting:"speed_print",recommendation:80,explanation:"Higher speeds reduce print time, monitor quality"},{title:"Fewer Walls",description:"Reduce perimeter count for faster printing",setting:"wall_line_count",recommendation:2,explanation:"Fewer perimeters print faster, ensure adequate strength"},{title:"Skip Supports",description:"Avoid supports when design allows",setting:"support_enable",recommendation:!1,explanation:"Supports add significant print time and material"}]},quality:{id:"optimize-quality",name:"Maximize Surface Quality",description:"Achieve the best possible surface finish",icon:"✨",steps:[{title:"Fine Layer Height",description:"Thinner layers create smoother surfaces",setting:"layer_height",recommendation:.15,explanation:"Fine layers reduce visible layer lines"},{title:"Slower Outer Walls",description:"Slow outer perimeter for better accuracy",setting:"speed_wall_0",recommendation:25,explanation:"Slower outer walls improve dimensional accuracy"},{title:"Optimal Temperature",description:"Perfect temperature prevents over/under-extrusion",setting:"material_print_temperature",recommendation:"calibrate",explanation:"Temperature towers help find optimal settings"},{title:"Retraction Tuning",description:"Proper retraction eliminates stringing",setting:"retraction_amount",recommendation:5,explanation:"Balanced retraction prevents oozing without jamming"},{title:"Support Settings",description:"Fine-tune supports for clean removal",setting:"support_angle",recommendation:45,explanation:"Appropriate support angle minimizes surface marks"}]}};function ri(t,a={}){const s=es[t];return s?{...a,...s.settings}:a}function ai(t,a){const s=Vt[t];if(!s)return a;const r={...a};return Object.entries(s.changes).forEach(([l,n])=>{const i=a[l]||0;if(typeof n=="string")if(n.startsWith("+")){const c=parseFloat(n.substring(1));r[l]=i+c}else if(n.startsWith("-")){const c=parseFloat(n.substring(1));r[l]=Math.max(0,i-c)}else r[l]=n;else r[l]=n}),r}function ni(){const t={};return Object.values(es).forEach(a=>{t[a.category]||(t[a.category]=[]),t[a.category].push(a)}),t}const ii=({isOpen:t,onClose:a,onApplyTemplate:s})=>{const[r,l]=d.useState(null),[n,i]=d.useState("All");if(!t)return null;const c=ni(),o=["All",...Object.keys(c)],m=n==="All"?Object.values(es):c[n]||[],u=()=>{r&&(s(r.id,r),a())},x=f=>[{key:"layer_height",label:"Layer Height",unit:"mm"},{key:"infill_sparse_density",label:"Infill",unit:"%"},{key:"speed_print",label:"Print Speed",unit:"mm/s"},{key:"wall_thickness",label:"Wall Thickness",unit:"mm"}].filter(N=>f.settings[N.key]!==void 0).slice(0,3);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Choose Profile Template"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Start with optimized settings for your print type"})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"w-48 border-r bg-gray-50 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Categories"}),e.jsx("div",{className:"space-y-1",children:o.map(f=>e.jsx("button",{onClick:()=>i(f),className:`w-full text-left px-3 py-2 rounded text-sm transition-colors ${n===f?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-100"}`,children:f},f))})]}),e.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(f=>e.jsxs("div",{onClick:()=>l(f),className:`border rounded-lg p-4 cursor-pointer transition-all ${(r==null?void 0:r.id)===f.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:f.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:f.name}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:f.category})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:f.description}),e.jsx("div",{className:"space-y-1",children:x(f).map(b=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:[b.label,":"]}),e.jsxs("span",{className:"font-medium",children:[f.settings[b.key],b.unit]})]},b.key))})]},f.id))})}),r&&e.jsxs("div",{className:"w-80 border-l bg-gray-50 p-6 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("span",{className:"text-3xl",children:r.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:r.name}),e.jsx("span",{className:"text-sm text-blue-600",children:r.category})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Key Settings"}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(r.settings).slice(0,8).map(([f,b])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 capitalize",children:[f.replace(/_/g," "),":"]}),e.jsx("span",{className:"font-medium",children:String(b)})]},f)),Object.keys(r.settings).length>8&&e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["+",Object.keys(r.settings).length-8," more settings..."]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3 mb-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Template Benefits"}),e.jsxs("p",{className:"text-yellow-700",children:[r.category==="Quality"&&"Optimized for visual appearance and detail",r.category==="Speed"&&"Balanced speed and quality for faster prints",r.category==="Strength"&&"Maximized durability and mechanical properties",r.category==="Material"&&"Tuned for specific material characteristics",r.category==="Specialty"&&"Specialized settings for unique applications"]})]})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:r?`${r.name} template selected`:"Select a template to continue"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:!r,className:`px-4 py-2 rounded-md transition-colors ${r?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Apply Template"})]})]})]})})},li=({currentSettings:t,onApplyPreset:a,className:s=""})=>{const[r,l]=d.useState({}),[n,i]=d.useState(null),c=u=>{const x=ai(u,t);a(x,u)},o=u=>{l(x=>({...x,[u]:!x[u]}))},m=u=>{const x=Vt[u];return x?Object.entries(x.changes).map(([f,b])=>{const N=t[f]||0;let p=N,h="";if(typeof b=="string")if(b.startsWith("+")){const g=parseFloat(b.substring(1));p=N+g,h=`+${g}`}else if(b.startsWith("-")){const g=parseFloat(b.substring(1));p=Math.max(0,N-g),h=`-${g}`}else p=b,h=`→ ${b}`;else p=b,h=`→ ${b}`;return{key:f,currentValue:N,newValue:p,change:h,setting:f.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase())}}):[]};return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Quick Adjustments"}),e.jsx(Ie,{className:"h-4 w-4 text-yellow-500"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.entries(Vt).map(([u,x])=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`border rounded-lg p-3 cursor-pointer transition-all ${n===u?"border-blue-300 bg-blue-50 shadow-sm":"border-gray-200 hover:border-gray-300"}`,onMouseEnter:()=>i(u),onMouseLeave:()=>i(null),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:x.icon}),e.jsx("span",{className:"font-medium text-sm",children:x.name})]}),e.jsx("button",{onClick:f=>{f.stopPropagation(),o(u)},className:"text-gray-400 hover:text-gray-600 transition-colors",title:r[u]?"Hide preview":"Show preview",children:r[u]?e.jsx(xt,{className:"h-4 w-4"}):e.jsx(He,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:x.description}),r[u]&&e.jsxs("div",{className:"mb-3 p-2 bg-gray-50 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Changes Preview:"}),e.jsx("div",{className:"space-y-1",children:m(u).map(f=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[f.setting,":"]}),e.jsxs("span",{className:"font-medium",children:[f.currentValue," ",f.change]})]},f.key))})]}),e.jsxs("button",{onClick:()=>c(u),className:"w-full py-2 px-3 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:["Apply ",x.name]})]}),n===u&&!r[u]&&e.jsxs("div",{className:"absolute z-10 bottom-full left-0 mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded shadow-lg",children:[e.jsx("div",{className:"font-medium mb-1",children:"Preview Changes:"}),e.jsxs("div",{className:"space-y-1",children:[m(u).slice(0,3).map(f=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-300",children:[f.setting,":"]}),e.jsxs("span",{children:[f.currentValue," ",f.change]})]},f.key)),m(u).length>3&&e.jsxs("div",{className:"text-gray-400 italic",children:["+",m(u).length-3," more changes..."]})]}),e.jsx("div",{className:"absolute top-full left-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]},u))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Quick Tip:"})," These presets apply multiple related changes at once. Preview changes before applying to understand the impact on your print."]})]})})]})},oi=({isOpen:t,onClose:a,wizardId:s,currentSettings:r,onApplyChanges:l})=>{const[n,i]=d.useState(0),[c,o]=d.useState({}),[m,u]=d.useState(!1),x=si[s];if(d.useEffect(()=>{t&&x&&(i(0),o({}),u(!1))},[t,x]),!t||!x)return null;const f=x.steps[n],b=n===x.steps.length-1,N=c[f==null?void 0:f.setting]!==void 0,p=(_,P)=>{o(E=>({...E,[_]:P}))},h=()=>{b?u(!0):i(_=>_+1)},g=()=>{m?u(!1):i(_=>_-1)},j=()=>{const _={...r};Object.entries(c).forEach(([P,E])=>{if(typeof E=="string"&&E.includes("°C")){const F=r[P]||200,v=parseInt(E.replace(/[^-+\d]/g,""));_[P]=F+v}else{if(E==="calibrate")return;_[P]=E}}),l(_),a()},S=()=>{const _=f,P=r[_.setting],E=_.recommendation,F=()=>{switch(_.setting){case"layer_height":return e.jsx("div",{className:"space-y-2",children:[.1,.15,.2,.25,.3].map(w=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"layer_height",value:w,checked:c[_.setting]===w,onChange:()=>p(_.setting,w),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[w,"mm"]}),e.jsx("div",{className:"text-sm text-gray-600",children:w<=.15?"High detail":w<=.25?"Balanced":"Fast print"})]}),w===E&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]},w))});case"infill_sparse_density":return e.jsx("div",{className:"space-y-2",children:[5,10,15,20,30,40,50].map(w=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"infill_density",value:w,checked:c[_.setting]===w,onChange:()=>p(_.setting,w),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[w,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:w<=15?"Light/decorative":w<=30?"Standard":"Heavy duty"})]}),w===E&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]},w))});case"infill_pattern":const v=["lines","grid","triangles","cubic","gyroid","honeycomb"];return e.jsx("div",{className:"space-y-2",children:v.map(w=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"infill_pattern",value:w,checked:c[_.setting]===w,onChange:()=>p(_.setting,w),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium capitalize",children:w}),e.jsxs("div",{className:"text-sm text-gray-600",children:[w==="grid"&&"Strong in all directions",w==="lines"&&"Fast, directional strength",w==="gyroid"&&"Organic, good strength-to-weight",w==="honeycomb"&&"Excellent strength, slower print",w==="cubic"&&"Isotropic strength",w==="triangles"&&"Good strength, fast print"]})]}),w===E&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]},w))});case"support_enable":return e.jsx("div",{className:"space-y-2",children:[!0,!1].map(w=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"supports",value:String(w),checked:c[_.setting]===w,onChange:()=>p(_.setting,w),className:"text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[w?"Enable":"Disable"," Supports"]}),e.jsx("div",{className:"text-sm text-gray-600",children:w?"Print overhangs and bridges":"Faster print, design dependent"})]}),w===E&&e.jsx(fe,{className:"h-5 w-5 text-green-600"})]},String(w)))});default:const C=_.setting.includes("temperature"),y=_.setting.includes("speed");return typeof E=="string"?e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-blue-800",children:[e.jsx(rt,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-medium",children:["Recommendation: ",E]})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-2",children:_.explanation}),e.jsx("button",{onClick:()=>p(_.setting,E),className:"mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Accept Recommendation"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:_.setting.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())}),e.jsx("input",{type:"number",value:c[_.setting]||P||"",onChange:w=>p(_.setting,parseFloat(w.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",step:C?1:y?5:.1})]}),E&&e.jsxs("button",{onClick:()=>p(_.setting,E),className:"px-3 py-2 bg-green-100 text-green-700 border border-green-300 rounded hover:bg-green-200",children:["Use ",E,C&&"°C",y&&" mm/s",!C&&!y&&typeof E=="number"&&" mm"]})]})})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:_.title}),e.jsx("p",{className:"text-gray-600",children:_.description})]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Current value:"}),e.jsx("span",{className:"ml-2",children:P||"Not set"})]})}),F(),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(rt,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-yellow-800",children:_.explanation})]})})]})},M=()=>{const _=Object.entries(c).map(([P,E])=>({setting:P,oldValue:r[P],newValue:E,label:P.replace(/_/g," ").replace(/\b\w/g,F=>F.toUpperCase())}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Review Changes"}),e.jsxs("p",{className:"text-gray-600",children:["These settings will be applied to optimize your profile for ",x.name.toLowerCase()]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b",children:e.jsx("h4",{className:"font-medium text-gray-900",children:"Setting Changes"})}),e.jsx("div",{className:"divide-y",children:_.map(P=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:P.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-500",children:String(P.oldValue)}),e.jsx(Nt,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-blue-600",children:String(P.newValue)})]})]},P.setting))})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(fe,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"Expected Results:"}),e.jsxs("p",{children:[x.id==="optimize-strength"&&"Improved layer adhesion, increased structural integrity, and better resistance to mechanical stress.",x.id==="optimize-speed"&&"Significantly reduced print time while maintaining acceptable quality for functional parts.",x.id==="optimize-quality"&&"Enhanced surface finish, better dimensional accuracy, and reduced visible layer lines."]})]})]})})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:x.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:x.name}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"px-6 py-2 bg-gray-50 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:m?"Review":`Step ${n+1} of ${x.steps.length}`}),e.jsxs("span",{children:[Math.round((m?x.steps.length:n)/x.steps.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${(m?x.steps.length:n+1)/x.steps.length*100}%`}})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:m?M():S()}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsxs("button",{onClick:g,disabled:n===0&&!m,className:`px-4 py-2 rounded transition-colors ${n===0&&!m?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(oa,{className:"h-4 w-4 inline mr-1"}),"Previous"]}),e.jsx("div",{className:"text-sm text-gray-500",children:m?"Ready to apply changes":`${Object.keys(c).length} of ${x.steps.length} completed`}),m?e.jsx("button",{onClick:j,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Apply Changes"}):e.jsxs("button",{onClick:h,disabled:!N,className:`px-4 py-2 rounded transition-colors ${N?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[b?"Review":"Next",e.jsx(Nt,{className:"h-4 w-4 inline ml-1"})]})]})]})})},ci=({isOpen:t,onClose:a,profile:s})=>{const{revertProfileToVersion:r}=ue(),[l,n]=d.useState(null),[i,c]=d.useState(!1);if(!t||!s)return null;const o=s.history||[],m=[...o].sort((h,g)=>new Date(g.timestamp)-new Date(h.timestamp)),u=h=>{confirm("Are you sure you want to revert to this version? This will create a new history entry.")&&(r(s.printerId||"",s.id,h),a())},x=h=>{switch(h){case"template":return e.jsx(ia,{className:"h-4 w-4 text-blue-600"});case"preset":return e.jsx(Ie,{className:"h-4 w-4 text-yellow-600"});case"wizard":return e.jsx(ha,{className:"h-4 w-4 text-purple-600"});case"import":return e.jsx(Ye,{className:"h-4 w-4 text-green-600"});case"revert":return e.jsx(lt,{className:"h-4 w-4 text-orange-600"});default:return e.jsx(Fs,{className:"h-4 w-4 text-gray-600"})}},f=h=>{switch(h){case"template":return"Template Applied";case"preset":return"Preset Applied";case"wizard":return"Wizard Optimization";case"import":return"Import";case"revert":return"Reverted";default:return"Manual Edit"}},b=h=>{const g=new Date(h),S=new Date-g,M=Math.floor(S/6e4),_=Math.floor(S/36e5),P=Math.floor(S/864e5);return M<1?"Just now":M<60?`${M} minutes ago`:_<24?`${_} hours ago`:P<7?`${P} days ago`:g.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},N=(h,g)=>{const j=[];return new Set([...Object.keys(h.snapshot||{}),...Object.keys(g.snapshot||{})]).forEach(M=>{var E,F;const _=(E=h.snapshot)==null?void 0:E[M],P=(F=g.snapshot)==null?void 0:F[M];JSON.stringify(_)!==JSON.stringify(P)&&j.push({key:M,oldValue:_,newValue:P,label:M.replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase())})}),j},p=()=>{if(!l||m.length<2)return null;const h=m.findIndex(S=>S.id===l.id),g=m[h+1];if(!g)return null;const j=N(g,l);return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4",children:["Changes from ",b(g.timestamp)]}),j.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No setting changes detected"}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"divide-y",children:j.map(S=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:S.label}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-red-600",children:String(S.oldValue)}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{className:"text-green-600",children:String(S.newValue)})]})]},S.key))})})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-3xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Profile History"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.name," - Version Timeline"]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ke,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No history available"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Changes will be tracked here as you modify the profile"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900",children:"Current Version"}),e.jsxs("div",{className:"text-sm text-green-700",children:["Last updated: ",b(s.updatedAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded",children:"Active"})})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:m.map((h,g)=>{var j;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 w-4 h-4 bg-white border-2 border-gray-300 rounded-full"}),e.jsxs("div",{className:"ml-12 bg-white border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[x(h.source),e.jsx("span",{className:"font-medium text-gray-900",children:f(h.source)}),h.revertedFrom&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(from version ",b((j=o.find(S=>S.id===h.revertedFrom))==null?void 0:j.timestamp),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{n((l==null?void 0:l.id)===h.id?null:h),c(!i||(l==null?void 0:l.id)!==h.id)},className:"text-gray-400 hover:text-gray-600 p-1",title:"View details",children:e.jsx(He,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>u(h.id),className:"text-blue-600 hover:text-blue-700 p-1",title:"Revert to this version",children:e.jsx(lt,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:b(h.timestamp)}),h.changes&&h.changes.length>0&&e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Changes:"})," ",h.changes.includes("reverted")?"Reverted to previous version":h.changes.slice(0,3).map(S=>S.replace(/_/g," ")).join(", "),h.changes.length>3&&e.jsxs("span",{className:"text-gray-500",children:[" +",h.changes.length-3," more"]})]}),(l==null?void 0:l.id)===h.id&&i&&p()]})]},h.id)})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:o.length>0?`${o.length} version${o.length!==1?"s":""} in history`:"No versions in history"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Close"})]})]})})};function di(t,a={}){const s=new Date().toISOString(),r={version:4,name:t.name,definition:a.definition||"fused_deposition"},l={type:t.type||"quality",setting_version:20,modified:s},n=t.settings||{},i=[];i.push("[general]");for(const[c,o]of Object.entries(r))i.push(`${c} = ${Ft(o)}`);i.push(""),i.push("[metadata]");for(const[c,o]of Object.entries(l))i.push(`${c} = ${Ft(o)}`);i.push(""),i.push("[values]");for(const[c,o]of Object.entries(n))i.push(`${c} = ${Ft(o)}`);return i.push(""),i.join(`
`)}function bs(t){t.forEach(a=>{const s=di(a),r=new Blob([s],{type:"text/plain"}),l=URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=`${mi(a.name)}.cfg`,n.click(),URL.revokeObjectURL(l)})}function mi(t){return String(t||"profile").replace(/[^a-z0-9-_]+/gi,"_")}function Ft(t){return typeof t=="boolean"?t?"True":"False":Array.isArray(t)?t.join(","):t}const ui=()=>{var D;const{getActivePrinter:t,addProfile:a,updateProfile:s,deleteProfile:r,duplicateProfile:l,setActiveProfile:n,updateCuraPath:i}=ue(),c=t(),[o,m]=d.useState(!1),[u,x]=d.useState(!1),[f,b]=d.useState(!1),[N,p]=d.useState(!1),[h,g]=d.useState(!1),[j,S]=d.useState(!1),[M,_]=d.useState(!1),[P,E]=d.useState(!1),[F,v]=d.useState(null),[C,y]=d.useState(null),[w,k]=d.useState(null),[H,K]=d.useState(null),[z,Z]=d.useState(null),[ne,je]=d.useState(null),[T,I]=d.useState({name:"",type:"quality",settings:{}});if(!c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500",children:"No printer selected"})});const A=((D=c.slicerProfiles)==null?void 0:D.profiles)||[],O=A.find(R=>R.isActive),X=()=>{if(!T.name.trim()){alert("Profile name is required");return}if(A.find(G=>G.name.toLowerCase()===T.name.toLowerCase())){alert("A profile with this name already exists");return}a(c.id,T),I({name:"",type:"quality",settings:{}}),m(!1)},$=()=>{if(!z.name.trim()){alert("Profile name is required");return}if(A.find(G=>G.name.toLowerCase()===z.name.toLowerCase()&&G.id!==z.id)){alert("A profile with this name already exists");return}s(c.id,z.id,z),Z(null),x(!1)},se=R=>{confirm("Are you sure you want to delete this profile?")&&r(c.id,R)},J=R=>{l(c.id,R)},U=R=>{n(c.id,R)},W=R=>{je(R),p(!0)},ee=()=>{bs(A)},oe=R=>{bs([R])},ie=(R,G)=>{k(R),K(G),g(!0)},pe=R=>{!w||!H||(s(c.id,w.id,{settings:{...w.settings,...R},source:"merge"}),g(!1))},L=(R,G)=>{if(!O){alert("Please select an active profile first");return}const te=ri(R,O.settings);s(c.id,O.id,{settings:te,source:"template"}),S(!1)},q=(R,G)=>{if(!O){alert("Please select an active profile first");return}s(c.id,O.id,{settings:R,source:"preset"})},ae=R=>{if(!O){alert("Please select an active profile first");return}s(c.id,O.id,{settings:R,source:"wizard"}),_(!1)},xe=R=>{y(R),E(!0)},ce=R=>{if(!O){alert("Please select an active profile first");return}v(R),_(!0)},he=async R=>{const te=Array.from(R.target.files||[]).filter(re=>/\.cfg$/i.test(re.name));for(const re of te){const de=await re.text(),le=re.name.replace(/\.cfg$/i,""),ge=A.find(be=>be.name.toLowerCase()===le.toLowerCase());if(ge){const be={...ge,name:le,settings:Ee(de)};ie(ge,be)}}};function Ee(R){const G={},te=R.split(/\r?\n/);let re=!1;for(const de of te){const le=de.trim();if(le==="[values]"){re=!0;continue}if(/^\[/.test(le)){re=!1;continue}if(!re)continue;const ge=le.match(/^(.*?)=(.*)$/);if(ge){const be=ge[1].trim(),me=ge[2].trim();G[be]=Pe(me)}}return G}function Pe(R){return/^(true|false)$/i.test(R)?/^true$/i.test(R):/^[+-]?\d+(\.\d+)?$/.test(R)?Number(R):R.includes(",")&&!R.includes(" ")?R.split(",").map(G=>G.trim()):R}const we=R=>{switch(R){case"quality":return e.jsx(ye,{className:"h-4 w-4"});case"material":return e.jsx(Ds,{className:"h-4 w-4"});case"print":return e.jsx(Te,{className:"h-4 w-4"});default:return e.jsx(ye,{className:"h-4 w-4"})}},B=R=>{switch(R){case"quality":return"bg-blue-100 text-blue-800";case"material":return"bg-green-100 text-green-800";case"print":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},Y=R=>new Date(R).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Profile Management"}),e.jsxs("p",{className:"text-gray-600",children:["Manage slicer profiles for ",c.name]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Create New"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[e.jsx(Qt,{className:"h-4 w-4"}),e.jsx("span",{children:"From Template"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(vt,{className:"h-4 w-4"}),e.jsx("span",{children:"Import"})]}),e.jsxs("button",{onClick:ee,className:"bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 transition-colors flex items-center space-x-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{children:"Export All"})]}),e.jsx("input",{type:"file",id:"sync-folder",className:"hidden",webkitdirectory:"true",directory:"true",multiple:!0,onChange:he}),e.jsx("label",{htmlFor:"sync-folder",className:"px-3 py-2 bg-gray-100 text-gray-700 rounded cursor-pointer hover:bg-gray-200 transition-colors",children:"Sync Folder"})]})]}),f&&e.jsx(Zn,{isOpen:f,onClose:()=>b(!1),onImported:()=>b(!1)}),j&&e.jsx(ii,{isOpen:j,onClose:()=>S(!1),onApplyTemplate:L}),M&&F&&e.jsx(oi,{isOpen:M,onClose:()=>_(!1),wizardId:`optimize-${F}`,currentSettings:(O==null?void 0:O.settings)||{},onApplyChanges:ae}),P&&C&&e.jsx(ci,{isOpen:P,onClose:()=>E(!1),profile:{...C,printerId:c.id}}),h&&w&&H&&e.jsx(fs,{isOpen:h,onClose:()=>g(!1),leftProfile:w,rightProfile:H,onMerge:pe}),O&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Active Profile"}),e.jsx("p",{className:"text-green-700",children:O.name})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>xe(O),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center space-x-1",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{children:"History"})]}),e.jsx("button",{onClick:()=>oe(O),className:"text-sm text-blue-600 hover:text-blue-700",children:"Export"})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Optimization Wizards"}),e.jsx(Ma,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>ce("strength"),className:"flex items-center space-x-2 px-3 py-2 bg-red-50 text-red-700 border border-red-200 rounded hover:bg-red-100 transition-colors",children:[e.jsx("span",{children:"💪"}),e.jsx("span",{className:"text-sm font-medium",children:"Strength"})]}),e.jsxs("button",{onClick:()=>ce("speed"),className:"flex items-center space-x-2 px-3 py-2 bg-yellow-50 text-yellow-700 border border-yellow-200 rounded hover:bg-yellow-100 transition-colors",children:[e.jsx("span",{children:"⚡"}),e.jsx("span",{className:"text-sm font-medium",children:"Speed"})]}),e.jsxs("button",{onClick:()=>ce("quality"),className:"flex items-center space-x-2 px-3 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded hover:bg-blue-100 transition-colors",children:[e.jsx("span",{children:"✨"}),e.jsx("span",{className:"text-sm font-medium",children:"Quality"})]})]})]}),e.jsx(li,{currentSettings:O.settings||{},onApplyPreset:q})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Profiles (",A.length,")"]})}),A.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No profiles created yet"}),e.jsx("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Create Your First Profile"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:A.map(R=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[R.isActive?e.jsx(fe,{className:"h-5 w-5 text-green-600"}):e.jsx(ut,{className:"h-5 w-5 text-gray-400"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${B(R.type)}`,children:[we(R.type),e.jsx("span",{className:"ml-1",children:R.type})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:R.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Last modified: ",Y(R.updatedAt)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>xe(R),className:"text-gray-700 p-2",title:"View History",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>oe(R),className:"text-gray-700 p-2",title:"Export",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>ie(O||A[0],R),className:"text-indigo-600 p-2",title:"Compare",children:e.jsx(Is,{className:"h-4 w-4"})}),!R.isActive&&e.jsx("button",{onClick:()=>U(R.id),className:"text-green-600 hover:text-green-700 p-2",title:"Set as active",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>J(R.id),className:"text-blue-600 hover:text-blue-700 p-2",title:"Duplicate profile",children:e.jsx(ca,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>W(R),className:"text-indigo-600 hover:text-indigo-700 p-2",title:"Open editor",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>se(R.id),className:"text-red-600 hover:text-red-700 p-2",title:"Delete profile",children:e.jsx(Rt,{className:"h-4 w-4"})})]})]})},R.id))})]}),N&&ne&&e.jsx(ei,{isOpen:N,onClose:()=>p(!1),profile:ne,onSave:()=>p(!1)}),h&&w&&H&&e.jsx(fs,{isOpen:h,onClose:()=>g(!1),leftProfile:w,rightProfile:H,onMerge:pe}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Profile"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Name"}),e.jsx("input",{type:"text",value:T.name,onChange:R=>I({...T,name:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter profile name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text sm font-medium text-gray-700 mb-1",children:"Profile Type"}),e.jsxs("select",{value:T.type,onChange:R=>I({...T,type:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"quality",children:"Quality Profile"}),e.jsx("option",{value:"material",children:"Material Profile"}),e.jsx("option",{value:"print",children:"Print Profile"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:X,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Create Profile"})]})]})}),u&&z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Profile"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Name"}),e.jsx("input",{type:"text",value:z.name,onChange:R=>Z({...z,name:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter profile name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text sm font-medium text-gray-700 mb-1",children:"Profile Type"}),e.jsxs("select",{value:z.type,onChange:R=>Z({...z,type:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"quality",children:"Quality Profile"}),e.jsx("option",{value:"material",children:"Material Profile"}),e.jsx("option",{value:"print",children:"Print Profile"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Save Changes"})]})]})})]})},ys=[{id:"mat-pla",name:"PLA",type:"PLA",properties:{density:1.24,glass_transition:60},recommendedSettings:{material_print_temperature:200,material_bed_temperature:60,cool_fan_enabled:!0,cool_fan_speed:100,retraction_enable:!0,retraction_distance:1.5,retraction_speed:35}},{id:"mat-petg",name:"PETG",type:"PETG",properties:{density:1.27,glass_transition:80},recommendedSettings:{material_print_temperature:240,material_bed_temperature:80,cool_fan_enabled:!0,cool_fan_speed:40,retraction_enable:!0,retraction_distance:4,retraction_speed:35}},{id:"mat-abs",name:"ABS",type:"ABS",properties:{density:1.05,glass_transition:105},recommendedSettings:{material_print_temperature:250,material_bed_temperature:100,cool_fan_enabled:!1,retraction_enable:!0,retraction_distance:2,retraction_speed:35}}];function xi(t,a=""){var s,r,l,n,i,c,o,m,u;try{const x=JSON.parse(t),f=x.name||a.replace(/\.json$/i,""),b=x.properties||{},N=x.settings||{},p={material_print_temperature:((s=N.material_print_temperature)==null?void 0:s.value)??((r=N.print_temperature)==null?void 0:r.value),material_bed_temperature:((l=N.material_bed_temperature)==null?void 0:l.value)??((n=N.bed_temperature)==null?void 0:n.value),cool_fan_enabled:((i=N.cool_fan_enabled)==null?void 0:i.value)??!0,cool_fan_speed:(c=N.cool_fan_speed)==null?void 0:c.value,retraction_enable:(o=N.retraction_enable)==null?void 0:o.value,retraction_distance:(m=N.retraction_distance)==null?void 0:m.value,retraction_speed:(u=N.retraction_speed)==null?void 0:u.value};return{name:f,type:x.guid||x.material||"Custom",properties:{density:b.density,glass_transition:b.glass_transition_temperature},recommendedSettings:p}}catch{return null}}const hi=()=>{var E,F;const t=qt(),{addMaterial:a,updateMaterial:s,deleteMaterial:r}=Fr(),{updateProfile:l,setProfileMaterial:n}=Or(),i=t(),[c,o]=d.useState(!1),[m,u]=d.useState(null),[x,f]=d.useState({name:"",type:"PLA",properties:{},recommendedSettings:{}}),[b,N]=d.useState(null);if(!i)return e.jsx("div",{className:"p-6 text-gray-500",children:"No printer selected"});const p=((E=i.slicerProfiles)==null?void 0:E.materials)||[],g=(((F=i.slicerProfiles)==null?void 0:F.profiles)||[]).find(v=>v.isActive),j=v=>{f({name:v.name,type:v.type,properties:{...v.properties},recommendedSettings:{...v.recommendedSettings}}),o(!0)},S=()=>{if(!x.name.trim())return alert("Name is required");m?(s(i.id,m.id,x),u(null)):a(i.id,x),o(!1),f({name:"",type:"PLA",properties:{},recommendedSettings:{}})},M=async v=>{const C=Array.from(v.target.files||[]),y={total:C.length,success:0,failed:0};for(const w of C)try{const k=await w.text(),H=xi(k,w.name);H?(a(i.id,H),y.success+=1):y.failed+=1}catch{y.failed+=1}N(y)},_=v=>{const C=JSON.stringify(v,null,2),y=new Blob([C],{type:"application/json"}),w=URL.createObjectURL(y),k=document.createElement("a");k.href=w,k.download=`${v.name.replace(/\s+/g,"_")}.json`,k.click(),URL.revokeObjectURL(w)},P=v=>{if(!g)return alert("No active profile to link");n(i.id,g.id,v,!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Materials"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Manage filament materials and link to profiles"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"file",accept:".json",multiple:!0,className:"hidden",id:"mat-import",onChange:M}),e.jsxs("label",{htmlFor:"mat-import",className:"px-3 py-2 bg-green-600 text-white rounded cursor-pointer flex items-center",children:[e.jsx(vt,{className:"h-4 w-4 mr-1"})," Import"]}),e.jsxs("button",{onClick:()=>j(ys[0]),className:"px-3 py-2 bg-blue-600 text-white rounded flex items-center",children:[e.jsx(Qe,{className:"h-4 w-4 mr-1"})," New"]})]})]}),e.jsxs("div",{className:"bg-white border rounded",children:[e.jsx("div",{className:"px-4 py-2 border-b text-sm font-medium text-gray-700",children:"Templates"}),e.jsx("div",{className:"p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:ys.map(v=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-medium",children:v.name}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Tg: ",v.properties.glass_transition,"°C • Density: ",v.properties.density," g/cm³"]}),e.jsx("button",{onClick:()=>j(v),className:"mt-2 text-blue-600 text-sm",children:"Use Template"})]},v.id))})]}),e.jsxs("div",{className:"bg-white border rounded overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 border-b text-sm font-medium text-gray-700",children:["Materials (",p.length,")"]}),e.jsx("div",{className:"divide-y",children:p.map(v=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[v.name," ",e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:v.type})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Print: ",v.recommendedSettings.material_print_temperature,"°C • Bed: ",v.recommendedSettings.material_bed_temperature,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(g==null?void 0:g.materialId)===v.id&&e.jsxs("span",{className:"text-green-700 text-xs inline-flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 mr-1"})," Linked"]}),e.jsx("button",{onClick:()=>_(v),className:"text-gray-700 px-2 py-1",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{u(v),f({name:v.name,type:v.type,properties:{...v.properties},recommendedSettings:{...v.recommendedSettings}}),o(!0)},className:"text-blue-700 px-2 py-1",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>P(v.id),className:"text-indigo-700 px-2 py-1",children:e.jsx(fa,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>r(i.id,v.id),className:"text-red-700 px-2 py-1",children:e.jsx(Rt,{className:"h-4 w-4"})})]})]},v.id))})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded p-4 w-full max-w-lg",children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:m?"Edit Material":"New Material"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Name"}),e.jsx("input",{value:x.name,onChange:v=>f({...x,name:v.target.value}),className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Type"}),e.jsxs("select",{value:x.type,onChange:v=>f({...x,type:v.target.value}),className:"w-full px-2 py-1 border rounded",children:[e.jsx("option",{children:"PLA"}),e.jsx("option",{children:"PETG"}),e.jsx("option",{children:"ABS"}),e.jsx("option",{children:"TPU"}),e.jsx("option",{children:"Nylon"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Print Temp (°C)"}),e.jsx("input",{type:"number",value:x.recommendedSettings.material_print_temperature??"",onChange:v=>f({...x,recommendedSettings:{...x.recommendedSettings,material_print_temperature:Number(v.target.value)}}),className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Bed Temp (°C)"}),e.jsx("input",{type:"number",value:x.recommendedSettings.material_bed_temperature??"",onChange:v=>f({...x,recommendedSettings:{...x.recommendedSettings,material_bed_temperature:Number(v.target.value)}}),className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Notes"}),e.jsx("textarea",{value:x.properties.notes||"",onChange:v=>f({...x,properties:{...x.properties,notes:v.target.value}}),className:"w-full px-2 py-1 border rounded min-h-[60px]"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>{o(!1),u(null)},className:"px-3 py-1.5 bg-gray-100 rounded",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-3 py-1.5 bg-blue-600 text-white rounded",children:"Save"})]})]})}),b&&e.jsxs("div",{className:"text-xs text-gray-600",children:["Imported ",b.success,"/",b.total," (failed ",b.failed,")"]})]})},pi=()=>{const[t,a]=d.useState("profiles");return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"border-b border-gray-200 mb-4",children:e.jsxs("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>a("profiles"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${t==="profiles"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Te,{className:"h-4 w-4 inline mr-2"}),"Profiles"]}),e.jsxs("button",{onClick:()=>a("materials"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${t==="materials"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ma,{className:"h-4 w-4 inline mr-2"}),"Materials"]})]})}),t==="profiles"?e.jsx(ui,{}):e.jsx(hi,{})]})},gi=({status:t})=>{const a=t==="connected"?"bg-green-500":t==="connecting"?"bg-yellow-500":"bg-gray-400";return e.jsx("span",{className:`inline-block w-2.5 h-2.5 rounded-full ${a}`})},ar=({status:t,baudRate:a,setBaudRate:s,autoDetect:r,setAutoDetect:l,error:n,onConnect:i,onDisconnect:c})=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gi,{status:t}),e.jsx("div",{className:"font-medium text-gray-900 capitalize",children:t})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Web Serial"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"block text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Baud Rate"}),e.jsx("select",{value:a,onChange:o=>s(parseInt(o.target.value,10)),disabled:r||t!=="disconnected",className:"mt-1 w-full border border-gray-300 rounded px-2 py-1",children:[25e4,230400,115200,57600,38400,9600].map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm mt-6 md:mt-0",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:o=>l(o.target.checked),disabled:t!=="disconnected"}),e.jsx("span",{className:"text-gray-700",children:"Auto-detect baud"})]}),e.jsx("div",{className:"flex items-center justify-end space-x-2",children:t!=="connected"?e.jsx("button",{onClick:i,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Connect"}):e.jsx("button",{onClick:c,className:"px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Disconnect"})})]}),n&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-200 rounded p-2",children:n})]}),nr=[{code:"G0/G1",name:"Linear Move",category:"Movement",syntax:"G0|G1 X<pos> Y<pos> Z<pos> E<len> F<feed>",params:[{key:"X",desc:"X position (mm)",type:"number"},{key:"Y",desc:"Y position (mm)",type:"number"},{key:"Z",desc:"Z position (mm)",type:"number"},{key:"E",desc:"Extruder length (mm)",type:"number"},{key:"F",desc:"Feedrate (mm/min)",type:"number"}],description:"Move in a straight line to the specified coordinates. G0 is treated as G1 in Marlin.",examples:["G1 X10 Y10 F6000","G1 Z0.2 F300"]},{code:"G28",name:"Auto Home",category:"Movement",syntax:"G28 [X] [Y] [Z]",params:[{key:"X",desc:"Home X axis",type:"flag"},{key:"Y",desc:"Home Y axis",type:"flag"},{key:"Z",desc:"Home Z axis",type:"flag"}],description:"Home one or more axes to their endstops.",examples:["G28","G28 X Y"]},{code:"G90",name:"Absolute Positioning",category:"Movement",syntax:"G90",params:[],description:"Set positioning to absolute for X/Y/Z/E.",examples:["G90"]},{code:"G91",name:"Relative Positioning",category:"Movement",syntax:"G91",params:[],description:"Set positioning to relative for X/Y/Z/E.",examples:["G91"]},{code:"M104",name:"Set Hotend Temperature",category:"Temperature",syntax:"M104 S<temp> [T<tool>]",params:[{key:"S",desc:"Target temperature (°C)",type:"number"},{key:"T",desc:"Tool index",type:"number"}],description:"Set the hotend temperature without waiting.",examples:["M104 S200","M104 S210 T0"]},{code:"M109",name:"Wait for Hotend Temp",category:"Temperature",syntax:"M109 S<temp> [T<tool>]",params:[{key:"S",desc:"Target temperature (°C)",type:"number"},{key:"T",desc:"Tool index",type:"number"}],description:"Set the hotend temperature and wait until reached.",examples:["M109 S200"]},{code:"M140",name:"Set Bed Temperature",category:"Temperature",syntax:"M140 S<temp>",params:[{key:"S",desc:"Target temperature (°C)",type:"number"}],description:"Set the bed temperature without waiting.",examples:["M140 S60"]},{code:"M190",name:"Wait for Bed Temp",category:"Temperature",syntax:"M190 S<temp>",params:[{key:"S",desc:"Target temperature (°C)",type:"number"}],description:"Set the bed temperature and wait until reached.",examples:["M190 S60"]},{code:"M106",name:"Fan On",category:"Cooling",syntax:"M106 [S<0-255>]",params:[{key:"S",desc:"Fan speed (0-255)",type:"number"}],description:"Set part cooling fan speed.",examples:["M106 S255","M106 S128"]},{code:"M107",name:"Fan Off",category:"Cooling",syntax:"M107",params:[],description:"Turn off part cooling fan.",examples:["M107"]},{code:"M114",name:"Get Current Position",category:"Information",syntax:"M114",params:[],description:"Report the current position of all axes and extruder.",examples:["M114"]},{code:"M115",name:"Firmware Info",category:"Information",syntax:"M115",params:[],description:"Request firmware capabilities and version.",examples:["M115"]},{code:"M303",name:"PID Autotune",category:"Temperature",syntax:"M303 E<hotend> S<temp> C<cycles>",params:[{key:"E",desc:"Hotend index (0 for first)",type:"number"},{key:"S",desc:"Target temp (°C)",type:"number"},{key:"C",desc:"Cycles count",type:"number"}],description:"Run PID autotune routine for the specified hotend.",examples:["M303 E0 S210 C8"]}],fi=nr.reduce((t,a)=>(t[a.category]=t[a.category]||[],t[a.category].push(a),t),{}),bi=({onInsert:t,onClose:a})=>{const{getActivePrinter:s,addMacro:r,updateMacro:l}=ue(),n=s(),[i,c]=d.useState(""),[o,m]=d.useState("All"),[u,x]=d.useState({name:"",description:"",commands:""}),f=["All",...Object.keys(fi)],b=d.useMemo(()=>{const g=i.trim().toLowerCase();return nr.filter(j=>{const S=!g||j.code.toLowerCase().includes(g)||j.name.toLowerCase().includes(g)||j.description.toLowerCase().includes(g),M=o==="All"||j.category===o;return S&&M})},[i,o]),N=g=>{var j;t(((j=g.examples)==null?void 0:j[0])||g.code)},p=()=>{if(!u.name.trim()||!u.commands.trim())return;const g=u.commands.split(/\r?\n/).map(j=>j.trim()).filter(Boolean);r(n.id,{name:u.name.trim(),description:u.description.trim(),commands:g}),x({name:"",description:"",commands:""})},h=g=>{l(n.id,g.id,{isFavorite:!g.isFavorite})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-end md:items-center justify-center",children:e.jsxs("div",{className:"bg-white w-full md:max-w-3xl rounded-t-lg md:rounded-lg overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gray-50",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"G-code Reference"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:"Close"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{placeholder:"Search commands…",value:i,onChange:g=>c(g.target.value),className:"border border-gray-300 rounded px-3 py-2"}),e.jsx("select",{value:o,onChange:g=>m(g.target.value),className:"border border-gray-300 rounded px-3 py-2",children:f.map(g=>e.jsx("option",{value:g,children:g},g))}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[b.length," results"]})]}),e.jsxs("div",{className:"max-h-64 overflow-auto border border-gray-200 rounded divide-y",children:[b.map(g=>e.jsxs("div",{className:"p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[g.code," — ",g.name]}),e.jsx("button",{onClick:()=>N(g),className:"text-blue-600 text-sm",children:"Insert"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:g.category}),e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:g.description}),g.params&&g.params.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Params:"})," ",g.params.map(j=>`${j.key} (${j.desc})`).join(", ")]}),g.examples&&g.examples.length>0&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Examples:"})," ",g.examples.map((j,S)=>e.jsx("button",{onClick:()=>t(j),className:"text-indigo-600 hover:underline ml-2",children:j},S))]})]},g.code+g.name)),b.length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No commands match your search."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 mb-2",children:"Macros"}),e.jsxs("div",{className:"border border-gray-200 rounded divide-y max-h-48 overflow-auto",children:[(n.macros||[]).map(g=>{var j;return e.jsxs("div",{className:"p-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[g.name,e.jsx("button",{onClick:()=>h(g),className:"text-yellow-600",children:g.isFavorite?e.jsx(Qt,{className:"h-4 w-4"}):e.jsx(_a,{className:"h-4 w-4"})})]}),g.description&&e.jsx("div",{className:"text-xs text-gray-600",children:g.description}),((j=g.commands)==null?void 0:j.length)>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-700",children:[g.commands.slice(0,3).map((S,M)=>e.jsx("div",{className:"font-mono",children:S},M)),g.commands.length>3&&e.jsxs("div",{className:"text-gray-400",children:["+",g.commands.length-3," more…"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"text-blue-600 text-sm",onClick:()=>g.commands.forEach(S=>t(S)),children:"Insert"})})]},g.id)}),(n.macros||[]).length===0&&e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No macros saved yet."})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 mb-2",children:"Create Macro"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{placeholder:"Macro name",className:"w-full border border-gray-300 rounded px-3 py-2",value:u.name,onChange:g=>x({...u,name:g.target.value})}),e.jsx("input",{placeholder:"Description (optional)",className:"w-full border border-gray-300 rounded px-3 py-2",value:u.description,onChange:g=>x({...u,description:g.target.value})}),e.jsx("textarea",{placeholder:`Commands (one per line)
Example:
G28
M104 S200
M109 S200`,className:"w-full border border-gray-300 rounded px-3 py-2 h-28 font-mono text-sm",value:u.commands,onChange:g=>x({...u,commands:g.target.value})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:p,children:[e.jsx(Fe,{className:"h-4 w-4 inline mr-1"})," Save Macro"]})})]})]})]})]})]})})},yi=({entry:t})=>{const a=t.type==="tx"?"text-blue-400":t.type==="rx"?"text-green-400":t.type==="err"?"text-red-400":"text-gray-300",s=t.type.toUpperCase(),r=t.type==="tx"?"bg-blue-600":t.type==="rx"?"bg-green-600":t.type==="err"?"bg-red-600":"bg-gray-600";return e.jsxs("div",{className:"text-xs leading-5",children:[e.jsx("span",{className:"text-gray-500 mr-2",children:t.timestamp}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-white text-xs font-bold mr-2 ${r}`,children:s}),e.jsx("span",{className:a,children:t.message})]})},Ni=_e.memo(({onSend:t,onSendMany:a,onClear:s})=>{const r=V(_=>{var P;return((P=_.serialLogs)==null?void 0:P.length)||0}),[l,n]=d.useState([]);d.useEffect(()=>{const _=V.getState().serialLogs||[];n(_)},[r]),V(_=>_.fetchAllPrinterSettings),V(_=>_.status);const[i,c]=d.useState(""),[o,m]=d.useState([]),[u,x]=d.useState(-1),f=d.useRef(null),[b,N]=d.useState(!1),p=V(_=>_.sendCommand),h=()=>{const _=i.trim();_&&(t(_),m(P=>[...P,_].slice(-100)),x(-1),c(""))},g=_=>{if(_.key==="Enter"&&!_.shiftKey)_.preventDefault(),h();else if(_.key==="ArrowUp"){if(_.preventDefault(),o.length===0)return;const P=u<0?o.length-1:Math.max(0,u-1);x(P),c(o[P]||"")}else if(_.key==="ArrowDown"){if(_.preventDefault(),o.length===0)return;const P=u>=o.length-1?-1:u+1;x(P),c(P===-1?"":o[P]||"")}};d.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[l]);const j=()=>{const _=l.map(v=>`${v.timestamp}	${v.type}	${v.message}`).join(`
`),P=new Blob([_],{type:"text/plain"}),E=URL.createObjectURL(P),F=document.createElement("a");F.href=E,F.download="serial_log.txt",F.click(),URL.revokeObjectURL(E)},S=_=>{c(P=>(P?P+`
`:"")+_),N(!1)},M=d.useMemo(()=>{const _=i.trim().split(/\s+/)[0]||"";if(!_)return"";const P=_.toUpperCase();return P==="G1"||P==="G0"?"Syntax: G1 X<pos> Y<pos> Z<pos> E<len> F<feed>":P==="G28"?"Syntax: G28 [X] [Y] [Z]":P==="M104"?"Syntax: M104 S<temp> [T<tool>]":P==="M109"?"Syntax: M109 S<temp> [T<tool>] (wait)":P==="M140"?"Syntax: M140 S<temp>":P==="M190"?"Syntax: M190 S<temp> (wait)":P==="M106"?"Syntax: M106 S<0-255>":P==="M303"?"Syntax: M303 E<hotend> S<temp> C<cycles>":""},[i]);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Serial Terminal"}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs("button",{onClick:()=>N(!0),className:"px-3 py-1 text-sm bg-gray-100 rounded inline-flex items-center hover:bg-gray-200",children:[e.jsx(pa,{className:"h-4 w-4 mr-1"})," Help"]}),e.jsx("button",{onClick:s,className:"px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200",children:"Clear"}),e.jsx("button",{onClick:j,className:"px-3 py-1 text-sm bg-gray-100 rounded hover:bg-gray-200",children:"Export"})]})]}),e.jsx("div",{ref:f,className:"flex-1 min-h-0 overflow-auto bg-gray-900 border border-gray-300 rounded p-3 font-mono text-sm",children:l.length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"No messages yet. Connect to your printer to see serial communication."}):e.jsx("div",{className:"space-y-1",children:l.map((_,P)=>e.jsx(yi,{entry:_},P))})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{value:i,onChange:_=>c(_.target.value),onKeyDown:g,placeholder:"Enter G-code (e.g., M114)",className:"flex-1 border border-gray-300 rounded px-3 py-2 text-sm"}),e.jsx("button",{onClick:h,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"}),e.jsx("button",{onClick:()=>p("M112"),className:"px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700",title:"Emergency Stop",children:"E-Stop"})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center justify-between",children:[e.jsx("span",{children:"Tip: Use Up/Down arrows to navigate command history"}),M&&e.jsx("span",{className:"text-indigo-700",children:M})]}),b&&e.jsx(bi,{onInsert:S,onClose:()=>N(!1)})]})},(t,a)=>t.onSend===a.onSend&&t.onSendMany===a.onSendMany&&t.onClear===a.onClear),ji=_e.memo(()=>{const t=V(x=>x.status),a=V(x=>x.baudRate),s=V(x=>x.setBaudRate),r=V(x=>x.autoDetect),l=V(x=>x.setAutoDetect),n=V(x=>x.error),i=V(x=>x.connect),c=V(x=>x.disconnect),o=V(x=>x.sendCommand),m=V(x=>x.sendCommands),u=V(x=>x.clearLogs);return e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsx(ar,{status:t,baudRate:a,setBaudRate:s,autoDetect:r,setAutoDetect:l,error:n,onConnect:i,onDisconnect:c}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Ni,{onSend:o,onSendMany:m,onClear:u})})]})}),vi=[1,10,100];function wi({send:t,requestPosition:a,lastPosition:s}){var x,f,b,N,p,h;const[r,l]=d.useState(10),[n,i]=d.useState({x:"",y:"",z:""}),c=(g,j)=>{t("G91"),t(`G0 ${g}${j*r} F6000`),t("G90")},o=g=>{t(`G28 ${g||""}`.trim())},m=()=>{const g=[];n.x!==""&&g.push(`X${n.x}`),n.y!==""&&g.push(`Y${n.y}`),n.z!==""&&g.push(`Z${n.z}`),g.length!==0&&(t("G90"),t(`G0 ${g.join(" ")} F6000`))};d.useEffect(()=>{const g=setInterval(()=>a&&a(),1500);return()=>clearInterval(g)},[a]);const u=s||{x:0,y:0,z:0,e:0};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Movement"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Step:"}),e.jsx("div",{className:"flex",children:vi.map(g=>e.jsxs("button",{onClick:()=>l(g),className:`px-2 py-1 border text-xs ${r===g?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"} first:rounded-l last:rounded-r -ml-px`,children:["±",g,"mm"]},g))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"X Axis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("X",-1),children:"−X"}),e.jsx("div",{className:"text-sm text-gray-600",children:((f=(x=u.x).toFixed)==null?void 0:f.call(x,2))??u.x}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("X",1),children:"+X"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"Y Axis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Y",-1),children:"−Y"}),e.jsx("div",{className:"text-sm text-gray-600",children:((N=(b=u.y).toFixed)==null?void 0:N.call(b,2))??u.y}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Y",1),children:"+Y"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"Z Axis"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Z",-1),children:"−Z"}),e.jsx("div",{className:"text-sm text-gray-600",children:((h=(p=u.z).toFixed)==null?void 0:h.call(p,2))??u.z}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>c("Z",1),children:"+Z"})]})]})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>o(""),children:"Home All"}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>o("X"),children:"Home X"}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>o("Y"),children:"Home Y"}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded",onClick:()=>o("Z"),children:"Home Z"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 items-end",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"X"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n.x,onChange:g=>i({...n,x:g.target.value})})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Y"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n.y,onChange:g=>i({...n,y:g.target.value})})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Z"}),e.jsx("input",{className:"w-full border border-gray-300 rounded px-2 py-1",value:n.z,onChange:g=>i({...n,z:g.target.value})})]}),e.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:m,children:"Go To"})]})]})}function Si({send:t,preheat:a}){const[s,r]=d.useState(5),[l,n]=d.useState(120),i=o=>{t("G91"),t(`G1 E${o*s} F${l}`),t("G90")},c=()=>{t("M600")};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Extrusion"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>a==null?void 0:a("PLA"),children:"Preheat PLA"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>a==null?void 0:a("PETG"),children:"Preheat PETG"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-end",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Length (mm)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-2 py-1",value:s,onChange:o=>r(parseFloat(o.target.value)||0)})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Speed (mm/min)"}),e.jsx("input",{type:"number",className:"w-full border border-gray-300 rounded px-2 py-1",value:l,onChange:o=>n(parseFloat(o.target.value)||0)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-green-600 text-white rounded",onClick:()=>i(1),children:"Extrude"}),e.jsx("button",{className:"px-3 py-2 bg-red-600 text-white rounded",onClick:()=>i(-1),children:"Retract"}),e.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:c,children:"Filament Change"})]})]})}function Ei({send:t}){const[a,s]=d.useState(0),r=n=>{const i=Math.max(0,Math.min(100,n));s(i);const c=Math.round(i/100*255);t(`M106 S${c}`)},l=()=>{s(0),t("M106 S0")};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Fan"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>r(50),children:"50%"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-gray-100 rounded",onClick:()=>r(100),children:"100%"}),e.jsx("button",{className:"px-2 py-1 text-xs bg-red-600 text-white rounded",onClick:l,children:"Off"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"range",min:0,max:100,value:a,onChange:n=>r(parseInt(n.target.value,10)),className:"w-full"}),e.jsxs("div",{className:"w-12 text-right text-sm text-gray-700",children:[a,"%"]})]})]})}const _i=[-.05,-.02,-.01,.01,.02,.05],Ti=_e.memo(function({send:a,isConnected:s=!1}){const[r,l]=d.useState(0),[n,i]=d.useState("0.02"),c=async m=>{if(!s)return;const u=Number(m);Number.isNaN(u)||u===0||(await a(`M290 Z${u}`),l(x=>Number((x+u).toFixed(3))))},o=async()=>{s&&(await a("M290 R"),l(0))};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Z Babystep"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Δ ",r.toFixed(3)," mm"]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:_i.map(m=>e.jsx("button",{disabled:!s,onClick:()=>c(m),className:`px-2 py-1 rounded text-sm ${s?"bg-gray-100 hover:bg-gray-200":"bg-gray-50 text-gray-400 cursor-not-allowed"}`,title:`M290 Z${m}`,children:m>0?`+${m}`:`${m}`},m))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:`w-24 border rounded px-2 py-1 text-sm ${s?"border-gray-300":"border-gray-200 bg-gray-50 text-gray-400"}`,value:n,onChange:m=>i(m.target.value),placeholder:"0.02"}),e.jsx("button",{disabled:!s,onClick:()=>c(Number(n)),className:`px-3 py-2 rounded text-sm ${s?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:"Apply"}),e.jsx("button",{disabled:!s,onClick:o,className:`ml-auto px-3 py-2 rounded text-sm ${s?"bg-red-600 text-white hover:bg-red-700":"bg-gray-400 text-gray-200 cursor-not-allowed"}`,children:"Reset"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Tip: Negative moves nozzle closer to bed; positive moves away. Real-time during first layer."})]})}),Ci=_e.memo(()=>{const[t,a]=d.useState(null),[s,r]=d.useState(!1),[l,n]=d.useState(!1),i=V(p=>{var h;return((h=p.serialLogs)==null?void 0:h.length)||0}),[c,o]=d.useState([]);d.useEffect(()=>{const h=(V.getState().serialLogs||[]).filter(g=>g.type==="rx"&&(g.message.includes("FIRMWARE_NAME:")||g.message.includes("SOURCE_CODE_URL:")||g.message.includes("PROTOCOL_VERSION:")||g.message.includes("MACHINE_TYPE:")||g.message.includes("EXTRUDER_COUNT:")||g.message.includes("Cap:")));o(h)},[i]);const m=V(p=>p.sendCommand),u=V(p=>p.status);d.useEffect(()=>{if(c.length===0)return;const h=c[c.length-1].message;if(h.includes("FIRMWARE_NAME:")||h.includes("SOURCE_CODE_URL:")||h.includes("PROTOCOL_VERSION:")||h.includes("MACHINE_TYPE:")||h.includes("EXTRUDER_COUNT:")||h.includes("Cap:")){n(!1);const g={firmwareName:x(h,"FIRMWARE_NAME:"),sourceCodeUrl:x(h,"SOURCE_CODE_URL:"),protocolVersion:x(h,"PROTOCOL_VERSION:"),machineType:x(h,"MACHINE_TYPE:"),extruderCount:x(h,"EXTRUDER_COUNT:"),uuid:x(h,"UUID:"),kinematics:x(h,"KINEMATICS:"),capabilities:f(h),rawMessage:h};a(g),r(!0)}},[c]);const x=(p,h)=>{const g=new RegExp(`${h}\\s*([^\\s]+(?:\\s+[^\\s]+)*?)(?=\\s+[A-Z_]+:|$)`),j=p.match(g);return j?j[1].trim():null},f=p=>{const h=[],g=/Cap:([A-Z_]+):(\d+)/g;let j;for(;(j=g.exec(p))!==null;){const S=j[1],M=j[2];h.push({name:S,enabled:M==="1"})}return h},b=async()=>{if(u==="connected"){n(!0),a(null),r(!0);try{await m("M115")}catch(p){console.error("Failed to get firmware info:",p),n(!1)}}},N=()=>{r(!1),a(null)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Firmware Information"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Requesting firmware information..."})]}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.firmwareName&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Firmware Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.firmwareName})]}),t.protocolVersion&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Protocol Version"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.protocolVersion})]}),t.machineType&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Machine Type"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.machineType})]}),t.extruderCount&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Extruder Count"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.extruderCount})]}),t.kinematics&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Kinematics"}),e.jsx("p",{className:"text-sm text-gray-900",children:t.kinematics})]}),t.uuid&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"UUID"}),e.jsx("p",{className:"text-sm text-gray-900 font-mono break-all",children:t.uuid})]})]}),t.sourceCodeUrl&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Source Code URL"}),e.jsx("a",{href:t.sourceCodeUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 break-all",children:t.sourceCodeUrl})]}),t.capabilities&&t.capabilities.length>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Capabilities"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2",children:t.capabilities.map((p,h)=>e.jsxs("div",{className:`px-2 py-1 text-xs rounded flex items-center justify-between ${p.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:[e.jsx("span",{children:p.name}),e.jsx("span",{className:"text-xs",children:p.enabled?"✓":"✗"})]},h))})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Raw Response"}),e.jsx("pre",{className:"text-xs text-gray-600 mt-1 whitespace-pre-wrap",children:t.rawMessage})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No firmware information received. Make sure your printer is connected and supports M115."})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:N,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Close"})})]})}):e.jsx("button",{onClick:b,disabled:u!=="connected",className:"px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Firmware Info"})});function Pi({send:t}){const a=()=>{t("M303 E0 S210 C8")},s=()=>{t("G29")},r=()=>{t("M112")};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Utilities"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:a,children:"PID Tune (E0)"}),e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:s,children:"Bed Leveling"}),e.jsx(Ci,{}),e.jsx("button",{className:"px-3 py-2 bg-red-600 text-white rounded",onClick:r,children:"Emergency Stop"})]})]})}const ir=d.memo(()=>{var l,n,i,c,o,m,u;const t=ue(x=>x.activePrinterId),a=ue(x=>{const f=x.printers.find(b=>b.id===t);return console.log("PrinterSettingsDisplay: activePrinterId:",t),console.log("PrinterSettingsDisplay: activePrinter:",f),console.log("PrinterSettingsDisplay: printerSettings:",f==null?void 0:f.printerSettings),f==null?void 0:f.printerSettings}),s=x=>typeof x=="object"&&x!==null?JSON.stringify(x,null,2):String(x),r=(x,f,b)=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 mr-2"}),x]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:b.map(N=>{const p=f==null?void 0:f[N];return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[N,":"]}),e.jsx("span",{className:"text-gray-900 font-mono text-sm",children:s(p)})]},N)})})]});return a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Printer Settings"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>window.location.href="#/configuration",className:"px-3 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center",children:[e.jsx(va,{className:"w-4 h-4 mr-2"}),"Edit Settings"]})})]}),a.lastUpdated&&e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:["Last updated: ",new Date(a.lastUpdated).toLocaleString()]}),r("Steps Per Unit (M92)",a.stepsPerUnit,["x","y","z","e"]),r("Feedrates (M203)",a.feedrates,["x","y","z","e"]),r("Acceleration (M201/M204)",a.acceleration,["max","print","retract","travel"]),r("Jerk Settings (M205)",(l=a.acceleration)==null?void 0:l.jerk,["x","y","z","e"]),r("Home Offset (M206)",a.homeOffset,["x","y","z"]),r("Z Probe Offset (M851)",a.zProbeOffset,["x","y","z"]),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 mr-2"}),"Bed Leveling (M420)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Enabled:"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${(n=a.bedLeveling)!=null&&n.enabled?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(i=a.bedLeveling)!=null&&i.enabled?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Fade Height:"}),e.jsxs("span",{className:"text-gray-900 font-mono text-sm",children:[(c=a.bedLeveling)==null?void 0:c.fadeHeight,"mm"]})]})]}),((o=a.bedLeveling)==null?void 0:o.mesh)&&a.bedLeveling.mesh.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("h4",{className:"font-medium text-gray-700 mb-2",children:["Mesh Points (",a.bedLeveling.mesh.length,"):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-gray-50 rounded p-2",children:e.jsx("pre",{className:"text-xs font-mono",children:a.bedLeveling.mesh.map((x,f)=>`Point ${f+1}: (${x.i}, ${x.j}) = ${x.z.toFixed(3)}mm`).join(`
`)})})]})]}),r("PID Hotend (M301)",(m=a.pid)==null?void 0:m.hotend,["p","i","d"]),r("PID Bed (M304)",(u=a.pid)==null?void 0:u.bed,["p","i","d"]),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 mr-2"}),"Material Heating (M145)"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Object.entries(a.materialHeating||{}).map(([x,f])=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2 capitalize",children:x}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Hotend:"}),e.jsxs("span",{className:"text-sm font-mono",children:[f.hotend,"°C"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bed:"}),e.jsxs("span",{className:"text-sm font-mono",children:[f.bed,"°C"]})]})]})]},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 mr-2"}),"Other Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Power Loss Recovery:"}),e.jsx("span",{className:`px-2 py-1 rounded text-sm ${a.powerLossRecovery?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.powerLossRecovery?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Linear Advance:"}),e.jsx("span",{className:"text-gray-900 font-mono text-sm",children:a.linearAdvance})]})]})]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No Printer Settings"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Connect to a printer to automatically fetch and view configuration"})]})})});ir.displayName="PrinterSettingsDisplay";const ki=_e.memo(()=>{const t=V(h=>h.status),a=V(h=>h.baudRate),s=V(h=>h.setBaudRate),r=V(h=>h.autoDetect),l=V(h=>h.setAutoDetect),n=V(h=>h.error),i=V(h=>h.connect),c=V(h=>h.disconnect),o=V(h=>h.sendCommand),m=d.useRef(0),[u,x]=d.useState(null),f=d.useCallback(()=>{const h=V.getState().serialLogs||[],g=h.length;if(g<=m.current)return;const j=h.slice(m.current).filter(S=>S.type==="rx"&&/\bX:\s*[-\d.]+/.test(S.message)&&/\bY:\s*[-\d.]+/.test(S.message)&&/\bZ:\s*[-\d.]+/.test(S.message));if(j.length>0){const M=j[j.length-1].message,_={x:parseFloat((M.match(/X:\s*([-\d.]+)/)||[])[1]||0),y:parseFloat((M.match(/Y:\s*([-\d.]+)/)||[])[1]||0),z:parseFloat((M.match(/Z:\s*([-\d.]+)/)||[])[1]||0),e:parseFloat((M.match(/E:\s*([-\d.]+)/)||[])[1]||0)};Number.isNaN(_.x)||x(P=>!P||P.x!==_.x||P.y!==_.y||P.z!==_.z||P.e!==_.e?_:P)}m.current=g},[]);d.useEffect(()=>{const h=setInterval(f,1e3);return()=>clearInterval(h)},[f]);const b=()=>o("M114"),N=h=>o(h),p=h=>{h==="PLA"&&(N("M104 S205"),N("M140 S60")),h==="PETG"&&(N("M104 S235"),N("M140 S80"))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ar,{status:t,baudRate:a,setBaudRate:s,autoDetect:r,setAutoDetect:l,error:n,onConnect:i,onDisconnect:c}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(wi,{send:N,requestPosition:b,lastPosition:u}),e.jsx(Xs,{send:N,isConnected:t==="connected"}),e.jsx(Si,{send:N,preheat:p}),e.jsx(Ei,{send:N}),e.jsx(Ti,{send:N,isConnected:t==="connected"}),e.jsx(Pi,{send:N})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Bed Leveling"}),e.jsx(zs,{showStatus:!1,showActions:!1})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Printer Settings"}),e.jsx(ir,{})]})]})},(t,a)=>!0),Ut=new Map;async function Mi(t){if(Ut.has(t))return Ut.get(t);try{const a=await fetch(`/src/gcode/${t}`);if(!a.ok)throw new Error(`Failed to load ${t}: ${a.statusText}`);const s=await a.text();return Ut.set(t,s),s}catch(a){throw console.error(`Error loading G-code file ${t}:`,a),a}}const Ri={"first-layer":{filename:"firstlayer.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0}},"temperature-tower":{filename:"temperature-tower.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:"G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:";M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!0,restoreABL:!1}},"retraction-tuning":{filename:"retraction.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-5",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:5,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0}},"flow-rate":{filename:"flow-rate.gcode",parameters:{bedTemp:{placeholder:"S90",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S255",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.4",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-3.2",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2700",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:90,hotendTemp:255,finalHotendTemp:235,layerHeight:.4,retractionDistance:3.2,retractionSpeed:2700,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!1}},"calibration-cube":{filename:"calibration-cube.gcode",parameters:{bedTemp:{placeholder:"S80",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S185",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S235",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.280",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2400",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F3300",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F11000",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:80,hotendTemp:185,finalHotendTemp:235,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0}},"speed-calibration":{filename:"speed.gcode",parameters:{bedTemp:{placeholder:"S50",description:"Bed temperature (°C)"},hotendTemp:{placeholder:"S240",description:"Initial hotend temperature (°C)"},finalHotendTemp:{placeholder:"S240",description:"Final hotend temperature (°C)"},layerHeight:{placeholder:"Z0.28",description:"Layer height (mm)"},retractionDistance:{placeholder:"E-6",description:"Retraction distance (mm)"},retractionSpeed:{placeholder:"F2700",description:"Retraction speed (mm/min)"},printSpeed:{placeholder:"F1500",description:"Print speed (mm/min)"},travelSpeed:{placeholder:"F7500",description:"Travel speed (mm/min)"},enableABL:{placeholder:";G29",description:"Enable auto bed leveling (G29)"},restoreABL:{placeholder:"M420 S1",description:"Restore ABL mesh"}},defaultValues:{bedTemp:50,hotendTemp:240,finalHotendTemp:240,layerHeight:.28,retractionDistance:6,retractionSpeed:2700,printSpeed:1500,travelSpeed:7500,enableABL:!1,restoreABL:!1}}};async function st(t,a={}){const s=Ri[t];if(!s)throw new Error(`No G-code configuration found for step: ${t}`);const r=await Mi(s.filename),l={...s.defaultValues,...a};let n=r;for(const[i,c]of Object.entries(s.parameters)){const o=l[i],m=c.placeholder;if(typeof o=="boolean")o?n=n.replace(`;${m}`,m):n=n.replace(m,`;${m}`);else{const u=new RegExp(m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g");n=n.replace(u,m.replace(/\d+\.?\d*/,o))}}return{gcode:n,parameters:l,stepConfig:s}}const Ae=[{id:"bed-leveling",title:"Bed Leveling",name:"Bed Leveling",description:"Probe the bed surface and analyze flatness to ensure proper first layer adhesion",category:"Movement",requiresSave:!0,videoUrl:"https://www.youtube.com/watch?v=Kj4x1P1R3sE",instructions:["Ensure your printer has a bed leveling probe (BLTouch, inductive sensor, etc.)","Clear the bed surface of any debris or residue","Make sure the bed is at room temperature","Run the bed leveling sequence (G29)","Analyze the mesh data for flatness and variation","Adjust bed screws or probe offset if needed"],visualAids:[],commonIssues:[{issue:"Bed not flat enough",solution:"Adjust bed screws, check for warped bed, or use manual leveling first"},{issue:"Probe not triggering",solution:"Check probe wiring, adjust trigger distance, or clean probe tip"},{issue:"Inconsistent readings",solution:"Check probe mounting, ensure stable bed temperature, clean bed surface"}],expectedOutcomes:"Bed flatness within ±0.1mm variation across the entire surface",checklist:["Bed leveling probe installed and calibrated","Bed surface clean and free of debris","Bed at room temperature","Probe trigger distance properly set","No obstructions in probe path"],inputs:[{type:"number",label:"Probe Speed (mm/min)",key:"probeSpeed",defaultValue:300,min:100,max:1e3,step:50,required:!0},{type:"number",label:"Probe Grid Size",key:"gridSize",defaultValue:5,min:3,max:9,step:1,required:!0},{type:"number",label:"Probe Z-Offset (mm)",key:"probeZOffset",defaultValue:0,min:-5,max:5,step:.01,required:!0},{type:"checkbox",label:"Enable Bed Heating",key:"enableBedHeating",defaultValue:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0}],gcode:t=>{const{probeSpeed:a,gridSize:s,probeZOffset:r,enableBedHeating:l,bedTemp:n}=t;let i=`; Bed Leveling Calibration
`;return i+=`; Grid size: ${s}x${s}, Probe speed: ${a}mm/min
`,i+=`; Z-offset: ${r}mm
`,i+=`G90
`,i+=`M82
`,i+=`; Home all axes
`,i+=`G28
`,l&&(i+=`; Heat bed to ${n}°C for consistent probing
`,i+=`M140 S${n}
`,i+=`M190 S${n}
`),i+=`; Set probe speed
`,i+=`M203 Z${a}
`,i+=`; Set probe Z-offset
`,i+=`M851 Z${r}
`,i+=`; Save probe settings
`,i+=`M500
`,i+=`; Enable bed leveling
`,i+=`M420 S1
`,i+=`; Run bed leveling (G29)
`,i+=`G29
`,i+=`; Get mesh data
`,i+=`M420 V
`,i+=`; Move to center for inspection
`,i+=`G0 X110 Y110 Z5
`,i+=`; Move up for safety
`,i+=`G0 Z20
`,l&&(i+=`; Turn off bed heater
`,i+=`M140 S0
`),i+=`M84
`,i}},{id:"pid-autotune",title:"PID Autotune",name:"PID Autotune",description:"Calibrate the PID values for your hotend and bed to achieve stable temperatures",category:"Temperature",requiresSave:!0,videoUrl:"https://www.youtube.com/watch?v=APzJfYAgFkQ",instructions:["Preheat the hotend and bed to approximate target temperatures.","Ensure no filament is loaded or disable extrusion during tuning.","Run PID autotune for the hotend and bed (if supported).","Save the tuned PID values to EEPROM with M500.","Test stability during a small print."],visualAids:[],commonIssues:[{issue:"Temperature oscillates after tuning",solution:"Increase cycles or re-run autotune closer to operating temp."},{issue:"Heater fault during tuning",solution:"Lower target temperature, ensure thermistor contact, check wiring."}],expectedOutcomes:"Stable temperature traces with minimal overshoot (≤2°C) and fast settling time.",checklist:["Printer powered and idle","Thermistors connected and reading correctly","Nozzle clear and safe (no filament required)"],inputs:[{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:200,min:150,max:280,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"number",label:"Number of Cycles",key:"cycles",defaultValue:8,min:3,max:20,step:1,required:!0},{type:"checkbox",label:"Include Bed PID Tune",key:"includeBed",defaultValue:!0}],gcode:t=>{const{hotendTemp:a,bedTemp:s,cycles:r,includeBed:l}=t;let n=`; PID Autotune for ${a}°C hotend, ${s}°C bed, ${r} cycles
`;return n+=`M303 E0 S${a} C${r}
`,l&&(n+=`M303 E-1 S${s} C${r}
`),n+="; After completion, save the new PID values with M500",n}},{id:"extruder-esteps",title:"Extruder E-Steps Calibration",name:"Extruder E-Steps Calibration",description:"Calibrate the extruder steps per mm to ensure accurate filament extrusion",category:"Movement",requiresSave:!0,videoUrl:"https://www.youtube.com/watch?v=7tCxO17XZtw",instructions:["Heat the hotend to printing temperature (e.g., 200°C).","Mark filament at 120mm from the extruder entry.","Extrude 100mm of filament using controlled feed.","Measure remaining distance to entry to find actual extruded amount.","Compute new E-steps = (Current E-steps × Requested) ÷ Actual."],visualAids:[],commonIssues:[{issue:"Under-extrusion",solution:"Increase E-steps using measured actual extrusion."},{issue:"Slipping",solution:"Increase idler tension, clean drive gear, slow extrusion speed."}],expectedOutcomes:"Extrusion distances match requested within ±1mm over 100mm.",checklist:["Hotend heated to target temperature","Filament loaded and feeding","Extruder gear clean and tension set"],inputs:[{type:"number",label:"Current E-Steps/mm",key:"currentEsteps",defaultValue:93,min:50,max:200,step:.1,required:!0},{type:"number",label:"Distance to Extrude (mm)",key:"extrudeDistance",defaultValue:100,min:50,max:200,step:5,required:!0},{type:"number",label:"Filament Diameter (mm)",key:"filamentDiameter",defaultValue:1.75,min:1,max:3,step:.01,required:!0},{type:"checkbox",label:"Use Filament Diameter",key:"useFilamentDiameter",defaultValue:!0}],gcode:t=>{const{currentEsteps:a,extrudeDistance:s,filamentDiameter:r,useFilamentDiameter:l}=t;let n=`; E-Steps Calibration
`;return n+=`; Current E-steps: ${a}
`,n+=`; Extrude distance: ${s}mm
`,l?(n+=`; Filament diameter: ${r}mm
`,n+=`M92 E${a}
`,n+=`M500
`,n+=`; Heat hotend to 200°C first
`,n+=`M104 S200
`,n+=`M190 S60
`,n+=`; Extrude filament
`,n+=`G92 E0
`,n+=`G1 E${s} F100
`,n+=`; Measure actual extrusion and calculate new E-steps
`,n+="; New E-steps = (Current E-steps × Requested distance) ÷ Actual distance"):(n+=`M92 E${a}
`,n+=`M500
`,n+=`; Heat hotend to 200°C first
`,n+=`M104 S200
`,n+=`M190 S60
`,n+=`; Extrude filament
`,n+=`G92 E0
`,n+=`G1 E${s} F100
`,n+=`; Measure actual extrusion and calculate new E-steps
`,n+="; New E-steps = (Current E-steps × Requested distance) ÷ Actual distance"),n}},{id:"retraction-tuning",title:"Retraction Tuning",name:"Retraction Tuning",description:"Optimize retraction settings to eliminate stringing and oozing",requiresSave:!0,category:"Quality",videoUrl:"https://www.youtube.com/watch?v=Z2hZKx9F9_s",instructions:["Load a stringing test model or use generated test moves.","Start with moderate retraction and speed.","Observe stringing between towers and adjust values.","Repeat until stringing is minimized without causing jams."],visualAids:[],commonIssues:[{issue:"Stringing persists",solution:"Increase retraction distance and/or temperature tuning; enable coasting."},{issue:"Grinding/jams",solution:"Reduce retraction speed and distance; check path and PTFE."}],expectedOutcomes:"Minimal or no stringing; clean travel moves; no filament grinding.",checklist:["Hotend clean and free of debris","Filament dry and within spec","Nozzle temperature verified"],inputs:[{type:"number",label:"Starting Retraction Distance (mm)",key:"startRetraction",defaultValue:5,min:0,max:20,step:.5,required:!0},{type:"number",label:"Ending Retraction Distance (mm)",key:"endRetraction",defaultValue:1.5,min:0,max:20,step:.5,required:!0},{type:"number",label:"Retraction Steps",key:"retractionSteps",defaultValue:5,min:2,max:10,step:1,required:!0},{type:"number",label:"Retraction Speed (mm/s)",key:"retractionSpeed",defaultValue:45,min:10,max:100,step:5,required:!0},{type:"number",label:"Z-Hop Height (mm)",key:"zHop",defaultValue:.2,min:0,max:1,step:.1,required:!0},{type:"checkbox",label:"Enable Z-Hop",key:"enableZHop",defaultValue:!0},{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:200,min:150,max:280,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"number",label:"Test Distance (mm)",key:"testDistance",defaultValue:50,min:20,max:100,step:5,required:!0}],gcode:async t=>{const{startRetraction:a,endRetraction:s,retractionSteps:r,retractionSpeed:l,zHop:n,enableZHop:i,testDistance:c,hotendTemp:o,bedTemp:m}=t,u={bedTemp:m,hotendTemp:o-50,finalHotendTemp:o,layerHeight:.28,retractionDistance:a,retractionSpeed:l*60,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!0};try{return(await st("retraction-tuning",u)).gcode}catch(x){return console.error("Error generating parameterized G-code:",x),`; Retraction Tuning
G90
M82
M140 S${m}
M190 S${m}
M104 S${o}
M109 S${o}
G28
G0 Z3
; Add your retraction test pattern here`}}},{id:"first-layer",title:"First Layer Calibration",name:"First Layer Calibration",description:"Calibrate the first layer height and bed leveling for perfect adhesion",requiresSave:!1,category:"Quality",videoUrl:"https://www.youtube.com/watch?v=Kj4x1P1R3sE",instructions:["Clean the build surface and remove residue.","Home all axes and level bed using ABL or manual paper method.","Adjust Z-offset while printing a first-layer test.","Inspect line width, squish, and adhesion; adjust as needed."],visualAids:[],commonIssues:[{issue:"Poor adhesion",solution:"Increase bed temp, clean surface, adjust Z-offset lower (closer)."},{issue:"Elephant foot",solution:"Lower bed temp slightly, raise first layer Z-offset, add chamfer."}],expectedOutcomes:"Uniform, slightly squished lines with consistent width and strong adhesion.",checklist:["Bed is clean and free of oils","Nozzle is clean","Bed leveling completed"],inputs:[{type:"number",label:"Layer Height (mm)",key:"layerHeight",defaultValue:.2,min:.1,max:.4,step:.05,required:!0},{type:"number",label:"First Layer Height (mm)",key:"firstLayerHeight",defaultValue:.2,min:.1,max:.4,step:.05,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:200,min:150,max:280,step:5,required:!0},{type:"number",label:"Print Speed (mm/s)",key:"printSpeed",defaultValue:20,min:10,max:60,step:5,required:!0},{type:"checkbox",label:"Enable Bed Leveling",key:"enableBedLeveling",defaultValue:!0}],gcode:async t=>{const{layerHeight:a,firstLayerHeight:s,bedTemp:r,hotendTemp:l,printSpeed:n,enableBedLeveling:i}=t,c={bedTemp:r,hotendTemp:l-50,finalHotendTemp:l,layerHeight:s,retractionDistance:6,retractionSpeed:2400,printSpeed:n*60,travelSpeed:11e3,enableABL:i,restoreABL:i};try{return(await st("first-layer",c)).gcode}catch(o){return console.error("Error generating parameterized G-code:",o),`; First Layer Calibration
G90
M82
M140 S${r}
M190 S${r}
M104 S${l}
G28
M109 S${l}
G0 Z3
; Add your first layer test pattern here`}}},{id:"flow-rate",title:"Flow Rate Calibration",name:"Flow Rate Calibration",description:"Calibrate the flow rate to achieve accurate wall thickness and dimensions",requiresSave:!0,category:"Quality",videoUrl:"https://www.youtube.com/watch?v=3-p7u0qv2bM",instructions:["Print a single-wall cube or use a generated line.","Measure wall thickness accurately with calipers.","Compute new flow = expected × current ÷ actual.","Apply new flow and re-test."],visualAids:[],commonIssues:[{issue:"Walls too thin",solution:"Increase flow rate or check extrusion path for leaks."},{issue:"Walls too thick",solution:"Decrease flow rate; verify nozzle diameter and slicer settings."}],expectedOutcomes:"Measured wall thickness within ±0.02 mm of expected for single-wall test.",checklist:["Calipers available and zeroed","Nozzle diameter known and configured","Single-wall model sliced with correct width"],inputs:[{type:"number",label:"Current Flow Rate (%)",key:"currentFlow",defaultValue:100,min:50,max:150,step:1,required:!0},{type:"number",label:"Wall Thickness (mm)",key:"wallThickness",defaultValue:.4,min:.2,max:1,step:.1,required:!0},{type:"number",label:"Nozzle Diameter (mm)",key:"nozzleDiameter",defaultValue:.4,min:.2,max:1,step:.1,required:!0},{type:"checkbox",label:"Print Test Cube",key:"printTestCube",defaultValue:!0},{type:"number",label:"Hotend Temperature (°C)",key:"hotendTemp",defaultValue:235,min:180,max:280,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:80,min:0,max:120,step:5,required:!0}],gcode:async t=>{const{currentFlow:a,wallThickness:s,nozzleDiameter:r,printTestCube:l,hotendTemp:n,bedTemp:i}=t,c={bedTemp:i||80,hotendTemp:(n||235)-50,finalHotendTemp:n||235,layerHeight:.4,retractionDistance:3.2,retractionSpeed:2700,printSpeed:3300,travelSpeed:11e3,enableABL:!1,restoreABL:!1};try{const o=await st("flow-rate",c);let m=`; Flow Rate Calibration
`;return m+=`; Current flow: ${a}%, Wall thickness: ${s}mm
`,m+=`; Nozzle: ${r}mm
`,m+=`; Set flow rate
`,m+=`M221 S${a}
`,m+=`M500

`,l&&(m+=`; Print flow rate test cube
`,m+=`; Measure wall thickness with calipers
`,m+=`; Calculate new flow rate:
`,m+=`; New Flow = (Expected thickness × Current flow) ÷ Actual thickness
`,m+=`; Use M221 S<value> to set new flow rate
`,m+=`; Use M500 to save

`),m+=o.gcode,m}catch(o){return console.error("Error generating parameterized G-code:",o),`; Flow Rate Calibration
; Current flow: ${a}%, Wall thickness: ${s}mm
; Nozzle: ${r}mm
; Set flow rate
M221 S${a}
M500
; Print test cube and measure wall thickness`}}},{id:"temperature-tower",title:"Temperature Tower",name:"Temperature Tower",description:"Find the optimal printing temperature for your filament",requiresSave:!1,category:"Temperature",videoUrl:"https://www.youtube.com/watch?v=0Y2YxYf-7xU",instructions:["Slice a temperature tower with scripted temperature changes.","Print the model and note artifacts at each temperature.","Select the range with best surface quality and bridging."],visualAids:[],commonIssues:[{issue:"Poor bridging in all segments",solution:"Increase cooling, reduce speed, and adjust temperature lower."}],expectedOutcomes:"A selected temperature range with crisp details, minimal stringing, and strong layer adhesion.",checklist:["Cooling fan functional","Stable filament feed","Bed adhesion consistent"],inputs:[{type:"number",label:"Start Temperature (°C)",key:"startTemp",defaultValue:220,min:180,max:280,step:5,required:!0},{type:"number",label:"End Temperature (°C)",key:"endTemp",defaultValue:180,min:150,max:250,step:5,required:!0},{type:"number",label:"Temperature Step (°C)",key:"tempStep",defaultValue:10,min:5,max:20,step:5,required:!0},{type:"number",label:"Bed Temperature (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0},{type:"checkbox",label:"Include Bed Temperature",key:"includeBed",defaultValue:!0}],gcode:async t=>{const{startTemp:a,endTemp:s,tempStep:r,bedTemp:l,includeBed:n}=t,i={bedTemp:n?l:0,hotendTemp:a-50,finalHotendTemp:a,layerHeight:.28,retractionDistance:6,retractionSpeed:2400,printSpeed:3300,travelSpeed:11e3,enableABL:!0,restoreABL:!1};try{return(await st("temperature-tower",i)).gcode}catch(c){return console.error("Error generating parameterized G-code:",c),`; Temperature Tower
G90
M82
M140 S${l}
M190 S${l}
M104 S${a}
G28
M109 S${a}
G0 Z3
; Add your temperature tower pattern here`}}}];Ae.push({id:"calibration-cube",title:"Calibration Cube",name:"Calibration Cube",description:"Print a 20 mm calibration cube to verify dimensional accuracy and general print health",requiresSave:!1,category:"Quality",videoUrl:"https://www.youtube-nocookie.com/embed/2RPO4mDFN70",instructions:["Use this cube to validate X/Y/Z dimensions, first-layer adhesion, and general motion.","Measure each axis with calipers after printing and compare against 20 mm.","Adjust steps/mm or flow if dimensional errors are consistent."],visualAids:[],commonIssues:[{issue:"Elephant foot",solution:"Lower bed temp slightly or add chamfer; adjust first-layer Z-offset."},{issue:"Over/under extrusion",solution:"Tune flow rate and retraction settings."},{issue:"Ringing/ghosting",solution:"Reduce acceleration/jerk and speed."}],expectedOutcomes:"Cube measures close to 20.00 mm on X/Y/Z with clean walls and corners.",checklist:["Bed clean and leveled","Filament dry and consistent diameter","Temperatures appropriate for filament"],inputs:[{type:"number",label:"Cube Size (mm)",key:"cubeSize",defaultValue:20,min:10,max:40,step:1,required:!0},{type:"number",label:"Layer Height (mm)",key:"layerHeight",defaultValue:.2,min:.08,max:.36,step:.02,required:!0},{type:"number",label:"Perimeters",key:"perimeters",defaultValue:2,min:1,max:5,step:1,required:!0},{type:"number",label:"Top/Bottom Layers",key:"solidLayers",defaultValue:4,min:2,max:10,step:1,required:!0},{type:"number",label:"Infill (%)",key:"infill",defaultValue:15,min:0,max:40,step:5,required:!0},{type:"number",label:"Print Speed (mm/s)",key:"printSpeed",defaultValue:50,min:20,max:120,step:5,required:!0},{type:"number",label:"Hotend Temp (°C)",key:"hotendTemp",defaultValue:205,min:170,max:280,step:5,required:!0},{type:"number",label:"Bed Temp (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0}],gcode:t=>{const a=typeof window<"u"&&window.__PRINTER_BED__||{x:220,y:220},s=Math.max(10,Math.min(60,t.cubeSize||20)),r=Math.max(.08,Math.min(.4,t.layerHeight||.2)),l=Math.max(1,Math.min(5,t.perimeters||2)),n=Math.max(2,Math.min(10,t.solidLayers||4)),i=Math.max(0,Math.min(100,t.infill||15)),c=Math.max(10,Math.min(150,t.printSpeed||50)),o=Math.round(c*60),m=Math.max(0,t.hotendTemp||205),u=Math.max(0,t.bedTemp||60),x=20,f=Math.min(Math.max(x+s/2,a.x/2),a.x-x-s/2),b=Math.min(Math.max(x+s/2,a.y/2),a.y-x-s/2),N=(f-s/2).toFixed(3),p=(f+s/2).toFixed(3),h=(b-s/2).toFixed(3),g=(b+s/2).toFixed(3);let j="";j+=`; Calibration Cube ${s}mm
G90
M82
M106 S0
`,j+=`M140 S${u}
M190 S${u}
`,j+=`M104 S${m}
M109 S${m}
`,j+=`G28
G1 Z3 F1200
G92 E0
`;const S=Math.max(x,f-s).toFixed(2),M=Math.max(x,b-30).toFixed(2),_=Math.min(a.y-x,b+30).toFixed(2);j+=`G1 X${S} Y${M} F9000
G1 Z${r.toFixed(3)} F1200
G1 E2 F1500
G92 E0
`,j+=`G1 Y${_} E6 F${o}
G92 E0
`;const E=Math.max(1,Math.round(s/r)),F=.8;let v=r;for(let C=0;C<E;C++){j+=`; Layer ${C+1}/${E}
`,j+=`G1 Z${v.toFixed(3)} F1200
`;for(let w=0;w<l;w++){const k=w*.4,H=(parseFloat(N)+k).toFixed(3),K=(parseFloat(p)-k).toFixed(3),z=(parseFloat(h)+k).toFixed(3),Z=(parseFloat(g)-k).toFixed(3);j+=`G92 E0
G1 X${H} Y${z} F9000
`,j+=`G1 X${K} Y${z} E${F.toFixed(3)} F${o}
`,j+=`G1 X${K} Y${Z} E${(F*2).toFixed(3)}
`,j+=`G1 X${H} Y${Z} E${(F*3).toFixed(3)}
`,j+=`G1 X${H} Y${z} E${(F*4).toFixed(3)}
`}if(!(C<n||C>=E-n)&&i>0){const w=Math.max(2,Math.floor(s/2));for(let k=0;k<w;k++){const H=k/(w-1),K=(parseFloat(h)+.6+H*(s-1.2)).toFixed(3),z=k%2===0,Z=z?N:p,ne=z?p:N;j+=`G1 X${Z} Y${K} F9000
G92 E0
`,j+=`G1 X${ne} Y${K} E${(s*.04*(i/100)).toFixed(3)} F${o}
`}}v+=r}return j+=`M106 S0
M104 S0
M140 S0
G1 Z${(v+5).toFixed(2)} F1200
M84
`,j}},{id:"speed-calibration",title:"Speed Calibration",name:"Speed Calibration",description:"Print progressive speed lines to find the fastest reliable print speed without artifacts",requiresSave:!1,category:"Speed",videoUrl:"https://www.youtube-nocookie.com/embed/U9B6hVZ7S9U",instructions:["This test draws multiple line passes at increasing speeds across the bed.","Inspect for under-extrusion, ringing, or missed steps as speed increases.","Choose the highest speed with acceptable quality and no skipped steps."],visualAids:[],commonIssues:[{issue:"Ringing/ghosting",solution:"Lower acceleration/jerk and top speed, improve frame rigidity."},{issue:"Under-extrusion at high speed",solution:"Increase temperature slightly or reduce speed."},{issue:"Layer shifts",solution:"Reduce speed or acceleration; check belt tension and stepper current."}],expectedOutcomes:"Clear determination of maximum usable speed without major artifacts.",checklist:["Belts tensioned and pulleys tight","Nozzle and extruder in good condition","Filament dry and consistent"],inputs:[{type:"number",label:"Start Speed (mm/s)",key:"startSpeed",defaultValue:40,min:10,max:150,step:5,required:!0},{type:"number",label:"End Speed (mm/s)",key:"endSpeed",defaultValue:120,min:20,max:300,step:5,required:!0},{type:"number",label:"Speed Step (mm/s)",key:"stepSpeed",defaultValue:10,min:5,max:50,step:5,required:!0},{type:"number",label:"Line Length (mm)",key:"lineLength",defaultValue:160,min:60,max:220,step:10,required:!0},{type:"number",label:"Hotend Temp (°C)",key:"hotendTemp",defaultValue:210,min:170,max:280,step:5,required:!0},{type:"number",label:"Bed Temp (°C)",key:"bedTemp",defaultValue:60,min:0,max:120,step:5,required:!0}],gcode:async t=>{const{startSpeed:a,endSpeed:s,stepSpeed:r,lineLength:l,hotendTemp:n,bedTemp:i}=t,c={bedTemp:i||50,hotendTemp:n||240,finalHotendTemp:n||240,layerHeight:.28,retractionDistance:6,retractionSpeed:2700,printSpeed:1500,travelSpeed:7500,enableABL:!1,restoreABL:!1};try{const o=await st("speed-calibration",c);let m=`; Speed Calibration
`;return m+=`; Speed range: ${a||40} to ${s||120} mm/s (step: ${r||10} mm/s)
`,m+=`; Line length: ${l||160} mm
`,m+=`; Hotend: ${n||240}°C, Bed: ${i||50}°C

`,m+=`; This test prints progressive speed lines to find maximum reliable speed
`,m+=`; Inspect for under-extrusion, ringing, or missed steps as speed increases
`,m+=`; Choose the highest speed with acceptable quality and no skipped steps

`,m+=o.gcode,m}catch(o){return console.error("Error generating parameterized G-code:",o),`; Speed Calibration
; Speed range: ${a||40} to ${s||120} mm/s
; Line length: ${l||160} mm
; Hotend: ${n||240}°C, Bed: ${i||50}°C
; Print speed test lines and inspect for quality issues`}}});const Ai=d.memo(({onBackToDashboard:t})=>{var p,h,g;const[a,s]=d.useState("config");_s();const r=qt(),{status:l,sendCommand:n}=At(),i=r(),c=d.useMemo(()=>({serialStatus:l,sendCommand:n}),[l,n]),o=[{id:"monitor",name:"Print Monitor",icon:ya,description:"Monitor and control active prints",component:()=>window.location.href="#/control"},{id:"calibration-workflow",name:"Calibration Workflow",icon:os,description:"Guided step-by-step calibration process",component:()=>window.location.href="#/calibration"},{id:"config",name:"Printer Configuration",icon:ye,description:"Basic printer settings and information",component:cs},{id:"profilesMaterials",name:"Profiles & Materials",icon:Te,description:"Manage slicer profiles and materials together",component:pi,category:"Profiles"},{id:"firmwareConfig",name:"Firmware Configuration",icon:Te,description:"Parse and analyze Marlin firmware files",component:Wa},{id:"control",name:"Control",icon:Ea,description:"Manual control for movement, temperatures, extrusion, and more",component:ki,category:"Diagnostics"},{id:"serial",name:"Terminal",icon:Pa,description:"USB serial connection and G-code terminal",component:ji,category:"Diagnostics"},{id:"issueTracker",name:"Issue Tracker",icon:Ne,description:"Track and manage printer issues and diagnostics",component:Bn,category:"Diagnostics"},...Ae.map(j=>({id:j.id,name:j.title,icon:j.category==="Temperature"?Re:j.category==="Movement"?os:j.category==="Quality"?ye:Ie,description:j.description,component:()=>e.jsx(An,{step:j,onComplete:m,...c}),category:j.category}))];if(!i)return e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-800 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(it,{className:"h-16 w-16 text-gray-300 dark:text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Printer Selected"}),e.jsx("button",{onClick:t,className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-white px-4 py-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})]})});const m=j=>{console.log(`Calibration step ${j} completed`)},u=j=>{var M,_;if(j==="config")return"available";if(j==="firmwareConfig"){const P=(M=i.calibrationSteps)==null?void 0:M.firmwareConfig;return P?P.completed?"completed":"in-progress":"pending"}const S=(_=i.calibrationSteps)==null?void 0:_[j];return S?S.completed?"completed":"in-progress":"pending"},x=j=>{if(Ae.some(_=>_.id===j)){const _=u(j);return _==="completed"?fe:ut}const M=o.find(_=>_.id===j);return(M==null?void 0:M.icon)||ut},f=j=>{if(Ae.some(M=>M.id===j)){const M=u(j);return M==="completed"?"text-green-500":M==="in-progress"?"text-yellow-500":"text-gray-400 dark:text-gray-500"}return"text-gray-600 dark:text-gray-300"},b=((p=o.find(j=>j.id===a))==null?void 0:p.component)||cs,N=o.reduce((j,S)=>{if(S.id==="config"||S.id==="firmwareConfig")j.Configuration||(j.Configuration=[]),j.Configuration.push(S);else{const M=S.category||"Other";j[M]||(j[M]=[]),j[M].push(S)}return j},{});return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-800 dark:bg-gray-900 flex",children:[e.jsxs("div",{className:"w-64 bg-white dark:bg-gray-800 shadow-lg border-r border-gray-200 dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{onClick:t,className:"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Wt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Kt,{className:"h-6 w-6"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:i.name})]}),e.jsx(Jt,{})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:i.model}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:i.firmware})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"space-y-4",children:Object.entries(N).map(([j,S])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2",children:j}),e.jsx("div",{className:"space-y-2",children:S.map(M=>{const _=x(M.id),P=f(M.id),E=a===M.id;return e.jsxs("button",{onClick:()=>s(M.id),className:`w-full flex items-center space-x-3 p-3 rounded-lg text-left transition-colors ${E?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 text-blue-700 dark:text-blue-300":"hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(_,{className:`h-5 w-5 ${P}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:M.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:M.description})]})]},M.id)})})]},j))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(ga,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"3D Printer Suite"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:i.calibrationSteps&&`${Object.values(i.calibrationSteps).filter(j=>j==null?void 0:j.completed).length}/${Object.keys(i.calibrationSteps).length} steps completed`})]})})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:(h=o.find(j=>j.id===a))==null?void 0:h.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:(g=o.find(j=>j.id===a))==null?void 0:g.description})]})}),e.jsx("div",{className:"p-6",children:e.jsx(b,{})})]})]})},(t,a)=>t.onBackToDashboard===a.onBackToDashboard&&t.selectedStep===a.selectedStep);/**
  * @reach/utils v0.18.0
  *
  * Copyright (c) 2018-2022, React Training LLC
  *
  * This source code is licensed under the MIT license found in the
  * LICENSE.md file in the root directory of this source tree.
  *
  * @license MIT
  */function lr(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Ht(t,a){return s=>{if(t&&t(s),!s.defaultPrevented)return a(s)}}function Ii(t){return typeof t=="boolean"}function yt(t){return!!(t&&{}.toString.call(t)=="[object Function]")}function Di(t,a){if(t!=null)if(yt(t))t(a);else try{t.current=a}catch{throw new Error(`Cannot assign value "${a}" to ref "${t}"`)}}function It(...t){return d.useCallback(a=>{for(let s of t)Di(s,a)},t)}function or(t){return lr()?t?t.ownerDocument:document:null}function Li(t){let a=or(t);return a?a.defaultView||window:null}function Oi(t){let a=Li(t);return a?a.getComputedStyle(t,null):null}function Fi(t,a){var s;return((s=Oi(t))==null?void 0:s.getPropertyValue(a))||null}function Ui(t,a){let s=d.createContext(a);function r(n){let{children:i,...c}=n,o=d.useMemo(()=>c,Object.values(c));return d.createElement(s.Provider,{value:o},i)}function l(n){let i=d.useContext(s);if(i)return i;if(a)return a;throw Error(`${n} must be rendered inside of a ${t} component.`)}return s.displayName=`${t}Context`,r.displayName=`${t}Provider`,[r,l]}function Pt(...t){return t.filter(a=>a!=null).join("--")}function kt(){}function Bi({controlledValue:t,defaultValue:a,calledFrom:s="A component"}){let r=t!==void 0,l=d.useRef(r);!l.current&&r&&console.warn(`${s} is changing from controlled to uncontrolled. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),l.current&&!r&&console.warn(`${s} is changing from uncontrolled to controlled. Components should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`);let[n,i]=d.useState(l.current?t:a),c=d.useCallback(o=>{l.current||i(o)},[]);return[l.current?t:n,c]}function zi(){let[,t]=d.useState(Object.create(null));return d.useCallback(()=>{t(Object.create(null))},[])}var ts=lr()?d.useLayoutEffect:d.useEffect;function cr(t,a){let[s,r]=d.useState(a),l=d.useCallback(n=>{t.current=n,r(n)},[]);return[s,l]}function dr(t,a={}){const s=[];let r=d.createContext({descendants:s,registerDescendant:()=>kt,...a});return r.displayName=t,r}function mr(t,a,s){let r=zi(),{registerDescendant:l,descendants:n}=d.useContext(a),i=s??n.findIndex(c=>c.element===t.element);return ts(()=>(t.element||r(),l({...t,index:i})),[t,r,i,l,...Object.values(t)]),i}function ur(){return d.useState([])}function $i(t){return d.useContext(t).descendants}function xr({context:t,children:a,items:s,set:r}){let l=d.useCallback(({element:n,index:i,...c})=>n?(r(o=>{if(i!=null&&i!==-1)return Ns(o,{element:n,index:i,...c},i);if(o.length===0)return[{...c,element:n,index:0}];if(o.find(x=>x.element===n))return console.warn(`[reach-ui]: \`useDescendant\` was called with an element that was already registered.

If you are using the \`@reach/descendants\` package directly, make sure to only register descendants once. Registering a descendant more than once will lead to bugs in your app.

If you are using another \`reach-ui\` package, this is probably our bug!

To report a bug, open a new issue:

  https://github.com/reach/reach-ui/issues/new?assignees=&labels=&template=Bug_report.md

IMPORTANT: this check will only run in the development build, so if you see this warning please be aware that your app may crash when deployed.`),Hi(o);let m=Vi(o,n),u;return m===-1?u=[...o,{...c,element:n,index:o.length}]:u=Ns(o,{...c,element:n,index:m},m),u}),()=>{n&&r(o=>o.filter(m=>n!==m.element))}):kt,[]);return d.createElement(t.Provider,{value:d.useMemo(()=>({descendants:s,registerDescendant:l}),[s,l])},a)}function Gi(t,a){let{descendants:s}=d.useContext(t),{callback:r,currentIndex:l,filter:n,key:i="index",orientation:c="vertical",rotate:o=!0,rtl:m=!1}=a;return function(x){if(!["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(x.key))return;let f=l??-1,b=n?s.filter(n):s;if(!b.length)return;let N=b.findIndex(S=>S.index===l);function p(){return f===j().index?o?g():b[N]:b[(N+1)%b.length]}function h(){return f===g().index?o?j():b[N]:b[(N-1+b.length)%b.length]}function g(){return b[0]}function j(){return b[b.length-1]}switch(x.key){case"ArrowDown":if(c==="vertical"||c==="both"){x.preventDefault();let E=p();r(i==="option"?E:E[i])}break;case"ArrowUp":if(c==="vertical"||c==="both"){x.preventDefault();let E=h();r(i==="option"?E:E[i])}break;case"ArrowLeft":if(c==="horizontal"||c==="both"){x.preventDefault();let E=(m?p:h)();r(i==="option"?E:E[i])}break;case"ArrowRight":if(c==="horizontal"||c==="both"){x.preventDefault();let E=(m?h:p)();r(i==="option"?E:E[i])}break;case"PageUp":x.preventDefault();let S=(x.ctrlKey?h:g)();r(i==="option"?S:S[i]);break;case"Home":x.preventDefault();let M=g();r(i==="option"?M:M[i]);break;case"PageDown":x.preventDefault();let _=(x.ctrlKey?p:j)();r(i==="option"?_:_[i]);break;case"End":x.preventDefault();let P=j();r(i==="option"?P:P[i]);break}}}function hr(t,a){return!!(a.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING)}function Vi(t,a){if(!a||!t.length)return-1;let s=t.length;for(;s--;){let r=t[s].element;if(r&&hr(r,a))return s+1}return-1}function Ns(t,a,s){return s==null||!(s in t)?[...t,a]:[...t.slice(0,s),a,...t.slice(s)]}function Hi(t){return t.sort((a,s)=>!a.element||!s.element?0:hr(a.element,s.element)?-1:1).map((a,s)=>({...a,index:s}))}var Bt=!1,Xi=0;function js(){return++Xi}var vs=Cr["useId".toString()];function Zi(t){if(vs!==void 0){let l=vs();return t??l}let a=t??(Bt?js():null),[s,r]=d.useState(a);return ts(()=>{s===null&&r(js())},[]),d.useEffect(()=>{Bt===!1&&(Bt=!0)},[]),t??s??void 0}var Mt=dr("TabsDescendantsContext"),pr=dr("TabPanelDescendantsContext"),[Yi,ss]=Ui("Tabs"),gr=d.forwardRef(({as:t="div",children:a,defaultIndex:s,orientation:r="horizontal",index:l=void 0,keyboardActivation:n="auto",onChange:i,readOnly:c=!1,...o},m)=>{let{current:u}=d.useRef(l!==void 0),x=Zi(o.id||"tabs"),f=d.useRef(null),b=d.useRef(!1),[N,p]=Bi({controlledValue:l,defaultValue:s??0,calledFrom:"Tabs"}),[h,g]=d.useState(-1),[j,S]=ur(),M=d.useCallback(()=>{f.current&&yt(f.current.focus)&&f.current.focus()},[]),_=d.useCallback(E=>{i&&i(E),p(E)},[i,p]),P=d.useCallback(E=>{var C;let F=(C=j[E])==null?void 0:C.element,v=or(F);n==="auto"&&(i&&i(E),p(E)),F&&F!==v.activeElement&&yt(F.focus)&&F.focus()},[n,i,p,j]);return d.createElement(xr,{context:Mt,items:j,set:S},d.createElement(Yi,{focusedIndex:h,id:x,isControlled:u,isRTL:b,keyboardActivation:n,onFocusPanel:M,onSelectTab:c?kt:_,onSelectTabWithKeyboard:c?kt:P,orientation:r,selectedIndex:N,selectedPanelRef:f,setFocusedIndex:g,setSelectedIndex:p},d.createElement(t,{...o,ref:m,"data-reach-tabs":"","data-orientation":r,id:o.id},yt(a)?a({focusedIndex:h,id:x,selectedIndex:N}):a)))});gr.displayName="Tabs";var fr=d.forwardRef(({children:t,as:a="div",onKeyDown:s,...r},l)=>{let{focusedIndex:n,isControlled:i,isRTL:c,keyboardActivation:o,onSelectTabWithKeyboard:m,orientation:u,selectedIndex:x,setSelectedIndex:f}=ss("TabList"),b=$i(Mt),N=d.useRef(null),p=It(l,N);d.useEffect(()=>{N.current&&(N.current.ownerDocument&&N.current.ownerDocument.dir==="rtl"||Fi(N.current,"direction")==="rtl")&&(c.current=!0)},[c]);let h=Ht(s,Gi(Mt,{currentIndex:o==="manual"?n:x,orientation:u,rotate:!0,callback:m,filter:g=>!g.disabled,rtl:c.current}));return ts(()=>{var g;if(!i&&Wi((g=b[x])==null?void 0:g.disabled)){let j=b.find(S=>!S.disabled);j&&f(j.index)}},[b,i,x,f]),d.createElement(a,{role:"tablist","aria-orientation":u,...r,"data-reach-tab-list":"",ref:p,onKeyDown:h},t)});fr.displayName="TabList";var br=d.memo(fr);br.displayName="TabList";var $e=d.forwardRef(({isSelected:t,children:a,as:s="button",index:r,disabled:l,onBlur:n,onFocus:i,...c},o)=>{let{id:m,onSelectTab:u,orientation:x,selectedIndex:f,setFocusedIndex:b}=ss("Tab"),N=d.useRef(null),[p,h]=cr(N,null),g=It(o,h),j=d.useMemo(()=>({element:p,disabled:!!l}),[l,p]),S=mr(j,Mt,r),M=s==="button"&&c.type==null?"button":c.type,_=S===f;function P(){u(S)}return d.createElement(s,{"aria-controls":Pt(m,"panel",S),"aria-disabled":l,"aria-selected":_,role:"tab",tabIndex:_?0:-1,...c,ref:g,"data-reach-tab":"","data-orientation":x,"data-selected":_?"":void 0,disabled:l,id:Pt(m,"tab",S),onClick:P,onFocus:Ht(i,()=>{b(S)}),onBlur:Ht(n,()=>{b(-1)}),type:M},a)});$e.displayName="Tab";var yr=d.forwardRef(({children:t,as:a="div",...s},r)=>{let l=d.useRef(),n=It(l,r),[i,c]=ur();return d.createElement(xr,{context:pr,items:i,set:c},d.createElement(a,{...s,ref:n,"data-reach-tab-panels":""},t))});yr.displayName="TabPanels";var qi=d.memo(yr);qi.displayName="TabPanels";var Ge=d.forwardRef(({children:t,"aria-label":a,as:s="div",index:r,...l},n)=>{let{selectedPanelRef:i,selectedIndex:c,id:o}=ss("TabPanel"),m=d.useRef(null),[u,x]=cr(m,null),f=d.useMemo(()=>({element:u}),[u]),b=mr(f,pr,r),N=Pt(o,"panel",b),p=b===c,h=d.useRef(!1),g=h.current?!p:!1;d.useEffect(()=>{h.current=!0},[]);let j=It(n,x,p?i:null);return d.createElement(s,{"aria-labelledby":Pt(o,"tab",b),hidden:g,role:"tabpanel",tabIndex:p?0:-1,...l,ref:j,"data-reach-tab-panel":"",id:N},t)});Ge.displayName="TabPanel";function Wi(t){return t==="true"?!0:Ii(t)?t:!1}function Qi(){const{sendCommand:t}=At(),{updatePrintProgress:a}=Ue(),s=d.useRef({active:!1,paused:!1,linesSent:0,totalLines:0,buffer:[],waitingForResponse:!1,currentFileId:null}),r=d.useCallback(async()=>{const u=s.current;if(!(!u.active||u.paused||u.waitingForResponse))try{if(u.buffer.length===0){a(100),o();return}const x=u.buffer.shift();u.waitingForResponse=!0,await t(x),u.linesSent++;const f=u.linesSent/u.totalLines*100;a(f),setTimeout(()=>{u.waitingForResponse=!1,r()},50)}catch(x){throw console.error("Error streaming G-code:",x),o(),x}},[t,a]),l=d.useCallback(async(u,x)=>{if(s.current.active)throw new Error("Already streaming G-code");try{const f=x.split(`
`).map(b=>b.trim()).filter(b=>b&&!b.startsWith(";"));s.current={active:!0,paused:!1,linesSent:0,totalLines:f.length,buffer:f,waitingForResponse:!1,currentFileId:u},await r()}catch(f){throw o(),f}},[r]),n=d.useCallback(()=>{s.current.active&&(s.current.paused=!0)},[]),i=d.useCallback(()=>{s.current.active&&(s.current.paused=!1,r())},[r]),c=d.useCallback(()=>{s.current.active&&o()},[]),o=d.useCallback(()=>{s.current={active:!1,paused:!1,linesSent:0,totalLines:0,buffer:[],waitingForResponse:!1,currentFileId:null}},[]),m=d.useCallback(()=>{const{active:u,paused:x,linesSent:f,totalLines:b,currentFileId:N}=s.current;return{active:u,paused:x,progress:b?f/b*100:0,currentFileId:N}},[]);return{streamGcode:l,pauseStreaming:n,resumeStreaming:i,stopStreaming:c,getStreamingStatus:m}}const Ki=()=>{var C;const{gcodeFiles:t,printQueue:a,activePrint:s,removeFromQueue:r,updateQueueOrder:l,startPrint:n,pausePrint:i,resumePrint:c,stopPrint:o,completePrint:m}=Ue(),{status:u}=At(),{streamGcode:x,pauseStreaming:f,resumeStreaming:b,stopStreaming:N,getStreamingStatus:p}=Qi(),h=d.useCallback(async y=>{if(u!=="connected"){alert("Please connect to the printer first");return}const w=t.find(k=>k.id===y);if(w)try{n(y),await x(y,w.content)}catch(k){console.error("Failed to start print:",k),o()}},[u,t,n,x,o]),g=d.useCallback(()=>{i(),f()},[i,f]),j=d.useCallback(()=>{c(),b()},[c,b]),S=d.useCallback(()=>{o(),N()},[o,N]);d.useEffect(()=>{const w=setInterval(()=>{const k=p();k.active&&s&&k.progress>=100&&m()},1e3);return()=>clearInterval(w)},[s,m,p]);const M=(y,w)=>{y.dataTransfer.setData("text/plain",w)},_=y=>{y.preventDefault()},P=d.useCallback((y,w)=>{y.preventDefault();const k=y.dataTransfer.getData("text/plain"),H=a.map(ne=>ne.fileId),K=H.indexOf(k),z=H.indexOf(w);if(K===-1||z===-1)return;const Z=[...H];Z.splice(K,1),Z.splice(z,0,k),l(Z)},[a,l]),E=y=>y?new Date(y).toLocaleTimeString():"",F=y=>{if(!y)return"Unknown";const w=Math.floor(y/3600),k=Math.floor(y%3600/60);return`${w}h ${k}m`},v=y=>{switch(y){case"printing":return"text-green-500";case"paused":return"text-yellow-500";case"completed":return"text-blue-500";case"failed":return"text-red-500";default:return"text-gray-500"}};return e.jsxs("div",{className:"w-full space-y-4",children:[s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Currently Printing"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:(C=t.find(y=>y.id===s.fileId))==null?void 0:C.name}),e.jsx("span",{className:v(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${s.progress}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:["Started: ",E(s.startTime)]}),e.jsxs("span",{children:["Est. completion: ",E(s.estimatedEndTime)]})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[s.status==="printing"?e.jsx("button",{onClick:g,className:"px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600",children:"Pause"}):e.jsx("button",{onClick:j,className:"px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600",children:"Resume"}),e.jsx("button",{onClick:S,className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"Stop"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Print Queue"})}),e.jsxs("div",{className:"divide-y",children:[a.map(y=>{const w=t.find(k=>k.id===y.fileId);return w?e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",draggable:!0,onDragStart:k=>M(k,y.fileId),onDragOver:_,onDrop:k=>P(k,y.fileId),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium",children:w.name}),e.jsx("span",{className:`ml-2 text-sm ${v(y.status)}`,children:y.status})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("span",{children:["Size: ",(w.size/1024/1024).toFixed(2)," MB"]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:["Est. time: ",F(w.estimatedPrintTime)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[y.status==="queued"&&!s&&e.jsx("button",{onClick:()=>h(y.fileId),disabled:u!=="connected",className:`p-2 ${u==="connected"?"text-green-500 hover:bg-green-50":"text-gray-400 cursor-not-allowed"} rounded`,children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})}),e.jsx("button",{onClick:()=>r(y.fileId),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},y.fileId):null}),a.length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No files in queue"})]})]})]})},Ji=()=>{const t=Cs(),a=qr(),{addFolder:s,updateFolder:r,deleteFolder:l}=Wr(),[n,i]=d.useState(""),[c,o]=d.useState(new Set),[m,u]=d.useState(null),[x,f]=d.useState(!1),[b,N]=d.useState(""),[p,h]=d.useState("name"),[g,j]=d.useState("asc"),[S,M]=d.useState([]),_=d.useMemo(()=>{const y=new Set;return t.forEach(w=>{var k;(k=w.tags)==null||k.forEach(H=>y.add(H))}),Array.from(y)},[t]),P=d.useMemo(()=>t.filter(y=>m&&y.folder!==m||n&&!y.name.toLowerCase().includes(n.toLowerCase())?!1:S.length>0?S.every(w=>{var k;return(k=y.tags)==null?void 0:k.includes(w)}):!0).sort((y,w)=>{let k=0;switch(p){case"name":k=y.name.localeCompare(w.name);break;case"date":k=new Date(w.uploadDate)-new Date(y.uploadDate);break;case"size":k=y.size-w.size;break;default:k=0}return g==="asc"?k:-k}),[t,m,n,S,p,g]),E=d.useMemo(()=>{const y=[];let w=m;for(;w;){const k=a.find(H=>H.id===w);if(k)y.unshift(k),w=k.parentId;else break}return y},[m,a]),F=()=>{b.trim()&&(s(b.trim(),m),N(""),f(!1))},v=y=>{},C=y=>y<1024?`${y} B`:y<1024*1024?`${(y/1024).toFixed(1)} KB`:`${(y/(1024*1024)).toFixed(1)} MB`;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search files...",value:n,onChange:y=>i(y.target.value),className:"w-full p-2 border rounded"})}),e.jsx("div",{className:"relative",children:e.jsx("select",{multiple:!0,value:S,onChange:y=>{const w=Array.from(y.target.selectedOptions,k=>k.value);M(w)},className:"p-2 border rounded",children:_.map(y=>e.jsx("option",{value:y,children:y},y))})}),e.jsxs("select",{value:p,onChange:y=>h(y.target.value),className:"p-2 border rounded",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"size",children:"Size"})]}),e.jsx("button",{onClick:()=>j(y=>y==="asc"?"desc":"asc"),className:"p-2 text-gray-500 hover:text-gray-700",children:g==="asc"?"↑":"↓"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"New Folder"})})]})}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("button",{onClick:()=>u(null),className:"text-blue-500 hover:text-blue-600",children:"Root"}),E.map((y,w)=>e.jsxs(_e.Fragment,{children:[e.jsx("span",{children:"/"}),e.jsx("button",{onClick:()=>u(y.id),className:"text-blue-500 hover:text-blue-600",children:y.name})]},y.id))]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:c.size===P.length,onChange:y=>{y.target.checked?o(new Set(P.map(w=>w.id))):o(new Set)},className:"rounded"}),e.jsxs("span",{className:"font-medium",children:[c.size," selected"]})]}),c.size>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>v(),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded",children:"Move"}),e.jsx("button",{onClick:()=>v(),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded",children:"Tag"}),e.jsx("button",{onClick:()=>v(),className:"px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded",children:"Add to Queue"}),e.jsx("button",{onClick:()=>v(),className:"px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded",children:"Delete"})]})]})}),e.jsxs("div",{className:"divide-y",children:[a.filter(y=>y.parentId===m).map(y=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),e.jsx("button",{onClick:()=>u(y.id),className:"font-medium hover:text-blue-500",children:y.name})]}),e.jsx("button",{onClick:()=>l(y.id),className:"text-red-500 hover:text-red-600",children:"Delete"})]},y.id)),P.map(y=>{var w;return e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:c.has(y.id),onChange:k=>{const H=new Set(c);k.target.checked?H.add(y.id):H.delete(y.id),o(H)},className:"rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:y.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[C(y.size)," • ",new Date(y.uploadDate).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(w=y.tags)==null?void 0:w.map(k=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:k},k))})]})},y.id)}),P.length===0&&a.filter(y=>y.parentId===m).length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No files or folders found"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New Folder"}),e.jsx("input",{type:"text",value:b,onChange:y=>N(y.target.value),placeholder:"Folder name",className:"w-full p-2 border rounded mb-4"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Create"})]})]})})]})},ws=128,mt=32,el=3,tl=1e4;function sl(){const{sendCommand:t,status:a,temperatures:s,log:r}=At(),{activePrint:l,updatePrintProgress:n,pausePrint:i,resumePrint:c,completePrint:o,stopPrint:m,getFile:u}=Ue(),[x,f]=d.useState({position:{x:0,y:0,z:0,e:0},bufferSpace:ws,isPrinting:!1,isPaused:!1,isEmergencyStopped:!1,currentLine:0,lastResponse:"",retryCount:0,lastError:null}),b=d.useRef([]),N=d.useRef(null),p=d.useRef(null),h=d.useCallback(v=>{const C=v.match(/X:(-?\d+\.?\d*) Y:(-?\d+\.?\d*) Z:(-?\d+\.?\d*) E:(-?\d+\.?\d*)/);return C?{x:parseFloat(C[1]),y:parseFloat(C[2]),z:parseFloat(C[3]),e:parseFloat(C[4])}:null},[]),g=d.useCallback(v=>{if(N.current&&(clearTimeout(N.current),N.current=null),v.includes("ok")?(f(C=>({...C,bufferSpace:C.bufferSpace+mt,lastResponse:v,retryCount:0,lastError:null})),S()):v.includes("Error")&&j(v),v.includes("X:")){const C=h(v);C&&f(y=>({...y,position:C}))}},[h]),j=d.useCallback(v=>{f(C=>{const y=C.retryCount+1;return y>=el?(E(`Max retries exceeded: ${v}`),{...C,lastError:v,isPrinting:!1,retryCount:0}):{...C,lastError:v,retryCount:y,bufferSpace:C.bufferSpace+mt}})},[]),S=d.useCallback(async()=>{if(!(!x.isPrinting||x.isPaused||x.isEmergencyStopped)){if(b.current.length===0){o(),f(v=>({...v,isPrinting:!1,currentLine:0}));return}if(!(x.bufferSpace<mt))try{const v=b.current[0];if(await t(v),N.current=setTimeout(()=>{j("Command timeout")},tl),f(C=>({...C,bufferSpace:C.bufferSpace-mt,currentLine:C.currentLine+1})),b.current.shift(),l){const C=x.currentLine/b.current.length*100;n(C)}}catch(v){j(v.message)}}},[l,x.bufferSpace,x.currentLine,x.isEmergencyStopped,x.isPaused,x.isPrinting,t,n,o]),M=d.useCallback(async v=>{const C=u(v);if(C)try{await t("M110 N0"),await t("M155 S1"),await t("M114");const y=C.content.split(`
`).map(w=>w.trim()).filter(w=>w&&!w.startsWith(";"));b.current=y,f(w=>({...w,isPrinting:!0,isPaused:!1,isEmergencyStopped:!1,currentLine:0,bufferSpace:ws,lastError:null,retryCount:0})),S()}catch(y){console.error("Error starting print:",y),f(w=>({...w,lastError:y.message}))}},[u,S,t]),_=d.useCallback(async()=>{try{const v=await t("M114"),C=h(v);C&&(p.current=C),await t("G91"),await t("G1 E-3 F1800"),await t("G90"),await t("G1 Z5 F300"),await t("G1 X0 Y0 F3000"),f(y=>({...y,isPaused:!0})),i()}catch(v){console.error("Error pausing print:",v)}},[i,h,t]),P=d.useCallback(async()=>{if(p.current)try{await t("G90"),await t(`G1 Z${p.current.z+5} F300`),await t(`G1 X${p.current.x} Y${p.current.y} F3000`),await t(`G1 Z${p.current.z} F300`),await t("G91"),await t("G1 E3 F1800"),await t("G90"),f(v=>({...v,isPaused:!1})),c(),S()}catch(v){console.error("Error resuming print:",v)}},[S,c,t]),E=d.useCallback(async(v="Emergency stop triggered")=>{try{await t("M410"),await t("M112"),await t("M108"),b.current=[],f(C=>({...C,isPrinting:!1,isPaused:!1,isEmergencyStopped:!0,lastError:v})),m()}catch(C){console.error("Error during emergency stop:",C)}},[m,t]),F=d.useCallback(async v=>{try{await t(`M290 Z${v}`),await t("M114")}catch(C){console.error("Error adjusting Z offset:",C)}},[t]);return d.useEffect(()=>{if(r&&r.length>0){const v=r[r.length-1];(v==null?void 0:v.type)==="rx"&&g(v.message)}},[r,g]),d.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]),{printerState:x,startPrint:M,pausePrint:_,resumePrint:P,emergencyStop:E,adjustZOffset:F,temperatures:s}}const rl=()=>{var h,g,j,S,M,_,P,E;const{printerState:t,temperatures:a,pausePrint:s,resumePrint:r,emergencyStop:l,adjustZOffset:n}=sl(),i=zr(),c=$r(),o=Br().sendCommand,[m,u]=d.useState(null),[x,f]=d.useState(null),b=()=>{window.location.hash="#/control"};d.useEffect(()=>{i&&!m?u(new Date):i||u(null)},[i,m]),d.useEffect(()=>{if(!i||!m){f(null);return}const F=c(i.fileId);if(!(F!=null&&F.estimatedPrintTime))return;const v=(new Date-m)/1e3,C=Math.max(0,F.estimatedPrintTime-v);f(C);const y=setInterval(()=>{const w=(new Date-m)/1e3,k=Math.max(0,F.estimatedPrintTime-w);f(k)},1e3);return()=>clearInterval(y)},[i,m,c]);const N=F=>{if(!F)return"--:--:--";const v=Math.floor(F/3600),C=Math.floor(F%3600/60),y=Math.floor(F%60);return`${v.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}:${y.toString().padStart(2,"0")}`};if(!i)return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Print Monitor"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Control Panel"})]}),e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx("p",{className:"text-lg mb-2",children:"No active print"}),e.jsx("p",{className:"text-sm",children:"Start a print from the control panel to monitor its progress here."})]})]});const p=c(i.fileId);return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Print Monitor"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Back to Control Panel"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-black rounded-lg shadow-lg",children:e.jsx(ze,{content:p==null?void 0:p.content,width:"100%",height:400,currentPosition:t.position,highlightedLayer:Math.floor(i.progress*(p==null?void 0:p.layerCount)||0)})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Print Controls"}),e.jsxs("div",{className:"flex space-x-2",children:[t.isPaused?e.jsx("button",{onClick:r,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Resume Print"}):e.jsx("button",{onClick:s,className:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600",children:"Pause Print"}),e.jsx("button",{onClick:()=>l(),className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Emergency Stop"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Z Offset Adjustment"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>n(-.1),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"-0.1mm"}),e.jsx("button",{onClick:()=>n(-.05),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"-0.05mm"}),e.jsx("button",{onClick:()=>n(.05),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"+0.05mm"}),e.jsx("button",{onClick:()=>n(.1),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"+0.1mm"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Print Progress"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 mb-1",children:[e.jsxs("span",{children:[Math.round(i.progress),"%"]}),e.jsxs("span",{children:["Layer ",Math.floor(i.progress*(p==null?void 0:p.layerCount)||0)," / ",p==null?void 0:p.layerCount]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${i.progress}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Elapsed Time"}),e.jsx("p",{className:"font-medium",children:m?N((new Date-m)/1e3):"--:--:--"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Remaining Time"}),e.jsx("p",{className:"font-medium",children:N(x)})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Temperatures"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hotend"}),e.jsxs("span",{className:"text-sm font-medium",children:[(h=a.hotend)==null?void 0:h.current,"°C / ",(g=a.hotend)==null?void 0:g.target,"°C"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500 transition-all duration-300",style:{width:`${((j=a.hotend)==null?void 0:j.current)/Math.max((S=a.hotend)==null?void 0:S.target,250)*100}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bed"}),e.jsxs("span",{className:"text-sm font-medium",children:[(M=a.bed)==null?void 0:M.current,"°C / ",(_=a.bed)==null?void 0:_.target,"°C"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 transition-all duration-300",style:{width:`${((P=a.bed)==null?void 0:P.current)/Math.max((E=a.bed)==null?void 0:E.target,100)*100}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Position"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"X"}),e.jsxs("p",{className:"font-medium",children:[t.position.x.toFixed(2),"mm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Y"}),e.jsxs("p",{className:"font-medium",children:[t.position.y.toFixed(2),"mm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Z"}),e.jsxs("p",{className:"font-medium",children:[t.position.z.toFixed(2),"mm"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"E"}),e.jsxs("p",{className:"font-medium",children:[t.position.e.toFixed(2),"mm"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Bed Leveling"}),e.jsx("button",{onClick:()=>o("M503"),className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"Refresh"})]}),e.jsx(Zs,{})]}),t.lastError&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-600 font-semibold mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:t.lastError})]})]})]})]})},al=_e.memo(function({series:a,width:s=600,height:r=120}){const l=d.useRef(null);return d.useEffect(()=>{const n=l.current;if(!n)return;const i=n.getContext("2d"),c=n.width,o=n.height;if(i.clearRect(0,0,c,o),a.length===0)return;const m=a.map(E=>E.hotend||0),u=a.map(E=>E.bed||0),x=a.map(E=>E.targetHotend||0),f=a.map(E=>E.targetBed||0),b=[...m,...u,...x,...f],N=Math.min(0,...b),p=Math.max(Math.ceil((Math.max(...b)+10)/10)*10,100),h={left:40,right:10,top:10,bottom:20},g=c-h.left-h.right,j=o-h.top-h.bottom,S=E=>h.left+E/Math.max(1,a.length-1)*g,M=E=>h.top+j-(E-N)/Math.max(1,p-N)*j;i.strokeStyle="#e5e7eb",i.lineWidth=1,i.setLineDash([]),i.textAlign="right",i.textBaseline="middle",i.font="10px sans-serif";const _=Math.ceil((p-N)/5/10)*10;for(let E=Math.ceil(N/_)*_;E<=p;E+=_){const F=M(E);i.beginPath(),i.moveTo(h.left,F),i.lineTo(c-h.right,F),i.stroke(),i.fillStyle="#6b7280",i.fillText(E.toString()+"°C",h.left-5,F)}const P=(E,F,v=!1)=>{i.strokeStyle=F,i.lineWidth=2,i.setLineDash(v?[5,5]:[]),i.beginPath(),E.forEach((C,y)=>{const w=S(y),k=M(C);y===0?i.moveTo(w,k):i.lineTo(w,k)}),i.stroke(),v||(i.fillStyle=F,E.forEach((C,y)=>{const w=S(y),k=M(C);i.beginPath(),i.arc(w,k,3,0,Math.PI*2),i.fill()}))};P(x,"#ef4444",!0),P(f,"#3b82f6",!0),P(m,"#ef4444"),P(u,"#3b82f6")},[a,s,r]),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-2",children:[e.jsx("canvas",{ref:l,width:s,height:r,className:"w-full h-28"}),e.jsxs("div",{className:"text-xs text-gray-500 flex justify-between",children:[e.jsx("span",{children:"Hotend (red)"}),e.jsx("span",{children:"Bed (blue)"})]})]})},(t,a)=>{var r,l,n,i,c,o,m,u;if(t.series.length!==a.series.length||t.width!==a.width||t.height!==a.height)return!1;const s=t.series.length-1;return((r=t.series[s])==null?void 0:r.hotend)===((l=a.series[s])==null?void 0:l.hotend)&&((n=t.series[s])==null?void 0:n.bed)===((i=a.series[s])==null?void 0:i.bed)&&((c=t.series[s])==null?void 0:c.targetHotend)===((o=a.series[s])==null?void 0:o.targetHotend)&&((m=t.series[s])==null?void 0:m.targetBed)===((u=a.series[s])==null?void 0:u.targetBed)}),nl=()=>{const t=Ae.find(s=>s.id==="bed-leveling"),a=Ae.filter(s=>s.id!=="bed-leveling");return t?[t,...a]:Ae},De=nl(),Ss={hotendTemp:!0,bedTemp:!0,nozzleDiameter:!0,layerHeight:!0,printSpeed:!0,retractionDistance:!0,retractionSpeed:!0,primeSpeed:!0,flowRate:!0,wallThickness:!0,enableABL:!0,firstLayerSpeed:!0},Xt=()=>{var ee,oe,ie,pe;const t=window.location.hash==="#/bed-leveling",[a,s]=d.useState(()=>{if(t){const q=De.findIndex(ae=>ae.id==="bed-leveling");return q>=0?q:0}const L=sessionStorage.getItem("calibration_currentStepIndex");return L?parseInt(L):0}),[r,l]=d.useState(()=>sessionStorage.getItem("calibration_workflowState")||"idle"),[n,i]=d.useState(()=>sessionStorage.getItem("calibration_stepState")||"config"),[c,o]=d.useState({}),[m,u]=d.useState(()=>sessionStorage.getItem("calibration_generatedGcode")||""),[x,f]=d.useState(()=>sessionStorage.getItem("calibration_gcodeViewMode")||"3d"),[b,N]=d.useState(()=>{const L=sessionStorage.getItem("calibration_executionProgress");return L?JSON.parse(L):{sent:0,total:0}}),[p,h]=d.useState(()=>{const L=sessionStorage.getItem("calibration_stepResults");return L?JSON.parse(L):{}}),[g,j]=d.useState(()=>{const L=sessionStorage.getItem("calibration_workflowResults");return L?JSON.parse(L):{}}),[S,M]=d.useState(!1),[_,P]=d.useState({}),E=d.useRef(null),F=V(L=>L.status),v=V(L=>L.sendGcodeProgram),C=V(L=>L.temperatures);V(L=>L.position);const y=V(L=>L.activeExecution),w=V(L=>L.activePrinter),k=De[a],H=a===De.length-1,K=a===0;d.useEffect(()=>{sessionStorage.setItem("calibration_currentStepIndex",a.toString())},[a]),d.useEffect(()=>{sessionStorage.setItem("calibration_workflowState",r)},[r]),d.useEffect(()=>{sessionStorage.setItem("calibration_stepState",n)},[n]),d.useEffect(()=>{Object.keys(c).length>0&&sessionStorage.setItem("calibration_parameters",JSON.stringify(c))},[c]),d.useEffect(()=>{sessionStorage.setItem("calibration_generatedGcode",m)},[m]),d.useEffect(()=>{sessionStorage.setItem("calibration_executionProgress",JSON.stringify(b))},[b]),d.useEffect(()=>{sessionStorage.setItem("calibration_stepResults",JSON.stringify(p))},[p]),d.useEffect(()=>{sessionStorage.setItem("calibration_workflowResults",JSON.stringify(g))},[g]),d.useEffect(()=>{sessionStorage.setItem("calibration_gcodeViewMode",x)},[x]),d.useEffect(()=>{if(w!=null&&w.id){const L=Ze(w.id);P(L),console.log("Loaded globalThis parameters for display:",L)}},[w==null?void 0:w.id]),d.useEffect(()=>{k&&E.current!==k.id&&(w!=null&&w.id)&&(console.log("Initializing parameters for step:",k.id,"printer:",w.id,"current parameters:",c),(async()=>{var q,ae;try{const xe=sessionStorage.getItem("calibration_parameters");let ce={};if(xe)try{ce=JSON.parse(xe)}catch(we){console.warn("Failed to parse saved parameters:",we)}const he=Ze(w.id);console.log("Loaded globalThis parameters:",he);const Ee=await Ka(k.id),Pe={};(q=k.inputs)==null||q.forEach(we=>{Pe[we.key]=ce[we.key]||he[we.key]||Ee[we.key]||we.defaultValue||""}),k.inputs&&k.inputs.length>0&&(console.log("Setting initial parameters:",Pe),o(we=>Object.keys(we).length===0||E.current!==k.id?Pe:we),E.current=k.id)}catch(xe){console.error("Error loading parameters:",xe);const ce=Ze(w.id),he={};(ae=k.inputs)==null||ae.forEach(Ee=>{he[Ee.key]=ce[Ee.key]||Ee.defaultValue||""}),console.log("Setting fallback parameters:",he),o(he),E.current=k.id}})())},[a,w==null?void 0:w.id]),d.useEffect(()=>{k&&Object.keys(c).length>0&&z()},[c,a]);const z=async()=>{if(k)try{if(k.gcode){const L=await k.gcode(c);u(L)}}catch(L){console.error("Error generating G-code:",L),u("")}},Z=(L,q)=>{console.log("Parameter change:",L,"from",c[L],"to",q,"step:",k==null?void 0:k.id);let ae=q;if(q==="")ae="";else if(k.inputs){const xe=k.inputs.find(ce=>ce.key===L);(xe==null?void 0:xe.type)==="number"&&(ae=parseFloat(q)||0)}console.log("Processed value:",ae,"for key:",L),o(xe=>{const ce={...xe,[L]:ae};return console.log("Setting new parameters:",ce,"previous:",xe),w!=null&&w.id&&Object.keys(Ss).includes(L)&&(console.log("Updating globalThis parameter:",L,"to",ae),$t(w.id,k.id,{[L]:ae}),P(he=>({...he,[L]:ae}))),ce})},ne=async()=>{if(!S){alert("Please connect to your printer first");return}i("running"),l("running"),N({sent:0,total:0});try{const L=await v(m,{delayMs:100,waitForReady:!0,executionData:{stepName:k.name,stepId:k.id,workflowId:`calibration-${Date.now()}`},onProgress:(q,ae)=>{N({sent:q,total:ae})}});i("review"),h(q=>({...q,[k.id]:{parameters:{...c},gcode:m,executionResult:L,timestamp:Date.now()}}))}catch(L){console.error("Error executing G-code:",L),alert("Error executing G-code: "+L.message),i("config"),l("idle"),N({sent:0,total:0})}},je=V(L=>L.abortExecution),T=async()=>{if(confirm("Are you sure you want to abort the current calibration execution? This will send an emergency stop to the printer."))try{await je(),i("config"),l("idle"),N({sent:0,total:0})}catch(L){console.error("Failed to abort execution:",L),alert("Failed to abort execution: "+L.message)}},I=async()=>{i("completed");const L={...p[k.id],completed:!0,timestamp:Date.now(),success:!0};if(j(q=>({...q,[k.id]:L})),en(k.id,c,L),w!=null&&w.id&&($t(w.id,k.id,c),console.log("Updated globalThis parameters for printer:",w.id)),k.requiresSave)try{await Ja(k.id,c),await A()}catch(q){console.error("Error saving parameters:",q),alert("Error saving parameters: "+q.message)}},A=async()=>{try{const L=V.getState().sendCommand;await L("M500"),alert("Printer settings saved successfully")}catch(L){console.error("Error saving settings:",L),alert("Error saving settings: "+L.message)}},O=()=>{i("config"),h(L=>{const q={...L};return delete q[k.id],q})},X=()=>{H?l("completed"):(s(L=>L+1),i("config"))},$=()=>{K||(s(L=>L-1),i("config"))},se=()=>{s(0),l("idle"),i("config"),h({}),j({}),o({}),u(""),N({sent:0,total:0}),sessionStorage.removeItem("calibration_currentStepIndex"),sessionStorage.removeItem("calibration_workflowState"),sessionStorage.removeItem("calibration_stepState"),sessionStorage.removeItem("calibration_parameters"),sessionStorage.removeItem("calibration_generatedGcode"),sessionStorage.removeItem("calibration_executionProgress"),sessionStorage.removeItem("calibration_stepResults"),sessionStorage.removeItem("calibration_workflowResults")};d.useEffect(()=>{(()=>{if(r==="running"&&n==="running"){const q=sessionStorage.getItem("calibration_executionProgress");if(q){const ae=JSON.parse(q);ae.sent>0&&ae.sent<ae.total&&(confirm("Previous calibration execution was interrupted. Do you want to continue from where you left off?")?(i("running"),l("running")):(i("config"),l("idle"),N({sent:0,total:0})))}}})()},[]),d.useEffect(()=>{const L=q=>{if(r==="running"&&n==="running")return q.preventDefault(),q.returnValue="Calibration is currently running. Are you sure you want to leave?","Calibration is currently running. Are you sure you want to leave?"};return window.addEventListener("beforeunload",L),()=>window.removeEventListener("beforeunload",L)},[r,n]),d.useEffect(()=>{M(F==="connected")},[F]),d.useEffect(()=>{y&&y.status==="running"?n!=="running"&&(i("running"),l("running"),N(y.progress)):!y&&n==="running"&&(i("config"),l("idle"),N({sent:0,total:0}))},[y]);const J=L=>({"pid-tune":Re,"extruder-esteps":ht,"retraction-tuning":Ie,"first-layer":ye,"temperature-tower":Re,"flow-rate":ht,"calibration-cube":ht,"speed-calibration":Ie})[L]||ye,U=L=>{var q;return(q=g[L])!=null&&q.completed?"completed":p[L]?"review":a>De.findIndex(ae=>ae.id===L)?"pending":"current"},W=L=>({"pid-tune":["Check temperature stability - should be within ±1°C of target","Verify no temperature oscillations","Confirm heating time is reasonable"],"extruder-esteps":["Measure 100mm of filament with calipers","Check if measurement matches expected 100mm","Verify consistent extrusion throughout test"],"retraction-tuning":["Look for stringing between printed parts","Check for blobs or zits on print surface","Verify clean retraction without under-extrusion"],"first-layer":["Check bed adhesion - no warping or lifting","Verify first layer height is consistent","Look for proper squish without over-squish"],"temperature-tower":["Examine each temperature section for quality","Look for best balance of strength and appearance","Check for layer adhesion issues"],"flow-rate":["Measure wall thickness with calipers","Check for over/under-extrusion patterns","Verify consistent wall thickness"],"calibration-cube":["Measure cube dimensions with calipers","Check for dimensional accuracy (should be 20mm)","Look for layer consistency and surface quality"],"speed-calibration":["Check for ringing or ghosting at higher speeds","Look for missed steps or layer shifts","Verify print quality at different speeds"]})[L]||[];return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[r==="running"&&n==="running"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Calibration in Progress"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[k==null?void 0:k.name," - ",b.sent," / ",b.total," commands sent"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"⚠️ Do not navigate away or refresh the page during execution"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-mono text-blue-800",children:b.total>0?`${Math.round(b.sent/b.total*100)}%`:"0%"}),e.jsx("div",{className:"w-24 bg-blue-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${b.total>0?b.sent/b.total*100:0}%`}})}),e.jsx("button",{onClick:T,className:"mt-2 px-3 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200 text-xs",children:"Abort (Emergency Stop)"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"3D Printer Calibration Workflow"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${r==="idle"?"bg-gray-100 text-gray-800":r==="running"?"bg-blue-100 text-blue-800":r==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:[r==="idle"&&"Ready to Start",r==="running"&&"Running",r==="completed"&&"Completed",r==="paused"&&"Paused"]}),r==="running"&&n==="running"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Executing G-code..."})]}),e.jsx("button",{onClick:se,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Reset Workflow"})]})]}),e.jsx("div",{className:"flex items-center justify-between mb-6",children:De.map((L,q)=>{const ae=J(L.id),xe=U(L.id),ce=q===a;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${xe==="completed"?"bg-green-500 border-green-500 text-white":xe==="review"?"bg-yellow-500 border-yellow-500 text-white":ce?"bg-blue-500 border-blue-500 text-white":"bg-gray-100 border-gray-300 text-gray-500"}`,children:xe==="completed"?e.jsx(fe,{className:"w-5 h-5"}):e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium",children:L.name}),e.jsx("div",{className:"text-xs text-gray-500",children:xe==="completed"?"Completed":xe==="review"?"Review Results":ce?"Current":"Pending"})]}),q<De.length-1&&e.jsx(zt,{className:"w-4 h-4 text-gray-400 mx-4"})]},L.id)})})]}),k&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:k.name}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Step ",a+1," of ",De.length]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:k.description}),k.instructions&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Instructions:"}),e.jsx("ul",{className:"list-disc list-inside text-blue-800 space-y-1",children:k.instructions.map((L,q)=>e.jsx("li",{children:L},q))})]})]}),n==="config"&&e.jsxs("div",{className:"space-y-6",children:[k.inputs&&k.inputs.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.inputs.map(L=>{const q=Object.keys(Ss).includes(L.key);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[L.label,L.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"}),q&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Global"})]}),e.jsx("input",{type:L.type,value:c[L.key]??"",onChange:ae=>{console.log("Input change detected:",L.key,"value:",ae.target.value,"current parameters:",c),Z(L.key,ae.target.value)},min:L.min,max:L.max,step:L.step,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-colors ${q?"border-blue-300 focus:ring-blue-500 bg-blue-50":"border-gray-300 focus:ring-blue-500"}`,placeholder:L.placeholder,disabled:n!=="config",style:{backgroundColor:n!=="config"?"#f3f4f6":q?"#eff6ff":"white",cursor:n!=="config"?"not-allowed":"text"}},`${L.key}-${c[L.key]}`),L.description&&e.jsx("p",{className:"text-xs text-gray-500",children:L.description})]},L.key)})}),(w==null?void 0:w.id)&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Global Parameters for ",w.name||w.id]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:Object.entries(_).map(([L,q])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-blue-700 font-medium",children:[L,":"]}),e.jsx("span",{className:"text-blue-900 font-mono",children:q})]},L))}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"These parameters persist across all calibration steps and are saved per printer."})]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-700",children:"Generated G-code:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>f("text"),className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${x==="text"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"Text View"})]}),e.jsxs("button",{onClick:()=>{console.log("Switching to 3D view, current mode:",x),f("3d")},className:`px-3 py-1 rounded text-sm flex items-center space-x-1 ${x==="3d"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx(Ps,{className:"w-4 h-4"}),e.jsx("span",{children:"3D View"})]})]})]}),x==="text"?e.jsx("div",{className:"bg-gray-900 text-green-400 p-4 rounded font-mono text-sm max-h-40 overflow-y-auto",children:e.jsx("pre",{children:m})}):e.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:[console.log("Rendering 3D view, gcodeViewMode:",x,"generatedGcode length:",m==null?void 0:m.length),e.jsx(rr,{content:m,width:"100%",height:600,buildPlateSize:(w==null?void 0:w.bedSize)||{x:220,y:220}})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[n==="running"&&e.jsxs("button",{onClick:T,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Abort (Emergency Stop)"]}),e.jsxs("button",{onClick:ne,disabled:!S||!m,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Ls,{className:"w-4 h-4"}),"Start Calibration"]})]})]}),n==="running"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),"Executing G-code..."]}),e.jsxs("span",{className:"font-mono",children:[b.sent," / ",b.total," commands"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${b.total>0?b.sent/b.total*100:0}%`}})}),e.jsx("div",{className:"text-xs text-gray-600 text-center",children:b.total>0?`${Math.round(b.sent/b.total*100)}% complete`:"Preparing..."})]}),e.jsxs("div",{className:"bg-gray-50 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Temperature Monitoring"}),e.jsx(al,{series:[]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsxs("span",{children:["Hotend: ",((ee=C==null?void 0:C.hotend)==null?void 0:ee.current)||0,"°C / ",((oe=C==null?void 0:C.hotend)==null?void 0:oe.target)||0,"°C"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsxs("span",{children:["Bed: ",((ie=C==null?void 0:C.bed)==null?void 0:ie.current)||0,"°C / ",((pe=C==null?void 0:C.bed)==null?void 0:pe.target)||0,"°C"]})]})]})]}),n==="review"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-4",children:[e.jsxs("h3",{className:"font-medium text-yellow-900 mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Review Results"]}),e.jsx("p",{className:"text-yellow-800 mb-3",children:"Please check the following items after the calibration has completed:"}),e.jsx("ul",{className:"list-disc list-inside text-yellow-800 space-y-1",children:W(k.id).map((L,q)=>e.jsx("li",{children:L},q))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:O,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4"}),"Redo with New Parameters"]}),e.jsxs("button",{onClick:I,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),"Complete Step"]})]})]}),n==="completed"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:[e.jsxs("h3",{className:"font-medium text-green-900 mb-2 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Step Completed"]}),e.jsx("p",{className:"text-green-800",children:"This calibration step has been completed successfully. You can proceed to the next step."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:$,disabled:K,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Wt,{className:"w-4 h-4"}),"Previous Step"]}),e.jsxs("button",{onClick:X,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2",children:[H?"Finish Workflow":"Next Step",e.jsx(zt,{className:"w-4 h-4"})]})]})]})]}),k&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Parameter History"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{if(Xe(k.id).length>0){const q=tn(k.id);o(ae=>({...ae,...q}))}},className:"px-3 py-1 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 text-sm",children:"Load Best Parameters"}),e.jsx("button",{onClick:rn,className:"px-3 py-1 bg-green-100 text-green-800 rounded hover:bg-green-200 text-sm",children:"Export History"}),e.jsx("button",{onClick:()=>{confirm("Clear parameter history for this step?")&&(sn(k.id),o(wt(k.id)))},className:"px-3 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200 text-sm",children:"Clear History"})]})]}),e.jsx("div",{className:"space-y-2",children:Xe(k.id).length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No parameter history for this step yet."}):e.jsx("div",{className:"space-y-2",children:Xe(k.id).slice(-5).reverse().map((L,q)=>{var ae,xe;return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(L.timestamp).toLocaleString()}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${(ae=L.result)!=null&&ae.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:(xe=L.result)!=null&&xe.success?"Success":"Failed"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:Object.entries(L.parameters).map(([ce,he])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:[ce,":"]}),e.jsx("span",{className:"font-mono",children:he})]},ce))}),e.jsx("button",{onClick:()=>o(ce=>({...ce,...L.parameters})),className:"mt-2 px-2 py-1 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 text-xs",children:"Use These Parameters"})]},q)})})})]}),r==="completed"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Calibration Workflow Completed"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"All calibration steps have been completed. Your printer should now be properly calibrated."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(g).map(([L,q])=>{const ae=Ae.find(xe=>xe.id===L);return e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:[e.jsx("h3",{className:"font-medium text-green-900",children:ae==null?void 0:ae.name}),e.jsxs("p",{className:"text-sm text-green-800",children:["Completed at ",new Date(q.timestamp).toLocaleTimeString()]})]},L)})})]})]})]})},il=()=>{const t=Zr(),{addTemplate:a,updateTemplate:s,deleteTemplate:r}=Yr();Xr();const l=Cs(),[n,i]=d.useState(!1),[c,o]=d.useState(null),[m,u]=d.useState({name:"",description:"",parameters:[],defaultSettings:{},compatibleFiles:[]}),x=()=>{u(p=>({...p,parameters:[...p.parameters,{id:crypto.randomUUID(),name:"",type:"number",default:"",min:"",max:"",step:"1",unit:"",description:""}]}))},f=(p,h,g)=>{u(j=>({...j,parameters:j.parameters.map(S=>S.id===p?{...S,[h]:g}:S)}))},b=()=>{c?s(c.id,m):a(m),i(!1),o(null),u({name:"",description:"",parameters:[],defaultSettings:{},compatibleFiles:[]})},N=p=>{o(p)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Print Templates"}),e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"New Template"})]}),e.jsxs("div",{className:"divide-y",children:[t.map(p=>e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:p.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:p.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>N(p),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Use Template"}),e.jsx("button",{onClick:()=>{o(p),u({...p,parameters:[...p.parameters]}),i(!0)},className:"p-1 text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>r(p.id),className:"p-1 text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),p.parameters.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Parameters"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:p.parameters.map(h=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:h.name}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",h.type,h.unit&&` ${h.unit}`,h.min!==""&&`, min: ${h.min}`,h.max!==""&&`, max: ${h.max}`,")"]}),h.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:h.description})]},h.id))})]}),p.compatibleFiles.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Compatible Files"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.compatibleFiles.map(h=>{const g=l.find(j=>j.id===h);return g?e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded",children:g.name},h):null})})]})]},p.id)),t.length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No templates found"})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:c?"Edit Template":"New Template"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name"}),e.jsx("input",{type:"text",value:m.name,onChange:p=>u(h=>({...h,name:p.target.value})),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:m.description,onChange:p=>u(h=>({...h,description:p.target.value})),rows:3,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Parameters"}),e.jsx("button",{onClick:x,className:"text-blue-500 hover:text-blue-600",children:"+ Add Parameter"})]}),e.jsx("div",{className:"space-y-4",children:m.parameters.map(p=>e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 border rounded",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:p.name,onChange:h=>f(p.id,"name",h.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Type"}),e.jsxs("select",{value:p.type,onChange:h=>f(p.id,"type",h.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"boolean",children:"Boolean"}),e.jsx("option",{value:"select",children:"Select"})]})]}),p.type==="number"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Min"}),e.jsx("input",{type:"number",value:p.min,onChange:h=>f(p.id,"min",h.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Max"}),e.jsx("input",{type:"number",value:p.max,onChange:h=>f(p.id,"max",h.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Step"}),e.jsx("input",{type:"number",value:p.step,onChange:h=>f(p.id,"step",h.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Unit"}),e.jsx("input",{type:"text",value:p.unit,onChange:h=>f(p.id,"unit",h.target.value),className:"w-full p-2 border rounded"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:p.description,onChange:h=>f(p.id,"description",h.target.value),className:"w-full p-2 border rounded"})]})]},p.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compatible Files"}),e.jsx("select",{multiple:!0,value:m.compatibleFiles,onChange:p=>{const h=Array.from(p.target.selectedOptions,g=>g.value);u(g=>({...g,compatibleFiles:h}))},className:"w-full p-2 border rounded",size:5,children:l.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>{i(!1),o(null),u({name:"",description:"",parameters:[],defaultSettings:{},compatibleFiles:[]})},className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Save Template"})]})]})]})})]})},ll=()=>{const[t,a]=d.useState(null);return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Kt,{className:"h-8 w-8 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"3D Printer Suite"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx(Jt,{})})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs(gr,{className:"space-y-6",children:[e.jsxs(br,{className:"flex space-x-4 border-b border-gray-200",children:[e.jsx($e,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Print Monitor"}),e.jsx($e,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"File Management"}),e.jsx($e,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Queue"}),e.jsx($e,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Calibration"}),e.jsx($e,{className:"px-4 py-2 text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300",children:"Templates"})]}),e.jsx(Ge,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(rl,{})}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"3D Preview"}),e.jsx(ze,{content:t.content,width:"100%",height:400})]})})]})}),e.jsx(Ge,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(Ji,{onFileSelect:a})}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"File Preview"}),e.jsx(ze,{content:t.content,width:"100%",height:400})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"File Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",t.name]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",(t.size/1024).toFixed(2)," KB"]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Uploaded:"})," ",new Date(t.uploadDate).toLocaleString()]})]})]})]})})]})}),e.jsx(Ge,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ki,{}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Queue Preview"}),e.jsx(ze,{content:t.content,width:"100%",height:400})]})})]})}),e.jsx(Ge,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Xt,{}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Calibration Preview"}),e.jsx(ze,{content:t.content,width:"100%",height:400})]})})]})}),e.jsx(Ge,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(il,{}),e.jsx("div",{className:"space-y-6",children:t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Template Preview"}),e.jsx(ze,{content:t.content,width:"100%",height:400})]})})]})})]})})]})},ol=()=>{const t=V(o=>o.activeExecution),a=V(o=>o.abortExecution);if(!t||t.status!=="running")return null;const{stepName:s,progress:r,startTime:l}=t,n=r.total>0?Math.round(r.sent/r.total*100):0,i=Math.round((Date.now()-l)/1e3),c=async()=>{if(confirm("Are you sure you want to abort the current calibration execution? This will send an emergency stop to the printer."))try{await a()}catch(o){console.error("Failed to abort execution:",o),alert("Failed to abort execution: "+o.message)}};return e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-blue-50 border border-blue-200 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsx("h3",{className:"font-medium text-blue-900",children:"Calibration Running"})]}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-red-100 rounded text-red-600 hover:text-red-700",title:"Abort execution (Emergency Stop)",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"text-xs text-blue-600",children:[r.sent," / ",r.total," commands • ",i,"s elapsed"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})}),e.jsxs("div",{className:"text-xs text-blue-600 text-center",children:[n,"% complete"]})]}),e.jsx("div",{className:"mt-3 text-xs text-blue-600 bg-blue-100 rounded p-2",children:"💡 You can navigate to other tabs while this runs. Progress will be tracked globally."})]})},cl=()=>{const[t,a]=d.useState(window.location.hash.slice(1)||"/");return d.useEffect(()=>{const r=()=>{a(window.location.hash.slice(1)||"/")};return window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r)},[]),{route:t,navigate:r=>{window.location.hash=r}}};function dl(){const{route:t,navigate:a}=cl();_s();const s=Ts();d.useEffect(()=>{console.log("🚀 3D Printer Suite App initialized with globalThis store access")},[]);const r=m=>{s(m),a(`/printer/${m}`)},l=()=>{s(null),a("/")},[n,i,c]=t.split("/"),o=()=>{switch(i){case"printer":if(c)return e.jsx(Ai,{onBackToDashboard:l});break;case"control":return e.jsx(ll,{});case"calibration":return e.jsx(Xt,{});case"bed-leveling":return e.jsx(Xt,{});default:return e.jsx(Da,{onPrinterSelect:r})}};return e.jsxs(Ia,{children:[o(),e.jsx(ol,{})]})}Tr.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(dl,{})}));
